(function(){const _n=document.createElement("link").relList;if(_n&&_n.supports&&_n.supports("modulepreload"))return;for(const Ot of document.querySelectorAll('link[rel="modulepreload"]'))Ce(Ot);new MutationObserver(Ot=>{for(const li of Ot)if(li.type==="childList")for(const F of li.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&Ce(F)}).observe(document,{childList:!0,subtree:!0});function Wt(Ot){const li={};return Ot.integrity&&(li.integrity=Ot.integrity),Ot.referrerPolicy&&(li.referrerPolicy=Ot.referrerPolicy),Ot.crossOrigin==="use-credentials"?li.credentials="include":Ot.crossOrigin==="anonymous"?li.credentials="omit":li.credentials="same-origin",li}function Ce(Ot){if(Ot.ep)return;Ot.ep=!0;const li=Wt(Ot);fetch(Ot.href,li)}})();function Tp(st){return st&&st.__esModule&&Object.prototype.hasOwnProperty.call(st,"default")?st.default:st}var ip={exports:{}},hf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var up;function Sp(){if(up)return hf;up=1;var st=Symbol.for("react.transitional.element"),_n=Symbol.for("react.fragment");function Wt(Ce,Ot,li){var F=null;if(li!==void 0&&(F=""+li),Ot.key!==void 0&&(F=""+Ot.key),"key"in Ot){li={};for(var d in Ot)d!=="key"&&(li[d]=Ot[d])}else li=Ot;return Ot=li.ref,{$$typeof:st,type:Ce,key:F,ref:Ot!==void 0?Ot:null,props:li}}return hf.Fragment=_n,hf.jsx=Wt,hf.jsxs=Wt,hf}var hp;function Mp(){return hp||(hp=1,ip.exports=Sp()),ip.exports}var lp=Mp(),np={exports:{}},$t={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dp;function Ep(){if(dp)return $t;dp=1;var st=Symbol.for("react.transitional.element"),_n=Symbol.for("react.portal"),Wt=Symbol.for("react.fragment"),Ce=Symbol.for("react.strict_mode"),Ot=Symbol.for("react.profiler"),li=Symbol.for("react.consumer"),F=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),ot=Symbol.for("react.suspense"),Ve=Symbol.for("react.memo"),Ft=Symbol.for("react.lazy"),ai=Symbol.iterator;function ut(ue){return ue===null||typeof ue!="object"?null:(ue=ai&&ue[ai]||ue["@@iterator"],typeof ue=="function"?ue:null)}var xe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},at=Object.assign,Rn={};function gn(ue,Xe,vt){this.props=ue,this.context=Xe,this.refs=Rn,this.updater=vt||xe}gn.prototype.isReactComponent={},gn.prototype.setState=function(ue,Xe){if(typeof ue!="object"&&typeof ue!="function"&&ue!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ue,Xe,"setState")},gn.prototype.forceUpdate=function(ue){this.updater.enqueueForceUpdate(this,ue,"forceUpdate")};function la(){}la.prototype=gn.prototype;function an(ue,Xe,vt){this.props=ue,this.context=Xe,this.refs=Rn,this.updater=vt||xe}var ca=an.prototype=new la;ca.constructor=an,at(ca,gn.prototype),ca.isPureReactComponent=!0;var Ki=Array.isArray,Vt={H:null,A:null,T:null,S:null},Xt=Object.prototype.hasOwnProperty;function ri(ue,Xe,vt,mt,We,Ct){return vt=Ct.ref,{$$typeof:st,type:ue,key:Xe,ref:vt!==void 0?vt:null,props:Ct}}function pi(ue,Xe){return ri(ue.type,Xe,void 0,void 0,void 0,ue.props)}function Mt(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===st}function ti(ue){var Xe={"=":"=0",":":"=2"};return"$"+ue.replace(/[=:]/g,function(vt){return Xe[vt]})}var En=/\/+/g;function qn(ue,Xe){return typeof ue=="object"&&ue!==null&&ue.key!=null?ti(""+ue.key):Xe.toString(36)}function rn(){}function ki(ue){switch(ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason;default:switch(typeof ue.status=="string"?ue.then(rn,rn):(ue.status="pending",ue.then(function(Xe){ue.status==="pending"&&(ue.status="fulfilled",ue.value=Xe)},function(Xe){ue.status==="pending"&&(ue.status="rejected",ue.reason=Xe)})),ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason}}throw ue}function kn(ue,Xe,vt,mt,We){var Ct=typeof ue;(Ct==="undefined"||Ct==="boolean")&&(ue=null);var kt=!1;if(ue===null)kt=!0;else switch(Ct){case"bigint":case"string":case"number":kt=!0;break;case"object":switch(ue.$$typeof){case st:case _n:kt=!0;break;case Ft:return kt=ue._init,kn(kt(ue._payload),Xe,vt,mt,We)}}if(kt)return We=We(ue),kt=mt===""?"."+qn(ue,0):mt,Ki(We)?(vt="",kt!=null&&(vt=kt.replace(En,"$&/")+"/"),kn(We,Xe,vt,"",function(oi){return oi})):We!=null&&(Mt(We)&&(We=pi(We,vt+(We.key==null||ue&&ue.key===We.key?"":(""+We.key).replace(En,"$&/")+"/")+kt)),Xe.push(We)),1;kt=0;var sn=mt===""?".":mt+":";if(Ki(ue))for(var Yt=0;Yt<ue.length;Yt++)mt=ue[Yt],Ct=sn+qn(mt,Yt),kt+=kn(mt,Xe,vt,Ct,We);else if(Yt=ut(ue),typeof Yt=="function")for(ue=Yt.call(ue),Yt=0;!(mt=ue.next()).done;)mt=mt.value,Ct=sn+qn(mt,Yt++),kt+=kn(mt,Xe,vt,Ct,We);else if(Ct==="object"){if(typeof ue.then=="function")return kn(ki(ue),Xe,vt,mt,We);throw Xe=String(ue),Error("Objects are not valid as a React child (found: "+(Xe==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":Xe)+"). If you meant to render a collection of children, use an array instead.")}return kt}function qe(ue,Xe,vt){if(ue==null)return ue;var mt=[],We=0;return kn(ue,mt,"","",function(Ct){return Xe.call(vt,Ct,We++)}),mt}function Pt(ue){if(ue._status===-1){var Xe=ue._result;Xe=Xe(),Xe.then(function(vt){(ue._status===0||ue._status===-1)&&(ue._status=1,ue._result=vt)},function(vt){(ue._status===0||ue._status===-1)&&(ue._status=2,ue._result=vt)}),ue._status===-1&&(ue._status=0,ue._result=Xe)}if(ue._status===1)return ue._result.default;throw ue._result}var Tt=typeof reportError=="function"?reportError:function(ue){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Xe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ue=="object"&&ue!==null&&typeof ue.message=="string"?String(ue.message):String(ue),error:ue});if(!window.dispatchEvent(Xe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ue);return}console.error(ue)};function si(){}return $t.Children={map:qe,forEach:function(ue,Xe,vt){qe(ue,function(){Xe.apply(this,arguments)},vt)},count:function(ue){var Xe=0;return qe(ue,function(){Xe++}),Xe},toArray:function(ue){return qe(ue,function(Xe){return Xe})||[]},only:function(ue){if(!Mt(ue))throw Error("React.Children.only expected to receive a single React element child.");return ue}},$t.Component=gn,$t.Fragment=Wt,$t.Profiler=Ot,$t.PureComponent=an,$t.StrictMode=Ce,$t.Suspense=ot,$t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Vt,$t.act=function(){throw Error("act(...) is not supported in production builds of React.")},$t.cache=function(ue){return function(){return ue.apply(null,arguments)}},$t.cloneElement=function(ue,Xe,vt){if(ue==null)throw Error("The argument must be a React element, but you passed "+ue+".");var mt=at({},ue.props),We=ue.key,Ct=void 0;if(Xe!=null)for(kt in Xe.ref!==void 0&&(Ct=void 0),Xe.key!==void 0&&(We=""+Xe.key),Xe)!Xt.call(Xe,kt)||kt==="key"||kt==="__self"||kt==="__source"||kt==="ref"&&Xe.ref===void 0||(mt[kt]=Xe[kt]);var kt=arguments.length-2;if(kt===1)mt.children=vt;else if(1<kt){for(var sn=Array(kt),Yt=0;Yt<kt;Yt++)sn[Yt]=arguments[Yt+2];mt.children=sn}return ri(ue.type,We,void 0,void 0,Ct,mt)},$t.createContext=function(ue){return ue={$$typeof:F,_currentValue:ue,_currentValue2:ue,_threadCount:0,Provider:null,Consumer:null},ue.Provider=ue,ue.Consumer={$$typeof:li,_context:ue},ue},$t.createElement=function(ue,Xe,vt){var mt,We={},Ct=null;if(Xe!=null)for(mt in Xe.key!==void 0&&(Ct=""+Xe.key),Xe)Xt.call(Xe,mt)&&mt!=="key"&&mt!=="__self"&&mt!=="__source"&&(We[mt]=Xe[mt]);var kt=arguments.length-2;if(kt===1)We.children=vt;else if(1<kt){for(var sn=Array(kt),Yt=0;Yt<kt;Yt++)sn[Yt]=arguments[Yt+2];We.children=sn}if(ue&&ue.defaultProps)for(mt in kt=ue.defaultProps,kt)We[mt]===void 0&&(We[mt]=kt[mt]);return ri(ue,Ct,void 0,void 0,null,We)},$t.createRef=function(){return{current:null}},$t.forwardRef=function(ue){return{$$typeof:d,render:ue}},$t.isValidElement=Mt,$t.lazy=function(ue){return{$$typeof:Ft,_payload:{_status:-1,_result:ue},_init:Pt}},$t.memo=function(ue,Xe){return{$$typeof:Ve,type:ue,compare:Xe===void 0?null:Xe}},$t.startTransition=function(ue){var Xe=Vt.T,vt={};Vt.T=vt;try{var mt=ue(),We=Vt.S;We!==null&&We(vt,mt),typeof mt=="object"&&mt!==null&&typeof mt.then=="function"&&mt.then(si,Tt)}catch(Ct){Tt(Ct)}finally{Vt.T=Xe}},$t.unstable_useCacheRefresh=function(){return Vt.H.useCacheRefresh()},$t.use=function(ue){return Vt.H.use(ue)},$t.useActionState=function(ue,Xe,vt){return Vt.H.useActionState(ue,Xe,vt)},$t.useCallback=function(ue,Xe){return Vt.H.useCallback(ue,Xe)},$t.useContext=function(ue){return Vt.H.useContext(ue)},$t.useDebugValue=function(){},$t.useDeferredValue=function(ue,Xe){return Vt.H.useDeferredValue(ue,Xe)},$t.useEffect=function(ue,Xe){return Vt.H.useEffect(ue,Xe)},$t.useId=function(){return Vt.H.useId()},$t.useImperativeHandle=function(ue,Xe,vt){return Vt.H.useImperativeHandle(ue,Xe,vt)},$t.useInsertionEffect=function(ue,Xe){return Vt.H.useInsertionEffect(ue,Xe)},$t.useLayoutEffect=function(ue,Xe){return Vt.H.useLayoutEffect(ue,Xe)},$t.useMemo=function(ue,Xe){return Vt.H.useMemo(ue,Xe)},$t.useOptimistic=function(ue,Xe){return Vt.H.useOptimistic(ue,Xe)},$t.useReducer=function(ue,Xe,vt){return Vt.H.useReducer(ue,Xe,vt)},$t.useRef=function(ue){return Vt.H.useRef(ue)},$t.useState=function(ue){return Vt.H.useState(ue)},$t.useSyncExternalStore=function(ue,Xe,vt){return Vt.H.useSyncExternalStore(ue,Xe,vt)},$t.useTransition=function(){return Vt.H.useTransition()},$t.version="19.0.0",$t}var fp;function cp(){return fp||(fp=1,np.exports=Ep()),np.exports}var ff=cp(),ap={exports:{}},df={},rp={exports:{}},sp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pp;function Cp(){return pp||(pp=1,function(st){function _n(qe,Pt){var Tt=qe.length;qe.push(Pt);e:for(;0<Tt;){var si=Tt-1>>>1,ue=qe[si];if(0<Ot(ue,Pt))qe[si]=Pt,qe[Tt]=ue,Tt=si;else break e}}function Wt(qe){return qe.length===0?null:qe[0]}function Ce(qe){if(qe.length===0)return null;var Pt=qe[0],Tt=qe.pop();if(Tt!==Pt){qe[0]=Tt;e:for(var si=0,ue=qe.length,Xe=ue>>>1;si<Xe;){var vt=2*(si+1)-1,mt=qe[vt],We=vt+1,Ct=qe[We];if(0>Ot(mt,Tt))We<ue&&0>Ot(Ct,mt)?(qe[si]=Ct,qe[We]=Tt,si=We):(qe[si]=mt,qe[vt]=Tt,si=vt);else if(We<ue&&0>Ot(Ct,Tt))qe[si]=Ct,qe[We]=Tt,si=We;else break e}}return Pt}function Ot(qe,Pt){var Tt=qe.sortIndex-Pt.sortIndex;return Tt!==0?Tt:qe.id-Pt.id}if(st.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var li=performance;st.unstable_now=function(){return li.now()}}else{var F=Date,d=F.now();st.unstable_now=function(){return F.now()-d}}var ot=[],Ve=[],Ft=1,ai=null,ut=3,xe=!1,at=!1,Rn=!1,gn=typeof setTimeout=="function"?setTimeout:null,la=typeof clearTimeout=="function"?clearTimeout:null,an=typeof setImmediate<"u"?setImmediate:null;function ca(qe){for(var Pt=Wt(Ve);Pt!==null;){if(Pt.callback===null)Ce(Ve);else if(Pt.startTime<=qe)Ce(Ve),Pt.sortIndex=Pt.expirationTime,_n(ot,Pt);else break;Pt=Wt(Ve)}}function Ki(qe){if(Rn=!1,ca(qe),!at)if(Wt(ot)!==null)at=!0,ki();else{var Pt=Wt(Ve);Pt!==null&&kn(Ki,Pt.startTime-qe)}}var Vt=!1,Xt=-1,ri=5,pi=-1;function Mt(){return!(st.unstable_now()-pi<ri)}function ti(){if(Vt){var qe=st.unstable_now();pi=qe;var Pt=!0;try{e:{at=!1,Rn&&(Rn=!1,la(Xt),Xt=-1),xe=!0;var Tt=ut;try{t:{for(ca(qe),ai=Wt(ot);ai!==null&&!(ai.expirationTime>qe&&Mt());){var si=ai.callback;if(typeof si=="function"){ai.callback=null,ut=ai.priorityLevel;var ue=si(ai.expirationTime<=qe);if(qe=st.unstable_now(),typeof ue=="function"){ai.callback=ue,ca(qe),Pt=!0;break t}ai===Wt(ot)&&Ce(ot),ca(qe)}else Ce(ot);ai=Wt(ot)}if(ai!==null)Pt=!0;else{var Xe=Wt(Ve);Xe!==null&&kn(Ki,Xe.startTime-qe),Pt=!1}}break e}finally{ai=null,ut=Tt,xe=!1}Pt=void 0}}finally{Pt?En():Vt=!1}}}var En;if(typeof an=="function")En=function(){an(ti)};else if(typeof MessageChannel<"u"){var qn=new MessageChannel,rn=qn.port2;qn.port1.onmessage=ti,En=function(){rn.postMessage(null)}}else En=function(){gn(ti,0)};function ki(){Vt||(Vt=!0,En())}function kn(qe,Pt){Xt=gn(function(){qe(st.unstable_now())},Pt)}st.unstable_IdlePriority=5,st.unstable_ImmediatePriority=1,st.unstable_LowPriority=4,st.unstable_NormalPriority=3,st.unstable_Profiling=null,st.unstable_UserBlockingPriority=2,st.unstable_cancelCallback=function(qe){qe.callback=null},st.unstable_continueExecution=function(){at||xe||(at=!0,ki())},st.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ri=0<qe?Math.floor(1e3/qe):5},st.unstable_getCurrentPriorityLevel=function(){return ut},st.unstable_getFirstCallbackNode=function(){return Wt(ot)},st.unstable_next=function(qe){switch(ut){case 1:case 2:case 3:var Pt=3;break;default:Pt=ut}var Tt=ut;ut=Pt;try{return qe()}finally{ut=Tt}},st.unstable_pauseExecution=function(){},st.unstable_requestPaint=function(){},st.unstable_runWithPriority=function(qe,Pt){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var Tt=ut;ut=qe;try{return Pt()}finally{ut=Tt}},st.unstable_scheduleCallback=function(qe,Pt,Tt){var si=st.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?si+Tt:si):Tt=si,qe){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=Tt+ue,qe={id:Ft++,callback:Pt,priorityLevel:qe,startTime:Tt,expirationTime:ue,sortIndex:-1},Tt>si?(qe.sortIndex=Tt,_n(Ve,qe),Wt(ot)===null&&qe===Wt(Ve)&&(Rn?(la(Xt),Xt=-1):Rn=!0,kn(Ki,Tt-si))):(qe.sortIndex=ue,_n(ot,qe),at||xe||(at=!0,ki())),qe},st.unstable_shouldYield=Mt,st.unstable_wrapCallback=function(qe){var Pt=ut;return function(){var Tt=ut;ut=Pt;try{return qe.apply(this,arguments)}finally{ut=Tt}}}}(sp)),sp}var mp;function Ap(){return mp||(mp=1,rp.exports=Cp()),rp.exports}var op={exports:{}},dr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _p;function zp(){if(_p)return dr;_p=1;var st=cp();function _n(ot){var Ve="https://react.dev/errors/"+ot;if(1<arguments.length){Ve+="?args[]="+encodeURIComponent(arguments[1]);for(var Ft=2;Ft<arguments.length;Ft++)Ve+="&args[]="+encodeURIComponent(arguments[Ft])}return"Minified React error #"+ot+"; visit "+Ve+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Wt(){}var Ce={d:{f:Wt,r:function(){throw Error(_n(522))},D:Wt,C:Wt,L:Wt,m:Wt,X:Wt,S:Wt,M:Wt},p:0,findDOMNode:null},Ot=Symbol.for("react.portal");function li(ot,Ve,Ft){var ai=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ot,key:ai==null?null:""+ai,children:ot,containerInfo:Ve,implementation:Ft}}var F=st.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(ot,Ve){if(ot==="font")return"";if(typeof Ve=="string")return Ve==="use-credentials"?Ve:""}return dr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ce,dr.createPortal=function(ot,Ve){var Ft=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ve||Ve.nodeType!==1&&Ve.nodeType!==9&&Ve.nodeType!==11)throw Error(_n(299));return li(ot,Ve,null,Ft)},dr.flushSync=function(ot){var Ve=F.T,Ft=Ce.p;try{if(F.T=null,Ce.p=2,ot)return ot()}finally{F.T=Ve,Ce.p=Ft,Ce.d.f()}},dr.preconnect=function(ot,Ve){typeof ot=="string"&&(Ve?(Ve=Ve.crossOrigin,Ve=typeof Ve=="string"?Ve==="use-credentials"?Ve:"":void 0):Ve=null,Ce.d.C(ot,Ve))},dr.prefetchDNS=function(ot){typeof ot=="string"&&Ce.d.D(ot)},dr.preinit=function(ot,Ve){if(typeof ot=="string"&&Ve&&typeof Ve.as=="string"){var Ft=Ve.as,ai=d(Ft,Ve.crossOrigin),ut=typeof Ve.integrity=="string"?Ve.integrity:void 0,xe=typeof Ve.fetchPriority=="string"?Ve.fetchPriority:void 0;Ft==="style"?Ce.d.S(ot,typeof Ve.precedence=="string"?Ve.precedence:void 0,{crossOrigin:ai,integrity:ut,fetchPriority:xe}):Ft==="script"&&Ce.d.X(ot,{crossOrigin:ai,integrity:ut,fetchPriority:xe,nonce:typeof Ve.nonce=="string"?Ve.nonce:void 0})}},dr.preinitModule=function(ot,Ve){if(typeof ot=="string")if(typeof Ve=="object"&&Ve!==null){if(Ve.as==null||Ve.as==="script"){var Ft=d(Ve.as,Ve.crossOrigin);Ce.d.M(ot,{crossOrigin:Ft,integrity:typeof Ve.integrity=="string"?Ve.integrity:void 0,nonce:typeof Ve.nonce=="string"?Ve.nonce:void 0})}}else Ve==null&&Ce.d.M(ot)},dr.preload=function(ot,Ve){if(typeof ot=="string"&&typeof Ve=="object"&&Ve!==null&&typeof Ve.as=="string"){var Ft=Ve.as,ai=d(Ft,Ve.crossOrigin);Ce.d.L(ot,Ft,{crossOrigin:ai,integrity:typeof Ve.integrity=="string"?Ve.integrity:void 0,nonce:typeof Ve.nonce=="string"?Ve.nonce:void 0,type:typeof Ve.type=="string"?Ve.type:void 0,fetchPriority:typeof Ve.fetchPriority=="string"?Ve.fetchPriority:void 0,referrerPolicy:typeof Ve.referrerPolicy=="string"?Ve.referrerPolicy:void 0,imageSrcSet:typeof Ve.imageSrcSet=="string"?Ve.imageSrcSet:void 0,imageSizes:typeof Ve.imageSizes=="string"?Ve.imageSizes:void 0,media:typeof Ve.media=="string"?Ve.media:void 0})}},dr.preloadModule=function(ot,Ve){if(typeof ot=="string")if(Ve){var Ft=d(Ve.as,Ve.crossOrigin);Ce.d.m(ot,{as:typeof Ve.as=="string"&&Ve.as!=="script"?Ve.as:void 0,crossOrigin:Ft,integrity:typeof Ve.integrity=="string"?Ve.integrity:void 0})}else Ce.d.m(ot)},dr.requestFormReset=function(ot){Ce.d.r(ot)},dr.unstable_batchedUpdates=function(ot,Ve){return ot(Ve)},dr.useFormState=function(ot,Ve,Ft){return F.H.useFormState(ot,Ve,Ft)},dr.useFormStatus=function(){return F.H.useHostTransitionStatus()},dr.version="19.0.0",dr}var gp;function Pp(){if(gp)return op.exports;gp=1;function st(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(st)}catch(_n){console.error(_n)}}return st(),op.exports=zp(),op.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yp;function Dp(){if(yp)return df;yp=1;var st=Ap(),_n=cp(),Wt=Pp();function Ce(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ot(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}var li=Symbol.for("react.element"),F=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),ot=Symbol.for("react.fragment"),Ve=Symbol.for("react.strict_mode"),Ft=Symbol.for("react.profiler"),ai=Symbol.for("react.provider"),ut=Symbol.for("react.consumer"),xe=Symbol.for("react.context"),at=Symbol.for("react.forward_ref"),Rn=Symbol.for("react.suspense"),gn=Symbol.for("react.suspense_list"),la=Symbol.for("react.memo"),an=Symbol.for("react.lazy"),ca=Symbol.for("react.offscreen"),Ki=Symbol.for("react.memo_cache_sentinel"),Vt=Symbol.iterator;function Xt(i){return i===null||typeof i!="object"?null:(i=Vt&&i[Vt]||i["@@iterator"],typeof i=="function"?i:null)}var ri=Symbol.for("react.client.reference");function pi(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ri?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ot:return"Fragment";case d:return"Portal";case Ft:return"Profiler";case Ve:return"StrictMode";case Rn:return"Suspense";case gn:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case xe:return(i.displayName||"Context")+".Provider";case ut:return(i._context.displayName||"Context")+".Consumer";case at:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case la:return s=i.displayName||null,s!==null?s:pi(i.type)||"Memo";case an:s=i._payload,i=i._init;try{return pi(i(s))}catch{}}return null}var Mt=_n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ti=Object.assign,En,qn;function rn(i){if(En===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);En=s&&s[1]||"",qn=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+En+i+qn}var ki=!1;function kn(i,s){if(!i||ki)return"";ki=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch(Le){var Ee=Le}Reflect.construct(i,[],He)}else{try{He.call()}catch(Le){Ee=Le}i.call(He.prototype)}}else{try{throw Error()}catch(Le){Ee=Le}(He=i())&&typeof He.catch=="function"&&He.catch(function(){})}}catch(Le){if(Le&&Ee&&typeof Le.stack=="string")return[Le.stack,Ee.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=p.DetermineComponentFrameRoot(),B=S[0],G=S[1];if(B&&G){var te=B.split(`
`),de=G.split(`
`);for(x=p=0;p<te.length&&!te[p].includes("DetermineComponentFrameRoot");)p++;for(;x<de.length&&!de[x].includes("DetermineComponentFrameRoot");)x++;if(p===te.length||x===de.length)for(p=te.length-1,x=de.length-1;1<=p&&0<=x&&te[p]!==de[x];)x--;for(;1<=p&&0<=x;p--,x--)if(te[p]!==de[x]){if(p!==1||x!==1)do if(p--,x--,0>x||te[p]!==de[x]){var Oe=`
`+te[p].replace(" at new "," at ");return i.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",i.displayName)),Oe}while(1<=p&&0<=x);break}}}finally{ki=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?rn(c):""}function qe(i){switch(i.tag){case 26:case 27:case 5:return rn(i.type);case 16:return rn("Lazy");case 13:return rn("Suspense");case 19:return rn("SuspenseList");case 0:case 15:return i=kn(i.type,!1),i;case 11:return i=kn(i.type.render,!1),i;case 1:return i=kn(i.type,!0),i;default:return""}}function Pt(i){try{var s="";do s+=qe(i),i=i.return;while(i);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function Tt(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function si(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function ue(i){if(Tt(i)!==i)throw Error(Ce(188))}function Xe(i){var s=i.alternate;if(!s){if(s=Tt(i),s===null)throw Error(Ce(188));return s!==i?null:i}for(var c=i,p=s;;){var x=c.return;if(x===null)break;var S=x.alternate;if(S===null){if(p=x.return,p!==null){c=p;continue}break}if(x.child===S.child){for(S=x.child;S;){if(S===c)return ue(x),i;if(S===p)return ue(x),s;S=S.sibling}throw Error(Ce(188))}if(c.return!==p.return)c=x,p=S;else{for(var B=!1,G=x.child;G;){if(G===c){B=!0,c=x,p=S;break}if(G===p){B=!0,p=x,c=S;break}G=G.sibling}if(!B){for(G=S.child;G;){if(G===c){B=!0,c=S,p=x;break}if(G===p){B=!0,p=S,c=x;break}G=G.sibling}if(!B)throw Error(Ce(189))}}if(c.alternate!==p)throw Error(Ce(190))}if(c.tag!==3)throw Error(Ce(188));return c.stateNode.current===c?i:s}function vt(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=vt(i),s!==null)return s;i=i.sibling}return null}var mt=Array.isArray,We=Wt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ct={pending:!1,data:null,method:null,action:null},kt=[],sn=-1;function Yt(i){return{current:i}}function oi(i){0>sn||(i.current=kt[sn],kt[sn]=null,sn--)}function _i(i,s){sn++,kt[sn]=i.current,i.current=s}var Ci=Yt(null),Vi=Yt(null),ta=Yt(null),Li=Yt(null);function Dr(i,s){switch(_i(ta,s),_i(Vi,i),_i(Ci,null),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)&&(s=s.namespaceURI)?vu(s):0;break;default:if(i=i===8?s.parentNode:s,s=i.tagName,i=i.namespaceURI)i=vu(i),s=tf(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}oi(Ci),_i(Ci,s)}function Xa(){oi(Ci),oi(Vi),oi(ta)}function Da(i){i.memoizedState!==null&&_i(Li,i);var s=Ci.current,c=tf(s,i.type);s!==c&&(_i(Vi,i),_i(Ci,c))}function fr(i){Vi.current===i&&(oi(Ci),oi(Vi)),Li.current===i&&(oi(Li),Z._currentValue=Ct)}var Ir=Object.prototype.hasOwnProperty,Ya=st.unstable_scheduleCallback,Ia=st.unstable_cancelCallback,Po=st.unstable_shouldYield,Ys=st.unstable_requestPaint,ia=st.unstable_now,Do=st.unstable_getCurrentPriorityLevel,_s=st.unstable_ImmediatePriority,Rr=st.unstable_UserBlockingPriority,Qa=st.unstable_NormalPriority,gs=st.unstable_LowPriority,Qr=st.unstable_IdlePriority,Ml=st.log,Io=st.unstable_setDisableYieldValue,Kr=null,on=null;function pe(i){if(on&&typeof on.onCommitFiberRoot=="function")try{on.onCommitFiberRoot(Kr,i,void 0,(i.current.flags&128)===128)}catch{}}function P(i){if(typeof Ml=="function"&&Io(i),on&&typeof on.setStrictMode=="function")try{on.setStrictMode(Kr,i)}catch{}}var V=Math.clz32?Math.clz32:re,H=Math.log,K=Math.LN2;function re(i){return i>>>=0,i===0?32:31-(H(i)/K|0)|0}var he=128,be=4194304;function ce(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Pe(i,s){var c=i.pendingLanes;if(c===0)return 0;var p=0,x=i.suspendedLanes,S=i.pingedLanes,B=i.warmLanes;i=i.finishedLanes!==0;var G=c&134217727;return G!==0?(c=G&~x,c!==0?p=ce(c):(S&=G,S!==0?p=ce(S):i||(B=G&~B,B!==0&&(p=ce(B))))):(G=c&~x,G!==0?p=ce(G):S!==0?p=ce(S):i||(B=c&~B,B!==0&&(p=ce(B)))),p===0?0:s!==0&&s!==p&&(s&x)===0&&(x=p&-p,B=s&-s,x>=B||x===32&&(B&4194176)!==0)?s:p}function Me(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function me(i,s){switch(i){case 1:case 2:case 4:case 8:return s+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Be(){var i=he;return he<<=1,(he&4194176)===0&&(he=128),i}function _e(){var i=be;return be<<=1,(be&62914560)===0&&(be=4194304),i}function Qe(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function lt(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function At(i,s,c,p,x,S){var B=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var G=i.entanglements,te=i.expirationTimes,de=i.hiddenUpdates;for(c=B&~c;0<c;){var Oe=31-V(c),He=1<<Oe;G[Oe]=0,te[Oe]=-1;var Ee=de[Oe];if(Ee!==null)for(de[Oe]=null,Oe=0;Oe<Ee.length;Oe++){var Le=Ee[Oe];Le!==null&&(Le.lane&=-536870913)}c&=~He}p!==0&&wt(i,p,0),S!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=S&~(B&~s))}function wt(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var p=31-V(s);i.entangledLanes|=s,i.entanglements[p]=i.entanglements[p]|1073741824|c&4194218}function ke(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var p=31-V(c),x=1<<p;x&s|i[p]&s&&(i[p]|=s),c&=~x}}function it(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Je(){var i=We.p;return i!==0?i:(i=window.event,i===void 0?32:Ui(i.type))}function Bt(i,s){var c=We.p;try{return We.p=i,s()}finally{We.p=c}}var _t=Math.random().toString(36).slice(2),xt="__reactFiber$"+_t,et="__reactProps$"+_t,Ka="__reactContainer$"+_t,Wi="__reactEvents$"+_t,Cn="__reactListeners$"+_t,Mi="__reactHandles$"+_t,El="__reactResources$"+_t,Ln="__reactMarker$"+_t;function ci(i){delete i[xt],delete i[et],delete i[Wi],delete i[Cn],delete i[Mi]}function ys(i){var s=i[xt];if(s)return s;for(var c=i.parentNode;c;){if(s=c[Ka]||c[xt]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=af(i);i!==null;){if(c=i[xt])return c;i=af(i)}return s}i=c,c=i.parentNode}return null}function kr(i){if(i=i[xt]||i[Ka]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function Qs(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(Ce(33))}function Ra(i){var s=i[El];return s||(s=i[El]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Zi(i){i[Ln]=!0}var gc=new Set,wu={};function vs(i,s){pr(i,s),pr(i+"Capture",s)}function pr(i,s){for(wu[i]=s,i=0;i<s.length;i++)gc.add(s[i])}var Lr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yh={},vh={};function Tu(i){return Ir.call(vh,i)?!0:Ir.call(yh,i)?!1:dd.test(i)?vh[i]=!0:(yh[i]=!0,!1)}function Wr(i,s,c){if(Tu(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function Ro(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function mr(i,s,c,p){if(p===null)i.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+p)}}function Hn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function yc(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Su(i){var s=yc(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),p=""+i[s];if(!i.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var x=c.get,S=c.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(B){p=""+B,S.call(this,B)}}),Object.defineProperty(i,s,{enumerable:c.enumerable}),{getValue:function(){return p},setValue:function(B){p=""+B},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Ks(i){i._valueTracker||(i._valueTracker=Su(i))}function vc(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),p="";return i&&(p=yc(i)?i.checked?"true":"false":i.value),i=p,i!==c?(s.setValue(i),!0):!1}function Br(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var _r=/[\n"\\]/g;function It(i){return i.replace(_r,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ua(i,s,c,p,x,S,B,G){i.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?i.type=B:i.removeAttribute("type"),s!=null?B==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Hn(s)):i.value!==""+Hn(s)&&(i.value=""+Hn(s)):B!=="submit"&&B!=="reset"||i.removeAttribute("value"),s!=null?Zt(i,B,Hn(s)):c!=null?Zt(i,B,Hn(c)):p!=null&&i.removeAttribute("value"),x==null&&S!=null&&(i.defaultChecked=!!S),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?i.name=""+Hn(G):i.removeAttribute("name")}function ka(i,s,c,p,x,S,B,G){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),s!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||s!=null))return;c=c!=null?""+Hn(c):"",s=s!=null?""+Hn(s):c,G||s===i.value||(i.value=s),i.defaultValue=s}p=p??x,p=typeof p!="function"&&typeof p!="symbol"&&!!p,i.checked=G?i.checked:!!p,i.defaultChecked=!!p,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(i.name=B)}function Zt(i,s,c){s==="number"&&Br(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Jr(i,s,c,p){if(i=i.options,s){s={};for(var x=0;x<c.length;x++)s["$"+c[x]]=!0;for(c=0;c<i.length;c++)x=s.hasOwnProperty("$"+i[c].value),i[c].selected!==x&&(i[c].selected=x),x&&p&&(i[c].defaultSelected=!0)}else{for(c=""+Hn(c),s=null,x=0;x<i.length;x++){if(i[x].value===c){i[x].selected=!0,p&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function xc(i,s,c){if(s!=null&&(s=""+Hn(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+Hn(c):""}function La(i,s,c,p){if(s==null){if(p!=null){if(c!=null)throw Error(Ce(92));if(mt(p)){if(1<p.length)throw Error(Ce(93));p=p[0]}c=p}c==null&&(c=""),s=c}c=Hn(s),i.defaultValue=c,p=i.textContent,p===c&&p!==""&&p!==null&&(i.value=p)}function Ji(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var Bn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Bi(i,s,c){var p=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?p?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":p?i.setProperty(s,c):typeof c!="number"||c===0||Bn.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function bc(i,s,c){if(s!=null&&typeof s!="object")throw Error(Ce(62));if(i=i.style,c!=null){for(var p in c)!c.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?i.setProperty(p,""):p==="float"?i.cssFloat="":i[p]="");for(var x in s)p=s[x],s.hasOwnProperty(x)&&c[x]!==p&&Bi(i,x,p)}else for(var S in s)s.hasOwnProperty(S)&&Bi(i,S,s[S])}function yn(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ha=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xa=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ws(i){return xa.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Ba=null;function en(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Oa=null,$n=null;function ko(i){var s=kr(i);if(s&&(i=s.stateNode)){var c=i[et]||null;e:switch(i=s.stateNode,s.type){case"input":if(ua(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+It(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var p=c[s];if(p!==i&&p.form===i.form){var x=p[et]||null;if(!x)throw Error(Ce(90));ua(p,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<c.length;s++)p=c[s],p.form===i.form&&vc(p)}break e;case"textarea":xc(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Jr(i,!!c.multiple,s,!1)}}}var ba=!1;function wc(i,s,c){if(ba)return i(s,c);ba=!0;try{var p=i(s);return p}finally{if(ba=!1,(Oa!==null||$n!==null)&&(sh(),Oa&&(s=Oa,i=$n,$n=Oa=null,ko(s),i)))for(s=0;s<i.length;s++)ko(i[s])}}function da(i,s){var c=i.stateNode;if(c===null)return null;var p=c[et]||null;if(p===null)return null;c=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(Ce(231,s,typeof c));return c}var xi=!1;if(Lr)try{var xs={};Object.defineProperty(xs,"passive",{get:function(){xi=!0}}),window.addEventListener("test",xs,xs),window.removeEventListener("test",xs,xs)}catch{xi=!1}var Lt=null,Dt=null,es=null;function Gt(){if(es)return es;var i,s=Dt,c=s.length,p,x="value"in Lt?Lt.value:Lt.textContent,S=x.length;for(i=0;i<c&&s[i]===x[i];i++);var B=c-i;for(p=1;p<=B&&s[c-p]===x[S-p];p++);return es=x.slice(i,1<p?1-p:void 0)}function bs(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function fa(){return!0}function Lo(){return!1}function Xn(i){function s(c,p,x,S,B){this._reactName=c,this._targetInst=x,this.type=p,this.nativeEvent=S,this.target=B,this.currentTarget=null;for(var G in i)i.hasOwnProperty(G)&&(c=i[G],this[G]=c?c(S):S[G]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?fa:Lo,this.isPropagationStopped=Lo,this}return ti(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=fa)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=fa)},persist:function(){},isPersistent:fa}),s}var gr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ts=Xn(gr),Or=ti({},gr,{view:0,detail:0}),fd=Xn(Or),Bo,Cl,is,An=ti({},Or,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ns,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==is&&(is&&i.type==="mousemove"?(Bo=i.screenX-is.screenX,Cl=i.screenY-is.screenY):Cl=Bo=0,is=i),Bo)},movementY:function(i){return"movementY"in i?i.movementY:Cl}}),Yn=Xn(An),Tc=ti({},An,{dataTransfer:0}),Fa=Xn(Tc),ln=ti({},Or,{relatedTarget:0}),Al=Xn(ln),Sc=ti({},gr,{animationName:0,elapsedTime:0,pseudoElement:0}),Js=Xn(Sc),pd=ti({},gr,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Mc=Xn(pd),Mu=ti({},gr,{data:0}),xh=Xn(Mu),Ec={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wa={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ac(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=wa[i])?!!s[i]:!1}function ns(){return Ac}var Eu=ti({},Or,{key:function(i){if(i.key){var s=Ec[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=bs(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Cc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ns,charCode:function(i){return i.type==="keypress"?bs(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?bs(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),zl=Xn(Eu),Fr=ti({},An,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bh=Xn(Fr),Cu=ti({},Or,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ns}),Pl=Xn(Cu),ws=ti({},gr,{propertyName:0,elapsedTime:0,pseudoElement:0}),md=Xn(ws),Dl=ti({},An,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),wh=Xn(Dl),Oo=ti({},gr,{newState:0,oldState:0}),Th=Xn(Oo),Sh=[9,13,27,32],Au=Lr&&"CompositionEvent"in window,Fo=null;Lr&&"documentMode"in document&&(Fo=document.documentMode);var zu=Lr&&"TextEvent"in window&&!Fo,Pu=Lr&&(!Au||Fo&&8<Fo&&11>=Fo),zc=" ",Pc=!1;function Dc(i,s){switch(i){case"keyup":return Sh.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ts(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var eo=!1;function Mh(i,s){switch(i){case"compositionend":return Ts(s);case"keypress":return s.which!==32?null:(Pc=!0,zc);case"textInput":return i=s.data,i===zc&&Pc?null:i;default:return null}}function to(i,s){if(eo)return i==="compositionend"||!Au&&Dc(i,s)?(i=Gt(),es=Dt=Lt=null,eo=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Pu&&s.locale!=="ko"?null:s.data;default:return null}}var _d={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Il(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!_d[i.type]:s==="textarea"}function Eh(i,s,c,p){Oa?$n?$n.push(p):$n=[p]:Oa=p,s=uh(s,"onChange"),0<s.length&&(c=new ts("onChange","change",null,c,p),i.push({event:c,listeners:s}))}var jo=null,io=null;function Ch(i){Qd(i,0)}function Rl(i){var s=Qs(i);if(vc(s))return i}function kl(i,s){if(i==="change")return s}var Ic=!1;if(Lr){var No;if(Lr){var yr="oninput"in document;if(!yr){var Rc=document.createElement("div");Rc.setAttribute("oninput","return;"),yr=typeof Rc.oninput=="function"}No=yr}else No=!1;Ic=No&&(!document.documentMode||9<document.documentMode)}function Ll(){jo&&(jo.detachEvent("onpropertychange",kc),io=jo=null)}function kc(i){if(i.propertyName==="value"&&Rl(io)){var s=[];Eh(s,io,i,en(i)),wc(Ch,s)}}function Ah(i,s,c){i==="focusin"?(Ll(),jo=s,io=c,jo.attachEvent("onpropertychange",kc)):i==="focusout"&&Ll()}function Du(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Rl(io)}function no(i,s){if(i==="click")return Rl(s)}function ii(i,s){if(i==="input"||i==="change")return Rl(s)}function gd(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var ja=typeof Object.is=="function"?Object.is:gd;function Bl(i,s){if(ja(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),p=Object.keys(s);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var x=c[p];if(!Ir.call(s,x)||!ja(i[x],s[x]))return!1}return!0}function zh(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Iu(i,s){var c=zh(i);i=0;for(var p;c;){if(c.nodeType===3){if(p=i+c.textContent.length,i<=s&&p>=s)return{node:c,offset:s-i};i=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=zh(c)}}function Ph(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Ph(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Ru(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Br(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=Br(i.document)}return s}function Uo(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function Lc(i,s){var c=Ru(s);s=i.focusedElem;var p=i.selectionRange;if(c!==s&&s&&s.ownerDocument&&Ph(s.ownerDocument.documentElement,s)){if(p!==null&&Uo(s)){if(i=p.start,c=p.end,c===void 0&&(c=i),"selectionStart"in s)s.selectionStart=i,s.selectionEnd=Math.min(c,s.value.length);else if(c=(i=s.ownerDocument||document)&&i.defaultView||window,c.getSelection){c=c.getSelection();var x=s.textContent.length,S=Math.min(p.start,x);p=p.end===void 0?S:Math.min(p.end,x),!c.extend&&S>p&&(x=p,p=S,S=x),x=Iu(s,S);var B=Iu(s,p);x&&B&&(c.rangeCount!==1||c.anchorNode!==x.node||c.anchorOffset!==x.offset||c.focusNode!==B.node||c.focusOffset!==B.offset)&&(i=i.createRange(),i.setStart(x.node,x.offset),c.removeAllRanges(),S>p?(c.addRange(i),c.extend(B.node,B.offset)):(i.setEnd(B.node,B.offset),c.addRange(i)))}}for(i=[],c=s;c=c.parentNode;)c.nodeType===1&&i.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<i.length;s++)c=i[s],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var Bc=Lr&&"documentMode"in document&&11>=document.documentMode,Ss=null,as=null,jr=null,Ta=!1;function ku(i,s,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Ta||Ss==null||Ss!==Br(p)||(p=Ss,"selectionStart"in p&&Uo(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),jr&&Bl(jr,p)||(jr=p,p=uh(as,"onSelect"),0<p.length&&(s=new ts("onSelect","select",null,s,c),i.push({event:s,listeners:p}),s.target=Ss)))}function Ms(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var Es={animationend:Ms("Animation","AnimationEnd"),animationiteration:Ms("Animation","AnimationIteration"),animationstart:Ms("Animation","AnimationStart"),transitionrun:Ms("Transition","TransitionRun"),transitionstart:Ms("Transition","TransitionStart"),transitioncancel:Ms("Transition","TransitionCancel"),transitionend:Ms("Transition","TransitionEnd")},rs={},Ol={};Lr&&(Ol=document.createElement("div").style,"AnimationEvent"in window||(delete Es.animationend.animation,delete Es.animationiteration.animation,delete Es.animationstart.animation),"TransitionEvent"in window||delete Es.transitionend.transition);function Nr(i){if(rs[i])return rs[i];if(!Es[i])return i;var s=Es[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Ol)return rs[i]=s[c];return i}var Vo=Nr("animationend"),Fl=Nr("animationiteration"),Lu=Nr("animationstart"),Zo=Nr("transitionrun"),Go=Nr("transitionstart"),Dh=Nr("transitioncancel"),Oc=Nr("transitionend"),Qt=new Map,jl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function vr(i,s){Qt.set(i,s),vs(s,[i])}var Na=[],Wa=0,Bu=0;function Fc(){for(var i=Wa,s=Bu=Wa=0;s<i;){var c=Na[s];Na[s++]=null;var p=Na[s];Na[s++]=null;var x=Na[s];Na[s++]=null;var S=Na[s];if(Na[s++]=null,p!==null&&x!==null){var B=p.pending;B===null?x.next=x:(x.next=B.next,B.next=x),p.pending=x}S!==0&&Ul(c,x,S)}}function Nl(i,s,c,p){Na[Wa++]=i,Na[Wa++]=s,Na[Wa++]=c,Na[Wa++]=p,Bu|=p,i.lanes|=p,i=i.alternate,i!==null&&(i.lanes|=p)}function jc(i,s,c,p){return Nl(i,s,c,p),Vr(i)}function Ur(i,s){return Nl(i,null,null,s),Vr(i)}function Ul(i,s,c){i.lanes|=c;var p=i.alternate;p!==null&&(p.lanes|=c);for(var x=!1,S=i.return;S!==null;)S.childLanes|=c,p=S.alternate,p!==null&&(p.childLanes|=c),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(x=!0)),i=S,S=S.return;x&&s!==null&&i.tag===3&&(S=i.stateNode,x=31-V(c),S=S.hiddenUpdates,i=S[x],i===null?S[x]=[s]:i.push(s),s.lane=c|536870912)}function Vr(i){if(50<hc)throw hc=0,Hh=null,Error(Ce(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var ss={},Nc=new WeakMap;function Ua(i,s){if(typeof i=="object"&&i!==null){var c=Nc.get(i);return c!==void 0?c:(s={value:i,source:s,stack:Pt(s)},Nc.set(i,s),s)}return{value:i,source:s,stack:Pt(s)}}var os=[],ls=0,qo=null,Vl=0,pa=[],Ja=0,Cs=null,Va=1,er="";function cs(i,s){os[ls++]=Vl,os[ls++]=qo,qo=i,Vl=s}function Uc(i,s,c){pa[Ja++]=Va,pa[Ja++]=er,pa[Ja++]=Cs,Cs=i;var p=Va;i=er;var x=32-V(p)-1;p&=~(1<<x),c+=1;var S=32-V(s)+x;if(30<S){var B=x-x%5;S=(p&(1<<B)-1).toString(32),p>>=B,x-=B,Va=1<<32-V(s)+x|c<<x|p,er=S+i}else Va=1<<S|c<<x|p,er=i}function As(i){i.return!==null&&(cs(i,1),Uc(i,1,0))}function ao(i){for(;i===qo;)qo=os[--ls],os[ls]=null,Vl=os[--ls],os[ls]=null;for(;i===Cs;)Cs=pa[--Ja],pa[Ja]=null,er=pa[--Ja],pa[Ja]=null,Va=pa[--Ja],pa[Ja]=null}var Qn=null,cn=null,Et=!1,Kn=null,un=!1,Zl=Error(Ce(519));function us(i){var s=Error(Ce(418,""));throw Ho(Ua(s,i)),Zl}function Ou(i){var s=i.stateNode,c=i.type,p=i.memoizedProps;switch(s[xt]=i,s[et]=p,c){case"dialog":qt("cancel",s),qt("close",s);break;case"iframe":case"object":case"embed":qt("load",s);break;case"video":case"audio":for(c=0;c<_u.length;c++)qt(_u[c],s);break;case"source":qt("error",s);break;case"img":case"image":case"link":qt("error",s),qt("load",s);break;case"details":qt("toggle",s);break;case"input":qt("invalid",s),ka(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Ks(s);break;case"select":qt("invalid",s);break;case"textarea":qt("invalid",s),La(s,p.value,p.defaultValue,p.children),Ks(s)}c=p.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||p.suppressHydrationWarning===!0||Wd(s.textContent,c)?(p.popover!=null&&(qt("beforetoggle",s),qt("toggle",s)),p.onScroll!=null&&qt("scroll",s),p.onScrollEnd!=null&&qt("scrollend",s),p.onClick!=null&&(s.onclick=ms),s=!0):s=!1,s||us(i)}function zs(i){for(Qn=i.return;Qn;)switch(Qn.tag){case 3:case 27:un=!0;return;case 5:case 13:un=!1;return;default:Qn=Qn.return}}function Zr(i){if(i!==Qn)return!1;if(!Et)return zs(i),Et=!0,!1;var s=!1,c;if((c=i.tag!==3&&i.tag!==27)&&((c=i.tag===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||xu(i.type,i.memoizedProps)),c=!c),c&&(s=!0),s&&cn&&us(i),zs(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ce(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(c=i.data,c==="/$"){if(s===0){cn=Xr(i.nextSibling);break e}s--}else c!=="$"&&c!=="$!"&&c!=="$?"||s++;i=i.nextSibling}cn=null}}else cn=Qn?Xr(i.stateNode.nextSibling):null;return!0}function Gr(){cn=Qn=null,Et=!1}function Ho(i){Kn===null?Kn=[i]:Kn.push(i)}var ro=Error(Ce(460)),Vc=Error(Ce(474)),Zc={then:function(){}};function Gc(i){return i=i.status,i==="fulfilled"||i==="rejected"}function xr(){}function so(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(xr,xr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,i===ro?Error(Ce(483)):i;default:if(typeof s.status=="string")s.then(xr,xr);else{if(i=Di,i!==null&&100<i.shellSuspendCounter)throw Error(Ce(482));i=s,i.status="pending",i.then(function(p){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=p}},function(p){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,i===ro?Error(Ce(483)):i}throw $o=s,ro}}var $o=null;function Fu(){if($o===null)throw Error(Ce(459));var i=$o;return $o=null,i}var oo=null,Xo=0;function Gl(i){var s=Xo;return Xo+=1,oo===null&&(oo=[]),so(oo,i,s)}function Yo(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function br(i,s){throw s.$$typeof===li?Error(Ce(525)):(i=Object.prototype.toString.call(s),Error(Ce(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function lo(i){var s=i._init;return s(i._payload)}function Oi(i){function s(ge,fe){if(i){var Te=ge.deletions;Te===null?(ge.deletions=[fe],ge.flags|=16):Te.push(fe)}}function c(ge,fe){if(!i)return null;for(;fe!==null;)s(ge,fe),fe=fe.sibling;return null}function p(ge){for(var fe=new Map;ge!==null;)ge.key!==null?fe.set(ge.key,ge):fe.set(ge.index,ge),ge=ge.sibling;return fe}function x(ge,fe){return ge=fl(ge,fe),ge.index=0,ge.sibling=null,ge}function S(ge,fe,Te){return ge.index=Te,i?(Te=ge.alternate,Te!==null?(Te=Te.index,Te<fe?(ge.flags|=33554434,fe):Te):(ge.flags|=33554434,fe)):(ge.flags|=1048576,fe)}function B(ge){return i&&ge.alternate===null&&(ge.flags|=33554434),ge}function G(ge,fe,Te,Ne){return fe===null||fe.tag!==6?(fe=Ld(Te,ge.mode,Ne),fe.return=ge,fe):(fe=x(fe,Te),fe.return=ge,fe)}function te(ge,fe,Te,Ne){var ht=Te.type;return ht===ot?Oe(ge,fe,Te.props.children,Ne,Te.key):fe!==null&&(fe.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===an&&lo(ht)===fe.type)?(fe=x(fe,Te.props),Yo(fe,Te),fe.return=ge,fe):(fe=th(Te.type,Te.key,Te.props,null,ge.mode,Ne),Yo(fe,Te),fe.return=ge,fe)}function de(ge,fe,Te,Ne){return fe===null||fe.tag!==4||fe.stateNode.containerInfo!==Te.containerInfo||fe.stateNode.implementation!==Te.implementation?(fe=lc(Te,ge.mode,Ne),fe.return=ge,fe):(fe=x(fe,Te.children||[]),fe.return=ge,fe)}function Oe(ge,fe,Te,Ne,ht){return fe===null||fe.tag!==7?(fe=pl(Te,ge.mode,Ne,ht),fe.return=ge,fe):(fe=x(fe,Te),fe.return=ge,fe)}function He(ge,fe,Te){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return fe=Ld(""+fe,ge.mode,Te),fe.return=ge,fe;if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case F:return Te=th(fe.type,fe.key,fe.props,null,ge.mode,Te),Yo(Te,fe),Te.return=ge,Te;case d:return fe=lc(fe,ge.mode,Te),fe.return=ge,fe;case an:var Ne=fe._init;return fe=Ne(fe._payload),He(ge,fe,Te)}if(mt(fe)||Xt(fe))return fe=pl(fe,ge.mode,Te,null),fe.return=ge,fe;if(typeof fe.then=="function")return He(ge,Gl(fe),Te);if(fe.$$typeof===xe)return He(ge,Oh(ge,fe),Te);br(ge,fe)}return null}function Ee(ge,fe,Te,Ne){var ht=fe!==null?fe.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ht!==null?null:G(ge,fe,""+Te,Ne);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case F:return Te.key===ht?te(ge,fe,Te,Ne):null;case d:return Te.key===ht?de(ge,fe,Te,Ne):null;case an:return ht=Te._init,Te=ht(Te._payload),Ee(ge,fe,Te,Ne)}if(mt(Te)||Xt(Te))return ht!==null?null:Oe(ge,fe,Te,Ne,null);if(typeof Te.then=="function")return Ee(ge,fe,Gl(Te),Ne);if(Te.$$typeof===xe)return Ee(ge,fe,Oh(ge,Te),Ne);br(ge,Te)}return null}function Le(ge,fe,Te,Ne,ht){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return ge=ge.get(Te)||null,G(fe,ge,""+Ne,ht);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case F:return ge=ge.get(Ne.key===null?Te:Ne.key)||null,te(fe,ge,Ne,ht);case d:return ge=ge.get(Ne.key===null?Te:Ne.key)||null,de(fe,ge,Ne,ht);case an:var Ht=Ne._init;return Ne=Ht(Ne._payload),Le(ge,fe,Te,Ne,ht)}if(mt(Ne)||Xt(Ne))return ge=ge.get(Te)||null,Oe(fe,ge,Ne,ht,null);if(typeof Ne.then=="function")return Le(ge,fe,Te,Gl(Ne),ht);if(Ne.$$typeof===xe)return Le(ge,fe,Te,Oh(fe,Ne),ht);br(fe,Ne)}return null}function bt(ge,fe,Te,Ne){for(var ht=null,Ht=null,St=fe,zt=fe=0,oa=null;St!==null&&zt<Te.length;zt++){St.index>zt?(oa=St,St=null):oa=St.sibling;var Rt=Ee(ge,St,Te[zt],Ne);if(Rt===null){St===null&&(St=oa);break}i&&St&&Rt.alternate===null&&s(ge,St),fe=S(Rt,fe,zt),Ht===null?ht=Rt:Ht.sibling=Rt,Ht=Rt,St=oa}if(zt===Te.length)return c(ge,St),Et&&cs(ge,zt),ht;if(St===null){for(;zt<Te.length;zt++)St=He(ge,Te[zt],Ne),St!==null&&(fe=S(St,fe,zt),Ht===null?ht=St:Ht.sibling=St,Ht=St);return Et&&cs(ge,zt),ht}for(St=p(St);zt<Te.length;zt++)oa=Le(St,ge,zt,Te[zt],Ne),oa!==null&&(i&&oa.alternate!==null&&St.delete(oa.key===null?zt:oa.key),fe=S(oa,fe,zt),Ht===null?ht=oa:Ht.sibling=oa,Ht=oa);return i&&St.forEach(function(Gn){return s(ge,Gn)}),Et&&cs(ge,zt),ht}function Nt(ge,fe,Te,Ne){if(Te==null)throw Error(Ce(151));for(var ht=null,Ht=null,St=fe,zt=fe=0,oa=null,Rt=Te.next();St!==null&&!Rt.done;zt++,Rt=Te.next()){St.index>zt?(oa=St,St=null):oa=St.sibling;var Gn=Ee(ge,St,Rt.value,Ne);if(Gn===null){St===null&&(St=oa);break}i&&St&&Gn.alternate===null&&s(ge,St),fe=S(Gn,fe,zt),Ht===null?ht=Gn:Ht.sibling=Gn,Ht=Gn,St=oa}if(Rt.done)return c(ge,St),Et&&cs(ge,zt),ht;if(St===null){for(;!Rt.done;zt++,Rt=Te.next())Rt=He(ge,Rt.value,Ne),Rt!==null&&(fe=S(Rt,fe,zt),Ht===null?ht=Rt:Ht.sibling=Rt,Ht=Rt);return Et&&cs(ge,zt),ht}for(St=p(St);!Rt.done;zt++,Rt=Te.next())Rt=Le(St,ge,zt,Rt.value,Ne),Rt!==null&&(i&&Rt.alternate!==null&&St.delete(Rt.key===null?zt:Rt.key),fe=S(Rt,fe,zt),Ht===null?ht=Rt:Ht.sibling=Rt,Ht=Rt);return i&&St.forEach(function(_c){return s(ge,_c)}),Et&&cs(ge,zt),ht}function Mn(ge,fe,Te,Ne){if(typeof Te=="object"&&Te!==null&&Te.type===ot&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case F:e:{for(var ht=Te.key;fe!==null;){if(fe.key===ht){if(ht=Te.type,ht===ot){if(fe.tag===7){c(ge,fe.sibling),Ne=x(fe,Te.props.children),Ne.return=ge,ge=Ne;break e}}else if(fe.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===an&&lo(ht)===fe.type){c(ge,fe.sibling),Ne=x(fe,Te.props),Yo(Ne,Te),Ne.return=ge,ge=Ne;break e}c(ge,fe);break}else s(ge,fe);fe=fe.sibling}Te.type===ot?(Ne=pl(Te.props.children,ge.mode,Ne,Te.key),Ne.return=ge,ge=Ne):(Ne=th(Te.type,Te.key,Te.props,null,ge.mode,Ne),Yo(Ne,Te),Ne.return=ge,ge=Ne)}return B(ge);case d:e:{for(ht=Te.key;fe!==null;){if(fe.key===ht)if(fe.tag===4&&fe.stateNode.containerInfo===Te.containerInfo&&fe.stateNode.implementation===Te.implementation){c(ge,fe.sibling),Ne=x(fe,Te.children||[]),Ne.return=ge,ge=Ne;break e}else{c(ge,fe);break}else s(ge,fe);fe=fe.sibling}Ne=lc(Te,ge.mode,Ne),Ne.return=ge,ge=Ne}return B(ge);case an:return ht=Te._init,Te=ht(Te._payload),Mn(ge,fe,Te,Ne)}if(mt(Te))return bt(ge,fe,Te,Ne);if(Xt(Te)){if(ht=Xt(Te),typeof ht!="function")throw Error(Ce(150));return Te=ht.call(Te),Nt(ge,fe,Te,Ne)}if(typeof Te.then=="function")return Mn(ge,fe,Gl(Te),Ne);if(Te.$$typeof===xe)return Mn(ge,fe,Oh(ge,Te),Ne);br(ge,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint"?(Te=""+Te,fe!==null&&fe.tag===6?(c(ge,fe.sibling),Ne=x(fe,Te),Ne.return=ge,ge=Ne):(c(ge,fe),Ne=Ld(Te,ge.mode,Ne),Ne.return=ge,ge=Ne),B(ge)):c(ge,fe)}return function(ge,fe,Te,Ne){try{Xo=0;var ht=Mn(ge,fe,Te,Ne);return oo=null,ht}catch(St){if(St===ro)throw St;var Ht=Pa(29,St,null,ge.mode);return Ht.lanes=Ne,Ht.return=ge,Ht}finally{}}}var vn=Oi(!0),qc=Oi(!1),ma=Yt(null),hs=Yt(0);function Qo(i,s){i=qs,_i(hs,i),_i(ma,s),qs=i|s.baseLanes}function Hc(){_i(hs,qs),_i(ma,ma.current)}function ql(){qs=hs.current,oi(ma),oi(hs)}var tr=Yt(null),Za=null;function ir(i){var s=i.alternate;_i(hn,hn.current&1),_i(tr,i),Za===null&&(s===null||ma.current!==null||s.memoizedState!==null)&&(Za=i)}function Sa(i){if(i.tag===22){if(_i(hn,hn.current),_i(tr,i),Za===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(Za=i)}}else Ke()}function Ke(){_i(hn,hn.current),_i(tr,tr.current)}function Ma(i){oi(tr),Za===i&&(Za=null),oi(hn)}var hn=Yt(0);function Hl(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ps=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,p){i.push(p)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},$l=st.unstable_scheduleCallback,$c=st.unstable_NormalPriority,yt={$$typeof:xe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ko(){return{controller:new Ps,data:new Map,refCount:0}}function Wo(i){i.refCount--,i.refCount===0&&$l($c,function(){i.controller.abort()})}var Ds=null,Xc=0,Is=0,Rs=null;function ju(i,s){if(Ds===null){var c=Ds=[];Xc=0,Is=Xd(),Rs={status:"pending",value:void 0,then:function(p){c.push(p)}}}return Xc++,s.then(Yc,Yc),s}function Yc(){if(--Xc===0&&Ds!==null){Rs!==null&&(Rs.status="fulfilled");var i=Ds;Ds=null,Is=0,Rs=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function yd(i,s){var c=[],p={status:"pending",value:null,reason:null,then:function(x){c.push(x)}};return i.then(function(){p.status="fulfilled",p.value=s;for(var x=0;x<c.length;x++)(0,c[x])(s)},function(x){for(p.status="rejected",p.reason=x,x=0;x<c.length;x++)(0,c[x])(void 0)}),p}var Qc=Mt.S;Mt.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&ju(i,s),Qc!==null&&Qc(i,s)};var ks=Yt(null);function Kc(){var i=ks.current;return i!==null?i:Di.pooledCache}function wr(i,s){s===null?_i(ks,ks.current):_i(ks,s.pool)}function Ei(){var i=Kc();return i===null?null:{parent:yt._currentValue,pool:i}}var nr=0,jt=null,ui=null,tn=null,Ls=!1,Jo=!1,On=!1,co=0,ct=0,ft=null,Xl=0;function Fi(){throw Error(Ce(321))}function Yl(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!ja(i[c],s[c]))return!1;return!0}function na(i,s,c,p,x,S){return nr=S,jt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Mt.H=i===null||i.memoizedState===null?Pi:ji,On=!1,S=c(p,x),On=!1,Jo&&(S=Tr(s,c,p,x)),Nu(i),S}function Nu(i){Mt.H=wi;var s=ui!==null&&ui.next!==null;if(nr=0,tn=ui=jt=null,Ls=!1,ct=0,ft=null,s)throw Error(Ce(300));i===null||Pn||(i=i.dependencies,i!==null&&Aa(i)&&(Pn=!0))}function Tr(i,s,c,p){jt=i;var x=0;do{if(Jo&&(ft=null),ct=0,Jo=!1,25<=x)throw Error(Ce(301));if(x+=1,tn=ui=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}Mt.H=Ea,S=s(c,p)}while(Jo);return S}function vd(){var i=Mt.H,s=i.useState()[0];return s=typeof s.then=="function"?ho(s):s,i=i.useState()[0],(ui!==null?ui.memoizedState:null)!==i&&(jt.flags|=1024),s}function ar(){var i=co!==0;return co=0,i}function Ai(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function Gi(i){if(Ls){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Ls=!1}nr=0,tn=ui=jt=null,Jo=!1,ct=co=0,ft=null}function _a(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tn===null?jt.memoizedState=tn=i:tn=tn.next=i,tn}function zi(){if(ui===null){var i=jt.alternate;i=i!==null?i.memoizedState:null}else i=ui.next;var s=tn===null?jt.memoizedState:tn.next;if(s!==null)tn=s,ui=i;else{if(i===null)throw jt.alternate===null?Error(Ce(467)):Error(Ce(310));ui=i,i={memoizedState:ui.memoizedState,baseState:ui.baseState,baseQueue:ui.baseQueue,queue:ui.queue,next:null},tn===null?jt.memoizedState=tn=i:tn=tn.next=i}return tn}var uo;uo=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function ho(i){var s=ct;return ct+=1,ft===null&&(ft=[]),i=so(ft,i,s),s=jt,(tn===null?s.memoizedState:tn.next)===null&&(s=s.alternate,Mt.H=s===null||s.memoizedState===null?Pi:ji),i}function rr(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return ho(i);if(i.$$typeof===xe)return aa(i)}throw Error(Ce(438,String(i)))}function el(i){var s=null,c=jt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var p=jt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=uo(),jt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),p=0;p<i;p++)c[p]=Ki;return s.index++,c}function ga(i,s){return typeof s=="function"?s(i):s}function fo(i){var s=zi();return po(s,ui,i)}function po(i,s,c){var p=i.queue;if(p===null)throw Error(Ce(311));p.lastRenderedReducer=c;var x=i.baseQueue,S=p.pending;if(S!==null){if(x!==null){var B=x.next;x.next=S.next,S.next=B}s.baseQueue=x=S,p.pending=null}if(S=i.baseState,x===null)i.memoizedState=S;else{s=x.next;var G=B=null,te=null,de=s,Oe=!1;do{var He=de.lane&-536870913;if(He!==de.lane?(ei&He)===He:(nr&He)===He){var Ee=de.revertLane;if(Ee===0)te!==null&&(te=te.next={lane:0,revertLane:0,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),He===Is&&(Oe=!0);else if((nr&Ee)===Ee){de=de.next,Ee===Is&&(Oe=!0);continue}else He={lane:0,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(G=te=He,B=S):te=te.next=He,jt.lanes|=Ee,ml|=Ee;He=de.action,On&&c(S,He),S=de.hasEagerState?de.eagerState:c(S,He)}else Ee={lane:He,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(G=te=Ee,B=S):te=te.next=Ee,jt.lanes|=He,ml|=He;de=de.next}while(de!==null&&de!==s);if(te===null?B=S:te.next=G,!ja(S,i.memoizedState)&&(Pn=!0,Oe&&(c=Rs,c!==null)))throw c;i.memoizedState=S,i.baseState=B,i.baseQueue=te,p.lastRenderedState=S}return x===null&&(p.lanes=0),[i.memoizedState,p.dispatch]}function Ql(i){var s=zi(),c=s.queue;if(c===null)throw Error(Ce(311));c.lastRenderedReducer=i;var p=c.dispatch,x=c.pending,S=s.memoizedState;if(x!==null){c.pending=null;var B=x=x.next;do S=i(S,B.action),B=B.next;while(B!==x);ja(S,s.memoizedState)||(Pn=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),c.lastRenderedState=S}return[S,p]}function mo(i,s,c){var p=jt,x=zi(),S=Et;if(S){if(c===void 0)throw Error(Ce(407));c=c()}else c=s();var B=!ja((ui||x).memoizedState,c);if(B&&(x.memoizedState=c,Pn=!0),x=x.queue,$(Kl.bind(null,p,x,i),[i]),x.getSnapshot!==s||B||tn!==null&&tn.memoizedState.tag&1){if(p.flags|=2048,D(9,Wc.bind(null,p,x,c,s),{destroy:void 0},null),Di===null)throw Error(Ce(349));S||(nr&60)!==0||Bs(p,s,c)}return c}function Bs(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=jt.updateQueue,s===null?(s=uo(),jt.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function Wc(i,s,c,p){s.value=c,s.getSnapshot=p,Os(s)&&Wl(i)}function Kl(i,s,c){return c(function(){Os(s)&&Wl(i)})}function Os(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!ja(i,c)}catch{return!0}}function Wl(i){var s=Ur(i,2);s!==null&&Jn(s,i,2)}function Jl(i){var s=_a();if(typeof i=="function"){var c=i;if(i=c(),On){P(!0);try{c()}finally{P(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:i},s}function ec(i,s,c,p){return i.baseState=c,po(i,ui,typeof p=="function"?p:ga)}function Jc(i,s,c,p,x){if(Kt(i))throw Error(Ce(485));if(i=s.action,i!==null){var S={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){S.listeners.push(B)}};Mt.T!==null?c(!0):S.isTransition=!1,p(S),c=s.pending,c===null?(S.next=s.pending=S,f(s,S)):(S.next=c.next,s.pending=c.next=S)}}function f(i,s){var c=s.action,p=s.payload,x=i.state;if(s.isTransition){var S=Mt.T,B={};Mt.T=B;try{var G=c(x,p),te=Mt.S;te!==null&&te(B,G),e(i,s,G)}catch(de){l(i,s,de)}finally{Mt.T=S}}else try{S=c(x,p),e(i,s,S)}catch(de){l(i,s,de)}}function e(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(p){n(i,s,p)},function(p){return l(i,s,p)}):n(i,s,c)}function n(i,s,c){s.status="fulfilled",s.value=c,u(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,f(i,c)))}function l(i,s,c){var p=i.pending;if(i.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=c,u(s),s=s.next;while(s!==p)}i.action=null}function u(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function m(i,s){return s}function y(i,s){if(Et){var c=Di.formState;if(c!==null){e:{var p=jt;if(Et){if(cn){t:{for(var x=cn,S=un;x.nodeType!==8;){if(!S){x=null;break t}if(x=Xr(x.nextSibling),x===null){x=null;break t}}S=x.data,x=S==="F!"||S==="F"?x:null}if(x){cn=Xr(x.nextSibling),p=x.data==="F!";break e}}us(p)}p=!1}p&&(s=c[0])}}return c=_a(),c.memoizedState=c.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:s},c.queue=p,c=hi.bind(null,jt,p),p.dispatch=c,p=Jl(!1),S=gi.bind(null,jt,!1,p.queue),p=_a(),x={state:s,dispatch:null,action:i,pending:null},p.queue=x,c=Jc.bind(null,jt,x,S,c),x.dispatch=c,p.memoizedState=i,[s,c,!1]}function b(i){var s=zi();return T(s,ui,i)}function T(i,s,c){s=po(i,s,m)[0],i=fo(ga)[0],s=typeof s=="object"&&s!==null&&typeof s.then=="function"?ho(s):s;var p=zi(),x=p.queue,S=x.dispatch;return c!==p.memoizedState&&(jt.flags|=2048,D(9,E.bind(null,x,c),{destroy:void 0},null)),[s,S,i]}function E(i,s){i.action=s}function z(i){var s=zi(),c=ui;if(c!==null)return T(s,c,i);zi(),s=s.memoizedState,c=zi();var p=c.queue.dispatch;return c.memoizedState=i,[s,p,!1]}function D(i,s,c,p){return i={tag:i,create:s,inst:c,deps:p,next:null},s=jt.updateQueue,s===null&&(s=uo(),jt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(p=c.next,c.next=i,i.next=p,s.lastEffect=i),i}function I(){return zi().memoizedState}function j(i,s,c,p){var x=_a();jt.flags|=i,x.memoizedState=D(1|s,c,{destroy:void 0},p===void 0?null:p)}function N(i,s,c,p){var x=zi();p=p===void 0?null:p;var S=x.memoizedState.inst;ui!==null&&p!==null&&Yl(p,ui.memoizedState.deps)?x.memoizedState=D(s,c,S,p):(jt.flags|=i,x.memoizedState=D(1|s,c,S,p))}function X(i,s){j(8390656,8,i,s)}function $(i,s){N(2048,8,i,s)}function Y(i,s){return N(4,2,i,s)}function W(i,s){return N(4,4,i,s)}function ie(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function ne(i,s,c){c=c!=null?c.concat([i]):null,N(4,4,ie.bind(null,s,i),c)}function ae(){}function le(i,s){var c=zi();s=s===void 0?null:s;var p=c.memoizedState;return s!==null&&Yl(s,p[1])?p[0]:(c.memoizedState=[i,s],i)}function se(i,s){var c=zi();s=s===void 0?null:s;var p=c.memoizedState;if(s!==null&&Yl(s,p[1]))return p[0];if(p=i(),On){P(!0);try{i()}finally{P(!1)}}return c.memoizedState=[p,s],p}function ye(i,s,c){return c===void 0||(nr&1073741824)!==0?i.memoizedState=s:(i.memoizedState=c,i=ah(),jt.lanes|=i,ml|=i,c)}function we(i,s,c,p){return ja(c,s)?c:ma.current!==null?(i=ye(i,c,p),ja(i,s)||(Pn=!0),i):(nr&42)===0?(Pn=!0,i.memoizedState=c):(i=ah(),jt.lanes|=i,ml|=i,s)}function De(i,s,c,p,x){var S=We.p;We.p=S!==0&&8>S?S:8;var B=Mt.T,G={};Mt.T=G,gi(i,!1,s,c);try{var te=x(),de=Mt.S;if(de!==null&&de(G,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var Oe=yd(te,p);mi(i,s,Oe,Fn(i))}else mi(i,s,p,Fn(i))}catch(He){mi(i,s,{then:function(){},status:"rejected",reason:He},Fn())}finally{We.p=S,Mt.T=B}}function Ie(){}function ze(i,s,c,p){if(i.tag!==5)throw Error(Ce(476));var x=Ye(i).queue;De(i,x,s,Ct,c===null?Ie:function(){return $e(i),c(p)})}function Ye(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:Ct,baseState:Ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:Ct},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function $e(i){var s=Ye(i).next.queue;mi(i,s,{},Fn())}function Fe(){return aa(Z)}function rt(){return zi().memoizedState}function dt(){return zi().memoizedState}function ni(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=Fn();i=ol(c);var p=Zs(s,i,c);p!==null&&(Jn(p,s,c),ic(p,s,c)),s={cache:Ko()},i.payload=s;return}s=s.return}}function bi(i,s,c){var p=Fn();c={lane:p,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},Kt(i)?di(s,c):(c=jc(i,s,c,p),c!==null&&(Jn(c,i,p),zn(c,s,p)))}function hi(i,s,c){var p=Fn();mi(i,s,c,p)}function mi(i,s,c,p){var x={lane:p,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(Kt(i))di(s,x);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var B=s.lastRenderedState,G=S(B,c);if(x.hasEagerState=!0,x.eagerState=G,ja(G,B))return Nl(i,s,x,0),Di===null&&Fc(),!1}catch{}finally{}if(c=jc(i,s,x,p),c!==null)return Jn(c,i,p),zn(c,s,p),!0}return!1}function gi(i,s,c,p){if(p={lane:2,revertLane:Xd(),action:p,hasEagerState:!1,eagerState:null,next:null},Kt(i)){if(s)throw Error(Ce(479))}else s=jc(i,c,p,2),s!==null&&Jn(s,i,2)}function Kt(i){var s=i.alternate;return i===jt||s!==null&&s===jt}function di(i,s){Jo=Ls=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function zn(i,s,c){if((c&4194176)!==0){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,ke(i,c)}}var wi={readContext:aa,use:rr,useCallback:Fi,useContext:Fi,useEffect:Fi,useImperativeHandle:Fi,useLayoutEffect:Fi,useInsertionEffect:Fi,useMemo:Fi,useReducer:Fi,useRef:Fi,useState:Fi,useDebugValue:Fi,useDeferredValue:Fi,useTransition:Fi,useSyncExternalStore:Fi,useId:Fi};wi.useCacheRefresh=Fi,wi.useMemoCache=Fi,wi.useHostTransitionStatus=Fi,wi.useFormState=Fi,wi.useActionState=Fi,wi.useOptimistic=Fi;var Pi={readContext:aa,use:rr,useCallback:function(i,s){return _a().memoizedState=[i,s===void 0?null:s],i},useContext:aa,useEffect:X,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,j(4194308,4,ie.bind(null,s,i),c)},useLayoutEffect:function(i,s){return j(4194308,4,i,s)},useInsertionEffect:function(i,s){j(4,2,i,s)},useMemo:function(i,s){var c=_a();s=s===void 0?null:s;var p=i();if(On){P(!0);try{i()}finally{P(!1)}}return c.memoizedState=[p,s],p},useReducer:function(i,s,c){var p=_a();if(c!==void 0){var x=c(s);if(On){P(!0);try{c(s)}finally{P(!1)}}}else x=s;return p.memoizedState=p.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},p.queue=i,i=i.dispatch=bi.bind(null,jt,i),[p.memoizedState,i]},useRef:function(i){var s=_a();return i={current:i},s.memoizedState=i},useState:function(i){i=Jl(i);var s=i.queue,c=hi.bind(null,jt,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:ae,useDeferredValue:function(i,s){var c=_a();return ye(c,i,s)},useTransition:function(){var i=Jl(!1);return i=De.bind(null,jt,i.queue,!0,!1),_a().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var p=jt,x=_a();if(Et){if(c===void 0)throw Error(Ce(407));c=c()}else{if(c=s(),Di===null)throw Error(Ce(349));(ei&60)!==0||Bs(p,s,c)}x.memoizedState=c;var S={value:c,getSnapshot:s};return x.queue=S,X(Kl.bind(null,p,S,i),[i]),p.flags|=2048,D(9,Wc.bind(null,p,S,c,s),{destroy:void 0},null),c},useId:function(){var i=_a(),s=Di.identifierPrefix;if(Et){var c=er,p=Va;c=(p&~(1<<32-V(p)-1)).toString(32)+c,s=":"+s+"R"+c,c=co++,0<c&&(s+="H"+c.toString(32)),s+=":"}else c=Xl++,s=":"+s+"r"+c.toString(32)+":";return i.memoizedState=s},useCacheRefresh:function(){return _a().memoizedState=ni.bind(null,jt)}};Pi.useMemoCache=el,Pi.useHostTransitionStatus=Fe,Pi.useFormState=y,Pi.useActionState=y,Pi.useOptimistic=function(i){var s=_a();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=gi.bind(null,jt,!0,c),c.dispatch=s,[i,s]};var ji={readContext:aa,use:rr,useCallback:le,useContext:aa,useEffect:$,useImperativeHandle:ne,useInsertionEffect:Y,useLayoutEffect:W,useMemo:se,useReducer:fo,useRef:I,useState:function(){return fo(ga)},useDebugValue:ae,useDeferredValue:function(i,s){var c=zi();return we(c,ui.memoizedState,i,s)},useTransition:function(){var i=fo(ga)[0],s=zi().memoizedState;return[typeof i=="boolean"?i:ho(i),s]},useSyncExternalStore:mo,useId:rt};ji.useCacheRefresh=dt,ji.useMemoCache=el,ji.useHostTransitionStatus=Fe,ji.useFormState=b,ji.useActionState=b,ji.useOptimistic=function(i,s){var c=zi();return ec(c,ui,i,s)};var Ea={readContext:aa,use:rr,useCallback:le,useContext:aa,useEffect:$,useImperativeHandle:ne,useInsertionEffect:Y,useLayoutEffect:W,useMemo:se,useReducer:Ql,useRef:I,useState:function(){return Ql(ga)},useDebugValue:ae,useDeferredValue:function(i,s){var c=zi();return ui===null?ye(c,i,s):we(c,ui.memoizedState,i,s)},useTransition:function(){var i=Ql(ga)[0],s=zi().memoizedState;return[typeof i=="boolean"?i:ho(i),s]},useSyncExternalStore:mo,useId:rt};Ea.useCacheRefresh=dt,Ea.useMemoCache=el,Ea.useHostTransitionStatus=Fe,Ea.useFormState=z,Ea.useActionState=z,Ea.useOptimistic=function(i,s){var c=zi();return ui!==null?ec(c,ui,i,s):(c.baseState=i,[i,c.queue.dispatch])};function Sr(i,s,c,p){s=i.memoizedState,c=c(p,s),c=c==null?s:ti({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var sr={isMounted:function(i){return(i=i._reactInternals)?Tt(i)===i:!1},enqueueSetState:function(i,s,c){i=i._reactInternals;var p=Fn(),x=ol(p);x.payload=s,c!=null&&(x.callback=c),s=Zs(i,x,p),s!==null&&(Jn(s,i,p),ic(s,i,p))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var p=Fn(),x=ol(p);x.tag=1,x.payload=s,c!=null&&(x.callback=c),s=Zs(i,x,p),s!==null&&(Jn(s,i,p),ic(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=Fn(),p=ol(c);p.tag=2,s!=null&&(p.callback=s),s=Zs(i,p,c),s!==null&&(Jn(s,i,c),ic(s,i,c))}};function Ga(i,s,c,p,x,S,B){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,S,B):s.prototype&&s.prototype.isPureReactComponent?!Bl(c,p)||!Bl(x,S):!0}function Fs(i,s,c,p){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,p),s.state!==i&&sr.enqueueReplaceState(s,s.state,null)}function Mr(i,s){var c=s;if("ref"in s){c={};for(var p in s)p!=="ref"&&(c[p]=s[p])}if(i=i.defaultProps){c===s&&(c=ti({},c));for(var x in i)c[x]===void 0&&(c[x]=i[x])}return c}var qr=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function qa(i){qr(i)}function Er(i){console.error(i)}function or(i){qr(i)}function Ha(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function yi(i,s,c){try{var p=i.onCaughtError;p(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function fi(i,s,c){return c=ol(c),c.tag=3,c.payload={element:null},c.callback=function(){Ha(i,s)},c}function xn(i){return i=ol(i),i.tag=3,i}function bn(i,s,c,p){var x=c.type.getDerivedStateFromError;if(typeof x=="function"){var S=p.value;i.payload=function(){return x(S)},i.callback=function(){yi(s,c,p)}}var B=c.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(i.callback=function(){yi(s,c,p),typeof x!="function"&&(_l===null?_l=new Set([this]):_l.add(this));var G=p.stack;this.componentDidCatch(p.value,{componentStack:G!==null?G:""})})}function _o(i,s,c,p,x){if(c.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=c.alternate,s!==null&&go(s,c,x,!0),c=tr.current,c!==null){switch(c.tag){case 13:return Za===null?oh():c.alternate===null&&wn===0&&(wn=3),c.flags&=-257,c.flags|=65536,c.lanes=x,p===Zc?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([p]):s.add(p),Gd(i,p,x)),!1;case 22:return c.flags|=65536,p===Zc?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([p]):c.add(p)),Gd(i,p,x)),!1}throw Error(Ce(435,c.tag))}return Gd(i,p,x),oh(),!1}if(Et)return s=tr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,p!==Zl&&(i=Error(Ce(422),{cause:p}),Ho(Ua(i,c)))):(p!==Zl&&(s=Error(Ce(423),{cause:p}),Ho(Ua(s,c))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,p=Ua(p,c),x=fi(i.stateNode,p,x),Fh(i,x),wn!==4&&(wn=2)),!1;var S=Error(Ce(520),{cause:p});if(S=Ua(S,c),Xi===null?Xi=[S]:Xi.push(S),wn!==4&&(wn=2),s===null)return!0;p=Ua(p,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=x&-x,c.lanes|=i,i=fi(c.stateNode,p,i),Fh(c,i),!1;case 1:if(s=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(_l===null||!_l.has(S))))return c.flags|=65536,x&=-x,c.lanes|=x,x=xn(x),bn(x,i,c,p),Fh(c,x),!1}c=c.return}while(c!==null);return!1}var Ih=Error(Ce(461)),Pn=!1;function Dn(i,s,c,p){s.child=i===null?qc(s,null,c,p):vn(s,i.child,c,p)}function Uu(i,s,c,p,x){c=c.render;var S=s.ref;if("ref"in p){var B={};for(var G in p)G!=="ref"&&(B[G]=p[G])}else B=p;return rl(s),p=na(i,s,c,B,S,x),G=ar(),i!==null&&!Pn?(Ai(i,s,x),Us(i,s,x)):(Et&&G&&As(s),s.flags|=1,Dn(i,s,p,x),s.child)}function js(i,s,c,p,x){if(i===null){var S=c.type;return typeof S=="function"&&!eh(S)&&S.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=S,Ca(i,s,S,p,x)):(i=th(c.type,null,p,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(S=i.child,!kh(i,x)){var B=S.memoizedProps;if(c=c.compare,c=c!==null?c:Bl,c(B,p)&&i.ref===s.ref)return Us(i,s,x)}return s.flags|=1,i=fl(S,p),i.ref=s.ref,i.return=s,s.child=i}function Ca(i,s,c,p,x){if(i!==null){var S=i.memoizedProps;if(Bl(S,p)&&i.ref===s.ref)if(Pn=!1,s.pendingProps=p=S,kh(i,x))(i.flags&131072)!==0&&(Pn=!0);else return s.lanes=i.lanes,Us(i,s,x)}return tl(i,s,c,p,x)}function eu(i,s,c){var p=s.pendingProps,x=p.children,S=(s.stateNode._pendingVisibility&2)!==0,B=i!==null?i.memoizedState:null;if(Ns(i,s),p.mode==="hidden"||S){if((s.flags&128)!==0){if(p=B!==null?B.baseLanes|c:c,i!==null){for(x=s.child=i.child,S=0;x!==null;)S=S|x.lanes|x.childLanes,x=x.sibling;s.childLanes=S&~p}else s.childLanes=0,s.child=null;return Vu(i,s,p,c)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&wr(s,B!==null?B.cachePool:null),B!==null?Qo(s,B):Hc(),Sa(s);else return s.lanes=s.childLanes=536870912,Vu(i,s,B!==null?B.baseLanes|c:c,c)}else B!==null?(wr(s,B.cachePool),Qo(s,B),Ke(),s.memoizedState=null):(i!==null&&wr(s,null),Hc(),Ke());return Dn(i,s,x,c),s.child}function Vu(i,s,c,p){var x=Kc();return x=x===null?null:{parent:yt._currentValue,pool:x},s.memoizedState={baseLanes:c,cachePool:x},i!==null&&wr(s,null),Hc(),Sa(s),i!==null&&go(i,s,p,!0),null}function Ns(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=2097664);else{if(typeof c!="function"&&typeof c!="object")throw Error(Ce(284));(i===null||i.ref!==c)&&(s.flags|=2097664)}}function tl(i,s,c,p,x){return rl(s),c=na(i,s,c,p,void 0,x),p=ar(),i!==null&&!Pn?(Ai(i,s,x),Us(i,s,x)):(Et&&p&&As(s),s.flags|=1,Dn(i,s,c,x),s.child)}function Zu(i,s,c,p,x,S){return rl(s),s.updateQueue=null,c=Tr(s,p,c,x),Nu(i),p=ar(),i!==null&&!Pn?(Ai(i,s,S),Us(i,s,S)):(Et&&p&&As(s),s.flags|=1,Dn(i,s,c,S),s.child)}function tc(i,s,c,p,x){if(rl(s),s.stateNode===null){var S=ss,B=c.contextType;typeof B=="object"&&B!==null&&(S=aa(B)),S=new c(p,S),s.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=sr,s.stateNode=S,S._reactInternals=s,S=s.stateNode,S.props=p,S.state=s.memoizedState,S.refs={},Sd(s),B=c.contextType,S.context=typeof B=="object"&&B!==null?aa(B):ss,S.state=s.memoizedState,B=c.getDerivedStateFromProps,typeof B=="function"&&(Sr(s,c,B,p),S.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(B=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),B!==S.state&&sr.enqueueReplaceState(S,S.state,null),Xu(s,p,S,x),vo(),S.state=s.memoizedState),typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(i===null){S=s.stateNode;var G=s.memoizedProps,te=Mr(c,G);S.props=te;var de=S.context,Oe=c.contextType;B=ss,typeof Oe=="object"&&Oe!==null&&(B=aa(Oe));var He=c.getDerivedStateFromProps;Oe=typeof He=="function"||typeof S.getSnapshotBeforeUpdate=="function",G=s.pendingProps!==G,Oe||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(G||de!==B)&&Fs(s,S,p,B),sl=!1;var Ee=s.memoizedState;S.state=Ee,Xu(s,p,S,x),vo(),de=s.memoizedState,G||Ee!==de||sl?(typeof He=="function"&&(Sr(s,c,He,p),de=s.memoizedState),(te=sl||Ga(s,c,te,p,Ee,de,B))?(Oe||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=de),S.props=p,S.state=de,S.context=B,p=te):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{S=s.stateNode,Md(i,s),B=s.memoizedProps,Oe=Mr(c,B),S.props=Oe,He=s.pendingProps,Ee=S.context,de=c.contextType,te=ss,typeof de=="object"&&de!==null&&(te=aa(de)),G=c.getDerivedStateFromProps,(de=typeof G=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(B!==He||Ee!==te)&&Fs(s,S,p,te),sl=!1,Ee=s.memoizedState,S.state=Ee,Xu(s,p,S,x),vo();var Le=s.memoizedState;B!==He||Ee!==Le||sl||i!==null&&i.dependencies!==null&&Aa(i.dependencies)?(typeof G=="function"&&(Sr(s,c,G,p),Le=s.memoizedState),(Oe=sl||Ga(s,c,Oe,p,Ee,Le,te)||i!==null&&i.dependencies!==null&&Aa(i.dependencies))?(de||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,Le,te),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,Le,te)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||B===i.memoizedProps&&Ee===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||B===i.memoizedProps&&Ee===i.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=Le),S.props=p,S.state=Le,S.context=te,p=Oe):(typeof S.componentDidUpdate!="function"||B===i.memoizedProps&&Ee===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||B===i.memoizedProps&&Ee===i.memoizedState||(s.flags|=1024),p=!1)}return S=p,Ns(i,s),p=(s.flags&128)!==0,S||p?(S=s.stateNode,c=p&&typeof c.getDerivedStateFromError!="function"?null:S.render(),s.flags|=1,i!==null&&p?(s.child=vn(s,i.child,null,x),s.child=vn(s,null,c,x)):Dn(i,s,c,x),s.memoizedState=S.state,i=s.child):i=Us(i,s,x),i}function pf(i,s,c,p){return Gr(),s.flags|=256,Dn(i,s,c,p),s.child}var Gu={dehydrated:null,treeContext:null,retryLane:0};function xd(i){return{baseLanes:i,cachePool:Ei()}}function qu(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=cr),i}function bd(i,s,c){var p=s.pendingProps,x=!1,S=(s.flags&128)!==0,B;if((B=S)||(B=i!==null&&i.memoizedState===null?!1:(hn.current&2)!==0),B&&(x=!0,s.flags&=-129),B=(s.flags&32)!==0,s.flags&=-33,i===null){if(Et){if(x?ir(s):Ke(),Et){var G=cn,te;if(te=G){e:{for(te=G,G=un;te.nodeType!==8;){if(!G){G=null;break e}if(te=Xr(te.nextSibling),te===null){G=null;break e}}G=te}G!==null?(s.memoizedState={dehydrated:G,treeContext:Cs!==null?{id:Va,overflow:er}:null,retryLane:536870912},te=Pa(18,null,null,0),te.stateNode=G,te.return=s,s.child=te,Qn=s,cn=null,te=!0):te=!1}te||us(s)}if(G=s.memoizedState,G!==null&&(G=G.dehydrated,G!==null))return G.data==="$!"?s.lanes=16:s.lanes=536870912,null;Ma(s)}return G=p.children,p=p.fallback,x?(Ke(),x=s.mode,G=il({mode:"hidden",children:G},x),p=pl(p,x,c,null),G.return=s,p.return=s,G.sibling=p,s.child=G,x=s.child,x.memoizedState=xd(c),x.childLanes=qu(i,B,c),s.memoizedState=Gu,p):(ir(s),Rh(s,G))}if(te=i.memoizedState,te!==null&&(G=te.dehydrated,G!==null)){if(S)s.flags&256?(ir(s),s.flags&=-257,s=wd(i,s,c)):s.memoizedState!==null?(Ke(),s.child=i.child,s.flags|=128,s=null):(Ke(),x=p.fallback,G=s.mode,p=il({mode:"visible",children:p.children},G),x=pl(x,G,c,null),x.flags|=2,p.return=s,x.return=s,p.sibling=x,s.child=p,vn(s,i.child,null,c),p=s.child,p.memoizedState=xd(c),p.childLanes=qu(i,B,c),s.memoizedState=Gu,s=x);else if(ir(s),G.data==="$!"){if(B=G.nextSibling&&G.nextSibling.dataset,B)var de=B.dgst;B=de,p=Error(Ce(419)),p.stack="",p.digest=B,Ho({value:p,source:null,stack:null}),s=wd(i,s,c)}else if(Pn||go(i,s,c,!1),B=(c&i.childLanes)!==0,Pn||B){if(B=Di,B!==null){if(p=c&-c,(p&42)!==0)p=1;else switch(p){case 2:p=1;break;case 8:p=4;break;case 32:p=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:p=64;break;case 268435456:p=134217728;break;default:p=0}if(p=(p&(B.suspendedLanes|c))!==0?0:p,p!==0&&p!==te.retryLane)throw te.retryLane=p,Ur(i,p),Jn(B,i,p),Ih}G.data==="$?"||oh(),s=wd(i,s,c)}else G.data==="$?"?(s.flags|=128,s.child=i.child,s=Kf.bind(null,i),G._reactRetry=s,s=null):(i=te.treeContext,cn=Xr(G.nextSibling),Qn=s,Et=!0,Kn=null,un=!1,i!==null&&(pa[Ja++]=Va,pa[Ja++]=er,pa[Ja++]=Cs,Va=i.id,er=i.overflow,Cs=s),s=Rh(s,p.children),s.flags|=4096);return s}return x?(Ke(),x=p.fallback,G=s.mode,te=i.child,de=te.sibling,p=fl(te,{mode:"hidden",children:p.children}),p.subtreeFlags=te.subtreeFlags&31457280,de!==null?x=fl(de,x):(x=pl(x,G,c,null),x.flags|=2),x.return=s,p.return=s,p.sibling=x,s.child=p,p=x,x=s.child,G=i.child.memoizedState,G===null?G=xd(c):(te=G.cachePool,te!==null?(de=yt._currentValue,te=te.parent!==de?{parent:de,pool:de}:te):te=Ei(),G={baseLanes:G.baseLanes|c,cachePool:te}),x.memoizedState=G,x.childLanes=qu(i,B,c),s.memoizedState=Gu,p):(ir(s),c=i.child,i=c.sibling,c=fl(c,{mode:"visible",children:p.children}),c.return=s,c.sibling=null,i!==null&&(B=s.deletions,B===null?(s.deletions=[i],s.flags|=16):B.push(i)),s.child=c,s.memoizedState=null,c)}function Rh(i,s){return s=il({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function il(i,s){return Sf(i,s,0,null)}function wd(i,s,c){return vn(s,i.child,null,c),i=Rh(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function tu(i,s,c){i.lanes|=s;var p=i.alternate;p!==null&&(p.lanes|=s),Bh(i.return,s,c)}function iu(i,s,c,p,x){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:x}:(S.isBackwards=s,S.rendering=null,S.renderingStartTime=0,S.last=p,S.tail=c,S.tailMode=x)}function Hu(i,s,c){var p=s.pendingProps,x=p.revealOrder,S=p.tail;if(Dn(i,s,p.children,c),p=hn.current,(p&2)!==0)p=p&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&tu(i,c,s);else if(i.tag===19)tu(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}p&=1}switch(_i(hn,p),x){case"forwards":for(c=s.child,x=null;c!==null;)i=c.alternate,i!==null&&Hl(i)===null&&(x=c),c=c.sibling;c=x,c===null?(x=s.child,s.child=null):(x=c.sibling,c.sibling=null),iu(s,!1,x,c,S);break;case"backwards":for(c=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&Hl(i)===null){s.child=x;break}i=x.sibling,x.sibling=c,c=x,x=i}iu(s,!0,c,null,S);break;case"together":iu(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Us(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),ml|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(go(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(Ce(153));if(s.child!==null){for(i=s.child,c=fl(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=fl(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function kh(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&Aa(i)))}function Gf(i,s,c){switch(s.tag){case 3:Dr(s,s.stateNode.containerInfo),al(s,yt,i.memoizedState.cache),Gr();break;case 27:case 5:Da(s);break;case 4:Dr(s,s.stateNode.containerInfo);break;case 10:al(s,s.type,s.memoizedProps.value);break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(ir(s),s.flags|=128,null):(c&s.child.childLanes)!==0?bd(i,s,c):(ir(s),i=Us(i,s,c),i!==null?i.sibling:null);ir(s);break;case 19:var x=(i.flags&128)!==0;if(p=(c&s.childLanes)!==0,p||(go(i,s,c,!1),p=(c&s.childLanes)!==0),x){if(p)return Hu(i,s,c);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),_i(hn,hn.current),p)break;return null;case 22:case 23:return s.lanes=0,eu(i,s,c);case 24:al(s,yt,i.memoizedState.cache)}return Us(i,s,c)}function mf(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)Pn=!0;else{if(!kh(i,c)&&(s.flags&128)===0)return Pn=!1,Gf(i,s,c);Pn=(i.flags&131072)!==0}else Pn=!1,Et&&(s.flags&1048576)!==0&&Uc(s,Vl,s.index);switch(s.lanes=0,s.tag){case 16:e:{i=s.pendingProps;var p=s.elementType,x=p._init;if(p=x(p._payload),s.type=p,typeof p=="function")eh(p)?(i=Mr(p,i),s.tag=1,s=tc(null,s,p,i,c)):(s.tag=0,s=tl(null,s,p,i,c));else{if(p!=null){if(x=p.$$typeof,x===at){s.tag=11,s=Uu(null,s,p,i,c);break e}else if(x===la){s.tag=14,s=js(null,s,p,i,c);break e}}throw s=pi(p)||p,Error(Ce(306,s,""))}}return s;case 0:return tl(i,s,s.type,s.pendingProps,c);case 1:return p=s.type,x=Mr(p,s.pendingProps),tc(i,s,p,x,c);case 3:e:{if(Dr(s,s.stateNode.containerInfo),i===null)throw Error(Ce(387));var S=s.pendingProps;x=s.memoizedState,p=x.element,Md(i,s),Xu(s,S,null,c);var B=s.memoizedState;if(S=B.cache,al(s,yt,S),S!==x.cache&&$u(s,[yt],c,!0),vo(),S=B.element,x.isDehydrated)if(x={element:S,isDehydrated:!1,cache:B.cache},s.updateQueue.baseState=x,s.memoizedState=x,s.flags&256){s=pf(i,s,S,c);break e}else if(S!==p){p=Ua(Error(Ce(424)),s),Ho(p),s=pf(i,s,S,c);break e}else for(cn=Xr(s.stateNode.containerInfo.firstChild),Qn=s,Et=!0,Kn=null,un=!0,c=qc(s,null,S,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Gr(),S===p){s=Us(i,s,c);break e}Dn(i,s,S,c)}s=s.child}return s;case 26:return Ns(i,s),i===null?(c=hd(s.type,null,s.pendingProps,null))?s.memoizedState=c:Et||(c=s.type,i=s.pendingProps,p=hh(ta.current).createElement(c),p[xt]=s,p[et]=i,ra(p,c,i),Zi(p),s.stateNode=p):s.memoizedState=hd(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return Da(s),i===null&&Et&&(p=s.stateNode=cd(s.type,s.pendingProps,ta.current),Qn=s,un=!0,cn=Xr(p.firstChild)),p=s.pendingProps.children,i!==null||Et?Dn(i,s,p,c):s.child=vn(s,null,p,c),Ns(i,s),s.child;case 5:return i===null&&Et&&((x=p=cn)&&(p=xl(p,s.type,s.pendingProps,un),p!==null?(s.stateNode=p,Qn=s,cn=Xr(p.firstChild),un=!1,x=!0):x=!1),x||us(s)),Da(s),x=s.type,S=s.pendingProps,B=i!==null?i.memoizedProps:null,p=S.children,xu(x,S)?p=null:B!==null&&xu(x,B)&&(s.flags|=32),s.memoizedState!==null&&(x=na(i,s,vd,null,null,c),Z._currentValue=x),Ns(i,s),Dn(i,s,p,c),s.child;case 6:return i===null&&Et&&((i=c=cn)&&(c=nf(c,s.pendingProps,un),c!==null?(s.stateNode=c,Qn=s,cn=null,i=!0):i=!1),i||us(s)),null;case 13:return bd(i,s,c);case 4:return Dr(s,s.stateNode.containerInfo),p=s.pendingProps,i===null?s.child=vn(s,null,p,c):Dn(i,s,p,c),s.child;case 11:return Uu(i,s,s.type,s.pendingProps,c);case 7:return Dn(i,s,s.pendingProps,c),s.child;case 8:return Dn(i,s,s.pendingProps.children,c),s.child;case 12:return Dn(i,s,s.pendingProps.children,c),s.child;case 10:return p=s.pendingProps,al(s,s.type,p.value),Dn(i,s,p.children,c),s.child;case 9:return x=s.type._context,p=s.pendingProps.children,rl(s),x=aa(x),p=p(x),s.flags|=1,Dn(i,s,p,c),s.child;case 14:return js(i,s,s.type,s.pendingProps,c);case 15:return Ca(i,s,s.type,s.pendingProps,c);case 19:return Hu(i,s,c);case 22:return eu(i,s,c);case 24:return rl(s),p=aa(yt),i===null?(x=Kc(),x===null&&(x=Di,S=Ko(),x.pooledCache=S,S.refCount++,S!==null&&(x.pooledCacheLanes|=c),x=S),s.memoizedState={parent:p,cache:x},Sd(s),al(s,yt,x)):((i.lanes&c)!==0&&(Md(i,s),Xu(s,null,null,c),vo()),x=i.memoizedState,S=s.memoizedState,x.parent!==p?(x={parent:p,cache:p},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),al(s,yt,p)):(p=S.cache,al(s,yt,p),p!==x.cache&&$u(s,[yt],c,!0))),Dn(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Ce(156,s.tag))}var Lh=Yt(null),nl=null,Vs=null;function al(i,s,c){_i(Lh,s._currentValue),s._currentValue=c}function ds(i){i._currentValue=Lh.current,oi(Lh)}function Bh(i,s,c){for(;i!==null;){var p=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),i===c)break;i=i.return}}function $u(i,s,c,p){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var S=x.dependencies;if(S!==null){var B=x.child;S=S.firstContext;e:for(;S!==null;){var G=S;S=x;for(var te=0;te<s.length;te++)if(G.context===s[te]){S.lanes|=c,G=S.alternate,G!==null&&(G.lanes|=c),Bh(S.return,c,i),p||(B=null);break e}S=G.next}}else if(x.tag===18){if(B=x.return,B===null)throw Error(Ce(341));B.lanes|=c,S=B.alternate,S!==null&&(S.lanes|=c),Bh(B,c,i),B=null}else B=x.child;if(B!==null)B.return=x;else for(B=x;B!==null;){if(B===i){B=null;break}if(x=B.sibling,x!==null){x.return=B.return,B=x;break}B=B.return}x=B}}function go(i,s,c,p){i=null;for(var x=s,S=!1;x!==null;){if(!S){if((x.flags&524288)!==0)S=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var B=x.alternate;if(B===null)throw Error(Ce(387));if(B=B.memoizedProps,B!==null){var G=x.type;ja(x.pendingProps.value,B.value)||(i!==null?i.push(G):i=[G])}}else if(x===Li.current){if(B=x.alternate,B===null)throw Error(Ce(387));B.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(Z):i=[Z])}x=x.return}i!==null&&$u(s,i,c,p),s.flags|=262144}function Aa(i){for(i=i.firstContext;i!==null;){if(!ja(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function rl(i){nl=i,Vs=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function aa(i){return Td(nl,i)}function Oh(i,s){return nl===null&&rl(i),Td(i,s)}function Td(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},Vs===null){if(i===null)throw Error(Ce(308));Vs=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Vs=Vs.next=s;return c}var sl=!1;function Sd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Md(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ol(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Zs(i,s,c){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(nn&2)!==0){var x=p.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),p.pending=s,s=Vr(i),Ul(i,null,c),s}return Nl(i,p,s,c),Vr(i)}function ic(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194176)!==0)){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,ke(i,c)}}function Fh(i,s){var c=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var x=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var B={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?x=S=B:S=S.next=B,c=c.next}while(c!==null);S===null?x=S=s:S=S.next=s}else x=S=s;c={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:S,shared:p.shared,callbacks:p.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var yo=!1;function vo(){if(yo){var i=Rs;if(i!==null)throw i}}function Xu(i,s,c,p){yo=!1;var x=i.updateQueue;sl=!1;var S=x.firstBaseUpdate,B=x.lastBaseUpdate,G=x.shared.pending;if(G!==null){x.shared.pending=null;var te=G,de=te.next;te.next=null,B===null?S=de:B.next=de,B=te;var Oe=i.alternate;Oe!==null&&(Oe=Oe.updateQueue,G=Oe.lastBaseUpdate,G!==B&&(G===null?Oe.firstBaseUpdate=de:G.next=de,Oe.lastBaseUpdate=te))}if(S!==null){var He=x.baseState;B=0,Oe=de=te=null,G=S;do{var Ee=G.lane&-536870913,Le=Ee!==G.lane;if(Le?(ei&Ee)===Ee:(p&Ee)===Ee){Ee!==0&&Ee===Is&&(yo=!0),Oe!==null&&(Oe=Oe.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var bt=i,Nt=G;Ee=s;var Mn=c;switch(Nt.tag){case 1:if(bt=Nt.payload,typeof bt=="function"){He=bt.call(Mn,He,Ee);break e}He=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=Nt.payload,Ee=typeof bt=="function"?bt.call(Mn,He,Ee):bt,Ee==null)break e;He=ti({},He,Ee);break e;case 2:sl=!0}}Ee=G.callback,Ee!==null&&(i.flags|=64,Le&&(i.flags|=8192),Le=x.callbacks,Le===null?x.callbacks=[Ee]:Le.push(Ee))}else Le={lane:Ee,tag:G.tag,payload:G.payload,callback:G.callback,next:null},Oe===null?(de=Oe=Le,te=He):Oe=Oe.next=Le,B|=Ee;if(G=G.next,G===null){if(G=x.shared.pending,G===null)break;Le=G,G=Le.next,Le.next=null,x.lastBaseUpdate=Le,x.shared.pending=null}}while(!0);Oe===null&&(te=He),x.baseState=te,x.firstBaseUpdate=de,x.lastBaseUpdate=Oe,S===null&&(x.shared.lanes=0),ml|=B,i.lanes=B,i.memoizedState=He}}function _f(i,s){if(typeof i!="function")throw Error(Ce(191,i));i.call(s)}function gf(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)_f(c[i],s)}function Yu(i,s){try{var c=s.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var x=p.next;c=x;do{if((c.tag&i)===i){p=void 0;var S=c.create,B=c.inst;p=S(),B.destroy=p}c=c.next}while(c!==x)}}catch(G){Ii(s,s.return,G)}}function ll(i,s,c){try{var p=s.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var S=x.next;p=S;do{if((p.tag&i)===i){var B=p.inst,G=B.destroy;if(G!==void 0){B.destroy=void 0,x=s;var te=c;try{G()}catch(de){Ii(x,te,de)}}}p=p.next}while(p!==S)}}catch(de){Ii(s,s.return,de)}}function yf(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{gf(s,c)}catch(p){Ii(i,i.return,p)}}}function vf(i,s,c){c.props=Mr(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(p){Ii(i,s,p)}}function xo(i,s){try{var c=i.ref;if(c!==null){var p=i.stateNode;switch(i.tag){case 26:case 27:case 5:var x=p;break;default:x=p}typeof c=="function"?i.refCleanup=c(x):c.current=x}}catch(S){Ii(i,s,S)}}function Cr(i,s){var c=i.ref,p=i.refCleanup;if(c!==null)if(typeof p=="function")try{p()}catch(x){Ii(i,s,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(x){Ii(i,s,x)}else c.current=null}function Ed(i){var s=i.type,c=i.memoizedProps,p=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&p.focus();break e;case"img":c.src?p.src=c.src:c.srcSet&&(p.srcset=c.srcSet)}}catch(x){Ii(i,i.return,x)}}function nu(i,s,c){try{var p=i.stateNode;Ff(p,i.type,c,s),p[et]=s}catch(x){Ii(i,i.return,x)}}function xf(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27||i.tag===4}function qi(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||xf(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==27&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function cl(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?c.nodeType===8?c.parentNode.insertBefore(i,s):c.insertBefore(i,s):(c.nodeType===8?(s=c.parentNode,s.insertBefore(i,c)):(s=c,s.appendChild(i)),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=ms));else if(p!==4&&p!==27&&(i=i.child,i!==null))for(cl(i,s,c),i=i.sibling;i!==null;)cl(i,s,c),i=i.sibling}function Qu(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(p!==4&&p!==27&&(i=i.child,i!==null))for(Qu(i,s,c),i=i.sibling;i!==null;)Qu(i,s,c),i=i.sibling}var Hr=!1,Hi=!1,nc=!1,Cd=typeof WeakSet=="function"?WeakSet:Set,Wn=null,au=!1;function Ad(i,s){if(i=i.containerInfo,Jd=Ge,i=Ru(i),Uo(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var x=p.anchorOffset,S=p.focusNode;p=p.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var B=0,G=-1,te=-1,de=0,Oe=0,He=i,Ee=null;t:for(;;){for(var Le;He!==c||x!==0&&He.nodeType!==3||(G=B+x),He!==S||p!==0&&He.nodeType!==3||(te=B+p),He.nodeType===3&&(B+=He.nodeValue.length),(Le=He.firstChild)!==null;)Ee=He,He=Le;for(;;){if(He===i)break t;if(Ee===c&&++de===x&&(G=B),Ee===S&&++Oe===p&&(te=B),(Le=He.nextSibling)!==null)break;He=Ee,Ee=He.parentNode}He=Le}c=G===-1||te===-1?null:{start:G,end:te}}else c=null}c=c||{start:0,end:0}}else c=null;for(ef={focusedElem:i,selectionRange:c},Ge=!1,Wn=s;Wn!==null;)if(s=Wn,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Wn=i;else for(;Wn!==null;){switch(s=Wn,S=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,c=s,x=S.memoizedProps,S=S.memoizedState,p=c.stateNode;try{var bt=Mr(c.type,x,c.elementType===c.type);i=p.getSnapshotBeforeUpdate(bt,S),p.__reactInternalSnapshotBeforeUpdate=i}catch(Nt){Ii(c,c.return,Nt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)jn(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":jn(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(Ce(163))}if(i=s.sibling,i!==null){i.return=s.return,Wn=i;break}Wn=s.return}return bt=au,au=!1,bt}function ac(i,s,c){var p=c.flags;switch(c.tag){case 0:case 11:case 15:wo(i,c),p&4&&Yu(5,c);break;case 1:if(wo(i,c),p&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(G){Ii(c,c.return,G)}else{var x=Mr(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(x,s,i.__reactInternalSnapshotBeforeUpdate)}catch(G){Ii(c,c.return,G)}}p&64&&yf(c),p&512&&xo(c,c.return);break;case 3:if(wo(i,c),p&64&&(p=c.updateQueue,p!==null)){if(i=null,c.child!==null)switch(c.child.tag){case 27:case 5:i=c.child.stateNode;break;case 1:i=c.child.stateNode}try{gf(p,i)}catch(G){Ii(c,c.return,G)}}break;case 26:wo(i,c),p&512&&xo(c,c.return);break;case 27:case 5:wo(i,c),s===null&&p&4&&Ed(c),p&512&&xo(c,c.return);break;case 12:wo(i,c);break;case 13:wo(i,c),p&4&&ul(i,c);break;case 22:if(x=c.memoizedState!==null||Hr,!x){s=s!==null&&s.memoizedState!==null||Hi;var S=Hr,B=Hi;Hr=x,(Hi=s)&&!B?hl(i,c,(c.subtreeFlags&8772)!==0):wo(i,c),Hr=S,Hi=B}p&512&&(c.memoizedProps.mode==="manual"?xo(c,c.return):Cr(c,c.return));break;default:wo(i,c)}}function Ku(i){var s=i.alternate;s!==null&&(i.alternate=null,Ku(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&ci(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var $i=null,ya=!1;function bo(i,s,c){for(c=c.child;c!==null;)zd(i,s,c),c=c.sibling}function zd(i,s,c){if(on&&typeof on.onCommitFiberUnmount=="function")try{on.onCommitFiberUnmount(Kr,c)}catch{}switch(c.tag){case 26:Hi||Cr(c,s),bo(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Hi||Cr(c,s);var p=$i,x=ya;for($i=c.stateNode,bo(i,s,c),c=c.stateNode,s=c.attributes;s.length;)c.removeAttributeNode(s[0]);ci(c),$i=p,ya=x;break;case 5:Hi||Cr(c,s);case 6:x=$i;var S=ya;if($i=null,bo(i,s,c),$i=x,ya=S,$i!==null)if(ya)try{i=$i,p=c.stateNode,i.nodeType===8?i.parentNode.removeChild(p):i.removeChild(p)}catch(B){Ii(c,s,B)}else try{$i.removeChild(c.stateNode)}catch(B){Ii(c,s,B)}break;case 18:$i!==null&&(ya?(s=$i,c=c.stateNode,s.nodeType===8?vl(s.parentNode,c):s.nodeType===1&&vl(s,c),$a(s)):vl($i,c.stateNode));break;case 4:p=$i,x=ya,$i=c.stateNode.containerInfo,ya=!0,bo(i,s,c),$i=p,ya=x;break;case 0:case 11:case 14:case 15:Hi||ll(2,c,s),Hi||ll(4,c,s),bo(i,s,c);break;case 1:Hi||(Cr(c,s),p=c.stateNode,typeof p.componentWillUnmount=="function"&&vf(c,s,p)),bo(i,s,c);break;case 21:bo(i,s,c);break;case 22:Hi||Cr(c,s),Hi=(p=Hi)||c.memoizedState!==null,bo(i,s,c),Hi=p;break;default:bo(i,s,c)}}function ul(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{$a(i)}catch(c){Ii(s,s.return,c)}}function qf(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new Cd),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new Cd),s;default:throw Error(Ce(435,i.tag))}}function jh(i,s){var c=qf(i);s.forEach(function(p){var x=qd.bind(null,i,p);c.has(p)||(c.add(p),p.then(x,x))})}function za(i,s){var c=s.deletions;if(c!==null)for(var p=0;p<c.length;p++){var x=c[p],S=i,B=s,G=B;e:for(;G!==null;){switch(G.tag){case 27:case 5:$i=G.stateNode,ya=!1;break e;case 3:$i=G.stateNode.containerInfo,ya=!0;break e;case 4:$i=G.stateNode.containerInfo,ya=!0;break e}G=G.return}if($i===null)throw Error(Ce(160));zd(S,B,x),$i=null,ya=!1,S=x.alternate,S!==null&&(S.return=null),x.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)Pd(s,i),s=s.sibling}var Ar=null;function Pd(i,s){var c=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:za(s,i),zr(i),p&4&&(ll(3,i,i.return),Yu(3,i),ll(5,i,i.return));break;case 1:za(s,i),zr(i),p&512&&(Hi||c===null||Cr(c,c.return)),p&64&&Hr&&(i=i.updateQueue,i!==null&&(p=i.callbacks,p!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?p:c.concat(p))));break;case 26:var x=Ar;if(za(s,i),zr(i),p&512&&(Hi||c===null||Cr(c,c.return)),p&4){var S=c!==null?c.memoizedState:null;if(p=i.memoizedState,c===null)if(p===null)if(i.stateNode===null){e:{p=i.type,c=i.memoizedProps,x=x.ownerDocument||x;t:switch(p){case"title":S=x.getElementsByTagName("title")[0],(!S||S[Ln]||S[xt]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=x.createElement(p),x.head.insertBefore(S,x.querySelector("head > title"))),ra(S,p,c),S[xt]=i,Zi(S),p=S;break e;case"link":var B=M("link","href",x).get(p+(c.href||""));if(B){for(var G=0;G<B.length;G++)if(S=B[G],S.getAttribute("href")===(c.href==null?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){B.splice(G,1);break t}}S=x.createElement(p),ra(S,p,c),x.head.appendChild(S);break;case"meta":if(B=M("meta","content",x).get(p+(c.content||""))){for(G=0;G<B.length;G++)if(S=B[G],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){B.splice(G,1);break t}}S=x.createElement(p),ra(S,p,c),x.head.appendChild(S);break;default:throw Error(Ce(468,p))}S[xt]=i,Zi(S),p=S}i.stateNode=p}else C(x,i.type,i.stateNode);else i.stateNode=h(x,p,i.memoizedProps);else S!==p?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,p===null?C(x,i.type,i.stateNode):h(x,p,i.memoizedProps)):p===null&&i.stateNode!==null&&nu(i,i.memoizedProps,c.memoizedProps)}break;case 27:if(p&4&&i.alternate===null){x=i.stateNode,S=i.memoizedProps;try{for(var te=x.firstChild;te;){var de=te.nextSibling,Oe=te.nodeName;te[Ln]||Oe==="HEAD"||Oe==="BODY"||Oe==="SCRIPT"||Oe==="STYLE"||Oe==="LINK"&&te.rel.toLowerCase()==="stylesheet"||x.removeChild(te),te=de}for(var He=i.type,Ee=x.attributes;Ee.length;)x.removeAttributeNode(Ee[0]);ra(x,He,S),x[xt]=i,x[et]=S}catch(bt){Ii(i,i.return,bt)}}case 5:if(za(s,i),zr(i),p&512&&(Hi||c===null||Cr(c,c.return)),i.flags&32){x=i.stateNode;try{Ji(x,"")}catch(bt){Ii(i,i.return,bt)}}p&4&&i.stateNode!=null&&(x=i.memoizedProps,nu(i,x,c!==null?c.memoizedProps:x)),p&1024&&(nc=!0);break;case 6:if(za(s,i),zr(i),p&4){if(i.stateNode===null)throw Error(Ce(162));p=i.memoizedProps,c=i.stateNode;try{c.nodeValue=p}catch(bt){Ii(i,i.return,bt)}}break;case 3:if(w=null,x=Ar,Ar=fh(s.containerInfo),za(s,i),Ar=x,zr(i),p&4&&c!==null&&c.memoizedState.isDehydrated)try{$a(s.containerInfo)}catch(bt){Ii(i,i.return,bt)}nc&&(nc=!1,bf(i));break;case 4:p=Ar,Ar=fh(i.stateNode.containerInfo),za(s,i),zr(i),Ar=p;break;case 12:za(s,i),zr(i);break;case 13:za(s,i),zr(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Zh=ia()),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,jh(i,p)));break;case 22:if(p&512&&(Hi||c===null||Cr(c,c.return)),te=i.memoizedState!==null,de=c!==null&&c.memoizedState!==null,Oe=Hr,He=Hi,Hr=Oe||te,Hi=He||de,za(s,i),Hi=He,Hr=Oe,zr(i),s=i.stateNode,s._current=i,s._visibility&=-3,s._visibility|=s._pendingVisibility&2,p&8192&&(s._visibility=te?s._visibility&-2:s._visibility|1,te&&(s=Hr||Hi,c===null||de||s||ru(i)),i.memoizedProps===null||i.memoizedProps.mode!=="manual"))e:for(c=null,s=i;;){if(s.tag===5||s.tag===26||s.tag===27){if(c===null){de=c=s;try{if(x=de.stateNode,te)S=x.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{B=de.stateNode,G=de.memoizedProps.style;var Le=G!=null&&G.hasOwnProperty("display")?G.display:null;B.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(bt){Ii(de,de.return,bt)}}}else if(s.tag===6){if(c===null){de=s;try{de.stateNode.nodeValue=te?"":de.memoizedProps}catch(bt){Ii(de,de.return,bt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=i.updateQueue,p!==null&&(c=p.retryQueue,c!==null&&(p.retryQueue=null,jh(i,c))));break;case 19:za(s,i),zr(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,jh(i,p)));break;case 21:break;default:za(s,i),zr(i)}}function zr(i){var s=i.flags;if(s&2){try{if(i.tag!==27){e:{for(var c=i.return;c!==null;){if(xf(c)){var p=c;break e}c=c.return}throw Error(Ce(160))}switch(p.tag){case 27:var x=p.stateNode,S=qi(i);Qu(i,S,x);break;case 5:var B=p.stateNode;p.flags&32&&(Ji(B,""),p.flags&=-33);var G=qi(i);Qu(i,G,B);break;case 3:case 4:var te=p.stateNode.containerInfo,de=qi(i);cl(i,de,te);break;default:throw Error(Ce(161))}}}catch(Oe){Ii(i,i.return,Oe)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function bf(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;bf(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function wo(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ac(i,s.alternate,s),s=s.sibling}function ru(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:ll(4,s,s.return),ru(s);break;case 1:Cr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&vf(s,s.return,c),ru(s);break;case 26:case 27:case 5:Cr(s,s.return),ru(s);break;case 22:Cr(s,s.return),s.memoizedState===null&&ru(s);break;default:ru(s)}i=i.sibling}}function hl(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,x=i,S=s,B=S.flags;switch(S.tag){case 0:case 11:case 15:hl(x,S,c),Yu(4,S);break;case 1:if(hl(x,S,c),p=S,x=p.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(de){Ii(p,p.return,de)}if(p=S,x=p.updateQueue,x!==null){var G=p.stateNode;try{var te=x.shared.hiddenCallbacks;if(te!==null)for(x.shared.hiddenCallbacks=null,x=0;x<te.length;x++)_f(te[x],G)}catch(de){Ii(p,p.return,de)}}c&&B&64&&yf(S),xo(S,S.return);break;case 26:case 27:case 5:hl(x,S,c),c&&p===null&&B&4&&Ed(S),xo(S,S.return);break;case 12:hl(x,S,c);break;case 13:hl(x,S,c),c&&B&4&&ul(x,S);break;case 22:S.memoizedState===null&&hl(x,S,c),xo(S,S.return);break;default:hl(x,S,c)}s=s.sibling}}function Dd(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Wo(c))}function Wu(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Wo(i))}function To(i,s,c,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Nh(i,s,c,p),s=s.sibling}function Nh(i,s,c,p){var x=s.flags;switch(s.tag){case 0:case 11:case 15:To(i,s,c,p),x&2048&&Yu(9,s);break;case 3:To(i,s,c,p),x&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Wo(i)));break;case 12:if(x&2048){To(i,s,c,p),i=s.stateNode;try{var S=s.memoizedProps,B=S.id,G=S.onPostCommit;typeof G=="function"&&G(B,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(te){Ii(s,s.return,te)}}else To(i,s,c,p);break;case 23:break;case 22:S=s.stateNode,s.memoizedState!==null?S._visibility&4?To(i,s,c,p):sc(i,s):S._visibility&4?To(i,s,c,p):(S._visibility|=4,rc(i,s,c,p,(s.subtreeFlags&10256)!==0)),x&2048&&Dd(s.alternate,s);break;case 24:To(i,s,c,p),x&2048&&Wu(s.alternate,s);break;default:To(i,s,c,p)}}function rc(i,s,c,p,x){for(x=x&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var S=i,B=s,G=c,te=p,de=B.flags;switch(B.tag){case 0:case 11:case 15:rc(S,B,G,te,x),Yu(8,B);break;case 23:break;case 22:var Oe=B.stateNode;B.memoizedState!==null?Oe._visibility&4?rc(S,B,G,te,x):sc(S,B):(Oe._visibility|=4,rc(S,B,G,te,x)),x&&de&2048&&Dd(B.alternate,B);break;case 24:rc(S,B,G,te,x),x&&de&2048&&Wu(B.alternate,B);break;default:rc(S,B,G,te,x)}s=s.sibling}}function sc(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,p=s,x=p.flags;switch(p.tag){case 22:sc(c,p),x&2048&&Dd(p.alternate,p);break;case 24:sc(c,p),x&2048&&Wu(p.alternate,p);break;default:sc(c,p)}s=s.sibling}}var su=8192;function oc(i){if(i.subtreeFlags&su)for(i=i.child;i!==null;)Ju(i),i=i.sibling}function Ju(i){switch(i.tag){case 26:oc(i),i.flags&su&&i.memoizedState!==null&&U(Ar,i.memoizedState,i.memoizedProps);break;case 5:oc(i);break;case 3:case 4:var s=Ar;Ar=fh(i.stateNode.containerInfo),oc(i),Ar=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=su,su=16777216,oc(i),su=s):oc(i));break;default:oc(i)}}function Id(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function ou(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];Wn=p,wf(p,i)}Id(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Rd(i),i=i.sibling}function Rd(i){switch(i.tag){case 0:case 11:case 15:ou(i),i.flags&2048&&ll(9,i,i.return);break;case 3:ou(i);break;case 12:ou(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&4&&(i.return===null||i.return.tag!==13)?(s._visibility&=-5,dl(i)):ou(i);break;default:ou(i)}}function dl(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];Wn=p,wf(p,i)}Id(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:ll(8,s,s.return),dl(s);break;case 22:c=s.stateNode,c._visibility&4&&(c._visibility&=-5,dl(s));break;default:dl(s)}i=i.sibling}}function wf(i,s){for(;Wn!==null;){var c=Wn;switch(c.tag){case 0:case 11:case 15:ll(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var p=c.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Wo(c.memoizedState.cache)}if(p=c.child,p!==null)p.return=c,Wn=p;else e:for(c=i;Wn!==null;){p=Wn;var x=p.sibling,S=p.return;if(Ku(p),p===c){Wn=null;break e}if(x!==null){x.return=S,Wn=x;break e}Wn=S}}}function kd(i,s,c,p){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pa(i,s,c,p){return new kd(i,s,c,p)}function eh(i){return i=i.prototype,!(!i||!i.isReactComponent)}function fl(i,s){var c=i.alternate;return c===null?(c=Pa(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&31457280,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Tf(i,s){i.flags&=31457282;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function th(i,s,c,p,x,S){var B=0;if(p=i,typeof i=="function")eh(i)&&(B=1);else if(typeof i=="string")B=A(i,c,Ci.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case ot:return pl(c.children,x,S,s);case Ve:B=8,x|=24;break;case Ft:return i=Pa(12,c,s,x|2),i.elementType=Ft,i.lanes=S,i;case Rn:return i=Pa(13,c,s,x),i.elementType=Rn,i.lanes=S,i;case gn:return i=Pa(19,c,s,x),i.elementType=gn,i.lanes=S,i;case ca:return Sf(c,x,S,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ai:case xe:B=10;break e;case ut:B=9;break e;case at:B=11;break e;case la:B=14;break e;case an:B=16,p=null;break e}B=29,c=Error(Ce(130,i===null?"null":typeof i,"")),p=null}return s=Pa(B,c,s,x),s.elementType=i,s.type=p,s.lanes=S,s}function pl(i,s,c,p){return i=Pa(7,i,p,s),i.lanes=c,i}function Sf(i,s,c,p){i=Pa(22,i,p,s),i.elementType=ca,i.lanes=c;var x={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var S=x._current;if(S===null)throw Error(Ce(456));if((x._pendingVisibility&2)===0){var B=Ur(S,2);B!==null&&(x._pendingVisibility|=2,Jn(B,S,2))}},attach:function(){var S=x._current;if(S===null)throw Error(Ce(456));if((x._pendingVisibility&2)!==0){var B=Ur(S,2);B!==null&&(x._pendingVisibility&=-3,Jn(B,S,2))}}};return i.stateNode=x,i}function Ld(i,s,c){return i=Pa(6,i,null,s),i.lanes=c,i}function lc(i,s,c){return s=Pa(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function Gs(i){i.flags|=4}function Mf(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!R(s)){if(s=tr.current,s!==null&&((ei&4194176)===ei?Za!==null:(ei&62914560)!==ei&&(ei&536870912)===0||s!==Za))throw $o=Zc,Vc;i.flags|=8192}}function Uh(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?_e():536870912,i.lanes|=s,cc|=s)}function ih(i,s){if(!Et)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function dn(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,p=0;if(s)for(var x=i.child;x!==null;)c|=x.lanes|x.childLanes,p|=x.subtreeFlags&31457280,p|=x.flags&31457280,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)c|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=p,i.childLanes=c,s}function Hf(i,s,c){var p=s.pendingProps;switch(ao(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(s),null;case 1:return dn(s),null;case 3:return c=s.stateNode,p=null,i!==null&&(p=i.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),ds(yt),Xa(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Zr(s)?Gs(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Kn!==null&&(hu(Kn),Kn=null))),dn(s),null;case 26:return c=s.memoizedState,i===null?(Gs(s),c!==null?(dn(s),Mf(s,c)):(dn(s),s.flags&=-16777217)):c?c!==i.memoizedState?(Gs(s),dn(s),Mf(s,c)):(dn(s),s.flags&=-16777217):(i.memoizedProps!==p&&Gs(s),dn(s),s.flags&=-16777217),null;case 27:fr(s),c=ta.current;var x=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Gs(s);else{if(!p){if(s.stateNode===null)throw Error(Ce(166));return dn(s),null}i=Ci.current,Zr(s)?Ou(s):(i=cd(x,p,c),s.stateNode=i,Gs(s))}return dn(s),null;case 5:if(fr(s),c=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Gs(s);else{if(!p){if(s.stateNode===null)throw Error(Ce(166));return dn(s),null}if(i=Ci.current,Zr(s))Ou(s);else{switch(x=hh(ta.current),i){case 1:i=x.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:i=x.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":i=x.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":i=x.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":i=x.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof p.is=="string"?x.createElement("select",{is:p.is}):x.createElement("select"),p.multiple?i.multiple=!0:p.size&&(i.size=p.size);break;default:i=typeof p.is=="string"?x.createElement(c,{is:p.is}):x.createElement(c)}}i[xt]=s,i[et]=p;e:for(x=s.child;x!==null;){if(x.tag===5||x.tag===6)i.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===s)break e;for(;x.sibling===null;){if(x.return===null||x.return===s)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}s.stateNode=i;e:switch(ra(i,c,p),c){case"button":case"input":case"select":case"textarea":i=!!p.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Gs(s)}}return dn(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==p&&Gs(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(Ce(166));if(i=ta.current,Zr(s)){if(i=s.stateNode,c=s.memoizedProps,p=null,x=Qn,x!==null)switch(x.tag){case 27:case 5:p=x.memoizedProps}i[xt]=s,i=!!(i.nodeValue===c||p!==null&&p.suppressHydrationWarning===!0||Wd(i.nodeValue,c)),i||us(s)}else i=hh(i).createTextNode(p),i[xt]=s,s.stateNode=i}return dn(s),null;case 13:if(p=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=Zr(s),p!==null&&p.dehydrated!==null){if(i===null){if(!x)throw Error(Ce(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(Ce(317));x[xt]=s}else Gr(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;dn(s),x=!1}else Kn!==null&&(hu(Kn),Kn=null),x=!0;if(!x)return s.flags&256?(Ma(s),s):(Ma(s),null)}if(Ma(s),(s.flags&128)!==0)return s.lanes=c,s;if(c=p!==null,i=i!==null&&i.memoizedState!==null,c){p=s.child,x=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(x=p.alternate.memoizedState.cachePool.pool);var S=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(S=p.memoizedState.cachePool.pool),S!==x&&(p.flags|=2048)}return c!==i&&c&&(s.child.flags|=8192),Uh(s,s.updateQueue),dn(s),null;case 4:return Xa(),i===null&&ad(s.stateNode.containerInfo),dn(s),null;case 10:return ds(s.type),dn(s),null;case 19:if(oi(hn),x=s.memoizedState,x===null)return dn(s),null;if(p=(s.flags&128)!==0,S=x.rendering,S===null)if(p)ih(x,!1);else{if(wn!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(S=Hl(i),S!==null){for(s.flags|=128,ih(x,!1),i=S.updateQueue,s.updateQueue=i,Uh(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Tf(c,i),c=c.sibling;return _i(hn,hn.current&1|2),s.child}i=i.sibling}x.tail!==null&&ia()>cu&&(s.flags|=128,p=!0,ih(x,!1),s.lanes=4194304)}else{if(!p)if(i=Hl(S),i!==null){if(s.flags|=128,p=!0,i=i.updateQueue,s.updateQueue=i,Uh(s,i),ih(x,!0),x.tail===null&&x.tailMode==="hidden"&&!S.alternate&&!Et)return dn(s),null}else 2*ia()-x.renderingStartTime>cu&&c!==536870912&&(s.flags|=128,p=!0,ih(x,!1),s.lanes=4194304);x.isBackwards?(S.sibling=s.child,s.child=S):(i=x.last,i!==null?i.sibling=S:s.child=S,x.last=S)}return x.tail!==null?(s=x.tail,x.rendering=s,x.tail=s.sibling,x.renderingStartTime=ia(),s.sibling=null,i=hn.current,_i(hn,p?i&1|2:i&1),s):(dn(s),null);case 22:case 23:return Ma(s),ql(),p=s.memoizedState!==null,i!==null?i.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(c&536870912)!==0&&(s.flags&128)===0&&(dn(s),s.subtreeFlags&6&&(s.flags|=8192)):dn(s),c=s.updateQueue,c!==null&&Uh(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==c&&(s.flags|=2048),i!==null&&oi(ks),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ds(yt),dn(s),null;case 25:return null}throw Error(Ce(156,s.tag))}function $f(i,s){switch(ao(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return ds(yt),Xa(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return fr(s),null;case 13:if(Ma(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(Ce(340));Gr()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return oi(hn),null;case 4:return Xa(),null;case 10:return ds(s.type),null;case 22:case 23:return Ma(s),ql(),i!==null&&oi(ks),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return ds(yt),null;case 25:return null;default:return null}}function Bd(i,s){switch(ao(s),s.tag){case 3:ds(yt),Xa();break;case 26:case 27:case 5:fr(s);break;case 4:Xa();break;case 13:Ma(s);break;case 19:oi(hn);break;case 10:ds(s.type);break;case 22:case 23:Ma(s),ql(),i!==null&&oi(ks);break;case 24:ds(yt)}}var Od={getCacheForType:function(i){var s=aa(yt),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c}},Ef=typeof WeakMap=="function"?WeakMap:Map,nn=0,Di=null,Jt=null,ei=0,Ni=0,lr=null,So=!1,lu=!1,Fd=!1,qs=0,wn=0,ml=0,fs=0,Vh=0,cr=0,cc=0,Xi=null,$r=null,jd=!1,Zh=0,cu=1/0,uu=null,_l=null,Gh=!1,uc=null,nh=0,qh=0,va=null,hc=0,Hh=null;function Fn(){if((nn&2)!==0&&ei!==0)return ei&-ei;if(Mt.T!==null){var i=Is;return i!==0?i:Xd()}return Je()}function ah(){cr===0&&(cr=(ei&536870912)===0||Et?Be():536870912);var i=tr.current;return i!==null&&(i.flags|=32),cr}function Jn(i,s,c){(i===Di&&Ni===2||i.cancelPendingCommit!==null)&&(du(i,0),Mo(i,ei,cr,!1)),lt(i,c),((nn&2)===0||i!==Di)&&(i===Di&&((nn&2)===0&&(fs|=c),wn===4&&Mo(i,ei,cr,!1)),ps(i))}function dc(i,s,c){if((nn&6)!==0)throw Error(Ce(327));var p=!c&&(s&60)===0&&(s&i.expiredLanes)===0||Me(i,s),x=p?Yf(i,s):Vd(i,s,!0),S=p;do{if(x===0){lu&&!p&&Mo(i,s,0,!1);break}else if(x===6)Mo(i,s,0,!So);else{if(c=i.current.alternate,S&&!Xf(c)){x=Vd(i,s,!1),S=!1;continue}if(x===2){if(S=s,i.errorRecoveryDisabledLanes&S)var B=0;else B=i.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){s=B;e:{var G=i;x=Xi;var te=G.current.memoizedState.isDehydrated;if(te&&(du(G,B).flags|=256),B=Vd(G,B,!1),B!==2){if(Fd&&!te){G.errorRecoveryDisabledLanes|=S,fs|=S,x=4;break e}S=$r,$r=x,S!==null&&hu(S)}x=B}if(S=!1,x!==2)continue}}if(x===1){du(i,0),Mo(i,s,0,!0);break}e:{switch(p=i,x){case 0:case 1:throw Error(Ce(345));case 4:if((s&4194176)===s){Mo(p,s,cr,!So);break e}break;case 2:$r=null;break;case 3:case 5:break;default:throw Error(Ce(329))}if(p.finishedWork=c,p.finishedLanes=s,(s&62914560)===s&&(S=Zh+300-ia(),10<S)){if(Mo(p,s,cr,!So),Pe(p,0)!==0)break e;p.timeoutHandle=dh(rh.bind(null,p,c,$r,uu,jd,s,cr,fs,cc,So,2,-0,0),S);break e}rh(p,c,$r,uu,jd,s,cr,fs,cc,So,0,-0,0)}}break}while(!0);ps(i)}function hu(i){$r===null?$r=i:$r.push.apply($r,i)}function rh(i,s,c,p,x,S,B,G,te,de,Oe,He,Ee){var Le=s.subtreeFlags;if((Le&8192||(Le&16785408)===16785408)&&(k={stylesheets:null,count:0,unsuspend:O},Ju(s),s=q(),s!==null)){i.cancelPendingCommit=s(pu.bind(null,i,c,p,x,B,G,te,1,He,Ee)),Mo(i,S,B,!de);return}pu(i,c,p,x,B,G,te,Oe,He,Ee)}function Xf(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var p=0;p<c.length;p++){var x=c[p],S=x.getSnapshot;x=x.value;try{if(!ja(S(),x))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Mo(i,s,c,p){s&=~Vh,s&=~fs,i.suspendedLanes|=s,i.pingedLanes&=~s,p&&(i.warmLanes|=s),p=i.expirationTimes;for(var x=s;0<x;){var S=31-V(x),B=1<<S;p[S]=-1,x&=~B}c!==0&&wt(i,c,s)}function sh(){return(nn&6)===0?(ch(0),!1):!0}function $h(){if(Jt!==null){if(Ni===0)var i=Jt.return;else i=Jt,Vs=nl=null,Gi(i),oo=null,Xo=0,i=Jt;for(;i!==null;)Bd(i.alternate,i),i=i.return;Jt=null}}function du(i,s){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,ld(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),$h(),Di=i,Jt=c=fl(i.current,null),ei=s,Ni=0,lr=null,So=!1,lu=Me(i,s),Fd=!1,cc=cr=Vh=fs=ml=wn=0,$r=Xi=null,jd=!1,(s&8)!==0&&(s|=s&32);var p=i.entangledLanes;if(p!==0)for(i=i.entanglements,p&=s;0<p;){var x=31-V(p),S=1<<x;s|=i[x],p&=~S}return qs=s,Fc(),c}function Nd(i,s){jt=null,Mt.H=wi,s===ro?(s=Fu(),Ni=3):s===Vc?(s=Fu(),Ni=4):Ni=s===Ih?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,lr=s,Jt===null&&(wn=1,Ha(i,Ua(s,i.current)))}function Ud(){var i=Mt.H;return Mt.H=wi,i===null?wi:i}function Xh(){var i=Mt.A;return Mt.A=Od,i}function oh(){wn=4,So||(ei&4194176)!==ei&&tr.current!==null||(lu=!0),(ml&134217727)===0&&(fs&134217727)===0||Di===null||Mo(Di,ei,cr,!1)}function Vd(i,s,c){var p=nn;nn|=2;var x=Ud(),S=Xh();(Di!==i||ei!==s)&&(uu=null,du(i,s)),s=!1;var B=wn;e:do try{if(Ni!==0&&Jt!==null){var G=Jt,te=lr;switch(Ni){case 8:$h(),B=6;break e;case 3:case 2:case 6:tr.current===null&&(s=!0);var de=Ni;if(Ni=0,lr=null,fu(i,G,te,de),c&&lu){B=0;break e}break;default:de=Ni,Ni=0,lr=null,fu(i,G,te,de)}}Cf(),B=wn;break}catch(Oe){Nd(i,Oe)}while(!0);return s&&i.shellSuspendCounter++,Vs=nl=null,nn=p,Mt.H=x,Mt.A=S,Jt===null&&(Di=null,ei=0,Fc()),B}function Cf(){for(;Jt!==null;)Af(Jt)}function Yf(i,s){var c=nn;nn|=2;var p=Ud(),x=Xh();Di!==i||ei!==s?(uu=null,cu=ia()+500,du(i,s)):lu=Me(i,s);e:do try{if(Ni!==0&&Jt!==null){s=Jt;var S=lr;t:switch(Ni){case 1:Ni=0,lr=null,fu(i,s,S,1);break;case 2:if(Gc(S)){Ni=0,lr=null,zf(s);break}s=function(){Ni===2&&Di===i&&(Ni=7),ps(i)},S.then(s,s);break e;case 3:Ni=7;break e;case 4:Ni=5;break e;case 7:Gc(S)?(Ni=0,lr=null,zf(s)):(Ni=0,lr=null,fu(i,s,S,7));break;case 5:var B=null;switch(Jt.tag){case 26:B=Jt.memoizedState;case 5:case 27:var G=Jt;if(!B||R(B)){Ni=0,lr=null;var te=G.sibling;if(te!==null)Jt=te;else{var de=G.return;de!==null?(Jt=de,lh(de)):Jt=null}break t}}Ni=0,lr=null,fu(i,s,S,5);break;case 6:Ni=0,lr=null,fu(i,s,S,6);break;case 8:$h(),wn=6;break e;default:throw Error(Ce(462))}}Qf();break}catch(Oe){Nd(i,Oe)}while(!0);return Vs=nl=null,Mt.H=p,Mt.A=x,nn=c,Jt!==null?0:(Di=null,ei=0,Fc(),wn)}function Qf(){for(;Jt!==null&&!Po();)Af(Jt)}function Af(i){var s=mf(i.alternate,i,qs);i.memoizedProps=i.pendingProps,s===null?lh(i):Jt=s}function zf(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=Zu(c,s,s.pendingProps,s.type,void 0,ei);break;case 11:s=Zu(c,s,s.pendingProps,s.type.render,s.ref,ei);break;case 5:Gi(s);default:Bd(c,s),s=Jt=Tf(s,qs),s=mf(c,s,qs)}i.memoizedProps=i.pendingProps,s===null?lh(i):Jt=s}function fu(i,s,c,p){Vs=nl=null,Gi(s),oo=null,Xo=0;var x=s.return;try{if(_o(i,x,s,c,ei)){wn=1,Ha(i,Ua(c,i.current)),Jt=null;return}}catch(S){if(x!==null)throw Jt=x,S;wn=1,Ha(i,Ua(c,i.current)),Jt=null;return}s.flags&32768?(Et||p===1?i=!0:lu||(ei&536870912)!==0?i=!1:(So=i=!0,(p===2||p===3||p===6)&&(p=tr.current,p!==null&&p.tag===13&&(p.flags|=16384))),Zd(s,i)):lh(s)}function lh(i){var s=i;do{if((s.flags&32768)!==0){Zd(s,So);return}i=s.return;var c=Hf(s.alternate,s,qs);if(c!==null){Jt=c;return}if(s=s.sibling,s!==null){Jt=s;return}Jt=s=i}while(s!==null);wn===0&&(wn=5)}function Zd(i,s){do{var c=$f(i.alternate,i);if(c!==null){c.flags&=32767,Jt=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){Jt=i;return}Jt=i=c}while(i!==null);wn=6,Jt=null}function pu(i,s,c,p,x,S,B,G,te,de){var Oe=Mt.T,He=We.p;try{We.p=2,Mt.T=null,Hs(i,s,c,p,He,x,S,B,G,te,de)}finally{Mt.T=Oe,We.p=He}}function Hs(i,s,c,p,x,S,B,G){do fc();while(uc!==null);if((nn&6)!==0)throw Error(Ce(327));var te=i.finishedWork;if(p=i.finishedLanes,te===null)return null;if(i.finishedWork=null,i.finishedLanes=0,te===i.current)throw Error(Ce(177));i.callbackNode=null,i.callbackPriority=0,i.cancelPendingCommit=null;var de=te.lanes|te.childLanes;if(de|=Bu,At(i,p,de,S,B,G),i===Di&&(Jt=Di=null,ei=0),(te.subtreeFlags&10256)===0&&(te.flags&10256)===0||Gh||(Gh=!0,qh=de,va=c,Hd(Qa,function(){return fc(),null})),c=(te.flags&15990)!==0,(te.subtreeFlags&15990)!==0||c?(c=Mt.T,Mt.T=null,S=We.p,We.p=2,B=nn,nn|=4,Ad(i,te),Pd(te,i),Lc(ef,i.containerInfo),Ge=!!Jd,ef=Jd=null,i.current=te,ac(i,te.alternate,te),Ys(),nn=B,We.p=S,Mt.T=c):i.current=te,Gh?(Gh=!1,uc=i,nh=p):Eo(i,de),de=i.pendingLanes,de===0&&(_l=null),pe(te.stateNode),ps(i),s!==null)for(x=i.onRecoverableError,te=0;te<s.length;te++)de=s[te],x(de.value,{componentStack:de.stack});return(nh&3)!==0&&fc(),de=i.pendingLanes,(p&4194218)!==0&&(de&42)!==0?i===Hh?hc++:(hc=0,Hh=i):hc=0,ch(0),null}function Eo(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Wo(s)))}function fc(){if(uc!==null){var i=uc,s=qh;qh=0;var c=it(nh),p=Mt.T,x=We.p;try{if(We.p=32>c?32:c,Mt.T=null,uc===null)var S=!1;else{c=va,va=null;var B=uc,G=nh;if(uc=null,nh=0,(nn&6)!==0)throw Error(Ce(331));var te=nn;if(nn|=4,Rd(B.current),Nh(B,B.current,G,c),nn=te,ch(0,!1),on&&typeof on.onPostCommitFiberRoot=="function")try{on.onPostCommitFiberRoot(Kr,B)}catch{}S=!0}return S}finally{We.p=x,Mt.T=p,Eo(i,s)}}return!1}function Yh(i,s,c){s=Ua(c,s),s=fi(i.stateNode,s,2),i=Zs(i,s,2),i!==null&&(lt(i,2),ps(i))}function Ii(i,s,c){if(i.tag===3)Yh(i,i,c);else for(;s!==null;){if(s.tag===3){Yh(s,i,c);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(_l===null||!_l.has(p))){i=Ua(c,i),c=xn(2),p=Zs(s,c,2),p!==null&&(bn(c,p,s,i),lt(p,2),ps(p));break}}s=s.return}}function Gd(i,s,c){var p=i.pingCache;if(p===null){p=i.pingCache=new Ef;var x=new Set;p.set(s,x)}else x=p.get(s),x===void 0&&(x=new Set,p.set(s,x));x.has(c)||(Fd=!0,x.add(c),i=Qh.bind(null,i,s,c),s.then(i,i))}function Qh(i,s,c){var p=i.pingCache;p!==null&&p.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Di===i&&(ei&c)===c&&(wn===4||wn===3&&(ei&62914560)===ei&&300>ia()-Zh?(nn&2)===0&&du(i,0):Vh|=c,cc===ei&&(cc=0)),ps(i)}function Kh(i,s){s===0&&(s=_e()),i=Ur(i,s),i!==null&&(lt(i,s),ps(i))}function Kf(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),Kh(i,c)}function qd(i,s){var c=0;switch(i.tag){case 13:var p=i.stateNode,x=i.memoizedState;x!==null&&(c=x.retryLane);break;case 19:p=i.stateNode;break;case 22:p=i.stateNode._retryCache;break;default:throw Error(Ce(314))}p!==null&&p.delete(s),Kh(i,c)}function Hd(i,s){return Ya(i,s)}var Co=null,pc=null,Wh=!1,mu=!1,Jh=!1,$s=0;function ps(i){i!==pc&&i.next===null&&(pc===null?Co=pc=i:pc=pc.next=i),mu=!0,Wh||(Wh=!0,Jf(Wf))}function ch(i,s){if(!Jh&&mu){Jh=!0;do for(var c=!1,p=Co;p!==null;){if(i!==0){var x=p.pendingLanes;if(x===0)var S=0;else{var B=p.suspendedLanes,G=p.pingedLanes;S=(1<<31-V(42|i)+1)-1,S&=x&~(B&~G),S=S&201326677?S&201326677|1:S?S|2:0}S!==0&&(c=!0,Df(p,S))}else S=ei,S=Pe(p,p===Di?S:0),(S&3)===0||Me(p,S)||(c=!0,Df(p,S));p=p.next}while(c);Jh=!1}}function Wf(){mu=Wh=!1;var i=0;$s!==0&&(od()&&(i=$s),$s=0);for(var s=ia(),c=null,p=Co;p!==null;){var x=p.next,S=$d(p,s);S===0?(p.next=null,c===null?Co=x:c.next=x,x===null&&(pc=c)):(c=p,(i!==0||(S&3)!==0)&&(mu=!0)),p=x}ch(i)}function $d(i,s){for(var c=i.suspendedLanes,p=i.pingedLanes,x=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var B=31-V(S),G=1<<B,te=x[B];te===-1?((G&c)===0||(G&p)!==0)&&(x[B]=me(G,s)):te<=s&&(i.expiredLanes|=G),S&=~G}if(s=Di,c=ei,c=Pe(i,i===s?c:0),p=i.callbackNode,c===0||i===s&&Ni===2||i.cancelPendingCommit!==null)return p!==null&&p!==null&&Ia(p),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||Me(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(p!==null&&Ia(p),it(c)){case 2:case 8:c=Rr;break;case 32:c=Qa;break;case 268435456:c=Qr;break;default:c=Qa}return p=Pf.bind(null,i),c=Ya(c,p),i.callbackPriority=s,i.callbackNode=c,s}return p!==null&&p!==null&&Ia(p),i.callbackPriority=2,i.callbackNode=null,2}function Pf(i,s){var c=i.callbackNode;if(fc()&&i.callbackNode!==c)return null;var p=ei;return p=Pe(i,i===Di?p:0),p===0?null:(dc(i,p,s),$d(i,ia()),i.callbackNode!=null&&i.callbackNode===c?Pf.bind(null,i):null)}function Df(i,s){if(fc())return null;dc(i,s,!0)}function Jf(i){ep(function(){(nn&6)!==0?Ya(_s,i):i()})}function Xd(){return $s===0&&($s=Be()),$s}function If(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ws(""+i)}function ed(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function gl(i,s,c,p,x){if(s==="submit"&&c&&c.stateNode===x){var S=If((x[et]||null).action),B=p.submitter;B&&(s=(s=B[et]||null)?If(s.formAction):B.getAttribute("formAction"),s!==null&&(S=s,B=null));var G=new ts("action","action",null,p,x);i.push({event:G,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if($s!==0){var te=B?ed(x,B):new FormData(x);ze(c,{pending:!0,data:te,method:x.method,action:S},null,te)}}else typeof S=="function"&&(G.preventDefault(),te=B?ed(x,B):new FormData(x),ze(c,{pending:!0,data:te,method:x.method,action:S},S,te))},currentTarget:x}]})}}for(var td=0;td<jl.length;td++){var id=jl[td],Rf=id.toLowerCase(),kf=id[0].toUpperCase()+id.slice(1);vr(Rf,"on"+kf)}vr(Vo,"onAnimationEnd"),vr(Fl,"onAnimationIteration"),vr(Lu,"onAnimationStart"),vr("dblclick","onDoubleClick"),vr("focusin","onFocus"),vr("focusout","onBlur"),vr(Zo,"onTransitionRun"),vr(Go,"onTransitionStart"),vr(Dh,"onTransitionCancel"),vr(Oc,"onTransitionEnd"),pr("onMouseEnter",["mouseout","mouseover"]),pr("onMouseLeave",["mouseout","mouseover"]),pr("onPointerEnter",["pointerout","pointerover"]),pr("onPointerLeave",["pointerout","pointerover"]),vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vs("onBeforeInput",["compositionend","keypress","textInput","paste"]),vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _u="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_u));function Qd(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var p=i[c],x=p.event;p=p.listeners;e:{var S=void 0;if(s)for(var B=p.length-1;0<=B;B--){var G=p[B],te=G.instance,de=G.currentTarget;if(G=G.listener,te!==S&&x.isPropagationStopped())break e;S=G,x.currentTarget=de;try{S(x)}catch(Oe){qr(Oe)}x.currentTarget=null,S=te}else for(B=0;B<p.length;B++){if(G=p[B],te=G.instance,de=G.currentTarget,G=G.listener,te!==S&&x.isPropagationStopped())break e;S=G,x.currentTarget=de;try{S(x)}catch(Oe){qr(Oe)}x.currentTarget=null,S=te}}}}function qt(i,s){var c=s[Wi];c===void 0&&(c=s[Wi]=new Set);var p=i+"__bubble";c.has(p)||(ur(s,i,2,!1),c.add(p))}function nd(i,s,c){var p=0;s&&(p|=4),ur(c,i,p,s)}var gu="_reactListening"+Math.random().toString(36).slice(2);function ad(i){if(!i[gu]){i[gu]=!0,gc.forEach(function(c){c!=="selectionchange"&&(Yd.has(c)||nd(c,!1,i),nd(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[gu]||(s[gu]=!0,nd("selectionchange",!1,s))}}function ur(i,s,c,p){switch(Ui(s)){case 2:var x=Re;break;case 8:x=tt;break;default:x=gt}c=x.bind(null,s,c,i),x=void 0,!xi||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),p?x!==void 0?i.addEventListener(s,c,{capture:!0,passive:x}):i.addEventListener(s,c,!0):x!==void 0?i.addEventListener(s,c,{passive:x}):i.addEventListener(s,c,!1)}function yl(i,s,c,p,x){var S=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var B=p.tag;if(B===3||B===4){var G=p.stateNode.containerInfo;if(G===x||G.nodeType===8&&G.parentNode===x)break;if(B===4)for(B=p.return;B!==null;){var te=B.tag;if((te===3||te===4)&&(te=B.stateNode.containerInfo,te===x||te.nodeType===8&&te.parentNode===x))return;B=B.return}for(;G!==null;){if(B=ys(G),B===null)return;if(te=B.tag,te===5||te===6||te===26||te===27){p=S=B;continue e}G=G.parentNode}}p=p.return}wc(function(){var de=S,Oe=en(c),He=[];e:{var Ee=Qt.get(i);if(Ee!==void 0){var Le=ts,bt=i;switch(i){case"keypress":if(bs(c)===0)break e;case"keydown":case"keyup":Le=zl;break;case"focusin":bt="focus",Le=Al;break;case"focusout":bt="blur",Le=Al;break;case"beforeblur":case"afterblur":Le=Al;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=Yn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=Fa;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=Pl;break;case Vo:case Fl:case Lu:Le=Js;break;case Oc:Le=md;break;case"scroll":case"scrollend":Le=fd;break;case"wheel":Le=wh;break;case"copy":case"cut":case"paste":Le=Mc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=bh;break;case"toggle":case"beforetoggle":Le=Th}var Nt=(s&4)!==0,Mn=!Nt&&(i==="scroll"||i==="scrollend"),ge=Nt?Ee!==null?Ee+"Capture":null:Ee;Nt=[];for(var fe=de,Te;fe!==null;){var Ne=fe;if(Te=Ne.stateNode,Ne=Ne.tag,Ne!==5&&Ne!==26&&Ne!==27||Te===null||ge===null||(Ne=da(fe,ge),Ne!=null&&Nt.push(yu(fe,Ne,Te))),Mn)break;fe=fe.return}0<Nt.length&&(Ee=new Le(Ee,bt,null,c,Oe),He.push({event:Ee,listeners:Nt}))}}if((s&7)===0){e:{if(Ee=i==="mouseover"||i==="pointerover",Le=i==="mouseout"||i==="pointerout",Ee&&c!==Ba&&(bt=c.relatedTarget||c.fromElement)&&(ys(bt)||bt[Ka]))break e;if((Le||Ee)&&(Ee=Oe.window===Oe?Oe:(Ee=Oe.ownerDocument)?Ee.defaultView||Ee.parentWindow:window,Le?(bt=c.relatedTarget||c.toElement,Le=de,bt=bt?ys(bt):null,bt!==null&&(Mn=Tt(bt),Nt=bt.tag,bt!==Mn||Nt!==5&&Nt!==27&&Nt!==6)&&(bt=null)):(Le=null,bt=de),Le!==bt)){if(Nt=Yn,Ne="onMouseLeave",ge="onMouseEnter",fe="mouse",(i==="pointerout"||i==="pointerover")&&(Nt=bh,Ne="onPointerLeave",ge="onPointerEnter",fe="pointer"),Mn=Le==null?Ee:Qs(Le),Te=bt==null?Ee:Qs(bt),Ee=new Nt(Ne,fe+"leave",Le,c,Oe),Ee.target=Mn,Ee.relatedTarget=Te,Ne=null,ys(Oe)===de&&(Nt=new Nt(ge,fe+"enter",bt,c,Oe),Nt.target=Te,Nt.relatedTarget=Mn,Ne=Nt),Mn=Ne,Le&&bt)t:{for(Nt=Le,ge=bt,fe=0,Te=Nt;Te;Te=mc(Te))fe++;for(Te=0,Ne=ge;Ne;Ne=mc(Ne))Te++;for(;0<fe-Te;)Nt=mc(Nt),fe--;for(;0<Te-fe;)ge=mc(ge),Te--;for(;fe--;){if(Nt===ge||ge!==null&&Nt===ge.alternate)break t;Nt=mc(Nt),ge=mc(ge)}Nt=null}else Nt=null;Le!==null&&Kd(He,Ee,Le,Nt,!1),bt!==null&&Mn!==null&&Kd(He,Mn,bt,Nt,!0)}}e:{if(Ee=de?Qs(de):window,Le=Ee.nodeName&&Ee.nodeName.toLowerCase(),Le==="select"||Le==="input"&&Ee.type==="file")var ht=kl;else if(Il(Ee))if(Ic)ht=ii;else{ht=Du;var Ht=Ah}else Le=Ee.nodeName,!Le||Le.toLowerCase()!=="input"||Ee.type!=="checkbox"&&Ee.type!=="radio"?de&&yn(de.elementType)&&(ht=kl):ht=no;if(ht&&(ht=ht(i,de))){Eh(He,ht,c,Oe);break e}Ht&&Ht(i,Ee,de),i==="focusout"&&de&&Ee.type==="number"&&de.memoizedProps.value!=null&&Zt(Ee,"number",Ee.value)}switch(Ht=de?Qs(de):window,i){case"focusin":(Il(Ht)||Ht.contentEditable==="true")&&(Ss=Ht,as=de,jr=null);break;case"focusout":jr=as=Ss=null;break;case"mousedown":Ta=!0;break;case"contextmenu":case"mouseup":case"dragend":Ta=!1,ku(He,c,Oe);break;case"selectionchange":if(Bc)break;case"keydown":case"keyup":ku(He,c,Oe)}var St;if(Au)e:{switch(i){case"compositionstart":var zt="onCompositionStart";break e;case"compositionend":zt="onCompositionEnd";break e;case"compositionupdate":zt="onCompositionUpdate";break e}zt=void 0}else eo?Dc(i,c)&&(zt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(zt="onCompositionStart");zt&&(Pu&&c.locale!=="ko"&&(eo||zt!=="onCompositionStart"?zt==="onCompositionEnd"&&eo&&(St=Gt()):(Lt=Oe,Dt="value"in Lt?Lt.value:Lt.textContent,eo=!0)),Ht=uh(de,zt),0<Ht.length&&(zt=new xh(zt,i,null,c,Oe),He.push({event:zt,listeners:Ht}),St?zt.data=St:(St=Ts(c),St!==null&&(zt.data=St)))),(St=zu?Mh(i,c):to(i,c))&&(zt=uh(de,"onBeforeInput"),0<zt.length&&(Ht=new xh("onBeforeInput","beforeinput",null,c,Oe),He.push({event:Ht,listeners:zt}),Ht.data=St)),gl(He,i,de,c,Oe)}Qd(He,s)})}function yu(i,s,c){return{instance:i,listener:s,currentTarget:c}}function uh(i,s){for(var c=s+"Capture",p=[];i!==null;){var x=i,S=x.stateNode;x=x.tag,x!==5&&x!==26&&x!==27||S===null||(x=da(i,c),x!=null&&p.unshift(yu(i,x,S)),x=da(i,s),x!=null&&p.push(yu(i,x,S))),i=i.return}return p}function mc(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Kd(i,s,c,p,x){for(var S=s._reactName,B=[];c!==null&&c!==p;){var G=c,te=G.alternate,de=G.stateNode;if(G=G.tag,te!==null&&te===p)break;G!==5&&G!==26&&G!==27||de===null||(te=de,x?(de=da(c,S),de!=null&&B.unshift(yu(c,de,te))):x||(de=da(c,S),de!=null&&B.push(yu(c,de,te)))),c=c.return}B.length!==0&&i.push({event:s,listeners:B})}var Lf=/\r\n?/g,Bf=/\u0000|\uFFFD/g;function Of(i){return(typeof i=="string"?i:""+i).replace(Lf,`
`).replace(Bf,"")}function Wd(i,s){return s=Of(s),Of(i)===s}function ms(){}function Ti(i,s,c,p,x,S){switch(c){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||Ji(i,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&Ji(i,""+p);break;case"className":Ro(i,"class",p);break;case"tabIndex":Ro(i,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Ro(i,c,p);break;case"style":bc(i,p,S);break;case"data":if(s!=="object"){Ro(i,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=Ws(""+p),i.setAttribute(c,p);break;case"action":case"formAction":if(typeof p=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(s!=="input"&&Ti(i,s,"name",x.name,x,null),Ti(i,s,"formEncType",x.formEncType,x,null),Ti(i,s,"formMethod",x.formMethod,x,null),Ti(i,s,"formTarget",x.formTarget,x,null)):(Ti(i,s,"encType",x.encType,x,null),Ti(i,s,"method",x.method,x,null),Ti(i,s,"target",x.target,x,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=Ws(""+p),i.setAttribute(c,p);break;case"onClick":p!=null&&(i.onclick=ms);break;case"onScroll":p!=null&&qt("scroll",i);break;case"onScrollEnd":p!=null&&qt("scrollend",i);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(Ce(61));if(c=p.__html,c!=null){if(x.children!=null)throw Error(Ce(60));i.innerHTML=c}}break;case"multiple":i.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":i.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){i.removeAttribute("xlink:href");break}c=Ws(""+p),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""+p):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":p===!0?i.setAttribute(c,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,p):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?i.setAttribute(c,p):i.removeAttribute(c);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?i.removeAttribute(c):i.setAttribute(c,p);break;case"popover":qt("beforetoggle",i),qt("toggle",i),Wr(i,"popover",p);break;case"xlinkActuate":mr(i,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":mr(i,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":mr(i,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":mr(i,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":mr(i,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":mr(i,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":mr(i,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":mr(i,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":mr(i,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Wr(i,"is",p);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=ha.get(c)||c,Wr(i,c,p))}}function rd(i,s,c,p,x,S){switch(c){case"style":bc(i,p,S);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(Ce(61));if(c=p.__html,c!=null){if(x.children!=null)throw Error(Ce(60));i.innerHTML=c}}break;case"children":typeof p=="string"?Ji(i,p):(typeof p=="number"||typeof p=="bigint")&&Ji(i,""+p);break;case"onScroll":p!=null&&qt("scroll",i);break;case"onScrollEnd":p!=null&&qt("scrollend",i);break;case"onClick":p!=null&&(i.onclick=ms);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wu.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(x=c.endsWith("Capture"),s=c.slice(2,x?c.length-7:void 0),S=i[et]||null,S=S!=null?S[c]:null,typeof S=="function"&&i.removeEventListener(s,S,x),typeof p=="function")){typeof S!="function"&&S!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,p,x);break e}c in i?i[c]=p:p===!0?i.setAttribute(c,""):Wr(i,c,p)}}}function ra(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":qt("error",i),qt("load",i);var p=!1,x=!1,S;for(S in c)if(c.hasOwnProperty(S)){var B=c[S];if(B!=null)switch(S){case"src":p=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Ce(137,s));default:Ti(i,s,S,B,c,null)}}x&&Ti(i,s,"srcSet",c.srcSet,c,null),p&&Ti(i,s,"src",c.src,c,null);return;case"input":qt("invalid",i);var G=S=B=x=null,te=null,de=null;for(p in c)if(c.hasOwnProperty(p)){var Oe=c[p];if(Oe!=null)switch(p){case"name":x=Oe;break;case"type":B=Oe;break;case"checked":te=Oe;break;case"defaultChecked":de=Oe;break;case"value":S=Oe;break;case"defaultValue":G=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(Ce(137,s));break;default:Ti(i,s,p,Oe,c,null)}}ka(i,S,G,te,de,B,x,!1),Ks(i);return;case"select":qt("invalid",i),p=B=S=null;for(x in c)if(c.hasOwnProperty(x)&&(G=c[x],G!=null))switch(x){case"value":S=G;break;case"defaultValue":B=G;break;case"multiple":p=G;default:Ti(i,s,x,G,c,null)}s=S,c=B,i.multiple=!!p,s!=null?Jr(i,!!p,s,!1):c!=null&&Jr(i,!!p,c,!0);return;case"textarea":qt("invalid",i),S=x=p=null;for(B in c)if(c.hasOwnProperty(B)&&(G=c[B],G!=null))switch(B){case"value":p=G;break;case"defaultValue":x=G;break;case"children":S=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(Ce(91));break;default:Ti(i,s,B,G,c,null)}La(i,p,x,S),Ks(i);return;case"option":for(te in c)if(c.hasOwnProperty(te)&&(p=c[te],p!=null))switch(te){case"selected":i.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Ti(i,s,te,p,c,null)}return;case"dialog":qt("cancel",i),qt("close",i);break;case"iframe":case"object":qt("load",i);break;case"video":case"audio":for(p=0;p<_u.length;p++)qt(_u[p],i);break;case"image":qt("error",i),qt("load",i);break;case"details":qt("toggle",i);break;case"embed":case"source":case"link":qt("error",i),qt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in c)if(c.hasOwnProperty(de)&&(p=c[de],p!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(Ce(137,s));default:Ti(i,s,de,p,c,null)}return;default:if(yn(s)){for(Oe in c)c.hasOwnProperty(Oe)&&(p=c[Oe],p!==void 0&&rd(i,s,Oe,p,c,void 0));return}}for(G in c)c.hasOwnProperty(G)&&(p=c[G],p!=null&&Ti(i,s,G,p,c,null))}function Ff(i,s,c,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,S=null,B=null,G=null,te=null,de=null,Oe=null;for(Le in c){var He=c[Le];if(c.hasOwnProperty(Le)&&He!=null)switch(Le){case"checked":break;case"value":break;case"defaultValue":te=He;default:p.hasOwnProperty(Le)||Ti(i,s,Le,null,p,He)}}for(var Ee in p){var Le=p[Ee];if(He=c[Ee],p.hasOwnProperty(Ee)&&(Le!=null||He!=null))switch(Ee){case"type":S=Le;break;case"name":x=Le;break;case"checked":de=Le;break;case"defaultChecked":Oe=Le;break;case"value":B=Le;break;case"defaultValue":G=Le;break;case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(Ce(137,s));break;default:Le!==He&&Ti(i,s,Ee,Le,p,He)}}ua(i,B,G,te,de,Oe,S,x);return;case"select":Le=B=G=Ee=null;for(S in c)if(te=c[S],c.hasOwnProperty(S)&&te!=null)switch(S){case"value":break;case"multiple":Le=te;default:p.hasOwnProperty(S)||Ti(i,s,S,null,p,te)}for(x in p)if(S=p[x],te=c[x],p.hasOwnProperty(x)&&(S!=null||te!=null))switch(x){case"value":Ee=S;break;case"defaultValue":G=S;break;case"multiple":B=S;default:S!==te&&Ti(i,s,x,S,p,te)}s=G,c=B,p=Le,Ee!=null?Jr(i,!!c,Ee,!1):!!p!=!!c&&(s!=null?Jr(i,!!c,s,!0):Jr(i,!!c,c?[]:"",!1));return;case"textarea":Le=Ee=null;for(G in c)if(x=c[G],c.hasOwnProperty(G)&&x!=null&&!p.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:Ti(i,s,G,null,p,x)}for(B in p)if(x=p[B],S=c[B],p.hasOwnProperty(B)&&(x!=null||S!=null))switch(B){case"value":Ee=x;break;case"defaultValue":Le=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(Ce(91));break;default:x!==S&&Ti(i,s,B,x,p,S)}xc(i,Ee,Le);return;case"option":for(var bt in c)if(Ee=c[bt],c.hasOwnProperty(bt)&&Ee!=null&&!p.hasOwnProperty(bt))switch(bt){case"selected":i.selected=!1;break;default:Ti(i,s,bt,null,p,Ee)}for(te in p)if(Ee=p[te],Le=c[te],p.hasOwnProperty(te)&&Ee!==Le&&(Ee!=null||Le!=null))switch(te){case"selected":i.selected=Ee&&typeof Ee!="function"&&typeof Ee!="symbol";break;default:Ti(i,s,te,Ee,p,Le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Nt in c)Ee=c[Nt],c.hasOwnProperty(Nt)&&Ee!=null&&!p.hasOwnProperty(Nt)&&Ti(i,s,Nt,null,p,Ee);for(de in p)if(Ee=p[de],Le=c[de],p.hasOwnProperty(de)&&Ee!==Le&&(Ee!=null||Le!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(Ce(137,s));break;default:Ti(i,s,de,Ee,p,Le)}return;default:if(yn(s)){for(var Mn in c)Ee=c[Mn],c.hasOwnProperty(Mn)&&Ee!==void 0&&!p.hasOwnProperty(Mn)&&rd(i,s,Mn,void 0,p,Ee);for(Oe in p)Ee=p[Oe],Le=c[Oe],!p.hasOwnProperty(Oe)||Ee===Le||Ee===void 0&&Le===void 0||rd(i,s,Oe,Ee,p,Le);return}}for(var ge in c)Ee=c[ge],c.hasOwnProperty(ge)&&Ee!=null&&!p.hasOwnProperty(ge)&&Ti(i,s,ge,null,p,Ee);for(He in p)Ee=p[He],Le=c[He],!p.hasOwnProperty(He)||Ee===Le||Ee==null&&Le==null||Ti(i,s,He,Ee,p,Le)}var Jd=null,ef=null;function hh(i){return i.nodeType===9?i:i.ownerDocument}function vu(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function tf(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function xu(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var sd=null;function od(){var i=window.event;return i&&i.type==="popstate"?i===sd?!1:(sd=i,!0):(sd=null,!1)}var dh=typeof setTimeout=="function"?setTimeout:void 0,ld=typeof clearTimeout=="function"?clearTimeout:void 0,jf=typeof Promise=="function"?Promise:void 0,ep=typeof queueMicrotask=="function"?queueMicrotask:typeof jf<"u"?function(i){return jf.resolve(null).then(i).catch(tp)}:dh;function tp(i){setTimeout(function(){throw i})}function vl(i,s){var c=s,p=0;do{var x=c.nextSibling;if(i.removeChild(c),x&&x.nodeType===8)if(c=x.data,c==="/$"){if(p===0){i.removeChild(x),$a(s);return}p--}else c!=="$"&&c!=="$?"&&c!=="$!"||p++;c=x}while(c);$a(s)}function jn(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":jn(c),ci(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function xl(i,s,c,p){for(;i.nodeType===1;){var x=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(p){if(!i[Ln])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==x.rel||i.getAttribute("href")!==(x.href==null?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var S=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=Xr(i.nextSibling),i===null)break}return null}function nf(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Xr(i.nextSibling),i===null))return null;return i}function Xr(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}function af(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(s===0)return i;s--}else c==="/$"&&s++}i=i.previousSibling}return null}function cd(i,s,c){switch(s=hh(c),i){case"html":if(i=s.documentElement,!i)throw Error(Ce(452));return i;case"head":if(i=s.head,!i)throw Error(Ce(453));return i;case"body":if(i=s.body,!i)throw Error(Ce(454));return i;default:throw Error(Ce(451))}}var Yr=new Map,rf=new Set;function fh(i){return typeof i.getRootNode=="function"?i.getRootNode():i.ownerDocument}var Ao=We.d;We.d={f:Nf,r:sf,D:ph,C:lf,L:Uf,m:cf,X:mh,S:ud,M:uf};function Nf(){var i=Ao.f(),s=sh();return i||s}function sf(i){var s=kr(i);s!==null&&s.tag===5&&s.type==="form"?$e(s):Ao.r(i)}var bl=typeof document>"u"?null:document;function of(i,s,c){var p=bl;if(p&&typeof s=="string"&&s){var x=It(s);x='link[rel="'+i+'"][href="'+x+'"]',typeof c=="string"&&(x+='[crossorigin="'+c+'"]'),rf.has(x)||(rf.add(x),i={rel:i,crossOrigin:c,href:s},p.querySelector(x)===null&&(s=p.createElement("link"),ra(s,"link",i),Zi(s),p.head.appendChild(s)))}}function ph(i){Ao.D(i),of("dns-prefetch",i,null)}function lf(i,s){Ao.C(i,s),of("preconnect",i,s)}function Uf(i,s,c){Ao.L(i,s,c);var p=bl;if(p&&i&&s){var x='link[rel="preload"][as="'+It(s)+'"]';s==="image"&&c&&c.imageSrcSet?(x+='[imagesrcset="'+It(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(x+='[imagesizes="'+It(c.imageSizes)+'"]')):x+='[href="'+It(i)+'"]';var S=x;switch(s){case"style":S=wl(i);break;case"script":S=a(i)}Yr.has(S)||(i=ti({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),Yr.set(S,i),p.querySelector(x)!==null||s==="style"&&p.querySelector(_h(S))||s==="script"&&p.querySelector(o(S))||(s=p.createElement("link"),ra(s,"link",i),Zi(s),p.head.appendChild(s)))}}function cf(i,s){Ao.m(i,s);var c=bl;if(c&&i){var p=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+It(p)+'"][href="'+It(i)+'"]',S=x;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=a(i)}if(!Yr.has(S)&&(i=ti({rel:"modulepreload",href:i},s),Yr.set(S,i),c.querySelector(x)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(o(S)))return}p=c.createElement("link"),ra(p,"link",i),Zi(p),c.head.appendChild(p)}}}function ud(i,s,c){Ao.S(i,s,c);var p=bl;if(p&&i){var x=Ra(p).hoistableStyles,S=wl(i);s=s||"default";var B=x.get(S);if(!B){var G={loading:0,preload:null};if(B=p.querySelector(_h(S)))G.loading=5;else{i=ti({rel:"stylesheet",href:i,"data-precedence":s},c),(c=Yr.get(S))&&g(i,c);var te=B=p.createElement("link");Zi(te),ra(te,"link",i),te._p=new Promise(function(de,Oe){te.onload=de,te.onerror=Oe}),te.addEventListener("load",function(){G.loading|=1}),te.addEventListener("error",function(){G.loading|=2}),G.loading|=4,_(B,s,p)}B={type:"stylesheet",instance:B,count:1,state:G},x.set(S,B)}}}function mh(i,s){Ao.X(i,s);var c=bl;if(c&&i){var p=Ra(c).hoistableScripts,x=a(i),S=p.get(x);S||(S=c.querySelector(o(x)),S||(i=ti({src:i,async:!0},s),(s=Yr.get(x))&&v(i,s),S=c.createElement("script"),Zi(S),ra(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(x,S))}}function uf(i,s){Ao.M(i,s);var c=bl;if(c&&i){var p=Ra(c).hoistableScripts,x=a(i),S=p.get(x);S||(S=c.querySelector(o(x)),S||(i=ti({src:i,async:!0,type:"module"},s),(s=Yr.get(x))&&v(i,s),S=c.createElement("script"),Zi(S),ra(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(x,S))}}function hd(i,s,c,p){var x=(x=ta.current)?fh(x):null;if(!x)throw Error(Ce(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=wl(c.href),c=Ra(x).hoistableStyles,p=c.get(s),p||(p={type:"style",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=wl(c.href);var S=Ra(x).hoistableStyles,B=S.get(i);if(B||(x=x.ownerDocument||x,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,B),(S=x.querySelector(_h(i)))&&!S._p&&(B.instance=S,B.state.loading=5),Yr.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Yr.set(i,c),S||t(x,i,c,B.state))),s&&p===null)throw Error(Ce(528,""));return B}if(s&&p!==null)throw Error(Ce(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=a(c),c=Ra(x).hoistableScripts,p=c.get(s),p||(p={type:"script",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(Ce(444,i))}}function wl(i){return'href="'+It(i)+'"'}function _h(i){return'link[rel="stylesheet"]['+i+"]"}function r(i){return ti({},i,{"data-precedence":i.precedence,precedence:null})}function t(i,s,c,p){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=i.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),ra(s,"link",c),Zi(s),i.head.appendChild(s))}function a(i){return'[src="'+It(i)+'"]'}function o(i){return"script[async]"+i}function h(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var p=i.querySelector('style[data-href~="'+It(c.href)+'"]');if(p)return s.instance=p,Zi(p),p;var x=ti({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return p=(i.ownerDocument||i).createElement("style"),Zi(p),ra(p,"style",x),_(p,c.precedence,i),s.instance=p;case"stylesheet":x=wl(c.href);var S=i.querySelector(_h(x));if(S)return s.state.loading|=4,s.instance=S,Zi(S),S;p=r(c),(x=Yr.get(x))&&g(p,x),S=(i.ownerDocument||i).createElement("link"),Zi(S);var B=S;return B._p=new Promise(function(G,te){B.onload=G,B.onerror=te}),ra(S,"link",p),s.state.loading|=4,_(S,c.precedence,i),s.instance=S;case"script":return S=a(c.src),(x=i.querySelector(o(S)))?(s.instance=x,Zi(x),x):(p=c,(x=Yr.get(S))&&(p=ti({},c),v(p,x)),i=i.ownerDocument||i,x=i.createElement("script"),Zi(x),ra(x,"link",p),i.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(Ce(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,_(p,c.precedence,i));return s.instance}function _(i,s,c){for(var p=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=p.length?p[p.length-1]:null,S=x,B=0;B<p.length;B++){var G=p[B];if(G.dataset.precedence===s)S=G;else if(S!==x)break}S?S.parentNode.insertBefore(i,S.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function g(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function v(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var w=null;function M(i,s,c){if(w===null){var p=new Map,x=w=new Map;x.set(c,p)}else x=w,p=x.get(c),p||(p=new Map,x.set(c,p));if(p.has(i))return p;for(p.set(i,null),c=c.getElementsByTagName(i),x=0;x<c.length;x++){var S=c[x];if(!(S[Ln]||S[xt]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var B=S.getAttribute(s)||"";B=i+B;var G=p.get(B);G?G.push(S):p.set(B,[S])}}return p}function C(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function A(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function R(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var k=null;function O(){}function U(i,s,c){if(k===null)throw Error(Ce(475));var p=k;if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var x=wl(c.href),S=i.querySelector(_h(x));if(S){i=S._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(p.count++,p=Q.bind(p),i.then(p,p)),s.state.loading|=4,s.instance=S,Zi(S);return}S=i.ownerDocument||i,c=r(c),(x=Yr.get(x))&&g(c,x),S=S.createElement("link"),Zi(S);var B=S;B._p=new Promise(function(G,te){B.onload=G,B.onerror=te}),ra(S,"link",c),s.instance=S}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(p.count++,s=Q.bind(p),i.addEventListener("load",s),i.addEventListener("error",s))}}function q(){if(k===null)throw Error(Ce(475));var i=k;return i.stylesheets&&i.count===0&&J(i,i.stylesheets),0<i.count?function(s){var c=setTimeout(function(){if(i.stylesheets&&J(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(c)}}:null}function Q(){if(this.count--,this.count===0){if(this.stylesheets)J(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var oe=null;function J(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,oe=new Map,s.forEach(L,i),oe=null,Q.call(i))}function L(i,s){if(!(s.state.loading&4)){var c=oe.get(i);if(c)var p=c.get(null);else{c=new Map,oe.set(i,c);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<x.length;S++){var B=x[S];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(c.set(B.dataset.precedence,B),p=B)}p&&c.set(null,p)}x=s.instance,B=x.getAttribute("data-precedence"),S=c.get(B)||p,S===p&&c.set(null,x),c.set(B,x),this.count++,p=Q.bind(this),x.addEventListener("load",p),x.addEventListener("error",p),S?S.parentNode.insertBefore(x,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),s.state.loading|=4}}var Z={$$typeof:xe,Provider:null,Consumer:null,_currentValue:Ct,_currentValue2:Ct,_threadCount:0};function ee(i,s,c,p,x,S,B,G){this.tag=1,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qe(0),this.hiddenUpdates=Qe(null),this.identifierPrefix=p,this.onUncaughtError=x,this.onCaughtError=S,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function ve(i,s,c,p,x,S,B,G,te,de,Oe,He){return i=new ee(i,s,c,B,G,te,de,He),s=1,S===!0&&(s|=24),S=Pa(3,null,null,s),i.current=S,S.stateNode=i,s=Ko(),s.refCount++,i.pooledCache=s,s.refCount++,S.memoizedState={element:p,isDehydrated:c,cache:s},Sd(S),i}function je(i){return i?(i=ss,i):ss}function Se(i,s,c,p,x,S){x=je(x),p.context===null?p.context=x:p.pendingContext=x,p=ol(s),p.payload={element:c},S=S===void 0?null:S,S!==null&&(p.callback=S),c=Zs(i,p,s),c!==null&&(Jn(c,i,s),ic(c,i,s))}function Ae(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function Ze(i,s){Ae(i,s),(i=i.alternate)&&Ae(i,s)}function Ue(i){if(i.tag===13){var s=Ur(i,67108864);s!==null&&Jn(s,i,67108864),Ze(i,67108864)}}var Ge=!0;function Re(i,s,c,p){var x=Mt.T;Mt.T=null;var S=We.p;try{We.p=2,gt(i,s,c,p)}finally{We.p=S,Mt.T=x}}function tt(i,s,c,p){var x=Mt.T;Mt.T=null;var S=We.p;try{We.p=8,gt(i,s,c,p)}finally{We.p=S,Mt.T=x}}function gt(i,s,c,p){if(Ge){var x=pt(p);if(x===null)yl(i,s,p,nt,c),Un(i,p);else if(Pr(x,i,s,c,p))p.stopPropagation();else if(Un(i,p),s&4&&-1<ea.indexOf(i)){for(;x!==null;){var S=kr(x);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var B=ce(S.pendingLanes);if(B!==0){var G=S;for(G.pendingLanes|=2,G.entangledLanes|=2;B;){var te=1<<31-V(B);G.entanglements[1]|=te,B&=~te}ps(S),(nn&6)===0&&(cu=ia()+500,ch(0))}}break;case 13:G=Ur(S,2),G!==null&&Jn(G,S,2),sh(),Ze(S,2)}if(S=pt(p),S===null&&yl(i,s,p,nt,c),S===x)break;x=S}x!==null&&p.stopPropagation()}else yl(i,s,p,null,c)}}function pt(i){return i=en(i),Ut(i)}var nt=null;function Ut(i){if(nt=null,i=ys(i),i!==null){var s=Tt(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=si(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return nt=i,null}function Ui(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Do()){case _s:return 2;case Rr:return 8;case Qa:case gs:return 32;case Qr:return 268435456;default:return 32}default:return 32}}var fn=!1,Yi=null,Nn=null,Tn=null,pn=new Map,vi=new Map,Ri=[],ea="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Un(i,s){switch(i){case"focusin":case"focusout":Yi=null;break;case"dragenter":case"dragleave":Nn=null;break;case"mouseover":case"mouseout":Tn=null;break;case"pointerover":case"pointerout":pn.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":vi.delete(s.pointerId)}}function Vn(i,s,c,p,x,S){return i===null||i.nativeEvent!==S?(i={blockedOn:s,domEventName:c,eventSystemFlags:p,nativeEvent:S,targetContainers:[x]},s!==null&&(s=kr(s),s!==null&&Ue(s)),i):(i.eventSystemFlags|=p,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function Pr(i,s,c,p,x){switch(s){case"focusin":return Yi=Vn(Yi,i,s,c,p,x),!0;case"dragenter":return Nn=Vn(Nn,i,s,c,p,x),!0;case"mouseover":return Tn=Vn(Tn,i,s,c,p,x),!0;case"pointerover":var S=x.pointerId;return pn.set(S,Vn(pn.get(S)||null,i,s,c,p,x)),!0;case"gotpointercapture":return S=x.pointerId,vi.set(S,Vn(vi.get(S)||null,i,s,c,p,x)),!0}return!1}function In(i){var s=ys(i.target);if(s!==null){var c=Tt(s);if(c!==null){if(s=c.tag,s===13){if(s=si(c),s!==null){i.blockedOn=s,Bt(i.priority,function(){if(c.tag===13){var p=Fn(),x=Ur(c,p);x!==null&&Jn(x,c,p),Ze(c,p)}});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function sa(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=pt(i.nativeEvent);if(c===null){c=i.nativeEvent;var p=new c.constructor(c.type,c);Ba=p,c.target.dispatchEvent(p),Ba=null}else return s=kr(c),s!==null&&Ue(s),i.blockedOn=c,!1;s.shift()}return!0}function Sn(i,s,c){sa(i)&&c.delete(s)}function Zn(){fn=!1,Yi!==null&&sa(Yi)&&(Yi=null),Nn!==null&&sa(Nn)&&(Nn=null),Tn!==null&&sa(Tn)&&(Tn=null),pn.forEach(Sn),vi.forEach(Sn)}function mn(i,s){i.blockedOn===s&&(i.blockedOn=null,fn||(fn=!0,st.unstable_scheduleCallback(st.unstable_NormalPriority,Zn)))}var Qi=null;function Si(i){Qi!==i&&(Qi=i,st.unstable_scheduleCallback(st.unstable_NormalPriority,function(){Qi===i&&(Qi=null);for(var s=0;s<i.length;s+=3){var c=i[s],p=i[s+1],x=i[s+2];if(typeof p!="function"){if(Ut(p||c)===null)continue;break}var S=kr(c);S!==null&&(i.splice(s,3),s-=3,ze(S,{pending:!0,data:x,method:c.method,action:p},p,x))}}))}function $a(i){function s(te){return mn(te,i)}Yi!==null&&mn(Yi,i),Nn!==null&&mn(Nn,i),Tn!==null&&mn(Tn,i),pn.forEach(s),vi.forEach(s);for(var c=0;c<Ri.length;c++){var p=Ri[c];p.blockedOn===i&&(p.blockedOn=null)}for(;0<Ri.length&&(c=Ri[0],c.blockedOn===null);)In(c),c.blockedOn===null&&Ri.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(p=0;p<c.length;p+=3){var x=c[p],S=c[p+1],B=x[et]||null;if(typeof S=="function")B||Si(c);else if(B){var G=null;if(S&&S.hasAttribute("formAction")){if(x=S,B=S[et]||null)G=B.formAction;else if(Ut(x)!==null)continue}else G=B.action;typeof G=="function"?c[p+1]=G:(c.splice(p,3),p-=3),Si(c)}}}function Tl(i){this._internalRoot=i}hr.prototype.render=Tl.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(Ce(409));var c=s.current,p=Fn();Se(c,p,i,s,null,null)},hr.prototype.unmount=Tl.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;i.tag===0&&fc(),Se(i.current,2,null,i,null,null),sh(),s[Ka]=null}};function hr(i){this._internalRoot=i}hr.prototype.unstable_scheduleHydration=function(i){if(i){var s=Je();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Ri.length&&s!==0&&s<Ri[c].priority;c++);Ri.splice(c,0,i),c===0&&In(i)}};var Vf=_n.version;if(Vf!=="19.0.0")throw Error(Ce(527,Vf,"19.0.0"));We.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(Ce(188)):(i=Object.keys(i).join(","),Error(Ce(268,i)));return i=Xe(s),i=i!==null?vt(i):null,i=i===null?null:i.stateNode,i};var bu={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Mt,findFiberByHostInstance:ys,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xs.isDisabled&&Xs.supportsFiber)try{Kr=Xs.inject(bu),on=Xs}catch{}}return df.createRoot=function(i,s){if(!Ot(i))throw Error(Ce(299));var c=!1,p="",x=qa,S=Er,B=or,G=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(B=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(G=s.unstable_transitionCallbacks)),s=ve(i,1,!1,null,null,c,p,x,S,B,G,null),i[Ka]=s.current,ad(i.nodeType===8?i.parentNode:i),new Tl(s)},df.hydrateRoot=function(i,s,c){if(!Ot(i))throw Error(Ce(299));var p=!1,x="",S=qa,B=Er,G=or,te=null,de=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(B=c.onCaughtError),c.onRecoverableError!==void 0&&(G=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(te=c.unstable_transitionCallbacks),c.formState!==void 0&&(de=c.formState)),s=ve(i,1,!0,s,c??null,p,x,S,B,G,te,de),s.context=je(null),c=s.current,p=Fn(),x=ol(p),x.callback=null,Zs(c,x,p),s.current.lanes=p,lt(s,p),ps(s),i[Ka]=s.current,ad(i),new hr(s)},df.version="19.0.0",df}var vp;function Ip(){if(vp)return ap.exports;vp=1;function st(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(st)}catch(_n){console.error(_n)}}return st(),ap.exports=Dp(),ap.exports}var Rp=Ip(),Zf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.2.0/LICENSE.txt
 */var kp=Zf.exports,xp;function Lp(){return xp||(xp=1,function(st,_n){(function(Wt,Ce){st.exports=Ce()})(kp,function(){var Wt={},Ce={};function Ot(F,d,ot){if(Ce[F]=ot,F==="index"){var Ve="var sharedModule = {}; ("+Ce.shared+")(sharedModule); ("+Ce.worker+")(sharedModule);",Ft={};return Ce.shared(Ft),Ce.index(Wt,Ft),typeof window<"u"&&Wt.setWorkerUrl(window.URL.createObjectURL(new Blob([Ve],{type:"text/javascript"}))),Wt}}Ot("shared",["exports"],function(F){function d(r,t,a,o){return new(a||(a=Promise))(function(h,_){function g(M){try{w(o.next(M))}catch(C){_(C)}}function v(M){try{w(o.throw(M))}catch(C){_(C)}}function w(M){var C;M.done?h(M.value):(C=M.value,C instanceof a?C:new a(function(A){A(C)})).then(g,v)}w((o=o.apply(r,t||[])).next())})}function ot(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ve,Ft;function ai(){if(Ft)return Ve;function r(t,a){this.x=t,this.y=a}return Ft=1,Ve=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,o=t.y-this.y;return a*a+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),o=Math.sin(t),h=o*this.x+a*this.y;return this.x=a*this.x-o*this.y,this.y=h,this},_rotateAround:function(t,a){var o=Math.cos(t),h=Math.sin(t),_=a.y+h*(this.x-a.x)+o*(this.y-a.y);return this.x=a.x+o*(this.x-a.x)-h*(this.y-a.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t},Ve}typeof SuppressedError=="function"&&SuppressedError;var ut,xe,at=ot(ai()),Rn=function(){if(xe)return ut;function r(t,a,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=o,this.p2y=h}return xe=1,ut=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var _=this.sampleCurveX(o)-t;if(Math.abs(_)<a)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=_/g}var v=0,w=1;for(o=t,h=0;h<20&&(_=this.sampleCurveX(o),!(Math.abs(_-t)<a));h++)t>_?v=o:w=o,o=.5*(w-v)+v;return o},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},ut}(),gn=ot(Rn);let la,an;function ca(){return la==null&&(la=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),la}function Ki(){if(an==null&&(an=!1,ca())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const h=4*o;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&a[o]!==o){an=!0;break}}}return an||!1}var Vt,Xt=1e-6,ri=typeof Float32Array<"u"?Float32Array:Array;function pi(){var r=new ri(9);return ri!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Mt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ti(){var r=new ri(3);return ri!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function En(r,t,a){var o=new ri(3);return o[0]=r,o[1]=t,o[2]=a,o}function qn(r,t,a){var o=t[0],h=t[1],_=t[2],g=t[3];return r[0]=a[0]*o+a[4]*h+a[8]*_+a[12]*g,r[1]=a[1]*o+a[5]*h+a[9]*_+a[13]*g,r[2]=a[2]*o+a[6]*h+a[10]*_+a[14]*g,r[3]=a[3]*o+a[7]*h+a[11]*_+a[15]*g,r}function rn(){var r=new ri(4);return ri!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ki(){var r=new ri(2);return ri!=Float32Array&&(r[0]=0,r[1]=0),r}function kn(r,t){var a=new ri(2);return a[0]=r,a[1]=t,a}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)}),ti(),Vt=new ri(4),ri!=Float32Array&&(Vt[0]=0,Vt[1]=0,Vt[2]=0,Vt[3]=0),ti(),En(1,0,0),En(0,1,0),rn(),rn(),pi(),ki();const qe=8192;function Pt(r,t,a){return t*(qe/(r.tileSize*Math.pow(2,a-r.tileID.overscaledZ)))}function Tt(r,t){return(r%t+t)%t}function si(r,t,a){return r*(1-a)+t*a}function ue(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,a=t*r;return 4*(r<.5?a:3*(r-t)+a-.75)}function Xe(r,t,a,o){const h=new gn(r,t,a,o);return _=>h.solve(_)}const vt=Xe(.25,.1,.25,1);function mt(r,t,a){return Math.min(a,Math.max(t,r))}function We(r,t,a){const o=a-t,h=((r-t)%o+o)%o+t;return h===t?a:h}function Ct(r,...t){for(const a of t)for(const o in a)r[o]=a[o];return r}let kt=1;function sn(r,t,a){const o={};for(const h in r)o[h]=t.call(this,r[h],h,r);return o}function Yt(r,t,a){const o={};for(const h in r)t.call(this,r[h],h,r)&&(o[h]=r[h]);return o}function oi(r){return Array.isArray(r)?r.map(oi):typeof r=="object"&&r?sn(r,oi):r}const _i={};function Ci(r){_i[r]||(typeof console<"u"&&console.warn(r),_i[r]=!0)}function Vi(r,t,a){return(a.y-r.y)*(t.x-r.x)>(t.y-r.y)*(a.x-r.x)}function ta(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Li=null;function Dr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Xa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Da(r,t,a,o,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(r,{timestamp:0});try{const g=_==null?void 0:_.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const v=g.startsWith("BGR"),w=new Uint8ClampedArray(o*h*4);if(yield _.copyTo(w,function(M,C,A,R,k){const O=4*Math.max(1,0),U=(Math.max(0,A)-A)*R*4+O,q=4*R,Q=Math.max(0,C),oe=Math.max(0,A);return{rect:{x:Q,y:oe,width:Math.min(M.width,C+R)-Q,height:Math.min(M.height,A+k)-oe},layout:[{offset:U,stride:q}]}}(r,t,a,o,h)),v)for(let M=0;M<w.length;M+=4){const C=w[M];w[M]=w[M+2],w[M+2]=C}return w}finally{_.close()}})}let fr,Ir;function Ya(r,t,a,o){return r.addEventListener(t,a,o),{unsubscribe:()=>{r.removeEventListener(t,a,o)}}}function Ia(r){return r/Math.PI*180}const Po="AbortError";function Ys(){return new Error(Po)}const ia={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Do(r){return ia.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const _s="global-dispatcher";class Rr extends Error{constructor(t,a,o,h){super(`AJAXError: ${a} (${t}): ${o}`),this.status=t,this.statusText=a,this.url=o,this.body=h}}const Qa=()=>ta(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,gs=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Do(r.url);if(o)return o(r,t);if(ta(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:_s},t)}if(!(/^file:/.test(a=r.url)||/^file:/.test(Qa())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,h){return d(this,void 0,void 0,function*(){const _=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Qa(),signal:h.signal});let g,v;o.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{g=yield fetch(_)}catch(M){throw new Rr(0,M.message,o.url,new Blob)}if(!g.ok){const M=yield g.blob();throw new Rr(g.status,g.statusText,o.url,M)}v=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const w=yield v;if(h.signal.aborted)throw Ys();return{data:w,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(ta(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:_s},t)}var a;return function(o,h){return new Promise((_,g)=>{var v;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const M in o.headers)w.setRequestHeader(M,o.headers[M]);o.type==="json"&&(w.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{g(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let M=w.response;if(o.type==="json")try{M=JSON.parse(w.response)}catch(C){return void g(C)}_({data:M,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const M=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});g(new Rr(w.status,w.statusText,o.url,M))}},h.signal.addEventListener("abort",()=>{w.abort(),g(Ys())}),w.send(o.body)})}(r,t)};function Qr(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function Ml(r,t,a){a[r]&&a[r].indexOf(t)!==-1||(a[r]=a[r]||[],a[r].push(t))}function Io(r,t,a){if(a&&a[r]){const o=a[r].indexOf(t);o!==-1&&a[r].splice(o,1)}}class Kr{constructor(t,a={}){Ct(this,a),this.type=t}}class on extends Kr{constructor(t,a={}){super("error",Ct({error:t},a))}}class pe{on(t,a){return this._listeners=this._listeners||{},Ml(t,a,this._listeners),{unsubscribe:()=>{this.off(t,a)}}}off(t,a){return Io(t,a,this._listeners),Io(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ml(t,a,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,a){typeof t=="string"&&(t=new Kr(t,a||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of h)v.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of _)Io(o,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(Ct(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof on&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var P={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const V=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function H(r,t){const a={};for(const o in r)o!=="ref"&&(a[o]=r[o]);return V.forEach(o=>{o in t&&(a[o]=t[o])}),a}function K(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let a=0;a<r.length;a++)if(!K(r[a],t[a]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const a in r)if(!K(r[a],t[a]))return!1;return!0}return r===t}function re(r,t){r.push(t)}function he(r,t,a){re(a,{command:"addSource",args:[r,t[r]]})}function be(r,t,a){re(t,{command:"removeSource",args:[r]}),a[r]=!0}function ce(r,t,a,o){be(r,a,o),he(r,t,a)}function Pe(r,t,a){let o;for(o in r[a])if(Object.prototype.hasOwnProperty.call(r[a],o)&&o!=="data"&&!K(r[a][o],t[a][o]))return!1;for(o in t[a])if(Object.prototype.hasOwnProperty.call(t[a],o)&&o!=="data"&&!K(r[a][o],t[a][o]))return!1;return!0}function Me(r,t,a,o,h,_){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(K(r[g],t[g])||a.push({command:_,args:[o,g,t[g],h]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(K(r[g],t[g])||a.push({command:_,args:[o,g,t[g],h]}))}function me(r){return r.id}function Be(r,t){return r[t.id]=t,r}class _e{constructor(t,a,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)}}function Qe(r,...t){for(const a of t)for(const o in a)r[o]=a[o];return r}class lt extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class At{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[o,h]of a)this.bindings[o]=h}concat(t){return new At(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const wt={kind:"null"},ke={kind:"number"},it={kind:"string"},Je={kind:"boolean"},Bt={kind:"color"},_t={kind:"projectionDefinition"},xt={kind:"object"},et={kind:"value"},Ka={kind:"collator"},Wi={kind:"formatted"},Cn={kind:"padding"},Mi={kind:"resolvedImage"},El={kind:"variableAnchorOffsetCollection"};function Ln(r,t){return{kind:"array",itemType:r,N:t}}function ci(r){if(r.kind==="array"){const t=ci(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const ys=[wt,ke,it,Je,Bt,_t,Wi,xt,Ln(et),Cn,Mi,El];function kr(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!kr(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const a of ys)if(!kr(a,t))return null}}return`Expected ${ci(r)} but found ${ci(t)} instead.`}function Qs(r,t){return t.some(a=>a.kind===r.kind)}function Ra(r,t){return t.some(a=>a==="null"?r===null:a==="array"?Array.isArray(r):a==="object"?r&&!Array.isArray(r)&&typeof r=="object":a===typeof r)}function Zi(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const gc=.96422,wu=.82521,vs=4/29,pr=6/29,Lr=3*pr*pr,dd=pr*pr*pr,yh=Math.PI/180,vh=180/Math.PI;function Tu(r){return(r%=360)<0&&(r+=360),r}function Wr([r,t,a,o]){let h,_;const g=mr((.2225045*(r=Ro(r))+.7168786*(t=Ro(t))+.0606169*(a=Ro(a)))/1);r===t&&t===a?h=_=g:(h=mr((.4360747*r+.3850649*t+.1430804*a)/gc),_=mr((.0139322*r+.0971045*t+.7141733*a)/wu));const v=116*g-16;return[v<0?0:v,500*(h-g),200*(g-_),o]}function Ro(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function mr(r){return r>dd?Math.pow(r,1/3):r/Lr+vs}function Hn([r,t,a,o]){let h=(r+16)/116,_=isNaN(t)?h:h+t/500,g=isNaN(a)?h:h-a/200;return h=1*Su(h),_=gc*Su(_),g=wu*Su(g),[yc(3.1338561*_-1.6168667*h-.4906146*g),yc(-.9787684*_+1.9161415*h+.033454*g),yc(.0719453*_-.2289914*h+1.4052427*g),o]}function yc(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Su(r){return r>pr?r*r*r:Lr*(r-vs)}function Ks(r){return parseInt(r.padEnd(2,r),16)/255}function vc(r,t){return Br(t?r/100:r,0,1)}function Br(r,t,a){return Math.min(Math.max(t,r),a)}function _r(r){return!r.some(Number.isNaN)}const It={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ua(r,t,a){return r+a*(t-r)}function ka(r,t,a){return r.map((o,h)=>ua(o,t[h],a))}class Zt{constructor(t,a,o,h=1,_=!0){this.r=t,this.g=a,this.b=o,this.a=h,_||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,a,o,h]))}static parse(t){if(t instanceof Zt)return t;if(typeof t!="string")return;const a=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=It[o];if(h){const[g,v,w]=h;return[g/255,v/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let v=1;return[Ks(o.slice(v,v+=g)),Ks(o.slice(v,v+=g)),Ks(o.slice(v,v+=g)),Ks(o.slice(v,v+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[v,w,M,C,A,R,k,O,U,q,Q,oe]=g,J=[C||" ",k||" ",q].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const L=[M,R,U].join(""),Z=L==="%%%"?100:L===""?255:0;if(Z){const ee=[Br(+w/Z,0,1),Br(+A/Z,0,1),Br(+O/Z,0,1),Q?vc(+Q,oe):1];if(_r(ee))return ee}}return}}const _=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[g,v,w,M,C,A,R,k,O]=_,U=[w||" ",C||" ",R].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const q=[+v,Br(+M,0,100),Br(+A,0,100),k?vc(+k,O):1];if(_r(q))return function([Q,oe,J,L]){function Z(ee){const ve=(ee+Q/30)%12,je=oe*Math.min(J,1-J);return J-je*Math.max(-1,Math.min(ve-3,9-ve,1))}return Q=Tu(Q),oe/=100,J/=100,[Z(0),Z(8),Z(4),L]}(q)}}}(t);return a?new Zt(...a,!1):void 0}get rgb(){const{r:t,g:a,b:o,a:h}=this,_=h||1/0;return this.overwriteGetter("rgb",[t/_,a/_,o/_,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[a,o,h,_]=Wr(t),g=Math.sqrt(o*o+h*h);return[Math.round(1e4*g)?Tu(Math.atan2(h,o)*vh):NaN,g,a,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Wr(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,o,h]=this.rgb;return`rgba(${[t,a,o].map(_=>Math.round(255*_)).join(",")},${h})`}static interpolate(t,a,o,h="rgb"){switch(h){case"rgb":{const[_,g,v,w]=ka(t.rgb,a.rgb,o);return new Zt(_,g,v,w,!1)}case"hcl":{const[_,g,v,w]=t.hcl,[M,C,A,R]=a.hcl;let k,O;if(isNaN(_)||isNaN(M))isNaN(_)?isNaN(M)?k=NaN:(k=M,v!==1&&v!==0||(O=C)):(k=_,A!==1&&A!==0||(O=g));else{let J=M-_;M>_&&J>180?J-=360:M<_&&_-M>180&&(J+=360),k=_+o*J}const[U,q,Q,oe]=function([J,L,Z,ee]){return J=isNaN(J)?0:J*yh,Hn([Z,Math.cos(J)*L,Math.sin(J)*L,ee])}([k,O??ua(g,C,o),ua(v,A,o),ua(w,R,o)]);return new Zt(U,q,Q,oe,!1)}case"lab":{const[_,g,v,w]=Hn(ka(t.lab,a.lab,o));return new Zt(_,g,v,w,!1)}}}}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);class Jr{constructor(t,a,o){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const xc=["bottom","center","top"];class La{constructor(t,a,o,h,_,g){this.text=t,this.image=a,this.scale=o,this.fontStack=h,this.textColor=_,this.verticalAlign=g}}class Ji{constructor(t){this.sections=t}static fromString(t){return new Ji([new La(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Ji?t:Ji.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bn)return t;if(typeof t=="number")return new Bn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Bn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,a,o){return new Bn(ka(t.values,a.values,o))}}class Bi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const bc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class yn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof yn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const o=t[a],h=t[a+1];if(typeof o!="string"||!bc.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new yn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,a,o){const h=t.values,_=a.values;if(h.length!==_.length)throw new Bi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${a.toString()}`);const g=[];for(let v=0;v<h.length;v+=2){if(h[v]!==_[v])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${_[v]}`);g.push(h[v]);const[w,M]=h[v+1],[C,A]=_[v+1];g.push([ua(w,C,o),ua(M,A,o)])}return new yn(g)}}class ha{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ha({name:t,available:!1}):null}}class xa{constructor(t,a,o){this.from=t,this.to=a,this.transition=o}static interpolate(t,a,o){return new xa(t,a,o)}static parse(t){return t instanceof xa?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new xa(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new xa(t.from,t.to,t.transition):typeof t=="string"?new xa(t,t,1):void 0}}function Ws(r,t,a,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,a,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,a,o]:[r,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ba(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof xa||r instanceof Zt||r instanceof Jr||r instanceof Ji||r instanceof Bn||r instanceof yn||r instanceof ha)return!0;if(Array.isArray(r)){for(const t of r)if(!Ba(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Ba(r[t]))return!1;return!0}return!1}function en(r){if(r===null)return wt;if(typeof r=="string")return it;if(typeof r=="boolean")return Je;if(typeof r=="number")return ke;if(r instanceof Zt)return Bt;if(r instanceof xa)return _t;if(r instanceof Jr)return Ka;if(r instanceof Ji)return Wi;if(r instanceof Bn)return Cn;if(r instanceof yn)return El;if(r instanceof ha)return Mi;if(Array.isArray(r)){const t=r.length;let a;for(const o of r){const h=en(o);if(a){if(a===h)continue;a=et;break}a=h}return Ln(a||et,t)}return xt}function Oa(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Zt||r instanceof xa||r instanceof Ji||r instanceof Bn||r instanceof yn||r instanceof ha?r.toString():JSON.stringify(r)}class $n{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ba(t[1]))return a.error("invalid value");const o=t[1];let h=en(o);const _=a.expectedType;return h.kind!=="array"||h.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(h=_),new $n(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ko={string:it,number:ke,boolean:Je,object:xt};class ba{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let o,h=1;const _=t[0];if(_==="array"){let v,w;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in ko)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);v=ko[M],h++}else v=et;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}o=Ln(v,w)}else{if(!ko[_])throw new Error(`Types doesn't contain name = ${_}`);o=ko[_]}const g=[];for(;h<t.length;h++){const v=a.parse(t[h],h,et);if(!v)return null;g.push(v)}return new ba(o,g)}evaluate(t){for(let a=0;a<this.args.length;a++){const o=this.args[a].evaluate(t);if(!kr(this.type,en(o)))return o;if(a===this.args.length-1)throw new Bi(`Expected value to be of type ${ci(this.type)}, but found ${ci(en(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const wc={"to-boolean":Je,"to-color":Bt,"to-number":ke,"to-string":it};class da{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const o=t[0];if(!wc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return a.error("Expected one argument.");const h=wc[o],_=[];for(let g=1;g<t.length;g++){const v=a.parse(t[g],g,et);if(!v)return null;_.push(v)}return new da(h,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,o;for(const h of this.args){if(a=h.evaluate(t),o=null,a instanceof Zt)return a;if(typeof a=="string"){const _=t.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(o=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ws(a[0],a[1],a[2],a[3]),!o))return new Zt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Bi(o||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const o of this.args){a=o.evaluate(t);const h=Bn.parse(a);if(h)return h}throw new Bi(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const o of this.args){a=o.evaluate(t);const h=yn.parse(a);if(h)return h}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const o of this.args){if(a=o.evaluate(t),a===null)return 0;const h=Number(a);if(!isNaN(h))return h}throw new Bi(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return Ji.fromString(Oa(this.args[0].evaluate(t)));case"resolvedImage":return ha.fromString(Oa(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Oa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const xi=["Unknown","Point","LineString","Polygon"];class xs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Zt.parse(t)),a}}class Lt{constructor(t,a,o=[],h,_=new At,g=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=_,this.errors=g,this.expectedType=h,this._isConstant=a}parse(t,a,o,h,_={}){return a?this.concat(a,o,h)._parse(t,_):this._parse(t,_)}_parse(t,a){function o(h,_,g){return g==="assert"?new ba(_,[h]):g==="coerce"?new da(_,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[h];if(_){let g=_.parse(t,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,w=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="projectionDefinition"||w.kind!=="string"&&w.kind!=="array")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(v.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(v,w))return null}else g=o(g,v,a.typeAnnotation||"coerce");else g=o(g,v,a.typeAnnotation||"coerce");else g=o(g,v,a.typeAnnotation||"coerce");else g=o(g,v,a.typeAnnotation||"coerce");else g=o(g,v,a.typeAnnotation||"assert")}if(!(g instanceof $n)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const v=new xs;try{g=new $n(g.type,g.evaluate(v))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,o){const h=typeof t=="number"?this.path.concat(t):this.path,_=o?this.scope.concat(o):this.scope;return new Lt(this.registry,this._isConstant,h,a||null,_,this.errors)}error(t,...a){const o=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new lt(o,t))}checkSubtype(t,a){const o=kr(t,a);return o&&this.error(o),o}}class Dt{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let _=1;_<t.length-1;_+=2){const g=t[_];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,_);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const v=a.parse(t[_+1],_+1);if(!v)return null;o.push([g,v])}const h=a.parse(t[t.length-1],t.length-1,a.expectedType,o);return h?new Dt(o,h):null}outputDefined(){return this.result.outputDefined()}}class es{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const o=t[1];return a.scope.has(o)?new es(o,a.scope.get(o)):a.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Gt{constructor(t,a,o){this.type=t,this.index=a,this.input=o}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=a.parse(t[1],1,ke),h=a.parse(t[2],2,Ln(a.expectedType||et));return o&&h?new Gt(h.type.itemType,o,h):null}evaluate(t){const a=this.index.evaluate(t),o=this.input.evaluate(t);if(a<0)throw new Bi(`Array index out of bounds: ${a} < 0.`);if(a>=o.length)throw new Bi(`Array index out of bounds: ${a} > ${o.length-1}.`);if(a!==Math.floor(a))throw new Bi(`Array index must be an integer, but found ${a} instead.`);return o[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class bs{constructor(t,a){this.type=Je,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=a.parse(t[1],1,et),h=a.parse(t[2],2,et);return o&&h?Qs(o.type,[Je,it,ke,wt,et])?new bs(o,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Ra(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(en(a))} instead.`);if(!Ra(o,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${ci(en(o))} instead.`);return o.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fa{constructor(t,a,o){this.type=ke,this.needle=t,this.haystack=a,this.fromIndex=o}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=a.parse(t[1],1,et),h=a.parse(t[2],2,et);if(!o||!h)return null;if(!Qs(o.type,[Je,it,ke,wt,et]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,ke);return _?new fa(o,h,_):null}return new fa(o,h)}evaluate(t){const a=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Ra(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(en(a))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),Ra(o,["string"])){const _=o.indexOf(a,h);return _===-1?-1:[...o.slice(0,_)].length}if(Ra(o,["array"]))return o.indexOf(a,h);throw new Bi(`Expected second argument to be of type array or string, but found ${ci(en(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Lo{constructor(t,a,o,h,_,g){this.inputType=t,this.type=a,this.input=o,this.cases=h,this.outputs=_,this.otherwise=g}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let o,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const _={},g=[];for(let M=2;M<t.length-1;M+=2){let C=t[M];const A=t[M+1];Array.isArray(C)||(C=[C]);const R=a.concat(M);if(C.length===0)return R.error("Expected at least one branch label.");for(const O of C){if(typeof O!="number"&&typeof O!="string")return R.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return R.error("Numeric branch labels must be integer values.");if(o){if(R.checkSubtype(o,en(O)))return null}else o=en(O);if(_[String(O)]!==void 0)return R.error("Branch labels must be unique.");_[String(O)]=g.length}const k=a.parse(A,M,h);if(!k)return null;h=h||k.type,g.push(k)}const v=a.parse(t[1],1,et);if(!v)return null;const w=a.parse(t[t.length-1],t.length-1,h);return w?v.type.kind!=="value"&&a.concat(1).checkSubtype(o,v.type)?null:new Lo(o,h,v,_,g,w):null}evaluate(t){const a=this.input.evaluate(t);return(en(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Xn{constructor(t,a,o){this.type=t,this.branches=a,this.otherwise=o}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let o;a.expectedType&&a.expectedType.kind!=="value"&&(o=a.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const v=a.parse(t[g],g,Je);if(!v)return null;const w=a.parse(t[g+1],g+1,o);if(!w)return null;h.push([v,w]),o=o||w.type}const _=a.parse(t[t.length-1],t.length-1,o);if(!_)return null;if(!o)throw new Error("Can't infer output type");return new Xn(o,h,_)}evaluate(t){for(const[a,o]of this.branches)if(a.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,o]of this.branches)t(a),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class gr{constructor(t,a,o,h){this.type=t,this.input=a,this.beginIndex=o,this.endIndex=h}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=a.parse(t[1],1,et),h=a.parse(t[2],2,ke);if(!o||!h)return null;if(!Qs(o.type,[Ln(et),it,et]))return a.error(`Expected first argument to be of type array or string, but found ${ci(o.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,ke);return _?new gr(o.type,o,h,_):null}return new gr(o.type,o,h)}evaluate(t){const a=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),Ra(a,["string"]))return[...a].slice(o,h).join("");if(Ra(a,["array"]))return a.slice(o,h);throw new Bi(`Expected first argument to be of type array or string, but found ${ci(en(a))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ts(r,t){const a=r.length-1;let o,h,_=0,g=a,v=0;for(;_<=g;)if(v=Math.floor((_+g)/2),o=r[v],h=r[v+1],o<=t){if(v===a||t<h)return v;_=v+1}else{if(!(o>t))throw new Bi("Input is not a number.");g=v-1}return 0}class Or{constructor(t,a,o){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[h,_]of o)this.labels.push(h),this.outputs.push(_)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const o=a.parse(t[1],1,ke);if(!o)return null;const h=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let g=1;g<t.length;g+=2){const v=g===1?-1/0:t[g],w=t[g+1],M=g,C=g+1;if(typeof v!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=v)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const A=a.parse(w,C,_);if(!A)return null;_=_||A.type,h.push([v,A])}return new Or(_,o,h)}evaluate(t){const a=this.labels,o=this.outputs;if(a.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=a[0])return o[0].evaluate(t);const _=a.length;return h>=a[_-1]?o[_-1].evaluate(t):o[ts(a,h)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function fd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Bo,Cl,is=function(){if(Cl)return Bo;function r(t,a,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=o,this.p2y=h}return Cl=1,Bo=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var _=this.sampleCurveX(o)-t;if(Math.abs(_)<a)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=_/g}var v=0,w=1;for(o=t,h=0;h<20&&(_=this.sampleCurveX(o),!(Math.abs(_-t)<a));h++)t>_?v=o:w=o,o=.5*(w-v)+v;return o},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},Bo}(),An=fd(is);class Yn{constructor(t,a,o,h,_){this.type=t,this.operator=a,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of _)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,a,o,h){let _=0;if(t.name==="exponential")_=Tc(a,t.base,o,h);else if(t.name==="linear")_=Tc(a,1,o,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;_=new An(g[0],g[1],g[2],g[3]).solve(Tc(a,1,o,h))}return _}static parse(t,a){let[o,h,_,...g]=t;if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const M=h[1];if(typeof M!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if(h[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(M.length!==4||M.some(C=>typeof C!="number"||C<0||C>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,ke),!_)return null;const v=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=Bt:a.expectedType&&a.expectedType.kind!=="value"&&(w=a.expectedType);for(let M=0;M<g.length;M+=2){const C=g[M],A=g[M+1],R=M+3,k=M+4;if(typeof C!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(v.length&&v[v.length-1][0]>=C)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const O=a.parse(A,k,w);if(!O)return null;w=w||O.type,v.push([C,O])}return Zi(w,ke)||Zi(w,_t)||Zi(w,Bt)||Zi(w,Cn)||Zi(w,El)||Zi(w,Ln(ke))?new Yn(w,o,h,_,v):a.error(`Type ${ci(w)} is not interpolatable.`)}evaluate(t){const a=this.labels,o=this.outputs;if(a.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=a[0])return o[0].evaluate(t);const _=a.length;if(h>=a[_-1])return o[_-1].evaluate(t);const g=ts(a,h),v=Yn.interpolationFactor(this.interpolation,h,a[g],a[g+1]),w=o[g].evaluate(t),M=o[g+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ua(w,M,v);case"color":return Zt.interpolate(w,M,v);case"padding":return Bn.interpolate(w,M,v);case"variableAnchorOffsetCollection":return yn.interpolate(w,M,v);case"array":return ka(w,M,v);case"projectionDefinition":return xa.interpolate(w,M,v)}case"interpolate-hcl":return Zt.interpolate(w,M,v,"hcl");case"interpolate-lab":return Zt.interpolate(w,M,v,"lab")}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Tc(r,t,a,o){const h=o-a,_=r-a;return h===0?0:t===1?_/h:(Math.pow(t,_)-1)/(Math.pow(t,h)-1)}const Fa={color:Zt.interpolate,number:ua,padding:Bn.interpolate,variableAnchorOffsetCollection:yn.interpolate,array:ka};class ln{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let o=null;const h=a.expectedType;h&&h.kind!=="value"&&(o=h);const _=[];for(const v of t.slice(1)){const w=a.parse(v,1+_.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,_.push(w)}if(!o)throw new Error("No output type");const g=h&&_.some(v=>kr(h,v.type));return new ln(g?et:o,_)}evaluate(t){let a,o=null,h=0;for(const _ of this.args)if(h++,o=_.evaluate(t),o&&o instanceof ha&&!o.available&&(a||(a=o.name),o=null,h===this.args.length&&(o=a)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Al(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Sc(r,t,a,o){return o.compare(t,a)===0}function Js(r,t,a){const o=r!=="=="&&r!=="!=";return class wp{constructor(_,g,v){this.type=Je,this.lhs=_,this.rhs=g,this.collator=v,this.hasUntypedArgument=_.type.kind==="value"||g.type.kind==="value"}static parse(_,g){if(_.length!==3&&_.length!==4)return g.error("Expected two or three arguments.");const v=_[0];let w=g.parse(_[1],1,et);if(!w)return null;if(!Al(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${ci(w.type)}'.`);let M=g.parse(_[2],2,et);if(!M)return null;if(!Al(v,M.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${ci(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return g.error(`Cannot compare types '${ci(w.type)}' and '${ci(M.type)}'.`);o&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new ba(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new ba(w.type,[M])));let C=null;if(_.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(_[3],3,Ka),!C)return null}return new wp(w,M,C)}evaluate(_){const g=this.lhs.evaluate(_),v=this.rhs.evaluate(_);if(o&&this.hasUntypedArgument){const w=en(g),M=en(v);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new Bi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=en(g),M=en(v);if(w.kind!=="string"||M.kind!=="string")return t(_,g,v)}return this.collator?a(_,g,v,this.collator.evaluate(_)):t(_,g,v)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const pd=Js("==",function(r,t,a){return t===a},Sc),Mc=Js("!=",function(r,t,a){return t!==a},function(r,t,a,o){return!Sc(0,t,a,o)}),Mu=Js("<",function(r,t,a){return t<a},function(r,t,a,o){return o.compare(t,a)<0}),xh=Js(">",function(r,t,a){return t>a},function(r,t,a,o){return o.compare(t,a)>0}),Ec=Js("<=",function(r,t,a){return t<=a},function(r,t,a,o){return o.compare(t,a)<=0}),Cc=Js(">=",function(r,t,a){return t>=a},function(r,t,a,o){return o.compare(t,a)>=0});class wa{constructor(t,a,o){this.type=Ka,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return a.error("Collator options argument must be an object.");const h=a.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Je);if(!h)return null;const _=a.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Je);if(!_)return null;let g=null;return o.locale&&(g=a.parse(o.locale,1,it),!g)?null:new wa(h,_,g)}evaluate(t){return new Jr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ac{constructor(t,a,o,h,_){this.type=it,this.number=t,this.locale=a,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=_}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const o=a.parse(t[1],1,ke);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let _=null;if(h.locale&&(_=a.parse(h.locale,1,it),!_))return null;let g=null;if(h.currency&&(g=a.parse(h.currency,1,it),!g))return null;let v=null;if(h["min-fraction-digits"]&&(v=a.parse(h["min-fraction-digits"],1,ke),!v))return null;let w=null;return h["max-fraction-digits"]&&(w=a.parse(h["max-fraction-digits"],1,ke),!w)?null:new Ac(o,_,g,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ns{constructor(t){this.type=Wi,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return a.error("First argument must be an image or text section.");const h=[];let _=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(_&&typeof v=="object"&&!Array.isArray(v)){_=!1;let w=null;if(v["font-scale"]&&(w=a.parse(v["font-scale"],1,ke),!w))return null;let M=null;if(v["text-font"]&&(M=a.parse(v["text-font"],1,Ln(it)),!M))return null;let C=null;if(v["text-color"]&&(C=a.parse(v["text-color"],1,Bt),!C))return null;let A=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!xc.includes(v["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(A=a.parse(v["vertical-align"],1,it),!A)return null}const R=h[h.length-1];R.scale=w,R.font=M,R.textColor=C,R.verticalAlign=A}else{const w=a.parse(t[g],1,et);if(!w)return null;const M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,h.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ns(h)}evaluate(t){return new Ji(this.sections.map(a=>{const o=a.content.evaluate(t);return en(o)===Mi?new La("",o,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(t):null):new La(Oa(o),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null,a.verticalAlign?a.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor),a.verticalAlign&&t(a.verticalAlign)}outputDefined(){return!1}}class Eu{constructor(t){this.type=Mi,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const o=a.parse(t[1],1,it);return o?new Eu(o):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),o=ha.fromString(a);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(a)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class zl{constructor(t){this.type=ke,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=a.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ci(o.type)} instead.`):new zl(o):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new Bi(`Expected value to be of type string or array, but found ${ci(en(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Fr=8192;function bh(r,t){const a=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(a*h*Fr),Math.round(o*h*Fr)]}function Cu(r,t){const a=Math.pow(2,t.z);return[(h=(r[0]/Fr+t.x)/a,360*h-180),(o=(r[1]/Fr+t.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function Pl(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function ws(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function md(r,t,a){const o=r[0]-t[0],h=r[1]-t[1],_=r[0]-a[0],g=r[1]-a[1];return o*g-_*h==0&&o*_<=0&&h*g<=0}function Dl(r,t,a,o){return(h=[o[0]-a[0],o[1]-a[1]])[0]*(_=[t[0]-r[0],t[1]-r[1]])[1]-h[1]*_[0]!=0&&!(!Fo(r,t,a,o)||!Fo(a,o,r,t));var h,_}function wh(r,t,a){for(const o of a)for(let h=0;h<o.length-1;++h)if(Dl(r,t,o[h],o[h+1]))return!0;return!1}function Oo(r,t,a=!1){let o=!1;for(const v of t)for(let w=0;w<v.length-1;w++){if(md(r,v[w],v[w+1]))return a;(_=v[w])[1]>(h=r)[1]!=(g=v[w+1])[1]>h[1]&&h[0]<(g[0]-_[0])*(h[1]-_[1])/(g[1]-_[1])+_[0]&&(o=!o)}var h,_,g;return o}function Th(r,t){for(const a of t)if(Oo(r,a))return!0;return!1}function Sh(r,t){for(const a of r)if(!Oo(a,t))return!1;for(let a=0;a<r.length-1;++a)if(wh(r[a],r[a+1],t))return!1;return!0}function Au(r,t){for(const a of t)if(Sh(r,a))return!0;return!1}function Fo(r,t,a,o){const h=o[0]-a[0],_=o[1]-a[1],g=(r[0]-a[0])*_-h*(r[1]-a[1]),v=(t[0]-a[0])*_-h*(t[1]-a[1]);return g>0&&v<0||g<0&&v>0}function zu(r,t,a){const o=[];for(let h=0;h<r.length;h++){const _=[];for(let g=0;g<r[h].length;g++){const v=bh(r[h][g],a);Pl(t,v),_.push(v)}o.push(_)}return o}function Pu(r,t,a){const o=[];for(let h=0;h<r.length;h++){const _=zu(r[h],t,a);o.push(_)}return o}function zc(r,t,a,o){if(r[0]<a[0]||r[0]>a[2]){const h=.5*o;let _=r[0]-a[0]>h?-o:a[0]-r[0]>h?o:0;_===0&&(_=r[0]-a[2]>h?-o:a[2]-r[0]>h?o:0),r[0]+=_}Pl(t,r)}function Pc(r,t,a,o){const h=Math.pow(2,o.z)*Fr,_=[o.x*Fr,o.y*Fr],g=[];for(const v of r)for(const w of v){const M=[w.x+_[0],w.y+_[1]];zc(M,t,a,h),g.push(M)}return g}function Dc(r,t,a,o){const h=Math.pow(2,o.z)*Fr,_=[o.x*Fr,o.y*Fr],g=[];for(const w of r){const M=[];for(const C of w){const A=[C.x+_[0],C.y+_[1]];Pl(t,A),M.push(A)}g.push(M)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const M of w)zc(M,t,a,h)}var v;return g}class Ts{constructor(t,a){this.type=Je,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ba(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const h=[];for(const _ of o.features){const{type:g,coordinates:v}=_.geometry;g==="Polygon"&&h.push(v),g==="MultiPolygon"&&h.push(...v)}if(h.length)return new Ts(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ts(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ts(o,o)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,o){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(o.type==="Polygon"){const v=zu(o.coordinates,_,g),w=Pc(a.geometry(),h,_,g);if(!ws(h,_))return!1;for(const M of w)if(!Oo(M,v))return!1}if(o.type==="MultiPolygon"){const v=Pu(o.coordinates,_,g),w=Pc(a.geometry(),h,_,g);if(!ws(h,_))return!1;for(const M of w)if(!Th(M,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,o){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(o.type==="Polygon"){const v=zu(o.coordinates,_,g),w=Dc(a.geometry(),h,_,g);if(!ws(h,_))return!1;for(const M of w)if(!Sh(M,v))return!1}if(o.type==="MultiPolygon"){const v=Pu(o.coordinates,_,g),w=Dc(a.geometry(),h,_,g);if(!ws(h,_))return!1;for(const M of w)if(!Au(M,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let eo=class{constructor(r=[],t=(a,o)=>a<o?-1:a>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:a}=this,o=t[r];for(;r>0;){const h=r-1>>1,_=t[h];if(a(o,_)>=0)break;t[r]=_,r=h}t[r]=o}_down(r){const{data:t,compare:a}=this,o=this.length>>1,h=t[r];for(;r<o;){let _=1+(r<<1);const g=_+1;if(g<this.length&&a(t[g],t[_])<0&&(_=g),a(t[_],h)>=0)break;t[r]=t[_],r=_}t[r]=h}};function Mh(r,t,a=0,o=r.length-1,h=_d){for(;o>a;){if(o-a>600){const w=o-a+1,M=t-a+1,C=Math.log(w),A=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*A*(w-A)/w)*(M-w/2<0?-1:1);Mh(r,t,Math.max(a,Math.floor(t-M*A/w+R)),Math.min(o,Math.floor(t+(w-M)*A/w+R)),h)}const _=r[t];let g=a,v=o;for(to(r,a,t),h(r[o],_)>0&&to(r,a,o);g<v;){for(to(r,g,v),g++,v--;h(r[g],_)<0;)g++;for(;h(r[v],_)>0;)v--}h(r[a],_)===0?to(r,a,v):(v++,to(r,v,o)),v<=t&&(a=v+1),t<=v&&(o=v-1)}}function to(r,t,a){const o=r[t];r[t]=r[a],r[a]=o}function _d(r,t){return r<t?-1:r>t?1:0}function Il(r,t){if(r.length<=1)return[r];const a=[];let o,h;for(const _ of r){const g=jo(_);g!==0&&(_.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(o&&a.push(o),o=[_]):o.push(_))}if(o&&a.push(o),t>1)for(let _=0;_<a.length;_++)a[_].length<=t||(Mh(a[_],t,1,a[_].length-1,Eh),a[_]=a[_].slice(0,t));return a}function Eh(r,t){return t.area-r.area}function jo(r){let t=0;for(let a,o,h=0,_=r.length,g=_-1;h<_;g=h++)a=r[h],o=r[g],t+=(o.x-a.x)*(a.y+o.y);return t}const io=1/298.257223563,Ch=io*(2-io),Rl=Math.PI/180;class kl{constructor(t){const a=6378.137*Rl*1e3,o=Math.cos(t*Rl),h=1/(1-Ch*(1-o*o)),_=Math.sqrt(h);this.kx=a*_*o,this.ky=a*_*h*(1-Ch)}distance(t,a){const o=this.wrap(t[0]-a[0])*this.kx,h=(t[1]-a[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(t,a){let o,h,_,g,v=1/0;for(let w=0;w<t.length-1;w++){let M=t[w][0],C=t[w][1],A=this.wrap(t[w+1][0]-M)*this.kx,R=(t[w+1][1]-C)*this.ky,k=0;A===0&&R===0||(k=(this.wrap(a[0]-M)*this.kx*A+(a[1]-C)*this.ky*R)/(A*A+R*R),k>1?(M=t[w+1][0],C=t[w+1][1]):k>0&&(M+=A/this.kx*k,C+=R/this.ky*k)),A=this.wrap(a[0]-M)*this.kx,R=(a[1]-C)*this.ky;const O=A*A+R*R;O<v&&(v=O,o=M,h=C,_=w,g=k)}return{point:[o,h],index:_,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ic(r,t){return t[0]-r[0]}function No(r){return r[1]-r[0]+1}function yr(r,t){return r[1]>=r[0]&&r[1]<t}function Rc(r,t){if(r[0]>r[1])return[null,null];const a=No(r);if(t){if(a===2)return[r,null];const h=Math.floor(a/2);return[[r[0],r[0]+h],[r[0]+h,r[1]]]}if(a===1)return[r,null];const o=Math.floor(a/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Ll(r,t){if(!yr(t,r.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Pl(a,r[o]);return a}function kc(r){const t=[1/0,1/0,-1/0,-1/0];for(const a of r)for(const o of a)Pl(t,o);return t}function Ah(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Du(r,t,a){if(!Ah(r)||!Ah(t))return NaN;let o=0,h=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(h=r[1]-t[3]),r[3]<t[1]&&(h=t[1]-r[3]),a.distance([0,0],[o,h])}function no(r,t,a){const o=a.pointOnLine(t,r);return a.distance(r,o.point)}function ii(r,t,a,o,h){const _=Math.min(no(r,[a,o],h),no(t,[a,o],h)),g=Math.min(no(a,[r,t],h),no(o,[r,t],h));return Math.min(_,g)}function gd(r,t,a,o,h){if(!yr(t,r.length)||!yr(o,a.length))return 1/0;let _=1/0;for(let g=t[0];g<t[1];++g){const v=r[g],w=r[g+1];for(let M=o[0];M<o[1];++M){const C=a[M],A=a[M+1];if(Dl(v,w,C,A))return 0;_=Math.min(_,ii(v,w,C,A,h))}}return _}function ja(r,t,a,o,h){if(!yr(t,r.length)||!yr(o,a.length))return NaN;let _=1/0;for(let g=t[0];g<=t[1];++g)for(let v=o[0];v<=o[1];++v)if(_=Math.min(_,h.distance(r[g],a[v])),_===0)return _;return _}function Bl(r,t,a){if(Oo(r,t,!0))return 0;let o=1/0;for(const h of t){const _=h[0],g=h[h.length-1];if(_!==g&&(o=Math.min(o,no(r,[g,_],a)),o===0))return o;const v=a.pointOnLine(h,r);if(o=Math.min(o,a.distance(r,v.point)),o===0)return o}return o}function zh(r,t,a,o){if(!yr(t,r.length))return NaN;for(let _=t[0];_<=t[1];++_)if(Oo(r[_],a,!0))return 0;let h=1/0;for(let _=t[0];_<t[1];++_){const g=r[_],v=r[_+1];for(const w of a)for(let M=0,C=w.length,A=C-1;M<C;A=M++){const R=w[A],k=w[M];if(Dl(g,v,R,k))return 0;h=Math.min(h,ii(g,v,R,k,o))}}return h}function Iu(r,t){for(const a of r)for(const o of a)if(Oo(o,t,!0))return!0;return!1}function Ph(r,t,a,o=1/0){const h=kc(r),_=kc(t);if(o!==1/0&&Du(h,_,a)>=o)return o;if(ws(h,_)){if(Iu(r,t))return 0}else if(Iu(t,r))return 0;let g=1/0;for(const v of r)for(let w=0,M=v.length,C=M-1;w<M;C=w++){const A=v[C],R=v[w];for(const k of t)for(let O=0,U=k.length,q=U-1;O<U;q=O++){const Q=k[q],oe=k[O];if(Dl(A,R,Q,oe))return 0;g=Math.min(g,ii(A,R,Q,oe,a))}}return g}function Ru(r,t,a,o,h,_){if(!_)return;const g=Du(Ll(o,_),h,a);g<t&&r.push([g,_,[0,0]])}function Uo(r,t,a,o,h,_,g){if(!_||!g)return;const v=Du(Ll(o,_),Ll(h,g),a);v<t&&r.push([v,_,g])}function Lc(r,t,a,o,h=1/0){let _=Math.min(o.distance(r[0],a[0][0]),h);if(_===0)return _;const g=new eo([[0,[0,r.length-1],[0,0]]],Ic),v=kc(a);for(;g.length>0;){const w=g.pop();if(w[0]>=_)continue;const M=w[1],C=t?50:100;if(No(M)<=C){if(!yr(M,r.length))return NaN;if(t){const A=zh(r,M,a,o);if(isNaN(A)||A===0)return A;_=Math.min(_,A)}else for(let A=M[0];A<=M[1];++A){const R=Bl(r[A],a,o);if(_=Math.min(_,R),_===0)return 0}}else{const A=Rc(M,t);Ru(g,_,o,r,v,A[0]),Ru(g,_,o,r,v,A[1])}}return _}function Bc(r,t,a,o,h,_=1/0){let g=Math.min(_,h.distance(r[0],a[0]));if(g===0)return g;const v=new eo([[0,[0,r.length-1],[0,a.length-1]]],Ic);for(;v.length>0;){const w=v.pop();if(w[0]>=g)continue;const M=w[1],C=w[2],A=t?50:100,R=o?50:100;if(No(M)<=A&&No(C)<=R){if(!yr(M,r.length)&&yr(C,a.length))return NaN;let k;if(t&&o)k=gd(r,M,a,C,h),g=Math.min(g,k);else if(t&&!o){const O=r.slice(M[0],M[1]+1);for(let U=C[0];U<=C[1];++U)if(k=no(a[U],O,h),g=Math.min(g,k),g===0)return g}else if(!t&&o){const O=a.slice(C[0],C[1]+1);for(let U=M[0];U<=M[1];++U)if(k=no(r[U],O,h),g=Math.min(g,k),g===0)return g}else k=ja(r,M,a,C,h),g=Math.min(g,k)}else{const k=Rc(M,t),O=Rc(C,o);Uo(v,g,h,r,a,k[0],O[0]),Uo(v,g,h,r,a,k[0],O[1]),Uo(v,g,h,r,a,k[1],O[0]),Uo(v,g,h,r,a,k[1],O[1])}}return g}function Ss(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class as{constructor(t,a){this.type=ke,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ba(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new as(o,o.features.map(h=>Ss(h.geometry)).flat());if(o.type==="Feature")return new as(o,Ss(o.geometry));if("type"in o&&"coordinates"in o)return new as(o,Ss(o))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,o){const h=a.geometry(),_=h.flat().map(w=>Cu([w.x,w.y],a.canonical));if(h.length===0)return NaN;const g=new kl(_[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,Bc(_,!1,[w.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Bc(_,!1,w.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Lc(_,!1,w.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,o){const h=a.geometry(),_=h.flat().map(w=>Cu([w.x,w.y],a.canonical));if(h.length===0)return NaN;const g=new kl(_[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,Bc(_,!0,[w.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Bc(_,!0,w.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Lc(_,!0,w.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(a,o){const h=a.geometry();if(h.length===0||h[0].length===0)return NaN;const _=Il(h,0).map(w=>w.map(M=>M.map(C=>Cu([C.x,C.y],a.canonical)))),g=new kl(_[0][0][0][1]);let v=1/0;for(const w of o)for(const M of _){switch(w.type){case"Point":v=Math.min(v,Lc([w.coordinates],!1,M,g,v));break;case"LineString":v=Math.min(v,Lc(w.coordinates,!0,M,g,v));break;case"Polygon":v=Math.min(v,Ph(M,w.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const jr={"==":pd,"!=":Mc,">":xh,"<":Mu,">=":Cc,"<=":Ec,array:ba,at:Gt,boolean:ba,case:Xn,coalesce:ln,collator:wa,format:ns,image:Eu,in:bs,"index-of":fa,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:zl,let:Dt,literal:$n,match:Lo,number:ba,"number-format":Ac,object:ba,slice:gr,step:Or,string:ba,"to-boolean":da,"to-color":da,"to-number":da,"to-string":da,var:es,within:Ts,distance:as};class Ta{constructor(t,a,o,h){this.name=t,this.type=a,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const o=t[0],h=Ta.definitions[o];if(!h)return a.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let w=null;for(const[M,C]of v){w=new Lt(a.registry,Ol,a.path,null,a.scope);const A=[];let R=!1;for(let k=1;k<t.length;k++){const O=t[k],U=Array.isArray(M)?M[k-1]:M.type,q=w.parse(O,1+A.length,U);if(!q){R=!0;break}A.push(q)}if(!R)if(Array.isArray(M)&&M.length!==A.length)w.error(`Expected ${M.length} arguments, but found ${A.length} instead.`);else{for(let k=0;k<A.length;k++){const O=Array.isArray(M)?M[k]:M.type,U=A[k];w.concat(k+1).checkSubtype(O,U.type)}if(w.errors.length===0)return new Ta(o,_,C,A)}}if(v.length===1)a.errors.push(...w.errors);else{const M=(v.length?v:g).map(([A])=>{return R=A,Array.isArray(R)?`(${R.map(ci).join(", ")})`:`(${ci(R.type)}...)`;var R}).join(" | "),C=[];for(let A=1;A<t.length;A++){const R=a.parse(t[A],1+C.length);if(!R)return null;C.push(ci(R.type))}a.error(`Expected arguments of type ${M}, but found (${C.join(", ")}) instead.`)}return null}static register(t,a){Ta.definitions=a;for(const o in a)t[o]=Ta}}function ku(r,[t,a,o,h]){t=t.evaluate(r),a=a.evaluate(r),o=o.evaluate(r);const _=h?h.evaluate(r):1,g=Ws(t,a,o,_);if(g)throw new Bi(g);return new Zt(t/255,a/255,o/255,_,!1)}function Ms(r,t){return r in t}function Es(r,t){const a=t[r];return a===void 0?null:a}function rs(r){return{type:r}}function Ol(r){if(r instanceof es)return Ol(r.boundExpression);if(r instanceof Ta&&r.name==="error"||r instanceof wa||r instanceof Ts||r instanceof as)return!1;const t=r instanceof da||r instanceof ba;let a=!0;return r.eachChild(o=>{a=t?a&&Ol(o):a&&o instanceof $n}),!!a&&Nr(r)&&Fl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Nr(r){if(r instanceof Ta&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ts||r instanceof as)return!1;let t=!0;return r.eachChild(a=>{t&&!Nr(a)&&(t=!1)}),t}function Vo(r){if(r instanceof Ta&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(a=>{t&&!Vo(a)&&(t=!1)}),t}function Fl(r,t){if(r instanceof Ta&&t.indexOf(r.name)>=0)return!1;let a=!0;return r.eachChild(o=>{a&&!Fl(o,t)&&(a=!1)}),a}function Lu(r){return{result:"success",value:r}}function Zo(r){return{result:"error",value:r}}function Go(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Dh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Oc(r){return!!r.expression&&r.expression.interpolated}function Qt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function jl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function vr(r){return r}function Na(r,t){const a=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",h=o||!(o||r.property!==void 0),_=r.type||(Oc(t)?"exponential":"interval");if(a||t.type==="padding"){const C=a?Zt.parse:Bn.parse;(r=Qe({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],C(A[1])])),r.default=C(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let v,w,M;if(_==="exponential")v=Nl;else if(_==="interval")v=Fc;else if(_==="categorical"){v=Bu,w=Object.create(null);for(const C of r.stops)w[C[0]]=C[1];M=typeof r.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);v=jc}if(o){const C={},A=[];for(let O=0;O<r.stops.length;O++){const U=r.stops[O],q=U[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:r.type,property:r.property,default:r.default,stops:[]},A.push(q)),C[q].stops.push([U[0].value,U[1]])}const R=[];for(const O of A)R.push([C[O].zoom,Na(C[O],t)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Yn.interpolationFactor.bind(void 0,k),zoomStops:R.map(O=>O[0]),evaluate:({zoom:O},U)=>Nl({stops:R,base:r.base},t,O).evaluate(O,U)}}if(h){const C=_==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Yn.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>v(r,t,A,w,M)}}return{kind:"source",evaluate(C,A){const R=A&&A.properties?A.properties[r.property]:void 0;return R===void 0?Wa(r.default,t.default):v(r,t,R,w,M)}}}function Wa(r,t,a){return r!==void 0?r:t!==void 0?t:a!==void 0?a:void 0}function Bu(r,t,a,o,h){return Wa(typeof a===h?o[a]:void 0,r.default,t.default)}function Fc(r,t,a){if(Qt(a)!=="number")return Wa(r.default,t.default);const o=r.stops.length;if(o===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[o-1][0])return r.stops[o-1][1];const h=ts(r.stops.map(_=>_[0]),a);return r.stops[h][1]}function Nl(r,t,a){const o=r.base!==void 0?r.base:1;if(Qt(a)!=="number")return Wa(r.default,t.default);const h=r.stops.length;if(h===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[h-1][0])return r.stops[h-1][1];const _=ts(r.stops.map(C=>C[0]),a),g=function(C,A,R,k){const O=k-R,U=C-R;return O===0?0:A===1?U/O:(Math.pow(A,U)-1)/(Math.pow(A,O)-1)}(a,o,r.stops[_][0],r.stops[_+1][0]),v=r.stops[_][1],w=r.stops[_+1][1],M=Fa[t.type]||vr;return typeof v.evaluate=="function"?{evaluate(...C){const A=v.evaluate.apply(void 0,C),R=w.evaluate.apply(void 0,C);if(A!==void 0&&R!==void 0)return M(A,R,g,r.colorSpace)}}:M(v,w,g,r.colorSpace)}function jc(r,t,a){switch(t.type){case"color":a=Zt.parse(a);break;case"formatted":a=Ji.fromString(a.toString());break;case"resolvedImage":a=ha.fromString(a.toString());break;case"padding":a=Bn.parse(a);break;default:Qt(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return Wa(a,r.default,t.default)}Ta.register(jr,{error:[{kind:"error"},[it],(r,[t])=>{throw new Bi(t.evaluate(r))}],typeof:[it,[et],(r,[t])=>ci(en(t.evaluate(r)))],"to-rgba":[Ln(ke,4),[Bt],(r,[t])=>{const[a,o,h,_]=t.evaluate(r).rgb;return[255*a,255*o,255*h,_]}],rgb:[Bt,[ke,ke,ke],ku],rgba:[Bt,[ke,ke,ke,ke],ku],has:{type:Je,overloads:[[[it],(r,[t])=>Ms(t.evaluate(r),r.properties())],[[it,xt],(r,[t,a])=>Ms(t.evaluate(r),a.evaluate(r))]]},get:{type:et,overloads:[[[it],(r,[t])=>Es(t.evaluate(r),r.properties())],[[it,xt],(r,[t,a])=>Es(t.evaluate(r),a.evaluate(r))]]},"feature-state":[et,[it],(r,[t])=>Es(t.evaluate(r),r.featureState||{})],properties:[xt,[],r=>r.properties()],"geometry-type":[it,[],r=>r.geometryType()],id:[et,[],r=>r.id()],zoom:[ke,[],r=>r.globals.zoom],"heatmap-density":[ke,[],r=>r.globals.heatmapDensity||0],"line-progress":[ke,[],r=>r.globals.lineProgress||0],accumulated:[et,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ke,rs(ke),(r,t)=>{let a=0;for(const o of t)a+=o.evaluate(r);return a}],"*":[ke,rs(ke),(r,t)=>{let a=1;for(const o of t)a*=o.evaluate(r);return a}],"-":{type:ke,overloads:[[[ke,ke],(r,[t,a])=>t.evaluate(r)-a.evaluate(r)],[[ke],(r,[t])=>-t.evaluate(r)]]},"/":[ke,[ke,ke],(r,[t,a])=>t.evaluate(r)/a.evaluate(r)],"%":[ke,[ke,ke],(r,[t,a])=>t.evaluate(r)%a.evaluate(r)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(r,[t,a])=>Math.pow(t.evaluate(r),a.evaluate(r))],sqrt:[ke,[ke],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[ke,[ke],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[ke,[ke],(r,[t])=>Math.log(t.evaluate(r))],log2:[ke,[ke],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[ke,[ke],(r,[t])=>Math.sin(t.evaluate(r))],cos:[ke,[ke],(r,[t])=>Math.cos(t.evaluate(r))],tan:[ke,[ke],(r,[t])=>Math.tan(t.evaluate(r))],asin:[ke,[ke],(r,[t])=>Math.asin(t.evaluate(r))],acos:[ke,[ke],(r,[t])=>Math.acos(t.evaluate(r))],atan:[ke,[ke],(r,[t])=>Math.atan(t.evaluate(r))],min:[ke,rs(ke),(r,t)=>Math.min(...t.map(a=>a.evaluate(r)))],max:[ke,rs(ke),(r,t)=>Math.max(...t.map(a=>a.evaluate(r)))],abs:[ke,[ke],(r,[t])=>Math.abs(t.evaluate(r))],round:[ke,[ke],(r,[t])=>{const a=t.evaluate(r);return a<0?-Math.round(-a):Math.round(a)}],floor:[ke,[ke],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[ke,[ke],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Je,[it,et],(r,[t,a])=>r.properties()[t.value]===a.value],"filter-id-==":[Je,[et],(r,[t])=>r.id()===t.value],"filter-type-==":[Je,[it],(r,[t])=>r.geometryType()===t.value],"filter-<":[Je,[it,et],(r,[t,a])=>{const o=r.properties()[t.value],h=a.value;return typeof o==typeof h&&o<h}],"filter-id-<":[Je,[et],(r,[t])=>{const a=r.id(),o=t.value;return typeof a==typeof o&&a<o}],"filter->":[Je,[it,et],(r,[t,a])=>{const o=r.properties()[t.value],h=a.value;return typeof o==typeof h&&o>h}],"filter-id->":[Je,[et],(r,[t])=>{const a=r.id(),o=t.value;return typeof a==typeof o&&a>o}],"filter-<=":[Je,[it,et],(r,[t,a])=>{const o=r.properties()[t.value],h=a.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[Je,[et],(r,[t])=>{const a=r.id(),o=t.value;return typeof a==typeof o&&a<=o}],"filter->=":[Je,[it,et],(r,[t,a])=>{const o=r.properties()[t.value],h=a.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[Je,[et],(r,[t])=>{const a=r.id(),o=t.value;return typeof a==typeof o&&a>=o}],"filter-has":[Je,[et],(r,[t])=>t.value in r.properties()],"filter-has-id":[Je,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Je,[Ln(it)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Je,[Ln(et)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Je,[it,Ln(et)],(r,[t,a])=>a.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Je,[it,Ln(et)],(r,[t,a])=>function(o,h,_,g){for(;_<=g;){const v=_+g>>1;if(h[v]===o)return!0;h[v]>o?g=v-1:_=v+1}return!1}(r.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Je,overloads:[[[Je,Je],(r,[t,a])=>t.evaluate(r)&&a.evaluate(r)],[rs(Je),(r,t)=>{for(const a of t)if(!a.evaluate(r))return!1;return!0}]]},any:{type:Je,overloads:[[[Je,Je],(r,[t,a])=>t.evaluate(r)||a.evaluate(r)],[rs(Je),(r,t)=>{for(const a of t)if(a.evaluate(r))return!0;return!1}]]},"!":[Je,[Je],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Je,[it],(r,[t])=>{const a=r.globals&&r.globals.isSupportedScript;return!a||a(t.evaluate(r))}],upcase:[it,[it],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[it,[it],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[it,rs(et),(r,t)=>t.map(a=>Oa(a.evaluate(r))).join("")],"resolved-locale":[it,[Ka],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ur{constructor(t,a){var o;this.expression=t,this._warningHistory={},this._evaluator=new xs,this._defaultValue=a?(o=a).type==="color"&&jl(o.default)?new Zt(0,0,0,0):o.type==="color"?Zt.parse(o.default)||null:o.type==="padding"?Bn.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?yn.parse(o.default)||null:o.type==="projectionDefinition"?xa.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(t,a,o,h,_,g){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,a,o,h,_,g){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Ul(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in jr}function Vr(r,t){const a=new Lt(jr,Ol,[],t?function(h){const _={color:Bt,string:it,number:ke,enum:it,boolean:Je,formatted:Wi,padding:Cn,projectionDefinition:_t,resolvedImage:Mi,variableAnchorOffsetCollection:El};return h.type==="array"?Ln(_[h.value]||et,h.length):_[h.type]}(t):void 0),o=a.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Lu(new Ur(o,t)):Zo(a.errors)}class ss{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Vo(a.expression)}evaluateWithoutErrorHandling(t,a,o,h,_,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,o,h,_,g)}evaluate(t,a,o,h,_,g){return this._styleExpression.evaluate(t,a,o,h,_,g)}}class Nc{constructor(t,a,o,h){this.kind=t,this.zoomStops=o,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Vo(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,a,o,h,_,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,o,h,_,g)}evaluate(t,a,o,h,_,g){return this._styleExpression.evaluate(t,a,o,h,_,g)}interpolationFactor(t,a,o){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,t,a,o):0}}function Ua(r,t){const a=Vr(r,t);if(a.result==="error")return a;const o=a.value.expression,h=Nr(o);if(!h&&!Go(t))return Zo([new lt("","data expressions not supported")]);const _=Fl(o,["zoom"]);if(!_&&!Dh(t))return Zo([new lt("","zoom expressions not supported")]);const g=ls(o);return g||_?g instanceof lt?Zo([g]):g instanceof Yn&&!Oc(t)?Zo([new lt("",'"interpolate" expressions cannot be used with this property')]):Lu(g?new Nc(h?"camera":"composite",a.value,g.labels,g instanceof Yn?g.interpolation:void 0):new ss(h?"constant":"source",a.value)):Zo([new lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class os{constructor(t,a){this._parameters=t,this._specification=a,Qe(this,Na(this._parameters,this._specification))}static deserialize(t){return new os(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ls(r){let t=null;if(r instanceof Dt)t=ls(r.result);else if(r instanceof ln){for(const a of r.args)if(t=ls(a),t)break}else(r instanceof Or||r instanceof Yn)&&r.input instanceof Ta&&r.input.name==="zoom"&&(t=r);return t instanceof lt||r.eachChild(a=>{const o=ls(a);o instanceof lt?t=o:!t&&o?t=new lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new lt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function qo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!qo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Vl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pa(r){if(r==null)return{filter:()=>!0,needGeometry:!1};qo(r)||(r=Va(r));const t=Vr(r,Vl);if(t.result==="error")throw new Error(t.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,o,h)=>t.value.evaluate(a,o,{},h),needGeometry:Cs(r)}}function Ja(r,t){return r<t?-1:r>t?1:0}function Cs(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Cs(r[t]))return!0;return!1}function Va(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?er(r[1],r[2],"=="):t==="!="?As(er(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?er(r[1],r[2],t):t==="any"?(a=r.slice(1),["any"].concat(a.map(Va))):t==="all"?["all"].concat(r.slice(1).map(Va)):t==="none"?["all"].concat(r.slice(1).map(Va).map(As)):t==="in"?cs(r[1],r.slice(2)):t==="!in"?As(cs(r[1],r.slice(2))):t==="has"?Uc(r[1]):t!=="!has"||As(Uc(r[1]));var a}function er(r,t,a){switch(r){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,r,t]}}function cs(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Ja)]]:["filter-in-small",r,["literal",t]]}}function Uc(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function As(r){return["!",r]}function ao(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(const _ of r)h+=`${ao(_)},`;return`${h}]`}const a=Object.keys(r).sort();let o="{";for(let h=0;h<a.length;h++)o+=`${JSON.stringify(a[h])}:${ao(r[a[h]])},`;return`${o}}`}function Qn(r){let t="";for(const a of V)t+=`/${ao(r[a])}`;return t}function cn(r){const t=r.value;return t?[new _e(r.key,t,"constants have been deprecated as of v8")]:[]}function Et(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Kn(r){if(Array.isArray(r))return r.map(Kn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const a in r)t[a]=Kn(r[a]);return t}return Et(r)}function un(r){const t=r.key,a=r.value,o=r.valueSpec||{},h=r.objectElementValidators||{},_=r.style,g=r.styleSpec,v=r.validateSpec;let w=[];const M=Qt(a);if(M!=="object")return[new _e(t,a,`object expected, ${M} found`)];for(const C in a){const A=C.split(".")[0],R=o[A]||o["*"];let k;if(h[A])k=h[A];else if(o[A])k=v;else if(h["*"])k=h["*"];else{if(!o["*"]){w.push(new _e(t,a[C],`unknown property "${C}"`));continue}k=v}w=w.concat(k({key:(t&&`${t}.`)+C,value:a[C],valueSpec:R,style:_,styleSpec:g,object:a,objectKey:C,validateSpec:v},a))}for(const C in o)h[C]||o[C].required&&o[C].default===void 0&&a[C]===void 0&&w.push(new _e(t,a,`missing required property "${C}"`));return w}function Zl(r){const t=r.value,a=r.valueSpec,o=r.style,h=r.styleSpec,_=r.key,g=r.arrayElementValidator||r.validateSpec;if(Qt(t)!=="array")return[new _e(_,t,`array expected, ${Qt(t)} found`)];if(a.length&&t.length!==a.length)return[new _e(_,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new _e(_,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let v={type:a.value,values:a.values};h.$version<7&&(v.function=a.function),Qt(a.value)==="object"&&(v=a.value);let w=[];for(let M=0;M<t.length;M++)w=w.concat(g({array:t,arrayIndex:M,value:t[M],valueSpec:v,validateSpec:r.validateSpec,style:o,styleSpec:h,key:`${_}[${M}]`}));return w}function us(r){const t=r.key,a=r.value,o=r.valueSpec;let h=Qt(a);return h==="number"&&a!=a&&(h="NaN"),h!=="number"?[new _e(t,a,`number expected, ${h} found`)]:"minimum"in o&&a<o.minimum?[new _e(t,a,`${a} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&a>o.maximum?[new _e(t,a,`${a} is greater than the maximum value ${o.maximum}`)]:[]}function Ou(r){const t=r.valueSpec,a=Et(r.value.type);let o,h,_,g={};const v=a!=="categorical"&&r.value.property===void 0,w=!v,M=Qt(r.value.stops)==="array"&&Qt(r.value.stops[0])==="array"&&Qt(r.value.stops[0][0])==="object",C=un({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(k){if(a==="identity")return[new _e(k.key,k.value,'identity function may not have a "stops" property')];let O=[];const U=k.value;return O=O.concat(Zl({key:k.key,value:U,valueSpec:k.valueSpec,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:A})),Qt(U)==="array"&&U.length===0&&O.push(new _e(k.key,U,"array must have at least one stop")),O},default:function(k){return k.validateSpec({key:k.key,value:k.value,valueSpec:t,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec})}}});return a==="identity"&&v&&C.push(new _e(r.key,r.value,'missing required property "property"')),a==="identity"||r.value.stops||C.push(new _e(r.key,r.value,'missing required property "stops"')),a==="exponential"&&r.valueSpec.expression&&!Oc(r.valueSpec)&&C.push(new _e(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(w&&!Go(r.valueSpec)?C.push(new _e(r.key,r.value,"property functions not supported")):v&&!Dh(r.valueSpec)&&C.push(new _e(r.key,r.value,"zoom functions not supported"))),a!=="categorical"&&!M||r.value.property!==void 0||C.push(new _e(r.key,r.value,'"property" property is required')),C;function A(k){let O=[];const U=k.value,q=k.key;if(Qt(U)!=="array")return[new _e(q,U,`array expected, ${Qt(U)} found`)];if(U.length!==2)return[new _e(q,U,`array length 2 expected, length ${U.length} found`)];if(M){if(Qt(U[0])!=="object")return[new _e(q,U,`object expected, ${Qt(U[0])} found`)];if(U[0].zoom===void 0)return[new _e(q,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new _e(q,U,"object stop key must have value")];if(_&&_>Et(U[0].zoom))return[new _e(q,U[0].zoom,"stop zoom values must appear in ascending order")];Et(U[0].zoom)!==_&&(_=Et(U[0].zoom),h=void 0,g={}),O=O.concat(un({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:us,value:R}}))}else O=O.concat(R({key:`${q}[0]`,value:U[0],validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec},U));return Ul(Kn(U[1]))?O.concat([new _e(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):O.concat(k.validateSpec({key:`${q}[1]`,value:U[1],valueSpec:t,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec}))}function R(k,O){const U=Qt(k.value),q=Et(k.value),Q=k.value!==null?k.value:O;if(o){if(U!==o)return[new _e(k.key,Q,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new _e(k.key,Q,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&a!=="categorical"){let oe=`number expected, ${U} found`;return Go(t)&&a===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _e(k.key,Q,oe)]}return a!=="categorical"||U!=="number"||isFinite(q)&&Math.floor(q)===q?a!=="categorical"&&U==="number"&&h!==void 0&&q<h?[new _e(k.key,Q,"stop domain values must appear in ascending order")]:(h=q,a==="categorical"&&q in g?[new _e(k.key,Q,"stop domain values must be unique")]:(g[q]=!0,[])):[new _e(k.key,Q,`integer expected, found ${q}`)]}}function zs(r){const t=(r.expressionContext==="property"?Ua:Vr)(Kn(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new _e(`${r.key}${o.key}`,r.value,o.message));const a=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!a.outputDefined())return[new _e(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Vo(a))return[new _e(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Vo(a))return[new _e(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Fl(a,["zoom","feature-state"]))return[new _e(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Nr(a))return[new _e(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zr(r){const t=r.key,a=r.value,o=r.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(Et(a))===-1&&h.push(new _e(t,a,`expected one of [${o.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(o.values).indexOf(Et(a))===-1&&h.push(new _e(t,a,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function Gr(r){return qo(Kn(r.value))?zs(Qe({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ho(r)}function Ho(r){const t=r.value,a=r.key;if(Qt(t)!=="array")return[new _e(a,t,`array expected, ${Qt(t)} found`)];const o=r.styleSpec;let h,_=[];if(t.length<1)return[new _e(a,t,"filter array must have at least 1 element")];switch(_=_.concat(Zr({key:`${a}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),Et(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Et(t[1])==="$type"&&_.push(new _e(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new _e(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Qt(t[1]),h!=="string"&&_.push(new _e(`${a}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Qt(t[g]),Et(t[1])==="$type"?_=_.concat(Zr({key:`${a}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&_.push(new _e(`${a}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)_=_.concat(Ho({key:`${a}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Qt(t[1]),t.length!==2?_.push(new _e(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&_.push(new _e(`${a}[1]`,t[1],`string expected, ${h} found`))}return _}function ro(r,t){const a=r.key,o=r.validateSpec,h=r.style,_=r.styleSpec,g=r.value,v=r.objectKey,w=_[`${t}_${r.layerType}`];if(!w)return[];const M=v.match(/^(.*)-transition$/);if(t==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return o({key:a,value:g,valueSpec:_.transition,style:h,styleSpec:_});const C=r.valueSpec||w[v];if(!C)return[new _e(a,g,`unknown property "${v}"`)];let A;if(Qt(g)==="string"&&Go(C)&&!C.tokens&&(A=/^{([^}]+)}$/.exec(g)))return[new _e(a,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const R=[];return r.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&R.push(new _e(a,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&jl(Kn(g))&&Et(g.type)==="identity"&&R.push(new _e(a,g,'"text-font" does not support identity functions'))),R.concat(o({key:r.key,value:g,valueSpec:C,style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:v}))}function Vc(r){return ro(r,"paint")}function Zc(r){return ro(r,"layout")}function Gc(r){let t=[];const a=r.value,o=r.key,h=r.style,_=r.styleSpec;a.type||a.ref||t.push(new _e(o,a,'either "type" or "ref" is required'));let g=Et(a.type);const v=Et(a.ref);if(a.id){const w=Et(a.id);for(let M=0;M<r.arrayIndex;M++){const C=h.layers[M];Et(C.id)===w&&t.push(new _e(o,a.id,`duplicate layer id "${a.id}", previously used at line ${C.id.__line__}`))}}if("ref"in a){let w;["type","source","source-layer","filter","layout"].forEach(M=>{M in a&&t.push(new _e(o,a[M],`"${M}" is prohibited for ref layers`))}),h.layers.forEach(M=>{Et(M.id)===v&&(w=M)}),w?w.ref?t.push(new _e(o,a.ref,"ref cannot reference another ref layer")):g=Et(w.type):t.push(new _e(o,a.ref,`ref layer "${v}" not found`))}else if(g!=="background")if(a.source){const w=h.sources&&h.sources[a.source],M=w&&Et(w.type);w?M==="vector"&&g==="raster"?t.push(new _e(o,a.source,`layer "${a.id}" requires a raster source`)):M!=="raster-dem"&&g==="hillshade"?t.push(new _e(o,a.source,`layer "${a.id}" requires a raster-dem source`)):M==="raster"&&g!=="raster"?t.push(new _e(o,a.source,`layer "${a.id}" requires a vector source`)):M!=="vector"||a["source-layer"]?M==="raster-dem"&&g!=="hillshade"?t.push(new _e(o,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!a.paint||!a.paint["line-gradient"]||M==="geojson"&&w.lineMetrics||t.push(new _e(o,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new _e(o,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new _e(o,a.source,`source "${a.source}" not found`))}else t.push(new _e(o,a,'missing required property "source"'));return t=t.concat(un({key:o,value:a,valueSpec:_.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:a.type,valueSpec:_.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:a,objectKey:"type"}),filter:Gr,layout:w=>un({layer:a,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>Zc(Qe({layerType:g},M))}}),paint:w=>un({layer:a,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>Vc(Qe({layerType:g},M))}})}})),t}function xr(r){const t=r.value,a=r.key,o=Qt(t);return o!=="string"?[new _e(a,t,`string expected, ${o} found`)]:[]}const so={promoteId:function({key:r,value:t}){if(Qt(t)==="string")return xr({key:r,value:t});{const a=[];for(const o in t)a.push(...xr({key:`${r}.${o}`,value:t[o]}));return a}}};function $o(r){const t=r.value,a=r.key,o=r.styleSpec,h=r.style,_=r.validateSpec;if(!t.type)return[new _e(a,t,'"type" is required')];const g=Et(t.type);let v;switch(g){case"vector":case"raster":return v=un({key:a,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:so,validateSpec:_}),v;case"raster-dem":return v=function(w){var M;const C=(M=w.sourceName)!==null&&M!==void 0?M:"",A=w.value,R=w.styleSpec,k=R.source_raster_dem,O=w.style;let U=[];const q=Qt(A);if(A===void 0)return U;if(q!=="object")return U.push(new _e("source_raster_dem",A,`object expected, ${q} found`)),U;const Q=Et(A.encoding)==="custom",oe=["redFactor","greenFactor","blueFactor","baseShift"],J=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const L in A)!Q&&oe.includes(L)?U.push(new _e(L,A[L],`In "${C}": "${L}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):k[L]?U=U.concat(w.validateSpec({key:L,value:A[L],valueSpec:k[L],validateSpec:w.validateSpec,style:O,styleSpec:R})):U.push(new _e(L,A[L],`unknown property "${L}"`));return U}({sourceName:a,value:t,style:r.style,styleSpec:o,validateSpec:_}),v;case"geojson":if(v=un({key:a,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:_,objectElementValidators:so}),t.cluster)for(const w in t.clusterProperties){const[M,C]=t.clusterProperties[w],A=typeof M=="string"?[M,["accumulated"],["get",w]]:M;v.push(...zs({key:`${a}.${w}.map`,value:C,expressionContext:"cluster-map"})),v.push(...zs({key:`${a}.${w}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return v;case"video":return un({key:a,value:t,valueSpec:o.source_video,style:h,validateSpec:_,styleSpec:o});case"image":return un({key:a,value:t,valueSpec:o.source_image,style:h,validateSpec:_,styleSpec:o});case"canvas":return[new _e(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zr({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fu(r){const t=r.value,a=r.styleSpec,o=a.light,h=r.style;let _=[];const g=Qt(t);if(t===void 0)return _;if(g!=="object")return _=_.concat([new _e("light",t,`object expected, ${g} found`)]),_;for(const v in t){const w=v.match(/^(.*)-transition$/);_=_.concat(w&&o[w[1]]&&o[w[1]].transition?r.validateSpec({key:v,value:t[v],valueSpec:a.transition,validateSpec:r.validateSpec,style:h,styleSpec:a}):o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:r.validateSpec,style:h,styleSpec:a}):[new _e(v,t[v],`unknown property "${v}"`)])}return _}function oo(r){const t=r.value,a=r.styleSpec,o=a.sky,h=r.style,_=Qt(t);if(t===void 0)return[];if(_!=="object")return[new _e("sky",t,`object expected, ${_} found`)];let g=[];for(const v in t)g=g.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],style:h,styleSpec:a}):[new _e(v,t[v],`unknown property "${v}"`)]);return g}function Xo(r){const t=r.value,a=r.styleSpec,o=a.terrain,h=r.style;let _=[];const g=Qt(t);if(t===void 0)return _;if(g!=="object")return _=_.concat([new _e("terrain",t,`object expected, ${g} found`)]),_;for(const v in t)_=_.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:r.validateSpec,style:h,styleSpec:a}):[new _e(v,t[v],`unknown property "${v}"`)]);return _}function Gl(r){let t=[];const a=r.value,o=r.key;if(Array.isArray(a)){const h=[],_=[];for(const g in a)a[g].id&&h.includes(a[g].id)&&t.push(new _e(o,a,`all the sprites' ids must be unique, but ${a[g].id} is duplicated`)),h.push(a[g].id),a[g].url&&_.includes(a[g].url)&&t.push(new _e(o,a,`all the sprites' URLs must be unique, but ${a[g].url} is duplicated`)),_.push(a[g].url),t=t.concat(un({key:`${o}[${g}]`,value:a[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return xr({key:o,value:a})}const Yo={"*":()=>[],array:Zl,boolean:function(r){const t=r.value,a=r.key,o=Qt(t);return o!=="boolean"?[new _e(a,t,`boolean expected, ${o} found`)]:[]},number:us,color:function(r){const t=r.key,a=r.value,o=Qt(a);return o!=="string"?[new _e(t,a,`color expected, ${o} found`)]:Zt.parse(String(a))?[]:[new _e(t,a,`color expected, "${a}" found`)]},constants:cn,enum:Zr,filter:Gr,function:Ou,layer:Gc,object:un,source:$o,light:Fu,sky:oo,terrain:Xo,projection:function(r){const t=r.value,a=r.styleSpec,o=a.projection,h=r.style,_=Qt(t);if(t===void 0)return[];if(_!=="object")return[new _e("projection",t,`object expected, ${_} found`)];let g=[];for(const v in t)g=g.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],style:h,styleSpec:a}):[new _e(v,t[v],`unknown property "${v}"`)]);return g},projectionDefinition:function(r){const t=r.key;let a=r.value;a=a instanceof String?a.valueOf():a;const o=Qt(a);return o!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(a)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(a)?["array","string"].includes(o)?[]:[new _e(t,a,`projection expected, invalid type "${o}" found`)]:[new _e(t,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:xr,formatted:function(r){return xr(r).length===0?[]:zs(r)},resolvedImage:function(r){return xr(r).length===0?[]:zs(r)},padding:function(r){const t=r.key,a=r.value;if(Qt(a)==="array"){if(a.length<1||a.length>4)return[new _e(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const o={type:"number"};let h=[];for(let _=0;_<a.length;_++)h=h.concat(r.validateSpec({key:`${t}[${_}]`,value:a[_],validateSpec:r.validateSpec,valueSpec:o}));return h}return us({key:t,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,a=r.value,o=Qt(a),h=r.styleSpec;if(o!=="array"||a.length<1||a.length%2!=0)return[new _e(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let g=0;g<a.length;g+=2)_=_.concat(Zr({key:`${t}[${g}]`,value:a[g],valueSpec:h.layout_symbol["text-anchor"]})),_=_.concat(Zl({key:`${t}[${g+1}]`,value:a[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return _},sprite:Gl};function br(r){const t=r.value,a=r.valueSpec,o=r.styleSpec;return r.validateSpec=br,a.expression&&jl(Et(t))?Ou(r):a.expression&&Ul(Kn(t))?zs(r):a.type&&Yo[a.type]?Yo[a.type](r):un(Qe({},r,{valueSpec:a.type?o[a.type]:a}))}function lo(r){const t=r.value,a=r.key,o=xr(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new _e(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new _e(a,t,'"glyphs" url must include a "{range}" token'))),o}function Oi(r,t=P){let a=[];return a=a.concat(br({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:br,objectElementValidators:{glyphs:lo,"*":()=>[]}})),r.constants&&(a=a.concat(cn({key:"constants",value:r.constants}))),qc(a)}function vn(r){return function(t){return r({...t,validateSpec:br})}}function qc(r){return[].concat(r).sort((t,a)=>t.line-a.line)}function ma(r){return function(...t){return qc(r.apply(this,t))}}Oi.source=ma(vn($o)),Oi.sprite=ma(vn(Gl)),Oi.glyphs=ma(vn(lo)),Oi.light=ma(vn(Fu)),Oi.sky=ma(vn(oo)),Oi.terrain=ma(vn(Xo)),Oi.layer=ma(vn(Gc)),Oi.filter=ma(vn(Gr)),Oi.paintProperty=ma(vn(Vc)),Oi.layoutProperty=ma(vn(Zc));const hs=Oi,Qo=hs.light,Hc=hs.sky,ql=hs.paintProperty,tr=hs.layoutProperty;function Za(r,t){let a=!1;if(t&&t.length)for(const o of t)r.fire(new on(new Error(o.message))),a=!0;return a}class ir{constructor(t,a,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(a=g[1])+2*(o=g[2]);for(let w=0;w<this.d*this.d;w++){const M=g[3+w],C=g[3+w+1];h.push(M===C?null:g.subarray(M,C))}const v=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=a+2*o;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=o,this.scale=a/t,this.uid=0;const _=o/a*t;this.min=-_,this.max=t+_}insert(t,a,o,h,_){this._forEachCell(a,o,h,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,o,h,_,g){this.cells[_].push(g)}query(t,a,o,h,_){const g=this.min,v=this.max;if(t<=g&&a<=g&&v<=o&&v<=h&&!_)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,a,o,h,this._queryCell,w,{},_),w}}_queryCell(t,a,o,h,_,g,v,w){const M=this.cells[_];if(M!==null){const C=this.keys,A=this.bboxes;for(let R=0;R<M.length;R++){const k=M[R];if(v[k]===void 0){const O=4*k;(w?w(A[O+0],A[O+1],A[O+2],A[O+3]):t<=A[O+2]&&a<=A[O+3]&&o>=A[O+0]&&h>=A[O+1])?(v[k]=!0,g.push(C[k])):v[k]=!1}}}}_forEachCell(t,a,o,h,_,g,v,w){const M=this._convertToCellCoord(t),C=this._convertToCellCoord(a),A=this._convertToCellCoord(o),R=this._convertToCellCoord(h);for(let k=M;k<=A;k++)for(let O=C;O<=R;O++){const U=this.d*O+k;if((!w||w(this._convertFromCellCoord(k),this._convertFromCellCoord(O),this._convertFromCellCoord(k+1),this._convertFromCellCoord(O+1)))&&_.call(this,t,a,o,h,U,g,v,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const h=new Int32Array(a+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let _=a;for(let g=0;g<t.length;g++){const v=t[g];h[3+g]=_,h.set(v,_),_+=v.length}return h[3+t.length]=_,h.set(this.keys,_),_+=this.keys.length,h[3+t.length+1]=_,h.set(this.bboxes,_),_+=this.bboxes.length,h.buffer}static serialize(t,a){const o=t.toArrayBuffer();return a&&a.push(o),{buffer:o}}static deserialize(t){return new ir(t.buffer)}}const Sa={};function Ke(r,t,a={}){if(Sa[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Sa[r]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}Ke("Object",Object),Ke("TransferableGridIndex",ir),Ke("Color",Zt),Ke("Error",Error),Ke("AJAXError",Rr),Ke("ResolvedImage",ha),Ke("StylePropertyFunction",os),Ke("StyleExpression",Ur,{omit:["_evaluator"]}),Ke("ZoomDependentExpression",Nc),Ke("ZoomConstantExpression",ss),Ke("CompoundExpression",Ta,{omit:["_evaluate"]});for(const r in jr)jr[r]._classRegistryKey||Ke(`Expression_${r}`,jr[r]);function Ma(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function hn(r){return r.$name||r.constructor._classRegistryKey}function Hl(r){return!function(t){if(t===null||typeof t!="object")return!1;const a=hn(t);return!(!a||a==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Ma(r)||Dr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Ps(r,t){if(Hl(r))return(Ma(r)||Dr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const _=[];for(const g of r)_.push(Ps(g,t));return _}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const a=hn(r);if(!a)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Sa[a])throw new Error(`${a} is not registered.`);const{klass:o}=Sa[a],h=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in r){if(!r.hasOwnProperty(_)||Sa[a].omit.indexOf(_)>=0)continue;const g=r[_];h[_]=Sa[a].shallow.indexOf(_)>=0?g:Ps(g,t)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}function $l(r){if(Hl(r))return r;if(Array.isArray(r))return r.map($l);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=hn(r)||"Object";if(!Sa[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=Sa[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(r);const o=Object.create(a.prototype);for(const h of Object.keys(r)){if(h==="$name")continue;const _=r[h];o[h]=Sa[t].shallow.indexOf(h)>=0?_:$l(_)}return o}class $c{constructor(){this.first=!0}update(t,a){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const yt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Hangul Syllables":r=>r>=44032&&r<=55215,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Ko(r){for(const t of r)if(ju(t.charCodeAt(0)))return!0;return!1}function Wo(r){for(const t of r)if(!Is(t.charCodeAt(0)))return!1;return!0}function Ds(r){const t=r.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(t.join("|"),"u")}const Xc=Ds(["Arab","Dupl","Mong","Ougr","Syrc"]);function Is(r){return!Xc.test(String.fromCodePoint(r))}const Rs=Ds(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ju(r){return!(r!==746&&r!==747&&(r<4352||!(yt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||yt["CJK Compatibility"](r)||yt["CJK Strokes"](r)||!(!yt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||yt["Enclosed CJK Letters and Months"](r)||yt["Ideographic Description Characters"](r)||yt.Kanbun(r)||yt.Katakana(r)&&r!==12540||!(!yt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!yt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||yt["Vertical Forms"](r)||yt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Rs.test(String.fromCodePoint(r)))))}function Yc(r){return!(ju(r)||function(t){return!!(yt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||yt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||yt["Letterlike Symbols"](t)||yt["Number Forms"](t)||yt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||yt["Control Pictures"](t)&&t!==9251||yt["Optical Character Recognition"](t)||yt["Enclosed Alphanumerics"](t)||yt["Geometric Shapes"](t)||yt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||yt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||yt["CJK Symbols and Punctuation"](t)||yt.Katakana(t)||yt["Private Use Area"](t)||yt["CJK Compatibility Forms"](t)||yt["Small Form Variants"](t)||yt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const yd=Ds(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Qc(r){return yd.test(String.fromCodePoint(r))}function ks(r,t){return!(!t&&Qc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||yt.Khmer(r))}function Kc(r){for(const t of r)if(Qc(t.charCodeAt(0)))return!0;return!1}const wr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(wr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return d(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const a=r.pluginURL,o=new Promise(_=>{this.loadScriptResolve=_});t(a);const h=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([o,h]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:a};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)})}};class Ei{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $c,this.transition={})}isSupportedScript(t){return function(a,o){for(const h of a)if(!ks(h.charCodeAt(0),o))return!1;return!0}(t,wr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*a}}}class nr{constructor(t,a){this.property=t,this.value=a,this.expression=function(o,h){if(jl(o))return new os(o,h);if(Ul(o)){const _=Ua(o,h);if(_.result==="error")throw new Error(_.value.map(g=>`${g.key}: ${g.message}`).join(", "));return _.value}{let _=o;return h.type==="color"&&typeof o=="string"?_=Zt.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?_=yn.parse(o):h.type==="projectionDefinition"&&typeof o=="string"&&(_=xa.parse(o)):_=Bn.parse(o),{kind:"constant",evaluate:()=>_}}}(a===void 0?t.specification.default:a,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,o){return this.property.possiblyEvaluate(this,t,a,o)}}class jt{constructor(t){this.property=t,this.value=new nr(t,void 0)}transitioned(t,a){return new tn(this.property,this.value,a,Ct({},t.transition,this.transition),t.now)}untransitioned(){return new tn(this.property,this.value,null,{},0)}}class ui{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return oi(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new jt(this._values[t].property)),this._values[t].value=new nr(this._values[t].property,a===null?void 0:oi(a))}getTransition(t){return oi(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new jt(this._values[t].property)),this._values[t].transition=oi(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const o=this.getValue(a);o!==void 0&&(t[a]=o);const h=this.getTransition(a);h!==void 0&&(t[`${a}-transition`]=h)}return t}transitioned(t,a){const o=new Ls(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,a._values[h]);return o}untransitioned(){const t=new Ls(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class tn{constructor(t,a,o,h,_){this.property=t,this.value=a,this.begin=_+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,a,o){const h=t.now||0,_=this.value.possiblyEvaluate(t,a,o),g=this.prior;if(g){if(h>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(h<this.begin)return g.possiblyEvaluate(t,a,o);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,a,o),_,ue(v))}}return _}}class Ls{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,o){const h=new co(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(t,a,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return oi(this._values[t].value)}setValue(t,a){this._values[t]=new nr(this._values[t].property,a===null?void 0:oi(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const o=this.getValue(a);o!==void 0&&(t[a]=o)}return t}possiblyEvaluate(t,a,o){const h=new co(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(t,a,o);return h}}class On{constructor(t,a,o){this.property=t,this.value=a,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,o,h){return this.property.evaluate(this.value,this.parameters,t,a,o,h)}}class co{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ct{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,o){const h=Fa[this.specification.type];return h?h(t,a,o):t}}class ft{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,o,h){return new On(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},o,h)}:t.expression,a)}interpolate(t,a,o){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new On(this,{kind:"constant",value:void 0},t.parameters);const h=Fa[this.specification.type];if(h){const _=h(t.value.value,a.value.value,o);return new On(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,a,o,h,_,g){return t.kind==="constant"?t.value:t.evaluate(a,o,h,_,g)}}class Xl extends ft{possiblyEvaluate(t,a,o,h){if(t.value===void 0)return new On(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const _=t.expression.evaluate(a,null,{},o,h),g=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,v=this._calculate(g,g,g,a);return new On(this,{kind:"constant",value:v},a)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new On(this,{kind:"constant",value:_},a)}return new On(this,t.expression,a)}evaluate(t,a,o,h,_,g){if(t.kind==="source"){const v=t.evaluate(a,o,h,_,g);return this._calculate(v,v,v,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},o,h),t.evaluate({zoom:Math.floor(a.zoom)},o,h),t.evaluate({zoom:Math.floor(a.zoom)+1},o,h),a):t.value}_calculate(t,a,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:o,to:a}}interpolate(t){return t}}class Fi{constructor(t){this.specification=t}possiblyEvaluate(t,a,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(a,null,{},o,h);return this._calculate(_,_,_,a)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Ei(Math.floor(a.zoom),a)),t.expression.evaluate(new Ei(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:o,to:a}}interpolate(t){return t}}class Yl{constructor(t){this.specification=t}possiblyEvaluate(t,a,o,h){return!!t.expression.evaluate(a,null,{},o,h)}interpolate(){return!1}}class na{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const o=t[a];o.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new nr(o,void 0),_=this.defaultTransitionablePropertyValues[a]=new jt(o);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}}}Ke("DataDrivenProperty",ft),Ke("DataConstantProperty",ct),Ke("CrossFadedDataDrivenProperty",Xl),Ke("CrossFadedProperty",Fi),Ke("ColorRampProperty",Yl);const Nu="-transition";class Tr extends pe{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new Jo(a.layout)),a.paint)){this._transitionablePaint=new ui(a.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new co(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,o={}){a!=null&&this._validate(tr,`layers.${this.id}.layout.${t}`,t,a,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(Nu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,o={}){if(a!=null&&this._validate(ql,`layers.${this.id}.paint.${t}`,t,a,o))return!1;if(t.endsWith(Nu))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const h=this._transitionablePaint._values[t],_=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||g||_||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Yt(t,(a,o)=>!(a===void 0||o==="layout"&&!Object.keys(a).length||o==="paint"&&!Object.keys(a).length))}_validate(t,a,o,h,_={}){return(!_||_.validate!==!1)&&Za(this,t.call(hs,{key:a,layerType:this.type,objectKey:o,value:h,styleSpec:P,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof On&&Go(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const vd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ar{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(r,t=1){let a=0,o=0;return{members:r.map(h=>{const _=vd[h.type].BYTES_PER_ELEMENT,g=a=_a(a,Math.max(t,_)),v=h.components||1;return o=Math.max(o,_),a+=_*v,{name:h.name,type:h.type,components:v,offset:g}}),size:_a(a,Math.max(o,t)),alignment:t}}function _a(r,t){return Math.ceil(r/t)*t}class zi extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,a)}emplace(t,a,o){const h=2*t;return this.int16[h+0]=a,this.int16[h+1]=o,t}}zi.prototype.bytesPerElement=4,Ke("StructArrayLayout2i4",zi);class uo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,a,o)}emplace(t,a,o,h){const _=3*t;return this.int16[_+0]=a,this.int16[_+1]=o,this.int16[_+2]=h,t}}uo.prototype.bytesPerElement=6,Ke("StructArrayLayout3i6",uo);class ho extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,o,h)}emplace(t,a,o,h,_){const g=4*t;return this.int16[g+0]=a,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=_,t}}ho.prototype.bytesPerElement=8,Ke("StructArrayLayout4i8",ho);class rr extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,o,h,_,g)}emplace(t,a,o,h,_,g,v){const w=6*t;return this.int16[w+0]=a,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=_,this.int16[w+4]=g,this.int16[w+5]=v,t}}rr.prototype.bytesPerElement=12,Ke("StructArrayLayout2i4i12",rr);class el extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,o,h,_,g)}emplace(t,a,o,h,_,g,v){const w=4*t,M=8*t;return this.int16[w+0]=a,this.int16[w+1]=o,this.uint8[M+4]=h,this.uint8[M+5]=_,this.uint8[M+6]=g,this.uint8[M+7]=v,t}}el.prototype.bytesPerElement=8,Ke("StructArrayLayout2i4ub8",el);class ga extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,a)}emplace(t,a,o){const h=2*t;return this.float32[h+0]=a,this.float32[h+1]=o,t}}ga.prototype.bytesPerElement=8,Ke("StructArrayLayout2f8",ga);class fo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g,v,w,M,C){const A=this.length;return this.resize(A+1),this.emplace(A,t,a,o,h,_,g,v,w,M,C)}emplace(t,a,o,h,_,g,v,w,M,C,A){const R=10*t;return this.uint16[R+0]=a,this.uint16[R+1]=o,this.uint16[R+2]=h,this.uint16[R+3]=_,this.uint16[R+4]=g,this.uint16[R+5]=v,this.uint16[R+6]=w,this.uint16[R+7]=M,this.uint16[R+8]=C,this.uint16[R+9]=A,t}}fo.prototype.bytesPerElement=20,Ke("StructArrayLayout10ui20",fo);class po extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g,v,w,M,C,A,R){const k=this.length;return this.resize(k+1),this.emplace(k,t,a,o,h,_,g,v,w,M,C,A,R)}emplace(t,a,o,h,_,g,v,w,M,C,A,R,k){const O=12*t;return this.int16[O+0]=a,this.int16[O+1]=o,this.int16[O+2]=h,this.int16[O+3]=_,this.uint16[O+4]=g,this.uint16[O+5]=v,this.uint16[O+6]=w,this.uint16[O+7]=M,this.int16[O+8]=C,this.int16[O+9]=A,this.int16[O+10]=R,this.int16[O+11]=k,t}}po.prototype.bytesPerElement=24,Ke("StructArrayLayout4i4ui4i24",po);class Ql extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,a,o)}emplace(t,a,o,h){const _=3*t;return this.float32[_+0]=a,this.float32[_+1]=o,this.float32[_+2]=h,t}}Ql.prototype.bytesPerElement=12,Ke("StructArrayLayout3f12",Ql);class mo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}mo.prototype.bytesPerElement=4,Ke("StructArrayLayout1ul4",mo);class Bs extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g,v,w,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,a,o,h,_,g,v,w,M)}emplace(t,a,o,h,_,g,v,w,M,C){const A=10*t,R=5*t;return this.int16[A+0]=a,this.int16[A+1]=o,this.int16[A+2]=h,this.int16[A+3]=_,this.int16[A+4]=g,this.int16[A+5]=v,this.uint32[R+3]=w,this.uint16[A+8]=M,this.uint16[A+9]=C,t}}Bs.prototype.bytesPerElement=20,Ke("StructArrayLayout6i1ul2ui20",Bs);class Wc extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,o,h,_,g)}emplace(t,a,o,h,_,g,v){const w=6*t;return this.int16[w+0]=a,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=_,this.int16[w+4]=g,this.int16[w+5]=v,t}}Wc.prototype.bytesPerElement=12,Ke("StructArrayLayout2i2i2i12",Wc);class Kl extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,o,h,_)}emplace(t,a,o,h,_,g){const v=4*t,w=8*t;return this.float32[v+0]=a,this.float32[v+1]=o,this.float32[v+2]=h,this.int16[w+6]=_,this.int16[w+7]=g,t}}Kl.prototype.bytesPerElement=16,Ke("StructArrayLayout2f1f2i16",Kl);class Os extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,o,h,_,g)}emplace(t,a,o,h,_,g,v){const w=16*t,M=4*t,C=8*t;return this.uint8[w+0]=a,this.uint8[w+1]=o,this.float32[M+1]=h,this.float32[M+2]=_,this.int16[C+6]=g,this.int16[C+7]=v,t}}Os.prototype.bytesPerElement=16,Ke("StructArrayLayout2ub2f2i16",Os);class Wl extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,a,o)}emplace(t,a,o,h){const _=3*t;return this.uint16[_+0]=a,this.uint16[_+1]=o,this.uint16[_+2]=h,t}}Wl.prototype.bytesPerElement=6,Ke("StructArrayLayout3ui6",Wl);class Jl extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q){const oe=this.length;return this.resize(oe+1),this.emplace(oe,t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q)}emplace(t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q,oe){const J=24*t,L=12*t,Z=48*t;return this.int16[J+0]=a,this.int16[J+1]=o,this.uint16[J+2]=h,this.uint16[J+3]=_,this.uint32[L+2]=g,this.uint32[L+3]=v,this.uint32[L+4]=w,this.uint16[J+10]=M,this.uint16[J+11]=C,this.uint16[J+12]=A,this.float32[L+7]=R,this.float32[L+8]=k,this.uint8[Z+36]=O,this.uint8[Z+37]=U,this.uint8[Z+38]=q,this.uint32[L+10]=Q,this.int16[J+22]=oe,t}}Jl.prototype.bytesPerElement=48,Ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Jl);class ec extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q,oe,J,L,Z,ee,ve,je,Se,Ae,Ze,Ue){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q,oe,J,L,Z,ee,ve,je,Se,Ae,Ze,Ue)}emplace(t,a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q,oe,J,L,Z,ee,ve,je,Se,Ae,Ze,Ue,Ge){const Re=32*t,tt=16*t;return this.int16[Re+0]=a,this.int16[Re+1]=o,this.int16[Re+2]=h,this.int16[Re+3]=_,this.int16[Re+4]=g,this.int16[Re+5]=v,this.int16[Re+6]=w,this.int16[Re+7]=M,this.uint16[Re+8]=C,this.uint16[Re+9]=A,this.uint16[Re+10]=R,this.uint16[Re+11]=k,this.uint16[Re+12]=O,this.uint16[Re+13]=U,this.uint16[Re+14]=q,this.uint16[Re+15]=Q,this.uint16[Re+16]=oe,this.uint16[Re+17]=J,this.uint16[Re+18]=L,this.uint16[Re+19]=Z,this.uint16[Re+20]=ee,this.uint16[Re+21]=ve,this.uint16[Re+22]=je,this.uint32[tt+12]=Se,this.float32[tt+13]=Ae,this.float32[tt+14]=Ze,this.uint16[Re+30]=Ue,this.uint16[Re+31]=Ge,t}}ec.prototype.bytesPerElement=64,Ke("StructArrayLayout8i15ui1ul2f2ui64",ec);class Jc extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}Jc.prototype.bytesPerElement=4,Ke("StructArrayLayout1f4",Jc);class f extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,a,o)}emplace(t,a,o,h){const _=3*t;return this.uint16[6*t+0]=a,this.float32[_+1]=o,this.float32[_+2]=h,t}}f.prototype.bytesPerElement=12,Ke("StructArrayLayout1ui2f12",f);class e extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,a,o)}emplace(t,a,o,h){const _=4*t;return this.uint32[2*t+0]=a,this.uint16[_+2]=o,this.uint16[_+3]=h,t}}e.prototype.bytesPerElement=8,Ke("StructArrayLayout1ul2ui8",e);class n extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,a)}emplace(t,a,o){const h=2*t;return this.uint16[h+0]=a,this.uint16[h+1]=o,t}}n.prototype.bytesPerElement=4,Ke("StructArrayLayout2ui4",n);class l extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}l.prototype.bytesPerElement=2,Ke("StructArrayLayout1ui2",l);class u extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,o,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,o,h)}emplace(t,a,o,h,_){const g=4*t;return this.float32[g+0]=a,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=_,t}}u.prototype.bytesPerElement=16,Ke("StructArrayLayout4f16",u);class m extends ar{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new at(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class y extends Bs{get(t){return new m(this,t)}}Ke("CollisionBoxArray",y);class b extends ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class T extends Jl{get(t){return new b(this,t)}}Ke("PlacedSymbolArray",T);class E extends ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class z extends ec{get(t){return new E(this,t)}}Ke("SymbolInstanceArray",z);class D extends Jc{getoffsetX(t){return this.float32[1*t+0]}}Ke("GlyphOffsetArray",D);class I extends uo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ke("SymbolLineVertexArray",I);class j extends ar{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class N extends f{get(t){return new j(this,t)}}Ke("TextAnchorOffsetArray",N);class X extends ar{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}X.prototype.size=8;class $ extends e{get(t){return new X(this,t)}}Ke("FeatureIndexArray",$);class Y extends zi{}class W extends zi{}class ie extends zi{}class ne extends rr{}class ae extends el{}class le extends ga{}class se extends fo{}class ye extends po{}class we extends Ql{}class De extends mo{}class Ie extends Wc{}class ze extends Os{}class Ye extends Wl{}class $e extends n{}const Fe=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:rt}=Fe;class dt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,a,o,h){const _=this.segments[this.segments.length-1];return t>dt.MAX_VERTEX_ARRAY_LENGTH&&Ci(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>dt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==h?this.createNewSegment(a,o,h):_}createNewSegment(t,a,o){const h={vertexOffset:t.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,a,o){return this.prepareSegment(0,t,a,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,o,h){return new dt([{vertexOffset:t,primitiveOffset:a,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function ni(r,t){return 256*(r=mt(Math.floor(r),0,255))+mt(Math.floor(t),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke("SegmentVector",dt);const bi=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hi,mi,gi,Kt={exports:{}},di={exports:{}},zn={exports:{}},wi=function(){if(gi)return Kt.exports;gi=1;var r=(hi||(hi=1,di.exports=function(a,o){var h,_,g,v,w,M,C,A;for(_=a.length-(h=3&a.length),g=o,w=3432918353,M=461845907,A=0;A<_;)C=255&a.charCodeAt(A)|(255&a.charCodeAt(++A))<<8|(255&a.charCodeAt(++A))<<16|(255&a.charCodeAt(++A))<<24,++A,g=27492+(65535&(v=5*(65535&(g=(g^=C=(65535&(C=(C=(65535&C)*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,h){case 3:C^=(255&a.charCodeAt(A+2))<<16;case 2:C^=(255&a.charCodeAt(A+1))<<8;case 1:g^=C=(65535&(C=(C=(65535&(C^=255&a.charCodeAt(A)))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),di.exports),t=(mi||(mi=1,zn.exports=function(a,o){for(var h,_=a.length,g=o^_,v=0;_>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),_-=4,++v;switch(_){case 3:g^=(255&a.charCodeAt(v+2))<<16;case 2:g^=(255&a.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),zn.exports);return Kt.exports=r,Kt.exports.murmur3=r,Kt.exports.murmur2=t,Kt.exports}(),Pi=ot(wi);class ji{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,o,h){this.ids.push(Ea(t)),this.positions.push(a,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=Ea(t);let o=0,h=this.ids.length-1;for(;o<h;){const g=o+h>>1;this.ids[g]>=a?h=g:o=g+1}const _=[];for(;this.ids[o]===a;)_.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return _}static serialize(t,a){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Sr(o,h,0,o.length-1),a&&a.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const a=new ji;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function Ea(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Pi(String(r))}function Sr(r,t,a,o){for(;a<o;){const h=r[a+o>>1];let _=a-1,g=o+1;for(;;){do _++;while(r[_]<h);do g--;while(r[g]>h);if(_>=g)break;sr(r,_,g),sr(t,3*_,3*g),sr(t,3*_+1,3*g+1),sr(t,3*_+2,3*g+2)}g-a<o-g?(Sr(r,t,a,g),a=g+1):(Sr(r,t,g+1,o),o=g)}}function sr(r,t,a){const o=r[t];r[t]=r[a],r[a]=o}Ke("FeaturePositionMap",ji);class Ga{constructor(t,a){this.gl=t.gl,this.location=a}}class Fs extends Ga{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Mr extends Ga{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class qr extends Ga{constructor(t,a){super(t,a),this.current=Zt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const qa=new Float32Array(16);function Er(r){return[ni(255*r.r,255*r.g),ni(255*r.b,255*r.a)]}class or{constructor(t,a,o){this.value=t,this.uniformNames=a.map(h=>`u_${h}`),this.type=o}setUniform(t,a,o){t.set(o.constantOr(this.value))}getBinding(t,a,o){return this.type==="color"?new qr(t,a):new Fs(t,a)}}class Ha{constructor(t,a){this.uniformNames=a.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setUniform(t,a,o,h){const _=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,a,o){return o.substr(0,9)==="u_pattern"?new Mr(t,a):new Fs(t,a)}}class yi{constructor(t,a,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=a.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,a,o,h,_){const g=this.paintVertexArray.length,v=this.expression.evaluate(new Ei(0),a,{},h,[],_);this.paintVertexArray.resize(t),this._setPaintValue(g,t,v)}updatePaintArray(t,a,o,h){const _=this.expression.evaluate({zoom:0},o,h);this._setPaintValue(t,a,_)}_setPaintValue(t,a,o){if(this.type==="color"){const h=Er(o);for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=t;h<a;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fi{constructor(t,a,o,h,_,g){this.expression=t,this.uniformNames=a.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=h,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=a.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,a,o,h,_){const g=this.expression.evaluate(new Ei(this.zoom),a,{},h,[],_),v=this.expression.evaluate(new Ei(this.zoom+1),a,{},h,[],_),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,g,v)}updatePaintArray(t,a,o,h){const _=this.expression.evaluate({zoom:this.zoom},o,h),g=this.expression.evaluate({zoom:this.zoom+1},o,h);this._setPaintValue(t,a,_,g)}_setPaintValue(t,a,o,h){if(this.type==="color"){const _=Er(o),g=Er(h);for(let v=t;v<a;v++)this.paintVertexArray.emplace(v,_[0],_[1],g[0],g[1])}else{for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const o=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=mt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,a,o){return new Fs(t,a)}}class xn{constructor(t,a,o,h,_,g){this.expression=t,this.type=a,this.useIntegerZoom=o,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,a,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],o)}updatePaintArray(t,a,o,h,_){this._setPaintValues(t,a,o.patterns&&o.patterns[this.layerId],_)}_setPaintValues(t,a,o,h){if(!h||!o)return;const{min:_,mid:g,max:v}=o,w=h[_],M=h[g],C=h[v];if(w&&M&&C)for(let A=t;A<a;A++)this.zoomInPaintVertexArray.emplace(A,M.tl[0],M.tl[1],M.br[0],M.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],M.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,M.tl[0],M.tl[1],M.br[0],M.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],M.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bn{constructor(t,a,o){this.binders={},this._buffers=[];const h=[];for(const _ in t.paint._values){if(!o(_))continue;const g=t.paint.get(_);if(!(g instanceof On&&Go(g.property.specification)))continue;const v=Ih(_,t.type),w=g.value,M=g.property.specification.type,C=g.property.useIntegerZoom,A=g.property.specification["property-type"],R=A==="cross-faded"||A==="cross-faded-data-driven";if(w.kind==="constant")this.binders[_]=R?new Ha(w.value,v):new or(w.value,v,M),h.push(`/u_${_}`);else if(w.kind==="source"||R){const k=Pn(_,M,"source");this.binders[_]=R?new xn(w,M,C,a,k,t.id):new yi(w,v,M,k),h.push(`/a_${_}`)}else{const k=Pn(_,M,"composite");this.binders[_]=new fi(w,v,M,C,a,k),h.push(`/z_${_}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof yi||a instanceof fi?a.maxValue:0}populatePaintArrays(t,a,o,h,_){for(const g in this.binders){const v=this.binders[g];(v instanceof yi||v instanceof fi||v instanceof xn)&&v.populatePaintArray(t,a,o,h,_)}}setConstantPatternPositions(t,a){for(const o in this.binders){const h=this.binders[o];h instanceof Ha&&h.setConstantPatternPositions(t,a)}}updatePaintArrays(t,a,o,h,_){let g=!1;for(const v in t){const w=a.getPositions(v);for(const M of w){const C=o.feature(M.index);for(const A in this.binders){const R=this.binders[A];if((R instanceof yi||R instanceof fi||R instanceof xn)&&R.expression.isStateDependent===!0){const k=h.paint.get(A);R.expression=k.value,R.updatePaintArray(M.start,M.end,C,t[v],_),g=!0}}}}return g}defines(){const t=[];for(const a in this.binders){const o=this.binders[a];(o instanceof or||o instanceof Ha)&&t.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const o=this.binders[a];if(o instanceof yi||o instanceof fi)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof xn)for(let h=0;h<bi.members.length;h++)t.push(bi.members[h].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const o=this.binders[a];if(o instanceof or||o instanceof Ha||o instanceof fi)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const o=[];for(const h in this.binders){const _=this.binders[h];if(_ instanceof or||_ instanceof Ha||_ instanceof fi){for(const g of _.uniformNames)if(a[g]){const v=_.getBinding(t,a[g],g);o.push({name:g,property:h,binding:v})}}}return o}setUniforms(t,a,o,h){for(const{name:_,property:g,binding:v}of a)this.binders[g].setUniform(v,h,o.get(g),_)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const o=this.binders[a];if(t&&o instanceof xn){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof yi||o instanceof fi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const a in this.binders){const o=this.binders[a];(o instanceof yi||o instanceof fi||o instanceof xn)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof yi||a instanceof fi||a instanceof xn)&&a.destroy()}}}class _o{constructor(t,a,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new bn(h,a,o);this.needsUpload=!1,this._featureMap=new ji,this._bufferOffset=0}populatePaintArrays(t,a,o,h,_,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,a,h,_,g);a.id!==void 0&&this._featureMap.add(a.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,o,h){for(const _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,a,_,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ih(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Pn(r,t,a){const o={color:{source:ga,composite:u},number:{source:Jc,composite:ga}},h=function(_){return{"line-pattern":{source:se,composite:se},"fill-pattern":{source:se,composite:se},"fill-extrusion-pattern":{source:se,composite:se}}[_]}(r);return h&&h[a]||o[t][a]}Ke("ConstantBinder",or),Ke("CrossFadedConstantBinder",Ha),Ke("SourceExpressionBinder",yi),Ke("CrossFadedCompositeBinder",xn),Ke("CompositeExpressionBinder",fi),Ke("ProgramConfiguration",bn,{omit:["_buffers"]}),Ke("ProgramConfigurationSet",_o);const Dn=Math.pow(2,14)-1,Uu=-Dn-1;function js(r){const t=qe/r.extent,a=r.loadGeometry();for(let o=0;o<a.length;o++){const h=a[o];for(let _=0;_<h.length;_++){const g=h[_],v=Math.round(g.x*t),w=Math.round(g.y*t);g.x=mt(v,Uu,Dn),g.y=mt(w,Uu,Dn),(v<g.x||v>g.x+1||w<g.y||w>g.y+1)&&Ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function Ca(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?js(r):[]}}const eu=-32768;function Vu(r,t,a,o,h){r.emplaceBack(eu+8*t+o,eu+8*a+h)}class Ns{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new W,this.indexArray=new Ye,this.segments=new dt,this.programConfigurations=new _o(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,o){const h=this.layers[0],_=[];let g=null,v=!1,w=h.type==="heatmap";if(h.type==="circle"){const C=h;g=C.layout.get("circle-sort-key"),v=!g.isConstant(),w=w||C.paint.get("circle-pitch-alignment")==="map"}const M=w?a.subdivisionGranularity.circle:1;for(const{feature:C,id:A,index:R,sourceLayerIndex:k}of t){const O=this.layers[0]._featureFilter.needGeometry,U=Ca(C,O);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),U,o))continue;const q=v?g.evaluate(U,{},o):void 0,Q={id:A,properties:C.properties,type:C.type,sourceLayerIndex:k,index:R,geometry:O?U.geometry:js(C),patterns:{},sortKey:q};_.push(Q)}v&&_.sort((C,A)=>C.sortKey-A.sortKey);for(const C of _){const{geometry:A,index:R,sourceLayerIndex:k}=C,O=t[R].feature;this.addFeature(C,A,R,o,M),a.featureIndex.insert(O,A,R,k,this.index)}}update(t,a,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rt),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,o,h,_=1){let g;switch(_){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const v=g.length;for(const w of a)for(const M of w){const C=M.x,A=M.y;if(C<0||C>=qe||A<0||A>=qe)continue;const R=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),k=R.vertexLength;for(let O=0;O<v;O++)for(let U=0;U<v;U++)Vu(this.layoutVertexArray,C,A,g[U],g[O]);for(let O=0;O<v-1;O++)for(let U=0;U<v-1;U++){const q=k+O*v+U,Q=k+(O+1)*v+U;this.indexArray.emplaceBack(q,Q+1,q+1),this.indexArray.emplaceBack(q,Q,Q+1)}R.vertexLength+=v*v,R.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},h)}}function tl(r,t){for(let a=0;a<r.length;a++)if(il(t,r[a]))return!0;for(let a=0;a<t.length;a++)if(il(r,t[a]))return!0;return!!Gu(r,t)}function Zu(r,t,a){return!!il(r,t)||!!qu(t,r,a)}function tc(r,t){if(r.length===1)return Rh(t,r[0]);for(let a=0;a<t.length;a++){const o=t[a];for(let h=0;h<o.length;h++)if(il(r,o[h]))return!0}for(let a=0;a<r.length;a++)if(Rh(t,r[a]))return!0;for(let a=0;a<t.length;a++)if(Gu(r,t[a]))return!0;return!1}function pf(r,t,a){if(r.length>1){if(Gu(r,t))return!0;for(let o=0;o<t.length;o++)if(qu(t[o],r,a))return!0}for(let o=0;o<r.length;o++)if(qu(r[o],t,a))return!0;return!1}function Gu(r,t){if(r.length===0||t.length===0)return!1;for(let a=0;a<r.length-1;a++){const o=r[a],h=r[a+1];for(let _=0;_<t.length-1;_++)if(xd(o,h,t[_],t[_+1]))return!0}return!1}function xd(r,t,a,o){return Vi(r,a,o)!==Vi(t,a,o)&&Vi(r,t,a)!==Vi(r,t,o)}function qu(r,t,a){const o=a*a;if(t.length===1)return r.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(bd(r,t[h-1],t[h])<o)return!0;return!1}function bd(r,t,a){const o=t.distSqr(a);if(o===0)return r.distSqr(t);const h=((r.x-t.x)*(a.x-t.x)+(r.y-t.y)*(a.y-t.y))/o;return r.distSqr(h<0?t:h>1?a:a.sub(t)._mult(h)._add(t))}function Rh(r,t){let a,o,h,_=!1;for(let g=0;g<r.length;g++){a=r[g];for(let v=0,w=a.length-1;v<a.length;w=v++)o=a[v],h=a[w],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(_=!_)}return _}function il(r,t){let a=!1;for(let o=0,h=r.length-1;o<r.length;h=o++){const _=r[o],g=r[h];_.y>t.y!=g.y>t.y&&t.x<(g.x-_.x)*(t.y-_.y)/(g.y-_.y)+_.x&&(a=!a)}return a}function wd(r,t,a){const o=a[0],h=a[2];if(r.x<o.x&&t.x<o.x||r.x>h.x&&t.x>h.x||r.y<o.y&&t.y<o.y||r.y>h.y&&t.y>h.y)return!1;const _=Vi(r,t,a[0]);return _!==Vi(r,t,a[1])||_!==Vi(r,t,a[2])||_!==Vi(r,t,a[3])}function tu(r,t,a){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:a.programConfigurations.get(t.id).getMaxValue(r)}function iu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Hu(r,t,a,o,h){if(!t[0]&&!t[1])return r;const _=at.convert(t)._mult(h);a==="viewport"&&_._rotate(-o);const g=[];for(let v=0;v<r.length;v++)g.push(r[v].sub(_));return g}let Us,kh;Ke("CircleBucket",Ns,{omit:["layers"]});var Gf={get paint(){return kh=kh||new na({"circle-radius":new ft(P.paint_circle["circle-radius"]),"circle-color":new ft(P.paint_circle["circle-color"]),"circle-blur":new ft(P.paint_circle["circle-blur"]),"circle-opacity":new ft(P.paint_circle["circle-opacity"]),"circle-translate":new ct(P.paint_circle["circle-translate"]),"circle-translate-anchor":new ct(P.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct(P.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct(P.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ft(P.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ft(P.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ft(P.paint_circle["circle-stroke-opacity"])})},get layout(){return Us=Us||new na({"circle-sort-key":new ft(P.layout_circle["circle-sort-key"])})}};class mf extends Tr{constructor(t){super(t,Gf)}createBucket(t){return new Ns(t)}queryRadius(t){const a=t;return tu("circle-radius",this,a)+tu("circle-stroke-width",this,a)+iu(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:o,geometry:h,transform:_,pixelsToTileUnits:g,pixelPosMatrix:v}){const w=Hu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,g),M=this.paint.get("circle-radius").evaluate(a,o)+this.paint.get("circle-stroke-width").evaluate(a,o),C=this.paint.get("circle-pitch-alignment")==="map",A=C?w:function(k,O){return k.map(U=>Lh(U,O))}(w,v),R=C?M*g:M;for(const k of h)for(const O of k){const U=C?O:Lh(O,v);let q=R;const Q=qn([],[O.x,O.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?q*=Q[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(q*=_.cameraToCenterDistance/Q[3]),Zu(A,U,q))return!0}return!1}}function Lh(r,t){const a=qn([],[r.x,r.y,0,1],t);return new at(a[0]/a[3],a[1]/a[3])}class nl extends Ns{}let Vs;Ke("HeatmapBucket",nl,{omit:["layers"]});var al={get paint(){return Vs=Vs||new na({"heatmap-radius":new ft(P.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ft(P.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct(P.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yl(P.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct(P.paint_heatmap["heatmap-opacity"])})}};function ds(r,{width:t,height:a},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*a*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*a*o}`)}else h=new Uint8Array(t*a*o);return r.width=t,r.height=a,r.data=h,r}function Bh(r,{width:t,height:a},o){if(t===r.width&&a===r.height)return;const h=ds({},{width:t,height:a},o);$u(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,a)},o),r.width=t,r.height=a,r.data=h.data}function $u(r,t,a,o,h,_){if(h.width===0||h.height===0)return t;if(h.width>r.width||h.height>r.height||a.x>r.width-h.width||a.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,v=t.data;if(g===v)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const M=((a.y+w)*r.width+a.x)*_,C=((o.y+w)*t.width+o.x)*_;for(let A=0;A<h.width*_;A++)v[C+A]=g[M+A]}return t}class go{constructor(t,a){ds(this,t,1,a)}resize(t){Bh(this,t,1)}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,o,h,_){$u(t,a,o,h,_,1)}}class Aa{constructor(t,a){ds(this,t,4,a)}resize(t){Bh(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,o,h,_){$u(t,a,o,h,_,4)}}function rl(r){const t={},a=r.resolution||256,o=r.clips?r.clips.length:1,h=r.image||new Aa({width:a,height:o});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const _=(g,v,w)=>{t[r.evaluationKey]=w;const M=r.expression.evaluate(t);h.data[g+v+0]=Math.floor(255*M.r/M.a),h.data[g+v+1]=Math.floor(255*M.g/M.a),h.data[g+v+2]=Math.floor(255*M.b/M.a),h.data[g+v+3]=Math.floor(255*M.a)};if(r.clips)for(let g=0,v=0;g<o;++g,v+=4*a)for(let w=0,M=0;w<a;w++,M+=4){const C=w/(a-1),{start:A,end:R}=r.clips[g];_(v,M,A*(1-C)+R*C)}else for(let g=0,v=0;g<a;g++,v+=4)_(0,v,g/(a-1));return h}Ke("AlphaImage",go),Ke("RGBAImage",Aa);const aa="big-fb";class Oh extends Tr{createBucket(t){return new nl(t)}constructor(t){super(t,al),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(aa)&&this.heatmapFbos.delete(aa)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Td;var sl={get paint(){return Td=Td||new na({"hillshade-illumination-direction":new ct(P.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ct(P.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct(P.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct(P.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct(P.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct(P.paint_hillshade["hillshade-accent-color"])})}};class Sd extends Tr{constructor(t){super(t,sl)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Md=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ol}=Md;function Zs(r,t,a){const o=a.patternDependencies;let h=!1;for(const _ of t){const g=_.paint.get(`${r}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,o[v.to]=!0,o[v.from]=!0)}return h}function ic(r,t,a,o,h){const _=h.patternDependencies;for(const g of t){const v=g.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:o-1},a,{},h.availableImages),M=v.evaluate({zoom:o},a,{},h.availableImages),C=v.evaluate({zoom:o+1},a,{},h.availableImages);w=w&&w.name?w.name:w,M=M&&M.name?M.name:M,C=C&&C.name?C.name:C,_[w]=!0,_[M]=!0,_[C]=!0,a.patterns[g.id]={min:w,mid:M,max:C}}}return a}function Fh(r,t,a,o,h){let _;if(h===function(g,v,w,M){let C=0;for(let A=v,R=w-M;A<w;A+=M)C+=(g[R]-g[A])*(g[A+1]+g[R+1]),R=A;return C}(r,t,a,o)>0)for(let g=t;g<a;g+=o)_=Wn(g/o|0,r[g],r[g+1],_);else for(let g=a-o;g>=t;g-=o)_=Wn(g/o|0,r[g],r[g+1],_);return _&&cl(_,_.next)&&(au(_),_=_.next),_}function yo(r,t){if(!r)return r;t||(t=r);let a,o=r;do if(a=!1,o.steiner||!cl(o,o.next)&&qi(o.prev,o,o.next)!==0)o=o.next;else{if(au(o),o=t=o.prev,o===o.next)break;a=!0}while(a||o!==t);return t}function vo(r,t,a,o,h,_,g){if(!r)return;!g&&_&&function(w,M,C,A){let R=w;do R.z===0&&(R.z=xo(R.x,R.y,M,C,A)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==w);R.prevZ.nextZ=null,R.prevZ=null,function(k){let O,U=1;do{let q,Q=k;k=null;let oe=null;for(O=0;Q;){O++;let J=Q,L=0;for(let ee=0;ee<U&&(L++,J=J.nextZ,J);ee++);let Z=U;for(;L>0||Z>0&&J;)L!==0&&(Z===0||!J||Q.z<=J.z)?(q=Q,Q=Q.nextZ,L--):(q=J,J=J.nextZ,Z--),oe?oe.nextZ=q:k=q,q.prevZ=oe,oe=q;Q=J}oe.nextZ=null,U*=2}while(O>1)}(R)}(r,o,h,_);let v=r;for(;r.prev!==r.next;){const w=r.prev,M=r.next;if(_?_f(r,o,h,_):Xu(r))t.push(w.i,r.i,M.i),au(r),r=M.next,v=M.next;else if((r=M)===v){g?g===1?vo(r=gf(yo(r),t),t,a,o,h,_,2):g===2&&Yu(r,t,a,o,h,_):vo(yo(r),t,a,o,h,_,1);break}}}function Xu(r){const t=r.prev,a=r,o=r.next;if(qi(t,a,o)>=0)return!1;const h=t.x,_=a.x,g=o.x,v=t.y,w=a.y,M=o.y,C=Math.min(h,_,g),A=Math.min(v,w,M),R=Math.max(h,_,g),k=Math.max(v,w,M);let O=o.next;for(;O!==t;){if(O.x>=C&&O.x<=R&&O.y>=A&&O.y<=k&&nu(h,v,_,w,g,M,O.x,O.y)&&qi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function _f(r,t,a,o){const h=r.prev,_=r,g=r.next;if(qi(h,_,g)>=0)return!1;const v=h.x,w=_.x,M=g.x,C=h.y,A=_.y,R=g.y,k=Math.min(v,w,M),O=Math.min(C,A,R),U=Math.max(v,w,M),q=Math.max(C,A,R),Q=xo(k,O,t,a,o),oe=xo(U,q,t,a,o);let J=r.prevZ,L=r.nextZ;for(;J&&J.z>=Q&&L&&L.z<=oe;){if(J.x>=k&&J.x<=U&&J.y>=O&&J.y<=q&&J!==h&&J!==g&&nu(v,C,w,A,M,R,J.x,J.y)&&qi(J.prev,J,J.next)>=0||(J=J.prevZ,L.x>=k&&L.x<=U&&L.y>=O&&L.y<=q&&L!==h&&L!==g&&nu(v,C,w,A,M,R,L.x,L.y)&&qi(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;J&&J.z>=Q;){if(J.x>=k&&J.x<=U&&J.y>=O&&J.y<=q&&J!==h&&J!==g&&nu(v,C,w,A,M,R,J.x,J.y)&&qi(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;L&&L.z<=oe;){if(L.x>=k&&L.x<=U&&L.y>=O&&L.y<=q&&L!==h&&L!==g&&nu(v,C,w,A,M,R,L.x,L.y)&&qi(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function gf(r,t){let a=r;do{const o=a.prev,h=a.next.next;!cl(o,h)&&Qu(o,a,a.next,h)&&nc(o,h)&&nc(h,o)&&(t.push(o.i,a.i,h.i),au(a),au(a.next),a=r=h),a=a.next}while(a!==r);return yo(a)}function Yu(r,t,a,o,h,_){let g=r;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&xf(g,v)){let w=Cd(g,v);return g=yo(g,g.next),w=yo(w,w.next),vo(g,t,a,o,h,_,0),void vo(w,t,a,o,h,_,0)}v=v.next}g=g.next}while(g!==r)}function ll(r,t){let a=r.x-t.x;return a===0&&(a=r.y-t.y,a===0)&&(a=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),a}function yf(r,t){const a=function(h,_){let g=_;const v=h.x,w=h.y;let M,C=-1/0;if(cl(h,g))return g;do{if(cl(h,g.next))return g.next;if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){const U=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(U<=v&&U>C&&(C=U,M=g.x<g.next.x?g:g.next,U===v))return M}g=g.next}while(g!==_);if(!M)return null;const A=M,R=M.x,k=M.y;let O=1/0;g=M;do{if(v>=g.x&&g.x>=R&&v!==g.x&&Ed(w<k?v:C,w,R,k,w<k?C:v,w,g.x,g.y)){const U=Math.abs(w-g.y)/(v-g.x);nc(g,h)&&(U<O||U===O&&(g.x>M.x||g.x===M.x&&vf(M,g)))&&(M=g,O=U)}g=g.next}while(g!==A);return M}(r,t);if(!a)return t;const o=Cd(a,r);return yo(o,o.next),yo(a,a.next)}function vf(r,t){return qi(r.prev,r,t.prev)<0&&qi(t.next,r,r.next)<0}function xo(r,t,a,o,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-a)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cr(r){let t=r,a=r;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==r);return a}function Ed(r,t,a,o,h,_,g,v){return(h-g)*(t-v)>=(r-g)*(_-v)&&(r-g)*(o-v)>=(a-g)*(t-v)&&(a-g)*(_-v)>=(h-g)*(o-v)}function nu(r,t,a,o,h,_,g,v){return!(r===g&&t===v)&&Ed(r,t,a,o,h,_,g,v)}function xf(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(a,o){let h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==o.i&&h.next.i!==o.i&&Qu(h,h.next,a,o))return!0;h=h.next}while(h!==a);return!1}(r,t)&&(nc(r,t)&&nc(t,r)&&function(a,o){let h=a,_=!1;const g=(a.x+o.x)/2,v=(a.y+o.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(_=!_),h=h.next;while(h!==a);return _}(r,t)&&(qi(r.prev,r,t.prev)||qi(r,t.prev,t))||cl(r,t)&&qi(r.prev,r,r.next)>0&&qi(t.prev,t,t.next)>0)}function qi(r,t,a){return(t.y-r.y)*(a.x-t.x)-(t.x-r.x)*(a.y-t.y)}function cl(r,t){return r.x===t.x&&r.y===t.y}function Qu(r,t,a,o){const h=Hi(qi(r,t,a)),_=Hi(qi(r,t,o)),g=Hi(qi(a,o,r)),v=Hi(qi(a,o,t));return h!==_&&g!==v||!(h!==0||!Hr(r,a,t))||!(_!==0||!Hr(r,o,t))||!(g!==0||!Hr(a,r,o))||!(v!==0||!Hr(a,t,o))}function Hr(r,t,a){return t.x<=Math.max(r.x,a.x)&&t.x>=Math.min(r.x,a.x)&&t.y<=Math.max(r.y,a.y)&&t.y>=Math.min(r.y,a.y)}function Hi(r){return r>0?1:r<0?-1:0}function nc(r,t){return qi(r.prev,r,r.next)<0?qi(r,t,r.next)>=0&&qi(r,r.prev,t)>=0:qi(r,t,r.prev)<0||qi(r,r.next,t)<0}function Cd(r,t){const a=Ad(r.i,r.x,r.y),o=Ad(t.i,t.x,t.y),h=r.next,_=t.prev;return r.next=t,t.prev=r,a.next=h,h.prev=a,o.next=a,a.prev=o,_.next=o,o.prev=_,o}function Wn(r,t,a,o){const h=Ad(r,t,a);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function au(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ad(r,t,a){return{i:r,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ac{constructor(t,a){if(a>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=a}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Ku{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Ku.noSubdivision=new Ku({fill:new ac(0,0),line:new ac(0,0),tile:new ac(0,0),stencil:new ac(0,0),circle:1}),Ke("SubdivisionGranularityExpression",ac),Ke("SubdivisionGranularitySetting",Ku);const $i=-32768,ya=32767;class bo{constructor(t,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=qe/t,this._canonical=a}_getKey(t,a){return(t+=32768)<<16|(a+=32768)<<0}_vertexToIndex(t,a){if(t<-32768||a<-32768||t>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),h=0|Math.round(a),_=this._getKey(o,h);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,g),this._vertexBuffer.push(o,h),g}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(h,_){const g=[];for(let v=0;v<_.length;v+=3){const w=_[v],M=_[v+1],C=_[v+2],A=h[2*w],R=h[2*w+1];(h[2*M]-A)*(h[2*C+1]-R)-(h[2*M+1]-R)*(h[2*C]-A)>0?(g.push(w),g.push(C),g.push(M)):(g.push(w),g.push(M),g.push(C))}return g}(this._vertexBuffer,t);const a=[],o=t.length;for(let h=0;h<o;h+=3){const _=[t[h+0],t[h+1],t[h+2]],g=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let v=1/0,w=1/0,M=-1/0,C=-1/0;for(let U=0;U<3;U++){const q=g[2*U],Q=g[2*U+1];v=Math.min(v,q),M=Math.max(M,q),w=Math.min(w,Q),C=Math.max(C,Q)}if(v===M||w===C)continue;const A=Math.floor(v/this._granularityCellSize),R=Math.ceil(M/this._granularityCellSize),k=Math.floor(w/this._granularityCellSize),O=Math.ceil(C/this._granularityCellSize);if(A!==R||k!==O)for(let U=k;U<O;U++){const q=this._scanlineGenerateVertexRingForCellRow(U,g,_);qf(this._vertexBuffer,q,a)}else a.push(..._)}return a}_scanlineGenerateVertexRingForCellRow(t,a,o){const h=t*this._granularityCellSize,_=h+this._granularityCellSize,g=[];for(let v=0;v<3;v++){const w=a[2*v],M=a[2*v+1],C=a[2*(v+1)%6],A=a[(2*(v+1)+1)%6],R=a[2*(v+2)%6],k=a[(2*(v+2)+1)%6],O=C-w,U=A-M,q=O===0,Q=U===0,oe=(h-M)/U,J=(_-M)/U,L=Math.min(oe,J),Z=Math.max(oe,J);if(!Q&&(L>=1||Z<=0)||Q&&(M<h||M>_)){A>=h&&A<=_&&g.push(o[(v+1)%3]);continue}!Q&&L>0&&g.push(this._vertexToIndex(w+O*L,M+U*L));const ee=w+O*Math.max(L,0),ve=w+O*Math.min(Z,1);q||this._generateIntraEdgeVertices(g,w,M,C,A,ee,ve),!Q&&Z<1&&g.push(this._vertexToIndex(w+O*Z,M+U*Z)),(Q||A>=h&&A<=_)&&g.push(o[(v+1)%3]),!Q&&(A<=h||A>=_)&&this._generateInterEdgeVertices(g,w,M,C,A,R,k,ve,h,_)}return g}_generateIntraEdgeVertices(t,a,o,h,_,g,v){const w=h-a,M=_-o,C=M===0,A=C?Math.min(a,h):Math.min(g,v),R=C?Math.max(a,h):Math.max(g,v),k=Math.floor(A/this._granularityCellSize)+1,O=Math.ceil(R/this._granularityCellSize)-1;if(C?a<h:g<v)for(let U=k;U<=O;U++){const q=U*this._granularityCellSize;t.push(this._vertexToIndex(q,o+M*(q-a)/w))}else for(let U=O;U>=k;U--){const q=U*this._granularityCellSize;t.push(this._vertexToIndex(q,o+M*(q-a)/w))}}_generateInterEdgeVertices(t,a,o,h,_,g,v,w,M,C){const A=_-o,R=g-h,k=v-_,O=(M-_)/k,U=(C-_)/k,q=Math.min(O,U),Q=Math.max(O,U),oe=h+R*q;let J=Math.floor(Math.min(oe,w)/this._granularityCellSize)+1,L=Math.ceil(Math.max(oe,w)/this._granularityCellSize)-1,Z=w<oe;const ee=k===0;if(ee&&(v===M||v===C))return;if(ee||q>=1||Q<=0){const je=o-v,Se=g+(a-g)*Math.min((M-v)/je,(C-v)/je);J=Math.floor(Math.min(Se,w)/this._granularityCellSize)+1,L=Math.ceil(Math.max(Se,w)/this._granularityCellSize)-1,Z=w<Se}const ve=A>0?C:M;if(Z)for(let je=J;je<=L;je++)t.push(this._vertexToIndex(je*this._granularityCellSize,ve));else for(let je=L;je>=J;je--)t.push(this._vertexToIndex(je*this._granularityCellSize,ve))}_generateOutline(t){const a=[];for(const o of t){const h=ul(o,this._granularity,!0),_=this._pointArrayToIndices(h),g=[];for(let v=1;v<_.length;v++)g.push(_[v-1]),g.push(_[v]);a.push(g)}return a}_handlePoles(t){let a=!1,o=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(a||o)&&this._fillPoles(t,a,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let a=0;a<t.length;a+=2){const o=t[a+1];o===$i&&(t[a+1]=-32767),o===ya&&(t[a+1]=32766)}}_generatePoleQuad(t,a,o,h,_,g){h>_!=(g===$i)?(t.push(a),t.push(o),t.push(this._vertexToIndex(h,g)),t.push(o),t.push(this._vertexToIndex(_,g)),t.push(this._vertexToIndex(h,g))):(t.push(o),t.push(a),t.push(this._vertexToIndex(h,g)),t.push(this._vertexToIndex(_,g)),t.push(o),t.push(this._vertexToIndex(h,g)))}_fillPoles(t,a,o){const h=this._vertexBuffer,_=qe,g=t.length;for(let v=2;v<g;v+=3){const w=t[v-2],M=t[v-1],C=t[v],A=h[2*w],R=h[2*w+1],k=h[2*M],O=h[2*M+1],U=h[2*C],q=h[2*C+1];a&&(R===0&&O===0&&this._generatePoleQuad(t,w,M,A,k,$i),O===0&&q===0&&this._generatePoleQuad(t,M,C,k,U,$i),q===0&&R===0&&this._generatePoleQuad(t,C,w,U,A,$i)),o&&(R===_&&O===_&&this._generatePoleQuad(t,w,M,A,k,ya),O===_&&q===_&&this._generatePoleQuad(t,M,C,k,U,ya),q===_&&R===_&&this._generatePoleQuad(t,C,w,U,A,ya))}}_initializeVertices(t){for(let a=0;a<t.length;a+=2)this._vertexToIndex(t[a],t[a+1])}subdividePolygonInternal(t,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=function(v){const w=[],M=[];for(const C of v)if(C.length!==0){C!==v[0]&&w.push(M.length/2);for(let A=0;A<C.length;A++)M.push(C[A].x),M.push(C[A].y)}return{flattened:M,holeIndices:w}}(t);let _;this._initializeVertices(o);try{const v=function(M,C,A=2){const R=C&&C.length,k=R?C[0]*A:M.length;let O=Fh(M,0,k,A,!0);const U=[];if(!O||O.next===O.prev)return U;let q,Q,oe;if(R&&(O=function(J,L,Z,ee){const ve=[];for(let je=0,Se=L.length;je<Se;je++){const Ae=Fh(J,L[je]*ee,je<Se-1?L[je+1]*ee:J.length,ee,!1);Ae===Ae.next&&(Ae.steiner=!0),ve.push(Cr(Ae))}ve.sort(ll);for(let je=0;je<ve.length;je++)Z=yf(ve[je],Z);return Z}(M,C,O,A)),M.length>80*A){q=1/0,Q=1/0;let J=-1/0,L=-1/0;for(let Z=A;Z<k;Z+=A){const ee=M[Z],ve=M[Z+1];ee<q&&(q=ee),ve<Q&&(Q=ve),ee>J&&(J=ee),ve>L&&(L=ve)}oe=Math.max(J-q,L-Q),oe=oe!==0?32767/oe:0}return vo(O,U,A,q,Q,oe,0),U}(o,h),w=this._convertIndices(o,v);_=this._subdivideTrianglesScanline(w)}catch(v){console.error(v)}let g=[];return a&&(g=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:g}}_convertIndices(t,a){const o=[];for(let h=0;h<a.length;h++)o.push(this._vertexToIndex(t[2*a[h]],t[2*a[h]+1]));return o}_pointArrayToIndices(t){const a=[];for(let o=0;o<t.length;o++){const h=t[o];a.push(this._vertexToIndex(h.x,h.y))}return a}}function zd(r,t,a,o=!0){return new bo(a,t).subdividePolygonInternal(r,o)}function ul(r,t,a=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],h=r[r.length-1],_=a&&(o.x!==h.x||o.y!==h.y);if(t<2)return _?[...r,r[0]]:[...r];const g=Math.floor(qe/t),v=[];v.push(new at(r[0].x,r[0].y));const w=r.length,M=_?w:w-1;for(let C=0;C<M;C++){const A=r[C],R=C<w-1?r[C+1]:r[0],k=A.x,O=A.y,U=R.x,q=R.y,Q=k!==U,oe=O!==q;if(!Q&&!oe)continue;const J=U-k,L=q-O,Z=Math.abs(J),ee=Math.abs(L);let ve=k,je=O;for(;;){const Ae=J>0?(Math.floor(ve/g)+1)*g:(Math.ceil(ve/g)-1)*g,Ze=L>0?(Math.floor(je/g)+1)*g:(Math.ceil(je/g)-1)*g,Ue=Math.abs(ve-Ae),Ge=Math.abs(je-Ze),Re=Math.abs(ve-U),tt=Math.abs(je-q),gt=Q?Ue/Z:Number.POSITIVE_INFINITY,pt=oe?Ge/ee:Number.POSITIVE_INFINITY;if((Re<=Ue||!Q)&&(tt<=Ge||!oe))break;if(gt<pt&&Q||!oe){ve=Ae,je+=L*gt;const nt=new at(ve,Math.round(je));v[v.length-1].x===nt.x&&v[v.length-1].y===nt.y||v.push(nt)}else{ve+=J*pt,je=Ze;const nt=new at(Math.round(ve),je);v[v.length-1].x===nt.x&&v[v.length-1].y===nt.y||v.push(nt)}}const Se=new at(U,q);v[v.length-1].x===Se.x&&v[v.length-1].y===Se.y||v.push(Se)}return v}function qf(r,t,a){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=r[2*t[0]];for(let w=1;w<t.length;w++){const M=r[2*t[w]];M<h&&(h=M,o=w)}const _=t.length;let g=o,v=(g+1)%_;for(;;){const w=g-1>=0?g-1:_-1,M=(v+1)%_,C=r[2*t[w]],A=r[2*t[M]],R=r[2*t[g]],k=r[2*t[g]+1],O=r[2*t[v]+1];let U=!1;if(C<A)U=!0;else if(C>A)U=!1;else{const q=O-k,Q=-(r[2*t[v]]-R),oe=k<O?1:-1;((C-R)*q+(r[2*t[w]+1]-k)*Q)*oe>((A-R)*q+(r[2*t[M]+1]-k)*Q)*oe&&(U=!0)}if(U){const q=t[w],Q=t[g],oe=t[v];q!==Q&&q!==oe&&Q!==oe&&a.push(oe,Q,q),g--,g<0&&(g=_-1)}else{const q=t[M],Q=t[g],oe=t[v];q!==Q&&q!==oe&&Q!==oe&&a.push(oe,Q,q),v++,v>=_&&(v=0)}if(w===M)break}}function jh(r,t,a,o,h,_,g,v,w){const M=h.length/2,C=g&&v&&w;if(M<dt.MAX_VERTEX_ARRAY_LENGTH){const A=t.prepareSegment(M,a,o),R=A.vertexLength;for(let U=0;U<_.length;U+=3)o.emplaceBack(R+_[U],R+_[U+1],R+_[U+2]);let k,O;A.vertexLength+=M,A.primitiveLength+=_.length/3,C&&(O=g.prepareSegment(M,a,v),k=O.vertexLength,O.vertexLength+=M);for(let U=0;U<h.length;U+=2)r(h[U],h[U+1]);if(C)for(let U=0;U<w.length;U++){const q=w[U];for(let Q=1;Q<q.length;Q+=2)v.emplaceBack(k+q[Q-1],k+q[Q]);O.primitiveLength+=q.length/2}}else(function(A,R,k,O,U,q){const Q=[];for(let ee=0;ee<O.length/2;ee++)Q.push(-1);const oe={count:0};let J=0,L=A.getOrCreateLatestSegment(R,k),Z=L.vertexLength;for(let ee=2;ee<U.length;ee+=3){const ve=U[ee-2],je=U[ee-1],Se=U[ee];let Ae=Q[ve]<J,Ze=Q[je]<J,Ue=Q[Se]<J;L.vertexLength+((Ae?1:0)+(Ze?1:0)+(Ue?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(L=A.createNewSegment(R,k),J=oe.count,Ae=!0,Ze=!0,Ue=!0,Z=0);const Ge=za(Q,O,q,oe,ve,Ae,L),Re=za(Q,O,q,oe,je,Ze,L),tt=za(Q,O,q,oe,Se,Ue,L);k.emplaceBack(Z+Ge-J,Z+Re-J,Z+tt-J),L.primitiveLength++}})(t,a,o,h,_,r),C&&function(A,R,k,O,U,q){const Q=[];for(let ee=0;ee<O.length/2;ee++)Q.push(-1);const oe={count:0};let J=0,L=A.getOrCreateLatestSegment(R,k),Z=L.vertexLength;for(let ee=0;ee<U.length;ee++){const ve=U[ee];for(let je=1;je<U[ee].length;je+=2){const Se=ve[je-1],Ae=ve[je];let Ze=Q[Se]<J,Ue=Q[Ae]<J;L.vertexLength+((Ze?1:0)+(Ue?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(L=A.createNewSegment(R,k),J=oe.count,Ze=!0,Ue=!0,Z=0);const Ge=za(Q,O,q,oe,Se,Ze,L),Re=za(Q,O,q,oe,Ae,Ue,L);k.emplaceBack(Z+Ge-J,Z+Re-J),L.primitiveLength++}}}(g,a,v,h,w,r),t.forceNewSegmentOnNextPrepare(),g==null||g.forceNewSegmentOnNextPrepare()}function za(r,t,a,o,h,_,g){if(_){const v=o.count;return a(t[2*h],t[2*h+1]),r[h]=o.count,o.count++,g.vertexLength++,v}return r[h]}class Ar{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ie,this.indexArray=new Ye,this.indexArray2=new $e,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,o){this.hasPattern=Zs("fill",this.layers,a);const h=this.layers[0].layout.get("fill-sort-key"),_=!h.isConstant(),g=[];for(const{feature:v,id:w,index:M,sourceLayerIndex:C}of t){const A=this.layers[0]._featureFilter.needGeometry,R=Ca(v,A);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),R,o))continue;const k=_?h.evaluate(R,{},o,a.availableImages):void 0,O={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:A?R.geometry:js(v),patterns:{},sortKey:k};g.push(O)}_&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:M,sourceLayerIndex:C}=v;if(this.hasPattern){const A=ic("fill",this.layers,v,this.zoom,a);this.patternFeatures.push(A)}else this.addFeature(v,w,M,o,{},a.subdivisionGranularity);a.featureIndex.insert(t[M].feature,w,M,C,this.index)}}update(t,a,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,o)}addFeatures(t,a,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,a,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ol),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,o,h,_,g){for(const v of Il(a,500)){const w=zd(v,h,g.fill.getGranularityForZoomLevel(h.z)),M=this.layoutVertexArray;jh((C,A)=>{M.emplaceBack(C,A)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,h)}}let Pd,zr;Ke("FillBucket",Ar,{omit:["layers","patternFeatures"]});var bf={get paint(){return zr=zr||new na({"fill-antialias":new ct(P.paint_fill["fill-antialias"]),"fill-opacity":new ft(P.paint_fill["fill-opacity"]),"fill-color":new ft(P.paint_fill["fill-color"]),"fill-outline-color":new ft(P.paint_fill["fill-outline-color"]),"fill-translate":new ct(P.paint_fill["fill-translate"]),"fill-translate-anchor":new ct(P.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xl(P.paint_fill["fill-pattern"])})},get layout(){return Pd=Pd||new na({"fill-sort-key":new ft(P.layout_fill["fill-sort-key"])})}};class wo extends Tr{constructor(t){super(t,bf)}recalculate(t,a){super.recalculate(t,a);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ar(t)}queryRadius(){return iu(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:a,transform:o,pixelsToTileUnits:h}){return tc(Hu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),a)}isTileClipped(){return!0}}const ru=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),hl=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Dd}=ru;var Wu,To,Nh,rc,sc,su,oc,Ju={};function Id(){if(To)return Wu;To=1;var r=ai();function t(h,_,g,v,w){this.properties={},this.extent=g,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=w,h.readFields(a,this,_)}function a(h,_,g){h==1?_.id=g.readVarint():h==2?function(v,w){for(var M=v.readVarint()+v.pos;v.pos<M;){var C=w._keys[v.readVarint()],A=w._values[v.readVarint()];w.properties[C]=A}}(g,_):h==3?_.type=g.readVarint():h==4&&(_._geometry=g.pos)}function o(h){for(var _,g,v=0,w=0,M=h.length,C=M-1;w<M;C=w++)v+=((g=h[C]).x-(_=h[w]).x)*(_.y+g.y);return v}return Wu=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var _,g=h.readVarint()+h.pos,v=1,w=0,M=0,C=0,A=[];h.pos<g;){if(w<=0){var R=h.readVarint();v=7&R,w=R>>3}if(w--,v===1||v===2)M+=h.readSVarint(),C+=h.readSVarint(),v===1&&(_&&A.push(_),_=[]),_.push(new r(M,C));else{if(v!==7)throw new Error("unknown command "+v);_&&_.push(_[0].clone())}}return _&&A.push(_),A},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var _=h.readVarint()+h.pos,g=1,v=0,w=0,M=0,C=1/0,A=-1/0,R=1/0,k=-1/0;h.pos<_;){if(v<=0){var O=h.readVarint();g=7&O,v=O>>3}if(v--,g===1||g===2)(w+=h.readSVarint())<C&&(C=w),w>A&&(A=w),(M+=h.readSVarint())<R&&(R=M),M>k&&(k=M);else if(g!==7)throw new Error("unknown command "+g)}return[C,R,A,k]},t.prototype.toGeoJSON=function(h,_,g){var v,w,M=this.extent*Math.pow(2,g),C=this.extent*h,A=this.extent*_,R=this.loadGeometry(),k=t.types[this.type];function O(Q){for(var oe=0;oe<Q.length;oe++){var J=Q[oe];Q[oe]=[360*(J.x+C)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+A)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(v=0;v<R.length;v++)U[v]=R[v][0];O(R=U);break;case 2:for(v=0;v<R.length;v++)O(R[v]);break;case 3:for(R=function(Q){var oe=Q.length;if(oe<=1)return[Q];for(var J,L,Z=[],ee=0;ee<oe;ee++){var ve=o(Q[ee]);ve!==0&&(L===void 0&&(L=ve<0),L===ve<0?(J&&Z.push(J),J=[Q[ee]]):J.push(Q[ee]))}return J&&Z.push(J),Z}(R),v=0;v<R.length;v++)for(w=0;w<R[v].length;w++)O(R[v][w])}R.length===1?R=R[0]:k="Multi"+k;var q={type:"Feature",geometry:{type:k,coordinates:R},properties:this.properties};return"id"in this&&(q.id=this.id),q},Wu}function ou(){if(rc)return Nh;rc=1;var r=Id();function t(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(a,this,h),this.length=this._features.length}function a(o,h,_){o===15?h.version=_.readVarint():o===1?h.name=_.readString():o===5?h.extent=_.readVarint():o===2?h._features.push(_.pos):o===3?h._keys.push(_.readString()):o===4&&h._values.push(function(g){for(var v=null,w=g.readVarint()+g.pos;g.pos<w;){var M=g.readVarint()>>3;v=M===1?g.readString():M===2?g.readFloat():M===3?g.readDouble():M===4?g.readVarint64():M===5?g.readVarint():M===6?g.readSVarint():M===7?g.readBoolean():null}return v}(_))}return Nh=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,h,this.extent,this._keys,this._values)},Nh}function Rd(){return oc||(oc=1,Ju.VectorTile=function(){if(su)return sc;su=1;var r=ou();function t(a,o,h){if(a===3){var _=new r(h,h.readVarint()+h.pos);_.length&&(o[_.name]=_)}}return sc=function(a,o){this.layers=a.readFields(t,{},o)},sc}(),Ju.VectorTileFeature=Id(),Ju.VectorTileLayer=ou()),Ju}var dl=ot(Rd());const wf=dl.VectorTileFeature.types,kd=Math.pow(2,13);function Pa(r,t,a,o,h,_,g,v){r.emplaceBack(t,a,2*Math.floor(o*kd)+g,h*kd*2,_*kd*2,Math.round(v))}class eh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ne,this.centroidVertexArray=new Y,this.indexArray=new Ye,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,o){this.features=[],this.hasPattern=Zs("fill-extrusion",this.layers,a);for(const{feature:h,id:_,index:g,sourceLayerIndex:v}of t){const w=this.layers[0]._featureFilter.needGeometry,M=Ca(h,w);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),M,o))continue;const C={id:_,sourceLayerIndex:v,index:g,geometry:w?M.geometry:js(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(ic("fill-extrusion",this.layers,C,this.zoom,a)):this.addFeature(C,C.geometry,g,o,{},a.subdivisionGranularity),a.featureIndex.insert(h,C.geometry,g,v,this.index,!0)}}addFeatures(t,a,o){for(const h of this.features){const{geometry:_}=h;this.addFeature(h,_,h.index,a,o,t.subdivisionGranularity)}}update(t,a,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dd),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,hl.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,o,h,_,g){for(const v of Il(a,500)){const w={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(w,h,t,v,g);const C=this.layoutVertexArray.length-M,A=Math.floor(w.x/w.sampleCount),R=Math.floor(w.y/w.sampleCount);for(let k=0;k<C;k++)this.centroidVertexArray.emplaceBack(A,R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,h)}processPolygon(t,a,o,h,_){if(h.length<1||th(h[0]))return;for(const A of h)A.length!==0&&fl(t,A);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=_.fill.getGranularityForZoomLevel(a.z),w=wf[o.type]==="Polygon";for(const A of h){if(A.length===0||th(A))continue;const R=ul(A,v,w);this._generateSideFaces(R,g)}if(!w)return;const M=zd(h,a,v,!1),C=this.layoutVertexArray;jh((A,R)=>{Pa(C,A,R,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,a){let o=0;for(let h=1;h<t.length;h++){const _=t[h],g=t[h-1];if(Tf(_,g))continue;a.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=_.sub(g)._perp()._unit(),w=g.dist(_);o+w>32768&&(o=0),Pa(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Pa(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o),o+=w,Pa(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,o),Pa(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,o);const M=a.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function fl(r,t){for(let a=0;a<t.length;a++){const o=t[a];a===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function Tf(r,t){return r.x===t.x&&(r.x<0||r.x>qe)||r.y===t.y&&(r.y<0||r.y>qe)}function th(r){return r.every(t=>t.x<0)||r.every(t=>t.x>qe)||r.every(t=>t.y<0)||r.every(t=>t.y>qe)}let pl;Ke("FillExtrusionBucket",eh,{omit:["layers","features"]});var Sf={get paint(){return pl=pl||new na({"fill-extrusion-opacity":new ct(P["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ft(P["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct(P["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct(P["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xl(P["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ft(P["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ft(P["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct(P["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ld extends Tr{constructor(t){super(t,Sf)}createBucket(t){return new eh(t)}queryRadius(){return iu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:o,geometry:h,transform:_,pixelsToTileUnits:g,pixelPosMatrix:v}){const w=Hu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,g),M=this.paint.get("fill-extrusion-height").evaluate(a,o),C=this.paint.get("fill-extrusion-base").evaluate(a,o),A=function(k,O,U){const q=[];for(const Q of k){const oe=[Q.x,Q.y,0,1];qn(oe,oe,O),q.push(new at(oe[0]/oe[3],oe[1]/oe[3]))}return q}(w,v),R=function(k,O,U,q){const Q=[],oe=[],J=q[8]*O,L=q[9]*O,Z=q[10]*O,ee=q[11]*O,ve=q[8]*U,je=q[9]*U,Se=q[10]*U,Ae=q[11]*U;for(const Ze of k){const Ue=[],Ge=[];for(const Re of Ze){const tt=Re.x,gt=Re.y,pt=q[0]*tt+q[4]*gt+q[12],nt=q[1]*tt+q[5]*gt+q[13],Ut=q[2]*tt+q[6]*gt+q[14],Ui=q[3]*tt+q[7]*gt+q[15],fn=Ut+Z,Yi=Ui+ee,Nn=pt+ve,Tn=nt+je,pn=Ut+Se,vi=Ui+Ae,Ri=new at((pt+J)/Yi,(nt+L)/Yi);Ri.z=fn/Yi,Ue.push(Ri);const ea=new at(Nn/vi,Tn/vi);ea.z=pn/vi,Ge.push(ea)}Q.push(Ue),oe.push(Ge)}return[Q,oe]}(h,C,M,v);return function(k,O,U){let q=1/0;tc(U,O)&&(q=Gs(U,O[0]));for(let Q=0;Q<O.length;Q++){const oe=O[Q],J=k[Q];for(let L=0;L<oe.length-1;L++){const Z=oe[L],ee=[Z,oe[L+1],J[L+1],J[L],Z];tl(U,ee)&&(q=Math.min(q,Gs(U,ee)))}}return q!==1/0&&q}(R[0],R[1],A)}}function lc(r,t){return r.x*t.x+r.y*t.y}function Gs(r,t){if(r.length===1){let a=0;const o=t[a++];let h;for(;!h||o.equals(h);)if(h=t[a++],!h)return 1/0;for(;a<t.length;a++){const _=t[a],g=r[0],v=h.sub(o),w=_.sub(o),M=g.sub(o),C=lc(v,v),A=lc(v,w),R=lc(w,w),k=lc(M,v),O=lc(M,w),U=C*R-A*A,q=(R*k-A*O)/U,Q=(C*O-A*k)/U,oe=o.z*(1-q-Q)+h.z*q+_.z*Q;if(isFinite(oe))return oe}return 1/0}{let a=1/0;for(const o of t)a=Math.min(a,o.z);return a}}const Mf=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Uh}=Mf,ih=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:dn}=ih,Hf=dl.VectorTileFeature.types,$f=Math.cos(Math.PI/180*37.5),Bd=Math.pow(2,14)/.5;class Od{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new ae,this.layoutVertexArray2=new le,this.indexArray=new Ye,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,o){this.hasPattern=Zs("line",this.layers,a);const h=this.layers[0].layout.get("line-sort-key"),_=!h.isConstant(),g=[];for(const{feature:v,id:w,index:M,sourceLayerIndex:C}of t){const A=this.layers[0]._featureFilter.needGeometry,R=Ca(v,A);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),R,o))continue;const k=_?h.evaluate(R,{},o):void 0,O={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:A?R.geometry:js(v),patterns:{},sortKey:k};g.push(O)}_&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:M,sourceLayerIndex:C}=v;if(this.hasPattern){const A=ic("line",this.layers,v,this.zoom,a);this.patternFeatures.push(A)}else this.addFeature(v,w,M,o,{},a.subdivisionGranularity);a.featureIndex.insert(t[M].feature,w,M,C,this.index)}}update(t,a,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,o)}addFeatures(t,a,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,a,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,dn)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,o,h,_,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),M=v.get("line-cap"),C=v.get("line-miter-limit"),A=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of a)this.addLine(R,t,w,M,C,A,h,g);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,h)}addLine(t,a,o,h,_,g,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ul(t,v?w.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<t.length-1;J++)this.totalDistance+=t[J].dist(t[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Hf[a.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let A=0;for(;A<C-1&&t[A].equals(t[A+1]);)A++;if(C<(M?3:2))return;o==="bevel"&&(_=1.05);const R=this.overscaling<=16?15*qe/(512*this.overscaling):0,k=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let O,U,q,Q,oe;this.e1=this.e2=-1,M&&(O=t[C-2],oe=t[A].sub(O)._unit()._perp());for(let J=A;J<C;J++){if(q=J===C-1?M?t[A+1]:void 0:t[J+1],q&&t[J].equals(q))continue;oe&&(Q=oe),O&&(U=O),O=t[J],oe=q?q.sub(O)._unit()._perp():Q,Q=Q||oe;let L=Q.add(oe);L.x===0&&L.y===0||L._unit();const Z=Q.x*oe.x+Q.y*oe.y,ee=L.x*oe.x+L.y*oe.y,ve=ee!==0?1/ee:1/0,je=2*Math.sqrt(2-2*ee),Se=ee<$f&&U&&q,Ae=Q.x*oe.y-Q.y*oe.x>0;if(Se&&J>A){const Ge=O.dist(U);if(Ge>2*R){const Re=O.sub(O.sub(U)._mult(R/Ge)._round());this.updateDistance(U,Re),this.addCurrentVertex(Re,Q,0,0,k),U=Re}}const Ze=U&&q;let Ue=Ze?o:M?"butt":h;if(Ze&&Ue==="round"&&(ve<g?Ue="miter":ve<=2&&(Ue="fakeround")),Ue==="miter"&&ve>_&&(Ue="bevel"),Ue==="bevel"&&(ve>2&&(Ue="flipbevel"),ve<_&&(Ue="miter")),U&&this.updateDistance(U,O),Ue==="miter")L._mult(ve),this.addCurrentVertex(O,L,0,0,k);else if(Ue==="flipbevel"){if(ve>100)L=oe.mult(-1);else{const Ge=ve*Q.add(oe).mag()/Q.sub(oe).mag();L._perp()._mult(Ge*(Ae?-1:1))}this.addCurrentVertex(O,L,0,0,k),this.addCurrentVertex(O,L.mult(-1),0,0,k)}else if(Ue==="bevel"||Ue==="fakeround"){const Ge=-Math.sqrt(ve*ve-1),Re=Ae?Ge:0,tt=Ae?0:Ge;if(U&&this.addCurrentVertex(O,Q,Re,tt,k),Ue==="fakeround"){const gt=Math.round(180*je/Math.PI/20);for(let pt=1;pt<gt;pt++){let nt=pt/gt;if(nt!==.5){const Ui=nt-.5;nt+=nt*Ui*(nt-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*Ui*Ui+(.848013+Z*(.215638*Z-1.06021)))}const Ut=oe.sub(Q)._mult(nt)._add(Q)._unit()._mult(Ae?-1:1);this.addHalfVertex(O,Ut.x,Ut.y,!1,Ae,0,k)}}q&&this.addCurrentVertex(O,oe,-Re,-tt,k)}else if(Ue==="butt")this.addCurrentVertex(O,L,0,0,k);else if(Ue==="square"){const Ge=U?1:-1;this.addCurrentVertex(O,L,Ge,Ge,k)}else Ue==="round"&&(U&&(this.addCurrentVertex(O,Q,0,0,k),this.addCurrentVertex(O,Q,1,1,k,!0)),q&&(this.addCurrentVertex(O,oe,-1,-1,k,!0),this.addCurrentVertex(O,oe,0,0,k)));if(Se&&J<C-1){const Ge=O.dist(q);if(Ge>2*R){const Re=O.add(q.sub(O)._mult(R/Ge)._round());this.updateDistance(O,Re),this.addCurrentVertex(Re,oe,0,0,k),O=Re}}}}addCurrentVertex(t,a,o,h,_,g=!1){const v=a.y*h-a.x,w=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*o,a.y-a.x*o,g,!1,o,_),this.addHalfVertex(t,v,w,g,!0,-h,_),this.distance>Bd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,o,h,_,g))}addHalfVertex({x:t,y:a},o,h,_,g,v,w){const M=.5*(this.lineClips?this.scaledDistance*(Bd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(a<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),w.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}let Ef,nn;Ke("LineBucket",Od,{omit:["layers","patternFeatures"]});var Di={get paint(){return nn=nn||new na({"line-opacity":new ft(P.paint_line["line-opacity"]),"line-color":new ft(P.paint_line["line-color"]),"line-translate":new ct(P.paint_line["line-translate"]),"line-translate-anchor":new ct(P.paint_line["line-translate-anchor"]),"line-width":new ft(P.paint_line["line-width"]),"line-gap-width":new ft(P.paint_line["line-gap-width"]),"line-offset":new ft(P.paint_line["line-offset"]),"line-blur":new ft(P.paint_line["line-blur"]),"line-dasharray":new Fi(P.paint_line["line-dasharray"]),"line-pattern":new Xl(P.paint_line["line-pattern"]),"line-gradient":new Yl(P.paint_line["line-gradient"])})},get layout(){return Ef=Ef||new na({"line-cap":new ct(P.layout_line["line-cap"]),"line-join":new ft(P.layout_line["line-join"]),"line-miter-limit":new ct(P.layout_line["line-miter-limit"]),"line-round-limit":new ct(P.layout_line["line-round-limit"]),"line-sort-key":new ft(P.layout_line["line-sort-key"])})}};class Jt extends ft{possiblyEvaluate(t,a){return a=new Ei(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,o,h){return a=Ct({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,o,h)}}let ei;class Ni extends Tr{constructor(t){super(t,Di),this.gradientVersion=0,ei||(ei=new Jt(Di.paint.properties["line-width"].specification),ei.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof Or,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=ei.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Od(t)}queryRadius(t){const a=t,o=lr(tu("line-width",this,a),tu("line-gap-width",this,a)),h=tu("line-offset",this,a);return o/2+Math.abs(h)+iu(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:o,geometry:h,transform:_,pixelsToTileUnits:g}){const v=Hu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,g),w=g/2*lr(this.paint.get("line-width").evaluate(a,o),this.paint.get("line-gap-width").evaluate(a,o)),M=this.paint.get("line-offset").evaluate(a,o);return M&&(h=function(C,A){const R=[];for(let k=0;k<C.length;k++){const O=C[k],U=[];for(let q=0;q<O.length;q++){const Q=O[q-1],oe=O[q],J=O[q+1],L=q===0?new at(0,0):oe.sub(Q)._unit()._perp(),Z=q===O.length-1?new at(0,0):J.sub(oe)._unit()._perp(),ee=L._add(Z)._unit(),ve=ee.x*Z.x+ee.y*Z.y;ve!==0&&ee._mult(1/ve),U.push(ee._mult(A)._add(oe))}R.push(U)}return R}(h,M*g)),function(C,A,R){for(let k=0;k<A.length;k++){const O=A[k];if(C.length>=3){for(let U=0;U<O.length;U++)if(il(C,O[U]))return!0}if(pf(C,O,R))return!0}return!1}(v,h,w)}isTileClipped(){return!0}}function lr(r,t){return t>0?t+2*r:r}const So=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lu=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fd=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qs=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wn=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ml(r,t,a){return r.sections.forEach(o=>{o.text=function(h,_,g){const v=_.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),wr.applyArabicShaping&&(h=wr.applyArabicShaping(h)),h}(o.text,t,a)}),r}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const fs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Vh,cr,cc,Xi=24,$r={};function jd(){return Vh||(Vh=1,$r.read=function(r,t,a,o,h){var _,g,v=8*h-o-1,w=(1<<v)-1,M=w>>1,C=-7,A=a?h-1:0,R=a?-1:1,k=r[t+A];for(A+=R,_=k&(1<<-C)-1,k>>=-C,C+=v;C>0;_=256*_+r[t+A],A+=R,C-=8);for(g=_&(1<<-C)-1,_>>=-C,C+=o;C>0;g=256*g+r[t+A],A+=R,C-=8);if(_===0)_=1-M;else{if(_===w)return g?NaN:1/0*(k?-1:1);g+=Math.pow(2,o),_-=M}return(k?-1:1)*g*Math.pow(2,_-o)},$r.write=function(r,t,a,o,h,_){var g,v,w,M=8*_-h-1,C=(1<<M)-1,A=C>>1,R=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=o?0:_-1,O=o?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=C):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+A>=1?R/w:R*Math.pow(2,1-A))*w>=2&&(g++,w/=2),g+A>=C?(v=0,g=C):g+A>=1?(v=(t*w-1)*Math.pow(2,h),g+=A):(v=t*Math.pow(2,A-1)*Math.pow(2,h),g=0));h>=8;r[a+k]=255&v,k+=O,v/=256,h-=8);for(g=g<<h|v,M+=h;M>0;r[a+k]=255&g,k+=O,g/=256,M-=8);r[a+k-O]|=128*U}),$r}function Zh(){if(cc)return cr;cc=1,cr=t;var r=jd();function t(L){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(L)?L:new Uint8Array(L||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var a=4294967296,o=1/a,h=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function _(L){return L.type===t.Bytes?L.readVarint()+L.pos:L.pos+1}function g(L,Z,ee){return ee?4294967296*Z+(L>>>0):4294967296*(Z>>>0)+(L>>>0)}function v(L,Z,ee){var ve=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));ee.realloc(ve);for(var je=ee.pos-1;je>=L;je--)ee.buf[je+ve]=ee.buf[je]}function w(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeVarint(L[ee])}function M(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeSVarint(L[ee])}function C(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeFloat(L[ee])}function A(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeDouble(L[ee])}function R(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeBoolean(L[ee])}function k(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeFixed32(L[ee])}function O(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeSFixed32(L[ee])}function U(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeFixed64(L[ee])}function q(L,Z){for(var ee=0;ee<L.length;ee++)Z.writeSFixed64(L[ee])}function Q(L,Z){return(L[Z]|L[Z+1]<<8|L[Z+2]<<16)+16777216*L[Z+3]}function oe(L,Z,ee){L[ee]=Z,L[ee+1]=Z>>>8,L[ee+2]=Z>>>16,L[ee+3]=Z>>>24}function J(L,Z){return(L[Z]|L[Z+1]<<8|L[Z+2]<<16)+(L[Z+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(L,Z,ee){for(ee=ee||this.length;this.pos<ee;){var ve=this.readVarint(),je=ve>>3,Se=this.pos;this.type=7&ve,L(je,Z,this),this.pos===Se&&this.skip(ve)}return Z},readMessage:function(L,Z){return this.readFields(L,Z,this.readVarint()+this.pos)},readFixed32:function(){var L=Q(this.buf,this.pos);return this.pos+=4,L},readSFixed32:function(){var L=J(this.buf,this.pos);return this.pos+=4,L},readFixed64:function(){var L=Q(this.buf,this.pos)+Q(this.buf,this.pos+4)*a;return this.pos+=8,L},readSFixed64:function(){var L=Q(this.buf,this.pos)+J(this.buf,this.pos+4)*a;return this.pos+=8,L},readFloat:function(){var L=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,L},readDouble:function(){var L=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,L},readVarint:function(L){var Z,ee,ve=this.buf;return Z=127&(ee=ve[this.pos++]),ee<128?Z:(Z|=(127&(ee=ve[this.pos++]))<<7,ee<128?Z:(Z|=(127&(ee=ve[this.pos++]))<<14,ee<128?Z:(Z|=(127&(ee=ve[this.pos++]))<<21,ee<128?Z:function(je,Se,Ae){var Ze,Ue,Ge=Ae.buf;if(Ze=(112&(Ue=Ge[Ae.pos++]))>>4,Ue<128||(Ze|=(127&(Ue=Ge[Ae.pos++]))<<3,Ue<128)||(Ze|=(127&(Ue=Ge[Ae.pos++]))<<10,Ue<128)||(Ze|=(127&(Ue=Ge[Ae.pos++]))<<17,Ue<128)||(Ze|=(127&(Ue=Ge[Ae.pos++]))<<24,Ue<128)||(Ze|=(1&(Ue=Ge[Ae.pos++]))<<31,Ue<128))return g(je,Ze,Se);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(ee=ve[this.pos]))<<28,L,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var L=this.readVarint();return L%2==1?(L+1)/-2:L/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var L=this.readVarint()+this.pos,Z=this.pos;return this.pos=L,L-Z>=12&&h?function(ee,ve,je){return h.decode(ee.subarray(ve,je))}(this.buf,Z,L):function(ee,ve,je){for(var Se="",Ae=ve;Ae<je;){var Ze,Ue,Ge,Re=ee[Ae],tt=null,gt=Re>239?4:Re>223?3:Re>191?2:1;if(Ae+gt>je)break;gt===1?Re<128&&(tt=Re):gt===2?(192&(Ze=ee[Ae+1]))==128&&(tt=(31&Re)<<6|63&Ze)<=127&&(tt=null):gt===3?(Ue=ee[Ae+2],(192&(Ze=ee[Ae+1]))==128&&(192&Ue)==128&&((tt=(15&Re)<<12|(63&Ze)<<6|63&Ue)<=2047||tt>=55296&&tt<=57343)&&(tt=null)):gt===4&&(Ue=ee[Ae+2],Ge=ee[Ae+3],(192&(Ze=ee[Ae+1]))==128&&(192&Ue)==128&&(192&Ge)==128&&((tt=(15&Re)<<18|(63&Ze)<<12|(63&Ue)<<6|63&Ge)<=65535||tt>=1114112)&&(tt=null)),tt===null?(tt=65533,gt=1):tt>65535&&(tt-=65536,Se+=String.fromCharCode(tt>>>10&1023|55296),tt=56320|1023&tt),Se+=String.fromCharCode(tt),Ae+=gt}return Se}(this.buf,Z,L)},readBytes:function(){var L=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,L);return this.pos=L,Z},readPackedVarint:function(L,Z){if(this.type!==t.Bytes)return L.push(this.readVarint(Z));var ee=_(this);for(L=L||[];this.pos<ee;)L.push(this.readVarint(Z));return L},readPackedSVarint:function(L){if(this.type!==t.Bytes)return L.push(this.readSVarint());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readSVarint());return L},readPackedBoolean:function(L){if(this.type!==t.Bytes)return L.push(this.readBoolean());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readBoolean());return L},readPackedFloat:function(L){if(this.type!==t.Bytes)return L.push(this.readFloat());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readFloat());return L},readPackedDouble:function(L){if(this.type!==t.Bytes)return L.push(this.readDouble());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readDouble());return L},readPackedFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed32());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readFixed32());return L},readPackedSFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed32());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readSFixed32());return L},readPackedFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed64());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readFixed64());return L},readPackedSFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed64());var Z=_(this);for(L=L||[];this.pos<Z;)L.push(this.readSFixed64());return L},skip:function(L){var Z=7&L;if(Z===t.Varint)for(;this.buf[this.pos++]>127;);else if(Z===t.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===t.Fixed32)this.pos+=4;else{if(Z!==t.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(L,Z){this.writeVarint(L<<3|Z)},realloc:function(L){for(var Z=this.length||16;Z<this.pos+L;)Z*=2;if(Z!==this.length){var ee=new Uint8Array(Z);ee.set(this.buf),this.buf=ee,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(L){this.realloc(4),oe(this.buf,L,this.pos),this.pos+=4},writeSFixed32:function(L){this.realloc(4),oe(this.buf,L,this.pos),this.pos+=4},writeFixed64:function(L){this.realloc(8),oe(this.buf,-1&L,this.pos),oe(this.buf,Math.floor(L*o),this.pos+4),this.pos+=8},writeSFixed64:function(L){this.realloc(8),oe(this.buf,-1&L,this.pos),oe(this.buf,Math.floor(L*o),this.pos+4),this.pos+=8},writeVarint:function(L){(L=+L||0)>268435455||L<0?function(Z,ee){var ve,je;if(Z>=0?(ve=Z%4294967296|0,je=Z/4294967296|0):(je=~(-Z/4294967296),4294967295^(ve=~(-Z%4294967296))?ve=ve+1|0:(ve=0,je=je+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ee.realloc(10),function(Se,Ae,Ze){Ze.buf[Ze.pos++]=127&Se|128,Se>>>=7,Ze.buf[Ze.pos++]=127&Se|128,Se>>>=7,Ze.buf[Ze.pos++]=127&Se|128,Se>>>=7,Ze.buf[Ze.pos++]=127&Se|128,Ze.buf[Ze.pos]=127&(Se>>>=7)}(ve,0,ee),function(Se,Ae){var Ze=(7&Se)<<4;Ae.buf[Ae.pos++]|=Ze|((Se>>>=3)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se)))))}(je,ee)}(L,this):(this.realloc(4),this.buf[this.pos++]=127&L|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=L>>>7&127))))},writeSVarint:function(L){this.writeVarint(L<0?2*-L-1:2*L)},writeBoolean:function(L){this.writeVarint(!!L)},writeString:function(L){L=String(L),this.realloc(4*L.length),this.pos++;var Z=this.pos;this.pos=function(ve,je,Se){for(var Ae,Ze,Ue=0;Ue<je.length;Ue++){if((Ae=je.charCodeAt(Ue))>55295&&Ae<57344){if(!Ze){Ae>56319||Ue+1===je.length?(ve[Se++]=239,ve[Se++]=191,ve[Se++]=189):Ze=Ae;continue}if(Ae<56320){ve[Se++]=239,ve[Se++]=191,ve[Se++]=189,Ze=Ae;continue}Ae=Ze-55296<<10|Ae-56320|65536,Ze=null}else Ze&&(ve[Se++]=239,ve[Se++]=191,ve[Se++]=189,Ze=null);Ae<128?ve[Se++]=Ae:(Ae<2048?ve[Se++]=Ae>>6|192:(Ae<65536?ve[Se++]=Ae>>12|224:(ve[Se++]=Ae>>18|240,ve[Se++]=Ae>>12&63|128),ve[Se++]=Ae>>6&63|128),ve[Se++]=63&Ae|128)}return Se}(this.buf,L,this.pos);var ee=this.pos-Z;ee>=128&&v(Z,ee,this),this.pos=Z-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(L){this.realloc(4),r.write(this.buf,L,this.pos,!0,23,4),this.pos+=4},writeDouble:function(L){this.realloc(8),r.write(this.buf,L,this.pos,!0,52,8),this.pos+=8},writeBytes:function(L){var Z=L.length;this.writeVarint(Z),this.realloc(Z);for(var ee=0;ee<Z;ee++)this.buf[this.pos++]=L[ee]},writeRawMessage:function(L,Z){this.pos++;var ee=this.pos;L(Z,this);var ve=this.pos-ee;ve>=128&&v(ee,ve,this),this.pos=ee-1,this.writeVarint(ve),this.pos+=ve},writeMessage:function(L,Z,ee){this.writeTag(L,t.Bytes),this.writeRawMessage(Z,ee)},writePackedVarint:function(L,Z){Z.length&&this.writeMessage(L,w,Z)},writePackedSVarint:function(L,Z){Z.length&&this.writeMessage(L,M,Z)},writePackedBoolean:function(L,Z){Z.length&&this.writeMessage(L,R,Z)},writePackedFloat:function(L,Z){Z.length&&this.writeMessage(L,C,Z)},writePackedDouble:function(L,Z){Z.length&&this.writeMessage(L,A,Z)},writePackedFixed32:function(L,Z){Z.length&&this.writeMessage(L,k,Z)},writePackedSFixed32:function(L,Z){Z.length&&this.writeMessage(L,O,Z)},writePackedFixed64:function(L,Z){Z.length&&this.writeMessage(L,U,Z)},writePackedSFixed64:function(L,Z){Z.length&&this.writeMessage(L,q,Z)},writeBytesField:function(L,Z){this.writeTag(L,t.Bytes),this.writeBytes(Z)},writeFixed32Field:function(L,Z){this.writeTag(L,t.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(L,Z){this.writeTag(L,t.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(L,Z){this.writeTag(L,t.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(L,Z){this.writeTag(L,t.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(L,Z){this.writeTag(L,t.Varint),this.writeVarint(Z)},writeSVarintField:function(L,Z){this.writeTag(L,t.Varint),this.writeSVarint(Z)},writeStringField:function(L,Z){this.writeTag(L,t.Bytes),this.writeString(Z)},writeFloatField:function(L,Z){this.writeTag(L,t.Fixed32),this.writeFloat(Z)},writeDoubleField:function(L,Z){this.writeTag(L,t.Fixed64),this.writeDouble(Z)},writeBooleanField:function(L,Z){this.writeVarintField(L,!!Z)}},cr}var cu=ot(Zh());const uu=3;function _l(r,t,a){r===1&&a.readMessage(Gh,t)}function Gh(r,t,a){if(r===3){const{id:o,bitmap:h,width:_,height:g,left:v,top:w,advance:M}=a.readMessage(uc,{});t.push({id:o,bitmap:new go({width:_+2*uu,height:g+2*uu},h),metrics:{width:_,height:g,left:v,top:w,advance:M}})}}function uc(r,t,a){r===1?t.id=a.readVarint():r===2?t.bitmap=a.readBytes():r===3?t.width=a.readVarint():r===4?t.height=a.readVarint():r===5?t.left=a.readSVarint():r===6?t.top=a.readSVarint():r===7&&(t.advance=a.readVarint())}const nh=uu;function qh(r){let t=0,a=0;for(const g of r)t+=g.w*g.h,a=Math.max(a,g.w);r.sort((g,v)=>v.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let h=0,_=0;for(const g of r)for(let v=o.length-1;v>=0;v--){const w=o[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,_=Math.max(_,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const M=o.pop();v<o.length&&(o[v]=M)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(o.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:_,fill:t/(h*_)||0}}const va=1;class hc{constructor(t,{pixelRatio:a,version:o,stretchX:h,stretchY:_,content:g,textFitWidth:v,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=h,this.stretchY=_,this.content=g,this.version=o,this.textFitWidth=v,this.textFitHeight=w}get tl(){return[this.paddedRect.x+va,this.paddedRect.y+va]}get br(){return[this.paddedRect.x+this.paddedRect.w-va,this.paddedRect.y+this.paddedRect.h-va]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*va)/this.pixelRatio,(this.paddedRect.h-2*va)/this.pixelRatio]}}class Hh{constructor(t,a){const o={},h={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,o,_),this.addImages(a,h,_);const{w:g,h:v}=qh(_),w=new Aa({width:g||1,height:v||1});for(const M in t){const C=t[M],A=o[M].paddedRect;Aa.copy(C.data,w,{x:0,y:0},{x:A.x+va,y:A.y+va},C.data)}for(const M in a){const C=a[M],A=h[M].paddedRect,R=A.x+va,k=A.y+va,O=C.data.width,U=C.data.height;Aa.copy(C.data,w,{x:0,y:0},{x:R,y:k},C.data),Aa.copy(C.data,w,{x:0,y:U-1},{x:R,y:k-1},{width:O,height:1}),Aa.copy(C.data,w,{x:0,y:0},{x:R,y:k+U},{width:O,height:1}),Aa.copy(C.data,w,{x:O-1,y:0},{x:R-1,y:k},{width:1,height:U}),Aa.copy(C.data,w,{x:0,y:0},{x:R+O,y:k},{width:1,height:U})}this.image=w,this.iconPositions=o,this.patternPositions=h}addImages(t,a,o){for(const h in t){const _=t[h],g={x:0,y:0,w:_.data.width+2*va,h:_.data.height+2*va};o.push(g),a[h]=new hc(g,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),a),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),a)}patchUpdatedImage(t,a,o){if(!t||!a||t.version===a.version)return;t.version=a.version;const[h,_]=t.tl;o.update(a.data,void 0,{x:h,y:_})}}var Fn;Ke("ImagePosition",hc),Ke("ImageAtlas",Hh),F.ag=void 0,(Fn=F.ag||(F.ag={}))[Fn.none=0]="none",Fn[Fn.horizontal=1]="horizontal",Fn[Fn.vertical=2]="vertical",Fn[Fn.horizontalOnly=3]="horizontalOnly";const ah=-17;class Jn{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,a,o){const h=new Jn;return h.scale=t||1,h.fontStack=a,h.verticalAlign=o||"bottom",h}static forImage(t,a){const o=new Jn;return o.imageName=t,o.verticalAlign=a||"bottom",o}}class dc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const o=new dc;for(let h=0;h<t.sections.length;h++){const _=t.sections[h];_.image?o.addImageSection(_):o.addTextSection(_,a)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let a="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,_=t.charCodeAt(o-1)||null;a+=h&&Yc(h)&&!fs[t[o+1]]||_&&Yc(_)&&!fs[t[o-1]]||!fs[t[o]]?t[o]:fs[t[o]]}return a}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&rh[this.text.charCodeAt(o)];o++)t++;let a=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&rh[this.text.charCodeAt(o)];o--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const o=new dc;return o.text=this.text.substring(t,a),o.sectionIndex=this.sectionIndex.slice(t,a),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}getMaxImageSize(t){let a=0,o=0;for(let h=0;h<this.length();h++){const _=this.getSection(h);if(_.imageName){const g=t[_.imageName];if(!g)continue;const v=g.displaySize;a=Math.max(a,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:a,maxImageHeight:o}}addTextSection(t,a){this.text+=t.text,this.sections.push(Jn.forText(t.scale,t.fontStack||a,t.verticalAlign));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void Ci("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Jn.forImage(a,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hu(r,t,a,o,h,_,g,v,w,M,C,A,R,k,O){const U=dc.fromFeature(r,h);let q;A===F.ag.vertical&&U.verticalizePunctuation();const{processBidirectionalText:Q,processStyledBidirectionalText:oe}=wr;if(Q&&U.sections.length===1){q=[];const Z=Q(U.toString(),Xh(U,M,_,t,o,k));for(const ee of Z){const ve=new dc;ve.text=ee,ve.sections=U.sections;for(let je=0;je<ee.length;je++)ve.sectionIndex.push(0);q.push(ve)}}else if(oe){q=[];const Z=oe(U.text,U.sectionIndex,Xh(U,M,_,t,o,k));for(const ee of Z){const ve=new dc;ve.text=ee[0],ve.sectionIndex=ee[1],ve.sections=U.sections,q.push(ve)}}else q=function(Z,ee){const ve=[],je=Z.text;let Se=0;for(const Ae of ee)ve.push(Z.substring(Se,Ae)),Se=Ae;return Se<je.length&&ve.push(Z.substring(Se,je.length)),ve}(U,Xh(U,M,_,t,o,k));const J=[],L={positionedLines:J,text:U.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(Z,ee,ve,je,Se,Ae,Ze,Ue,Ge,Re,tt,gt){let pt=0,nt=0,Ut=0,Ui=0;const fn=Ue==="right"?1:Ue==="left"?0:.5,Yi=Xi/gt;let Nn=0;for(const vi of Se){vi.trim();const Ri=vi.getMaxScale(),ea={positionedGlyphs:[],lineOffset:0};Z.positionedLines[Nn]=ea;const Un=ea.positionedGlyphs;let Vn=0;if(!vi.length()){nt+=Ae,++Nn;continue}const Pr=Vd(je,vi,Yi);for(let sa=0;sa<vi.length();sa++){const Sn=vi.getSection(sa),Zn=vi.getSectionIndex(sa),mn=vi.getCharCode(sa),Qi=Yf(Ge,tt,mn);let Si;if(Sn.imageName){if(Z.iconsInText=!0,Sn.scale=Sn.scale*Yi,Si=Af(Sn,Qi,Ri,Pr,je),!Si)continue;Vn=Math.max(Vn,Si.imageOffset)}else if(Si=Qf(Sn,mn,Qi,Pr,ee,ve),!Si)continue;const{rect:$a,metrics:Tl,baselineOffset:hr}=Si;Un.push({glyph:mn,imageName:Sn.imageName,x:pt,y:nt+hr+ah,vertical:Qi,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:Zn,metrics:Tl,rect:$a}),Qi?(Z.verticalizable=!0,pt+=(Sn.imageName?Tl.advance:Xi)*Sn.scale+Re):pt+=Tl.advance*Sn.scale+Re}Un.length!==0&&(Ut=Math.max(pt-Re,Ut),zf(Un,0,Un.length-1,fn)),pt=0,ea.lineOffset=Math.max(Vn,(Ri-1)*Xi);const In=Ae*Ri+Vn;nt+=In,Ui=Math.max(In,Ui),++Nn}const{horizontalAlign:Tn,verticalAlign:pn}=oh(Ze);(function(vi,Ri,ea,Un,Vn,Pr,In,sa,Sn){const Zn=(Ri-ea)*Vn;let mn=0;mn=Pr!==In?-sa*Un-ah:-Un*Sn*In+.5*In;for(const Qi of vi)for(const Si of Qi.positionedGlyphs)Si.x+=Zn,Si.y+=mn})(Z.positionedLines,fn,Tn,pn,Ut,Ui,Ae,nt,Se.length),Z.top+=-pn*nt,Z.bottom=Z.top+nt,Z.left+=-Tn*Ut,Z.right=Z.left+Ut}(L,t,a,o,q,g,v,w,A,M,R,O),!function(Z){for(const ee of Z)if(ee.positionedGlyphs.length!==0)return!1;return!0}(J)&&L}const rh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Mo={40:!0};function sh(r,t,a,o,h,_){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*Xi/_+h:0}{const g=a[t.fontStack],v=g&&g[r];return v?v.metrics.advance*t.scale+h:0}}function $h(r,t,a,o){const h=Math.pow(r-t,2);return o?r<t?h/2:2*h:h+Math.abs(a)*a}function du(r,t,a){let o=0;return r===10&&(o-=1e4),a&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Nd(r,t,a,o,h,_){let g=null,v=$h(t,a,h,_);for(const w of o){const M=$h(t-w.x,a,h,_)+w.badness;M<=v&&(g=w,v=M)}return{index:r,x:t,priorBreak:g,badness:v}}function Ud(r){return r?Ud(r.priorBreak).concat(r.index):[]}function Xh(r,t,a,o,h,_){if(!r)return[];const g=[],v=function(A,R,k,O,U,q){let Q=0;for(let oe=0;oe<A.length();oe++){const J=A.getSection(oe);Q+=sh(A.getCharCode(oe),J,O,U,R,q)}return Q/Math.max(1,Math.ceil(Q/k))}(r,t,a,o,h,_),w=r.text.indexOf("​")>=0;let M=0;for(let A=0;A<r.length();A++){const R=r.getSection(A),k=r.getCharCode(A);if(rh[k]||(M+=sh(k,R,o,h,t,_)),A<r.length()-1){const O=!((C=k)<11904)&&(!!yt["CJK Compatibility Forms"](C)||!!yt["CJK Compatibility"](C)||!!yt["CJK Strokes"](C)||!!yt["CJK Symbols and Punctuation"](C)||!!yt["Enclosed CJK Letters and Months"](C)||!!yt["Halfwidth and Fullwidth Forms"](C)||!!yt["Ideographic Description Characters"](C)||!!yt["Vertical Forms"](C)||Rs.test(String.fromCodePoint(C)));(Xf[k]||O||R.imageName||A!==r.length()-2&&Mo[r.getCharCode(A+1)])&&g.push(Nd(A+1,M,v,g,du(k,r.getCharCode(A+1),O&&w),!1))}}var C;return Ud(Nd(r.length(),M,v,g,0,!0))}function oh(r){let t=.5,a=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function Vd(r,t,a){const o=t.getMaxScale()*Xi,{maxImageWidth:h,maxImageHeight:_}=t.getMaxImageSize(r),g=Math.max(o,_*a);return{verticalLineContentWidth:Math.max(o,h*a),horizontalLineContentHeight:g}}function Cf(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function Yf(r,t,a){return!(r===F.ag.horizontal||!t&&!ju(a)||t&&(rh[a]||(o=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Qf(r,t,a,o,h,_){const g=_[r.fontStack],v=function(M,C,A,R){if(M&&M.rect)return M;const k=C[A.fontStack],O=k&&k[R];return O?{rect:null,metrics:O.metrics}:null}(g&&g[t],h,r,t);if(v===null)return null;let w;if(a)w=o.verticalLineContentWidth-r.scale*Xi;else{const M=Cf(r.verticalAlign);w=(o.horizontalLineContentHeight-r.scale*Xi)*M}return{rect:v.rect,metrics:v.metrics,baselineOffset:w}}function Af(r,t,a,o,h){const _=h[r.imageName];if(!_)return null;const g=_.paddedRect,v=_.displaySize,w={width:v[0],height:v[1],left:va,top:-3,advance:t?v[1]:v[0]};let M;if(t)M=o.verticalLineContentWidth-v[1]*r.scale;else{const C=Cf(r.verticalAlign);M=(o.horizontalLineContentHeight-v[1]*r.scale)*C}return{rect:g,metrics:w,baselineOffset:M,imageOffset:(t?v[0]:v[1])*r.scale-Xi*a}}function zf(r,t,a,o){if(o===0)return;const h=r[a],_=(r[a].x+h.metrics.advance*h.scale)*o;for(let g=t;g<=a;g++)r[g].x-=_}function fu(r,t,a){const{horizontalAlign:o,verticalAlign:h}=oh(a),_=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*h;return{image:r,top:g,bottom:g+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function lh(r){var t,a;let o=r.left,h=r.top,_=r.right-o,g=r.bottom-h;const v=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(a=r.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",M=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(w==="proportional"){if(v==="stretchOnly"&&_/g<M||v==="proportional"){const C=Math.ceil(g*M);o*=C/_,_=C}}else if(v==="proportional"&&w==="stretchOnly"&&M!==0&&_/g>M){const C=Math.ceil(_/M);h*=C/g,g=C}return{x1:o,y1:h,x2:o+_,y2:h+g}}function Zd(r,t,a,o,h,_){const g=r.image;let v;if(g.content){const q=g.content,Q=g.pixelRatio||1;v=[q[0]/Q,q[1]/Q,g.displaySize[0]-q[2]/Q,g.displaySize[1]-q[3]/Q]}const w=t.left*_,M=t.right*_;let C,A,R,k;a==="width"||a==="both"?(k=h[0]+w-o[3],A=h[0]+M+o[1]):(k=h[0]+(w+M-g.displaySize[0])/2,A=k+g.displaySize[0]);const O=t.top*_,U=t.bottom*_;return a==="height"||a==="both"?(C=h[1]+O-o[0],R=h[1]+U+o[2]):(C=h[1]+(O+U-g.displaySize[1])/2,R=C+g.displaySize[1]),{image:g,top:C,right:A,bottom:R,left:k,collisionPadding:v}}const pu=255,Hs=128,Eo=pu*Hs;function fc(r,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Ei(r+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=a;let _=0;for(;_<o.length&&o[_]<=r;)_++;_=Math.max(0,_-1);let g=_;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const v=o[_],w=o[g];return a.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:a.evaluate(new Ei(v)),maxSize:a.evaluate(new Ei(w)),interpolationType:h}}}function Yh(r,t,a){let o="never";const h=r.get(t);return h?o=h:r.get(a)&&(o="always"),o}const Ii=dl.VectorTileFeature.types,Gd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qh(r,t,a,o,h,_,g,v,w,M,C,A,R){const k=v?Math.min(Eo,Math.round(v[0])):0,O=v?Math.min(Eo,Math.round(v[1])):0;r.emplaceBack(t,a,Math.round(32*o),Math.round(32*h),_,g,(k<<1)+(w?1:0),O,16*M,16*C,256*A,256*R)}function Kh(r,t,a){r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a)}function Kf(r){for(const t of r.sections)if(Kc(t.text))return!0;return!1}class qd{constructor(t){this.layoutVertexArray=new ye,this.indexArray=new Ye,this.programConfigurations=t,this.segments=new dt,this.dynamicLayoutVertexArray=new we,this.opacityVertexArray=new De,this.hasVisibleVertices=!1,this.placedSymbolArray=new T}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,So.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,lu.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Gd,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke("SymbolBuffers",qd);class Hd{constructor(t,a,o){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new o,this.segments=new dt,this.collisionVertexArray=new ze}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Fd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ke("CollisionBuffers",Hd);class Co{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fc(this.zoom,a["text-size"]),this.iconSizeData=fc(this.zoom,a["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),_=o.get("symbol-z-order");this.canOverlap=Yh(o,"text-overlap","text-allow-overlap")!=="never"||Yh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>F.ag[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new qd(new _o(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qd(new _o(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new D,this.lineVertexArray=new I,this.symbolInstances=new z,this.textAnchorOffsets=new N}calculateGlyphDependencies(t,a,o,h,_){for(let g=0;g<t.length;g++)if(a[t.charCodeAt(g)]=!0,(o||h)&&_){const v=fs[t.charAt(g)];v&&(a[v.charCodeAt(0)]=!0)}}populate(t,a,o){const h=this.layers[0],_=h.layout,g=_.get("text-font"),v=_.get("text-field"),w=_.get("icon-image"),M=(v.value.kind!=="constant"||v.value.value instanceof Ji&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,A=_.get("symbol-sort-key");if(this.features=[],!M&&!C)return;const R=a.iconDependencies,k=a.glyphDependencies,O=a.availableImages,U=new Ei(this.zoom);for(const{feature:q,id:Q,index:oe,sourceLayerIndex:J}of t){const L=h._featureFilter.needGeometry,Z=Ca(q,L);if(!h._featureFilter.filter(U,Z,o))continue;let ee,ve;if(L||(Z.geometry=js(q)),M){const Se=h.getValueAndResolveTokens("text-field",Z,o,O),Ae=Ji.factory(Se),Ze=this.hasRTLText=this.hasRTLText||Kf(Ae);(!Ze||wr.getRTLTextPluginStatus()==="unavailable"||Ze&&wr.isParsed())&&(ee=ml(Ae,h,Z))}if(C){const Se=h.getValueAndResolveTokens("icon-image",Z,o,O);ve=Se instanceof ha?Se:ha.fromString(Se)}if(!ee&&!ve)continue;const je=this.sortFeaturesByKey?A.evaluate(Z,{},o):void 0;if(this.features.push({id:Q,text:ee,icon:ve,index:oe,sourceLayerIndex:J,geometry:Z.geometry,properties:q.properties,type:Ii[q.type],sortKey:je}),ve&&(R[ve.name]=!0),ee){const Se=g.evaluate(Z,{},o).join(","),Ae=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(F.ag.vertical)>=0;for(const Ze of ee.sections)if(Ze.image)R[Ze.image.name]=!0;else{const Ue=Ko(ee.toString()),Ge=Ze.fontStack||Se,Re=k[Ge]=k[Ge]||{};this.calculateGlyphDependencies(Ze.text,Re,Ae,this.allowVerticalPlacement,Ue)}}}_.get("symbol-placement")==="line"&&(this.features=function(q){const Q={},oe={},J=[];let L=0;function Z(Se){J.push(q[Se]),L++}function ee(Se,Ae,Ze){const Ue=oe[Se];return delete oe[Se],oe[Ae]=Ue,J[Ue].geometry[0].pop(),J[Ue].geometry[0]=J[Ue].geometry[0].concat(Ze[0]),Ue}function ve(Se,Ae,Ze){const Ue=Q[Ae];return delete Q[Ae],Q[Se]=Ue,J[Ue].geometry[0].shift(),J[Ue].geometry[0]=Ze[0].concat(J[Ue].geometry[0]),Ue}function je(Se,Ae,Ze){const Ue=Ze?Ae[0][Ae[0].length-1]:Ae[0][0];return`${Se}:${Ue.x}:${Ue.y}`}for(let Se=0;Se<q.length;Se++){const Ae=q[Se],Ze=Ae.geometry,Ue=Ae.text?Ae.text.toString():null;if(!Ue){Z(Se);continue}const Ge=je(Ue,Ze),Re=je(Ue,Ze,!0);if(Ge in oe&&Re in Q&&oe[Ge]!==Q[Re]){const tt=ve(Ge,Re,Ze),gt=ee(Ge,Re,J[tt].geometry);delete Q[Ge],delete oe[Re],oe[je(Ue,J[gt].geometry,!0)]=gt,J[tt].geometry=null}else Ge in oe?ee(Ge,Re,Ze):Re in Q?ve(Ge,Re,Ze):(Z(Se),Q[Ge]=L-1,oe[Re]=L-1)}return J.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,Q)=>q.sortKey-Q.sortKey)}update(t,a,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(a[t.segment+1]),_=t.dist(a[t.segment]);const g={};for(let v=t.segment+1;v<a.length;v++)g[v]={x:a[v].x,y:a[v].y,tileUnitDistanceFromAnchor:h},v<a.length-1&&(h+=a[v+1].dist(a[v]));for(let v=t.segment||0;v>=0;v--)g[v]={x:a[v].x,y:a[v].y,tileUnitDistanceFromAnchor:_},v>0&&(_+=a[v-1].dist(a[v]));for(let v=0;v<a.length;v++){const w=g[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,a,o,h,_,g,v,w,M,C,A,R){const k=t.indexArray,O=t.layoutVertexArray,U=t.segments.prepareSegment(4*a.length,O,k,this.canOverlap?g.sortKey:void 0),q=this.glyphOffsetArray.length,Q=U.vertexLength,oe=this.allowVerticalPlacement&&v===F.ag.vertical?Math.PI/2:0,J=g.text&&g.text.sections;for(let L=0;L<a.length;L++){const{tl:Z,tr:ee,bl:ve,br:je,tex:Se,pixelOffsetTL:Ae,pixelOffsetBR:Ze,minFontScaleX:Ue,minFontScaleY:Ge,glyphOffset:Re,isSDF:tt,sectionIndex:gt}=a[L],pt=U.vertexLength,nt=Re[1];Qh(O,w.x,w.y,Z.x,nt+Z.y,Se.x,Se.y,o,tt,Ae.x,Ae.y,Ue,Ge),Qh(O,w.x,w.y,ee.x,nt+ee.y,Se.x+Se.w,Se.y,o,tt,Ze.x,Ae.y,Ue,Ge),Qh(O,w.x,w.y,ve.x,nt+ve.y,Se.x,Se.y+Se.h,o,tt,Ae.x,Ze.y,Ue,Ge),Qh(O,w.x,w.y,je.x,nt+je.y,Se.x+Se.w,Se.y+Se.h,o,tt,Ze.x,Ze.y,Ue,Ge),Kh(t.dynamicLayoutVertexArray,w,oe),k.emplaceBack(pt,pt+2,pt+1),k.emplaceBack(pt+1,pt+2,pt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Re[0]),L!==a.length-1&&gt===a[L+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,g,g.index,{},R,J&&J[gt])}t.placedSymbolArray.emplaceBack(w.x,w.y,q,this.glyphOffsetArray.length-q,Q,M,C,w.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],v,0,!1,0,A)}_addCollisionDebugVertex(t,a,o,h,_,g){return a.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,_,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,a,o,h,_,g,v){const w=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),M=w.vertexLength,C=_.layoutVertexArray,A=_.collisionVertexArray,R=v.anchorX,k=v.anchorY;this._addCollisionDebugVertex(C,A,g,R,k,new at(t,a)),this._addCollisionDebugVertex(C,A,g,R,k,new at(o,a)),this._addCollisionDebugVertex(C,A,g,R,k,new at(o,h)),this._addCollisionDebugVertex(C,A,g,R,k,new at(t,h)),w.vertexLength+=4;const O=_.indexArray;O.emplaceBack(M,M+1),O.emplaceBack(M+1,M+2),O.emplaceBack(M+2,M+3),O.emplaceBack(M+3,M),w.primitiveLength+=4}addDebugCollisionBoxes(t,a,o,h){for(let _=t;_<a;_++){const g=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hd(Ie,qs.members,$e),this.iconCollisionBox=new Hd(Ie,qs.members,$e);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,o,h,_,g,v,w,M){const C={};for(let A=a;A<o;A++){const R=t.get(A);C.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.textFeatureIndex=R.featureIndex;break}for(let A=h;A<_;A++){const R=t.get(A);C.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalTextFeatureIndex=R.featureIndex;break}for(let A=g;A<v;A++){const R=t.get(A);C.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.iconFeatureIndex=R.featureIndex;break}for(let A=w;A<M;A++){const R=t.get(A);C.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalIconFeatureIndex=R.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const o=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const o=t.placedSymbolArray.get(a),h=o.vertexStartIndex+4*o.numGlyphs;for(let _=o.vertexStartIndex;_<h;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),o=Math.cos(t),h=[],_=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(a*w.anchorX+o*w.anchorY)),_.push(w.featureIndex)}return g.sort((v,w)=>h[v]-h[w]||_[w]-_[v]),g}addToSortKeyRanges(t,a){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===a?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const o=this.symbolInstances.get(a);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((h,_,g)=>{h>=0&&g.indexOf(h)===_&&this.addIndicesForPlacedSymbol(this.text,h)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pc,Wh;Ke("SymbolBucket",Co,{omit:["layers","collisionBoxArray","features","compareText"]}),Co.MAX_GLYPHS=65535,Co.addDynamicAttributes=Kh;var mu={get paint(){return Wh=Wh||new na({"icon-opacity":new ft(P.paint_symbol["icon-opacity"]),"icon-color":new ft(P.paint_symbol["icon-color"]),"icon-halo-color":new ft(P.paint_symbol["icon-halo-color"]),"icon-halo-width":new ft(P.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ft(P.paint_symbol["icon-halo-blur"]),"icon-translate":new ct(P.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct(P.paint_symbol["icon-translate-anchor"]),"text-opacity":new ft(P.paint_symbol["text-opacity"]),"text-color":new ft(P.paint_symbol["text-color"],{runtimeType:Bt,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ft(P.paint_symbol["text-halo-color"]),"text-halo-width":new ft(P.paint_symbol["text-halo-width"]),"text-halo-blur":new ft(P.paint_symbol["text-halo-blur"]),"text-translate":new ct(P.paint_symbol["text-translate"]),"text-translate-anchor":new ct(P.paint_symbol["text-translate-anchor"])})},get layout(){return pc=pc||new na({"symbol-placement":new ct(P.layout_symbol["symbol-placement"]),"symbol-spacing":new ct(P.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct(P.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ft(P.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct(P.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ct(P.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ct(P.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ct(P.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct(P.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct(P.layout_symbol["icon-rotation-alignment"]),"icon-size":new ft(P.layout_symbol["icon-size"]),"icon-text-fit":new ct(P.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ct(P.layout_symbol["icon-text-fit-padding"]),"icon-image":new ft(P.layout_symbol["icon-image"]),"icon-rotate":new ft(P.layout_symbol["icon-rotate"]),"icon-padding":new ft(P.layout_symbol["icon-padding"]),"icon-keep-upright":new ct(P.layout_symbol["icon-keep-upright"]),"icon-offset":new ft(P.layout_symbol["icon-offset"]),"icon-anchor":new ft(P.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct(P.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct(P.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct(P.layout_symbol["text-rotation-alignment"]),"text-field":new ft(P.layout_symbol["text-field"]),"text-font":new ft(P.layout_symbol["text-font"]),"text-size":new ft(P.layout_symbol["text-size"]),"text-max-width":new ft(P.layout_symbol["text-max-width"]),"text-line-height":new ct(P.layout_symbol["text-line-height"]),"text-letter-spacing":new ft(P.layout_symbol["text-letter-spacing"]),"text-justify":new ft(P.layout_symbol["text-justify"]),"text-radial-offset":new ft(P.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct(P.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ft(P.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ft(P.layout_symbol["text-anchor"]),"text-max-angle":new ct(P.layout_symbol["text-max-angle"]),"text-writing-mode":new ct(P.layout_symbol["text-writing-mode"]),"text-rotate":new ft(P.layout_symbol["text-rotate"]),"text-padding":new ct(P.layout_symbol["text-padding"]),"text-keep-upright":new ct(P.layout_symbol["text-keep-upright"]),"text-transform":new ft(P.layout_symbol["text-transform"]),"text-offset":new ft(P.layout_symbol["text-offset"]),"text-allow-overlap":new ct(P.layout_symbol["text-allow-overlap"]),"text-overlap":new ct(P.layout_symbol["text-overlap"]),"text-ignore-placement":new ct(P.layout_symbol["text-ignore-placement"]),"text-optional":new ct(P.layout_symbol["text-optional"])})}};class Jh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:wt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke("FormatSectionOverride",Jh,{omit:["defaultValue"]});class $s extends Tr{constructor(t){super(t,mu)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const _ of o)h.indexOf(_)<0&&h.push(_);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,o,h){const _=this.layout.get(t).evaluate(a,{},o,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Ul(g.value)||!_?_:function(v,w){return w.replace(/{([^{}]+)}/g,(M,C)=>v&&C in v?String(v[C]):"")}(a.properties,_)}createBucket(t){return new Co(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of mu.paint.overridableProperties){if(!$s.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),o=new Jh(a),h=new Ur(o,a.property.specification);let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new ss("source",h):new Nc("composite",h,a.value.zoomStops),this.paint._values[t]=new On(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,o){return!(!this.layout||a.isDataDriven()||o.isDataDriven())&&$s.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const o=t.get("text-field"),h=mu.paint.properties[a];let _=!1;const g=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(_=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ji)g(o.value.value.sections);else if(o.value.kind==="source"){const v=M=>{_||(M instanceof $n&&en(M.value)===Wi?g(M.value.sections):M instanceof ns?g(M.sections):M.eachChild(v))},w=o.value;w._styleExpression&&v(w._styleExpression.expression)}return _}}let ps;var ch={get paint(){return ps=ps||new na({"background-color":new ct(P.paint_background["background-color"]),"background-pattern":new Fi(P.paint_background["background-pattern"]),"background-opacity":new ct(P.paint_background["background-opacity"])})}};class Wf extends Tr{constructor(t){super(t,ch)}}let $d;var Pf={get paint(){return $d=$d||new na({"raster-opacity":new ct(P.paint_raster["raster-opacity"]),"raster-hue-rotate":new ct(P.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct(P.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct(P.paint_raster["raster-brightness-max"]),"raster-saturation":new ct(P.paint_raster["raster-saturation"]),"raster-contrast":new ct(P.paint_raster["raster-contrast"]),"raster-resampling":new ct(P.paint_raster["raster-resampling"]),"raster-fade-duration":new ct(P.paint_raster["raster-fade-duration"])})}};class Df extends Tr{constructor(t){super(t,Pf)}}class Jf extends Tr{constructor(t){super(t,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Xd{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const If={once:!0},ed=63710088e-1;class gl{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new gl(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,o=this.lat*a,h=t.lat*a,_=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return ed*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof gl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new gl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new gl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const td=2*Math.PI*ed;function id(r){return td*Math.cos(r*Math.PI/180)}function Rf(r){return(180+r)/360}function kf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function _u(r,t){return r/id(t)}function Yd(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Qd(r,t){return r*id(Yd(t))}class qt{constructor(t,a,o=0){this.x=+t,this.y=+a,this.z=+o}static fromLngLat(t,a=0){const o=gl.convert(t);return new qt(Rf(o.lng),kf(o.lat),_u(a,o.lat))}toLngLat(){return new gl(360*this.x-180,Yd(this.y))}toAltitude(){return Qd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/td*(t=Yd(this.y),1/Math.cos(t*Math.PI/180));var t}}function nd(r,t,a){var o=2*Math.PI*6378137/256/Math.pow(2,a);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class gu{constructor(t,a,o){if(!function(h,_,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||_<0||_>=Math.pow(2,h))}(t,a,o))throw new Error(`x=${a}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=o,this.key=yl(0,t,t,a,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,o){const h=(g=this.y,v=this.z,w=nd(256*(_=this.x),256*(g=Math.pow(2,v)-g-1),v),M=nd(256*(_+1),256*(g+1),v),w[0]+","+w[1]+","+M[0]+","+M[1]);var _,g,v,w,M;const C=function(A,R,k){let O,U="";for(let q=A;q>0;q--)O=1<<q-1,U+=(R&O?1:0)+(k&O?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new at((t.x*a-this.x)*qe,(t.y*a-this.y)*qe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ad{constructor(t,a){this.wrap=t,this.canonical=a,this.key=yl(t,a.z,a.z,a.x,a.y)}}class ur{constructor(t,a,o,h,_){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=a,this.canonical=new gu(o,+h,+_),this.key=yl(a,t,o,h,_)}clone(){return new ur(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new ur(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ur(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?yl(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):yl(this.wrap*+a,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new ur(a,this.wrap,a,o,h),new ur(a,this.wrap,a,o+1,h),new ur(a,this.wrap,a,o,h+1),new ur(a,this.wrap,a,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ur(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ad(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new qt(t.x-this.wrap,t.y))}}function yl(r,t,a,o,h){(r*=2)<0&&(r=-1*r-1);const _=1<<a;return(_*_*r+_*h+o).toString(36)+a.toString(36)+t.toString(36)}Ke("CanonicalTileID",gu),Ke("OverscaledTileID",ur,{omit:["terrainRttPosMatrix32f"]});class yu{constructor(t,a,o,h=1,_=1,g=1,v=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ci(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const w=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=_,this.blueFactor=g,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<w;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(w,M)]=this.data[this._idx(w-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,w)]=this.data[this._idx(M,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<w;M++)for(let C=0;C<w;C++){const A=this.get(M,C);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(t,a){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,o){return t*this.redFactor+a*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Aa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,_=a*this.dim+this.dim,g=o*this.dim,v=o*this.dim+this.dim;switch(a){case-1:h=_-1;break;case 1:_=h+1}switch(o){case-1:g=v-1;break;case 1:v=g+1}const w=-a*this.dim,M=-o*this.dim;for(let C=g;C<v;C++)for(let A=h;A<_;A++)this.data[this._idx(A,C)]=t.data[this._idx(A+w,C+M)]}}Ke("DEMData",yu);class uh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const o=t[a];this._stringToNumber[o]=a,this._numberToString[a]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class mc{constructor(t,a,o,h,_){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=o,t._y=h,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class Kd{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ir(qe,16,0),this.grid3D=new ir(qe,16,0),this.featureIndexArray=new $,this.promoteId=a}insert(t,a,o,h,_,g){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,_);const w=g?this.grid3D:this.grid;for(let M=0;M<a.length;M++){const C=a[M],A=[1/0,1/0,-1/0,-1/0];for(let R=0;R<C.length;R++){const k=C[R];A[0]=Math.min(A[0],k.x),A[1]=Math.min(A[1],k.y),A[2]=Math.max(A[2],k.x),A[3]=Math.max(A[3],k.y)}A[0]<qe&&A[1]<qe&&A[2]>=0&&A[3]>=0&&w.insert(v,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new dl.VectorTile(new cu(this.rawTileData)).layers,this.sourceLayerCoder=new uh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,o,h){this.loadVTLayers();const _=t.params,g=qe/t.tileSize/t.scale,v=pa(_.filter),w=t.queryGeometry,M=t.queryPadding*g,C=Bf(w),A=this.grid.query(C.minX-M,C.minY-M,C.maxX+M,C.maxY+M),R=Bf(t.cameraQueryGeometry),k=this.grid3D.query(R.minX-M,R.minY-M,R.maxX+M,R.maxY+M,(q,Q,oe,J)=>function(L,Z,ee,ve,je){for(const Ae of L)if(Z<=Ae.x&&ee<=Ae.y&&ve>=Ae.x&&je>=Ae.y)return!0;const Se=[new at(Z,ee),new at(Z,je),new at(ve,je),new at(ve,ee)];if(L.length>2){for(const Ae of Se)if(il(L,Ae))return!0}for(let Ae=0;Ae<L.length-1;Ae++)if(wd(L[Ae],L[Ae+1],Se))return!0;return!1}(t.cameraQueryGeometry,q-M,Q-M,oe+M,J+M));for(const q of k)A.push(q);A.sort(Of);const O={};let U;for(let q=0;q<A.length;q++){const Q=A[q];if(Q===U)continue;U=Q;const oe=this.featureIndexArray.get(Q);let J=null;this.loadMatchingFeature(O,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,v,_.layers,_.availableImages,a,o,h,(L,Z,ee)=>(J||(J=js(L)),Z.queryIntersectsFeature({queryGeometry:w,feature:L,featureState:ee,geometry:J,zoom:this.z,transform:t.transform,pixelsToTileUnits:g,pixelPosMatrix:t.pixelPosMatrix})))}return O}loadMatchingFeature(t,a,o,h,_,g,v,w,M,C,A){const R=this.bucketLayerIDs[a];if(g&&!R.some(q=>g.has(q)))return;const k=this.sourceLayerCoder.decode(o),O=this.vtLayers[k].feature(h);if(_.needGeometry){const q=Ca(O,!0);if(!_.filter(new Ei(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!_.filter(new Ei(this.tileID.overscaledZ),O))return;const U=this.getId(O,k);for(let q=0;q<R.length;q++){const Q=R[q];if(g&&!g.has(Q))continue;const oe=w[Q];if(!oe)continue;let J={};U&&C&&(J=C.getState(oe.sourceLayer||"_geojsonTileLayer",U));const L=Ct({},M[Q]);L.paint=Lf(L.paint,oe.paint,O,J,v),L.layout=Lf(L.layout,oe.layout,O,J,v);const Z=!A||A(O,oe,J);if(!Z)continue;const ee=new mc(O,this.z,this.x,this.y,U);ee.layer=L;let ve=t[Q];ve===void 0&&(ve=t[Q]=[]),ve.push({featureIndex:h,feature:ee,intersectionZ:Z})}}lookupSymbolFeatures(t,a,o,h,_,g,v,w){const M={};this.loadVTLayers();const C=pa(_);for(const A of t)this.loadMatchingFeature(M,o,h,A,C,g,v,w,a);return M}hasLayer(t){for(const a of this.bucketLayerIDs)for(const o of a)if(t===o)return!0;return!1}getId(t,a){var o;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function Lf(r,t,a,o,h){return sn(r,(_,g)=>{const v=t instanceof co?t.get(g):null;return v&&v.evaluate?v.evaluate(a,o,h):v})}function Bf(r){let t=1/0,a=1/0,o=-1/0,h=-1/0;for(const _ of r)t=Math.min(t,_.x),a=Math.min(a,_.y),o=Math.max(o,_.x),h=Math.max(h,_.y);return{minX:t,minY:a,maxX:o,maxY:h}}function Of(r,t){return t-r}function Wd(r,t,a,o,h){const _=[];for(let g=0;g<r.length;g++){const v=r[g];let w;for(let M=0;M<v.length-1;M++){let C=v[M],A=v[M+1];C.x<t&&A.x<t||(C.x<t?C=new at(t,C.y+(t-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x<t&&(A=new at(t,C.y+(t-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y<a&&A.y<a||(C.y<a?C=new at(C.x+(a-C.y)/(A.y-C.y)*(A.x-C.x),a)._round():A.y<a&&(A=new at(C.x+(a-C.y)/(A.y-C.y)*(A.x-C.x),a)._round()),C.x>=o&&A.x>=o||(C.x>=o?C=new at(o,C.y+(o-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x>=o&&(A=new at(o,C.y+(o-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y>=h&&A.y>=h||(C.y>=h?C=new at(C.x+(h-C.y)/(A.y-C.y)*(A.x-C.x),h)._round():A.y>=h&&(A=new at(C.x+(h-C.y)/(A.y-C.y)*(A.x-C.x),h)._round()),w&&C.equals(w[w.length-1])||(w=[C],_.push(w)),w.push(A)))))}}return _}Ke("FeatureIndex",Kd,{omit:["rawTileData","sourceLayerCoder"]});class ms extends at{constructor(t,a,o,h){super(t,a),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new ms(this.x,this.y,this.angle,this.segment)}}function Ti(r,t,a,o,h){if(t.segment===void 0||a===0)return!0;let _=t,g=t.segment+1,v=0;for(;v>-a/2;){if(g--,g<0)return!1;v-=r[g].dist(_),_=r[g]}v+=r[g].dist(r[g+1]),g++;const w=[];let M=0;for(;v<a/2;){const C=r[g],A=r[g+1];if(!A)return!1;let R=r[g-1].angleTo(C)-C.angleTo(A);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:R}),M+=R;v-w[0].distance>o;)M-=w.shift().angleDelta;if(M>h)return!1;g++,v+=C.dist(A)}return!0}function rd(r){let t=0;for(let a=0;a<r.length-1;a++)t+=r[a].dist(r[a+1]);return t}function ra(r,t,a){return r?.6*t*a:0}function Ff(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Jd(r,t,a,o,h,_){const g=ra(a,h,_),v=Ff(a,o)*_;let w=0;const M=rd(r)/2;for(let C=0;C<r.length-1;C++){const A=r[C],R=r[C+1],k=A.dist(R);if(w+k>M){const O=(M-w)/k,U=Fa.number(A.x,R.x,O),q=Fa.number(A.y,R.y,O),Q=new ms(U,q,R.angleTo(A),C);return Q._round(),!g||Ti(r,Q,v,g,t)?Q:void 0}w+=k}}function ef(r,t,a,o,h,_,g,v,w){const M=ra(o,_,g),C=Ff(o,h),A=C*g,R=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return t-A<t/4&&(t=A+t/4),hh(r,R?t/2*v%t:(C/2+2*_)*g*v%t,t,M,a,A,R,!1,w)}function hh(r,t,a,o,h,_,g,v,w){const M=_/2,C=rd(r);let A=0,R=t-a,k=[];for(let O=0;O<r.length-1;O++){const U=r[O],q=r[O+1],Q=U.dist(q),oe=q.angleTo(U);for(;R+a<A+Q;){R+=a;const J=(R-A)/Q,L=Fa.number(U.x,q.x,J),Z=Fa.number(U.y,q.y,J);if(L>=0&&L<w&&Z>=0&&Z<w&&R-M>=0&&R+M<=C){const ee=new ms(L,Z,oe,O);ee._round(),o&&!Ti(r,ee,_,o,h)||k.push(ee)}}A+=Q}return v||k.length||g||(k=hh(r,A/2,a,o,h,_,g,!0,w)),k}Ke("Anchor",ms);const vu=va;function tf(r,t,a,o){const h=[],_=r.image,g=_.pixelRatio,v=_.paddedRect.w-2*vu,w=_.paddedRect.h-2*vu;let M={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const C=_.stretchX||[[0,v]],A=_.stretchY||[[0,w]],R=(Re,tt)=>Re+tt[1]-tt[0],k=C.reduce(R,0),O=A.reduce(R,0),U=v-k,q=w-O;let Q=0,oe=k,J=0,L=O,Z=0,ee=U,ve=0,je=q;if(_.content&&o){const Re=_.content,tt=Re[2]-Re[0],gt=Re[3]-Re[1];(_.textFitWidth||_.textFitHeight)&&(M=lh(r)),Q=xu(C,0,Re[0]),J=xu(A,0,Re[1]),oe=xu(C,Re[0],Re[2]),L=xu(A,Re[1],Re[3]),Z=Re[0]-Q,ve=Re[1]-J,ee=tt-oe,je=gt-L}const Se=M.x1,Ae=M.y1,Ze=M.x2-Se,Ue=M.y2-Ae,Ge=(Re,tt,gt,pt)=>{const nt=od(Re.stretch-Q,oe,Ze,Se),Ut=dh(Re.fixed-Z,ee,Re.stretch,k),Ui=od(tt.stretch-J,L,Ue,Ae),fn=dh(tt.fixed-ve,je,tt.stretch,O),Yi=od(gt.stretch-Q,oe,Ze,Se),Nn=dh(gt.fixed-Z,ee,gt.stretch,k),Tn=od(pt.stretch-J,L,Ue,Ae),pn=dh(pt.fixed-ve,je,pt.stretch,O),vi=new at(nt,Ui),Ri=new at(Yi,Ui),ea=new at(Yi,Tn),Un=new at(nt,Tn),Vn=new at(Ut/g,fn/g),Pr=new at(Nn/g,pn/g),In=t*Math.PI/180;if(In){const Zn=Math.sin(In),mn=Math.cos(In),Qi=[mn,-Zn,Zn,mn];vi._matMult(Qi),Ri._matMult(Qi),Un._matMult(Qi),ea._matMult(Qi)}const sa=Re.stretch+Re.fixed,Sn=tt.stretch+tt.fixed;return{tl:vi,tr:Ri,bl:Un,br:ea,tex:{x:_.paddedRect.x+vu+sa,y:_.paddedRect.y+vu+Sn,w:gt.stretch+gt.fixed-sa,h:pt.stretch+pt.fixed-Sn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:Pr,minFontScaleX:ee/g/Ze,minFontScaleY:je/g/Ue,isSDF:a}};if(o&&(_.stretchX||_.stretchY)){const Re=sd(C,U,k),tt=sd(A,q,O);for(let gt=0;gt<Re.length-1;gt++){const pt=Re[gt],nt=Re[gt+1];for(let Ut=0;Ut<tt.length-1;Ut++)h.push(Ge(pt,tt[Ut],nt,tt[Ut+1]))}}else h.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function xu(r,t,a){let o=0;for(const h of r)o+=Math.max(t,Math.min(a,h[1]))-Math.max(t,Math.min(a,h[0]));return o}function sd(r,t,a){const o=[{fixed:-1,stretch:0}];for(const[h,_]of r){const g=o[o.length-1];o.push({fixed:h-g.stretch,stretch:g.stretch}),o.push({fixed:h-g.stretch,stretch:g.stretch+(_-h)})}return o.push({fixed:t+vu,stretch:a}),o}function od(r,t,a,o){return r/t*a+o}function dh(r,t,a,o){return r-t*a/o}class ld{constructor(t,a,o,h,_,g,v,w,M,C){var A;if(this.boxStartIndex=t.length,M){let R=g.top,k=g.bottom;const O=g.collisionPadding;O&&(R-=O[1],k+=O[3]);let U=k-R;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const R=!((A=g.image)===null||A===void 0)&&A.content&&(g.image.textFitWidth||g.image.textFitHeight)?lh(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};R.y1=R.y1*v-w[0],R.y2=R.y2*v+w[2],R.x1=R.x1*v-w[3],R.x2=R.x2*v+w[1];const k=g.collisionPadding;if(k&&(R.x1-=k[0]*v,R.y1-=k[1]*v,R.x2+=k[2]*v,R.y2+=k[3]*v),C){const O=new at(R.x1,R.y1),U=new at(R.x2,R.y1),q=new at(R.x1,R.y2),Q=new at(R.x2,R.y2),oe=C*Math.PI/180;O._rotate(oe),U._rotate(oe),q._rotate(oe),Q._rotate(oe),R.x1=Math.min(O.x,U.x,q.x,Q.x),R.x2=Math.max(O.x,U.x,q.x,Q.x),R.y1=Math.min(O.y,U.y,q.y,Q.y),R.y2=Math.max(O.y,U.y,q.y,Q.y)}t.emplaceBack(a.x,a.y,R.x1,R.y1,R.x2,R.y2,o,h,_)}this.boxEndIndex=t.length}}class jf{constructor(t=[],a=(o,h)=>o<h?-1:o>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:o}=this,h=a[t];for(;t>0;){const _=t-1>>1,g=a[_];if(o(h,g)>=0)break;a[t]=g,t=_}a[t]=h}_down(t){const{data:a,compare:o}=this,h=this.length>>1,_=a[t];for(;t<h;){let g=1+(t<<1);const v=g+1;if(v<this.length&&o(a[v],a[g])<0&&(g=v),o(a[g],_)>=0)break;a[t]=a[g],t=g}a[t]=_}}function ep(r,t=1,a=!1){let o=1/0,h=1/0,_=-1/0,g=-1/0;const v=r[0];for(let k=0;k<v.length;k++){const O=v[k];(!k||O.x<o)&&(o=O.x),(!k||O.y<h)&&(h=O.y),(!k||O.x>_)&&(_=O.x),(!k||O.y>g)&&(g=O.y)}const w=Math.min(_-o,g-h);let M=w/2;const C=new jf([],tp);if(w===0)return new at(o,h);for(let k=o;k<_;k+=w)for(let O=h;O<g;O+=w)C.push(new vl(k+M,O+M,M,r));let A=function(k){let O=0,U=0,q=0;const Q=k[0];for(let oe=0,J=Q.length,L=J-1;oe<J;L=oe++){const Z=Q[oe],ee=Q[L],ve=Z.x*ee.y-ee.x*Z.y;U+=(Z.x+ee.x)*ve,q+=(Z.y+ee.y)*ve,O+=3*ve}return new vl(U/O,q/O,0,k)}(r),R=C.length;for(;C.length;){const k=C.pop();(k.d>A.d||!A.d)&&(A=k,a&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,R)),k.max-A.d<=t||(M=k.h/2,C.push(new vl(k.p.x-M,k.p.y-M,M,r)),C.push(new vl(k.p.x+M,k.p.y-M,M,r)),C.push(new vl(k.p.x-M,k.p.y+M,M,r)),C.push(new vl(k.p.x+M,k.p.y+M,M,r)),R+=4)}return a&&(console.log(`num probes: ${R}`),console.log(`best distance: ${A.d}`)),A.p}function tp(r,t){return t.max-r.max}function vl(r,t,a,o){this.p=new at(r,t),this.h=a,this.d=function(h,_){let g=!1,v=1/0;for(let w=0;w<_.length;w++){const M=_[w];for(let C=0,A=M.length,R=A-1;C<A;R=C++){const k=M[C],O=M[R];k.y>h.y!=O.y>h.y&&h.x<(O.x-k.x)*(h.y-k.y)/(O.y-k.y)+k.x&&(g=!g),v=Math.min(v,bd(h,k,O))}}return(g?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var jn;F.ax=void 0,(jn=F.ax||(F.ax={}))[jn.center=1]="center",jn[jn.left=2]="left",jn[jn.right=3]="right",jn[jn.top=4]="top",jn[jn.bottom=5]="bottom",jn[jn["top-left"]=6]="top-left",jn[jn["top-right"]=7]="top-right",jn[jn["bottom-left"]=8]="bottom-left",jn[jn["bottom-right"]=9]="bottom-right";const xl=7,nf=Number.POSITIVE_INFINITY;function Xr(r,t){return t[1]!==nf?function(a,o,h){let _=0,g=0;switch(o=Math.abs(o),h=Math.abs(h),a){case"top-right":case"top-left":case"top":g=h-xl;break;case"bottom-right":case"bottom-left":case"bottom":g=-h+xl}switch(a){case"top-right":case"bottom-right":case"right":_=-o;break;case"top-left":case"bottom-left":case"left":_=o}return[_,g]}(r,t[0],t[1]):function(a,o){let h=0,_=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(a){case"top-right":case"top-left":_=g-xl;break;case"bottom-right":case"bottom-left":_=-g+xl;break;case"bottom":_=-o+xl;break;case"top":_=o-xl}switch(a){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=o;break;case"right":h=-o}return[h,_]}(r,t[0])}function af(r,t,a){var o;const h=r.layout,_=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},a);if(_){const v=_.values,w=[];for(let M=0;M<v.length;M+=2){const C=w[M]=v[M],A=v[M+1].map(R=>R*Xi);C.startsWith("top")?A[1]-=xl:C.startsWith("bottom")&&(A[1]+=xl),w[M+1]=A}return new yn(w)}const g=h.get("text-variable-anchor");if(g){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},a)*Xi,nf]:h.get("text-offset").evaluate(t,{},a).map(M=>M*Xi);const w=[];for(const M of g)w.push(M,Xr(M,v));return new yn(w)}return null}function cd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yr(r,t,a,o,h,_,g,v,w,M,C,A){let R=_.textMaxSize.evaluate(t,{});R===void 0&&(R=g);const k=r.layers[0].layout,O=k.get("icon-offset").evaluate(t,{},C),U=fh(a.horizontal),q=g/24,Q=r.tilePixelRatio*q,oe=r.tilePixelRatio*R/24,J=r.tilePixelRatio*v,L=r.tilePixelRatio*k.get("symbol-spacing"),Z=k.get("text-padding")*r.tilePixelRatio,ee=function(gt,pt,nt,Ut=1){const Ui=gt.get("icon-padding").evaluate(pt,{},nt),fn=Ui&&Ui.values;return[fn[0]*Ut,fn[1]*Ut,fn[2]*Ut,fn[3]*Ut]}(k,t,C,r.tilePixelRatio),ve=k.get("text-max-angle")/180*Math.PI,je=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point",Se=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ae=k.get("symbol-placement"),Ze=L/2,Ue=k.get("icon-text-fit");let Ge;o&&Ue!=="none"&&(r.allowVerticalPlacement&&a.vertical&&(Ge=Zd(o,a.vertical,Ue,k.get("icon-text-fit-padding"),O,q)),U&&(o=Zd(o,U,Ue,k.get("icon-text-fit-padding"),O,q)));const Re=C?A.line.getGranularityForZoomLevel(C.z):1,tt=(gt,pt)=>{pt.x<0||pt.x>=qe||pt.y<0||pt.y>=qe||function(nt,Ut,Ui,fn,Yi,Nn,Tn,pn,vi,Ri,ea,Un,Vn,Pr,In,sa,Sn,Zn,mn,Qi,Si,$a,Tl,hr,Vf){const bu=nt.addToLineVertexArray(Ut,Ui);let Xs,i,s,c,p=0,x=0,S=0,B=0,G=-1,te=-1;const de={};let Oe=Pi("");if(nt.allowVerticalPlacement&&fn.vertical){const Rt=pn.layout.get("text-rotate").evaluate(Si,{},hr)+90;s=new ld(vi,Ut,Ri,ea,Un,fn.vertical,Vn,Pr,In,Rt),Tn&&(c=new ld(vi,Ut,Ri,ea,Un,Tn,Sn,Zn,In,Rt))}if(Yi){const Rt=pn.layout.get("icon-rotate").evaluate(Si,{}),Gn=pn.layout.get("icon-text-fit")!=="none",_c=tf(Yi,Rt,Tl,Gn),zo=Tn?tf(Tn,Rt,Tl,Gn):void 0;i=new ld(vi,Ut,Ri,ea,Un,Yi,Sn,Zn,!1,Rt),p=4*_c.length;const gh=nt.iconSizeData;let Sl=null;gh.kind==="source"?(Sl=[Hs*pn.layout.get("icon-size").evaluate(Si,{})],Sl[0]>Eo&&Ci(`${nt.layerIds[0]}: Value for "icon-size" is >= ${pu}. Reduce your "icon-size".`)):gh.kind==="composite"&&(Sl=[Hs*$a.compositeIconSizes[0].evaluate(Si,{},hr),Hs*$a.compositeIconSizes[1].evaluate(Si,{},hr)],(Sl[0]>Eo||Sl[1]>Eo)&&Ci(`${nt.layerIds[0]}: Value for "icon-size" is >= ${pu}. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,_c,Sl,Qi,mn,Si,F.ag.none,Ut,bu.lineStartIndex,bu.lineLength,-1,hr),G=nt.icon.placedSymbolArray.length-1,zo&&(x=4*zo.length,nt.addSymbols(nt.icon,zo,Sl,Qi,mn,Si,F.ag.vertical,Ut,bu.lineStartIndex,bu.lineLength,-1,hr),te=nt.icon.placedSymbolArray.length-1)}const He=Object.keys(fn.horizontal);for(const Rt of He){const Gn=fn.horizontal[Rt];if(!Xs){Oe=Pi(Gn.text);const zo=pn.layout.get("text-rotate").evaluate(Si,{},hr);Xs=new ld(vi,Ut,Ri,ea,Un,Gn,Vn,Pr,In,zo)}const _c=Gn.positionedLines.length===1;if(S+=rf(nt,Ut,Gn,Nn,pn,In,Si,sa,bu,fn.vertical?F.ag.horizontal:F.ag.horizontalOnly,_c?He:[Rt],de,G,$a,hr),_c)break}fn.vertical&&(B+=rf(nt,Ut,fn.vertical,Nn,pn,In,Si,sa,bu,F.ag.vertical,["vertical"],de,te,$a,hr));const Ee=Xs?Xs.boxStartIndex:nt.collisionBoxArray.length,Le=Xs?Xs.boxEndIndex:nt.collisionBoxArray.length,bt=s?s.boxStartIndex:nt.collisionBoxArray.length,Nt=s?s.boxEndIndex:nt.collisionBoxArray.length,Mn=i?i.boxStartIndex:nt.collisionBoxArray.length,ge=i?i.boxEndIndex:nt.collisionBoxArray.length,fe=c?c.boxStartIndex:nt.collisionBoxArray.length,Te=c?c.boxEndIndex:nt.collisionBoxArray.length;let Ne=-1;const ht=(Rt,Gn)=>Rt&&Rt.circleDiameter?Math.max(Rt.circleDiameter,Gn):Gn;Ne=ht(Xs,Ne),Ne=ht(s,Ne),Ne=ht(i,Ne),Ne=ht(c,Ne);const Ht=Ne>-1?1:0;Ht&&(Ne*=Vf/Xi),nt.glyphOffsetArray.length>=Co.MAX_GLYPHS&&Ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,Si.sortKey);const St=af(pn,Si,hr),[zt,oa]=function(Rt,Gn){const _c=Rt.length,zo=Gn==null?void 0:Gn.values;if((zo==null?void 0:zo.length)>0)for(let gh=0;gh<zo.length;gh+=2){const Sl=zo[gh+1];Rt.emplaceBack(F.ax[zo[gh]],Sl[0],Sl[1])}return[_c,Rt.length]}(nt.textAnchorOffsets,St);nt.symbolInstances.emplaceBack(Ut.x,Ut.y,de.right>=0?de.right:-1,de.center>=0?de.center:-1,de.left>=0?de.left:-1,de.vertical||-1,G,te,Oe,Ee,Le,bt,Nt,Mn,ge,fe,Te,Ri,S,B,p,x,Ht,0,Vn,Ne,zt,oa)}(r,pt,gt,a,o,h,Ge,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,Q,[Z,Z,Z,Z],je,w,J,ee,Se,O,t,_,M,C,g)};if(Ae==="line")for(const gt of Wd(t.geometry,0,0,qe,qe)){const pt=ul(gt,Re),nt=ef(pt,L,ve,a.vertical||U,o,24,oe,r.overscaling,qe);for(const Ut of nt)U&&Ao(r,U.text,Ze,Ut)||tt(pt,Ut)}else if(Ae==="line-center"){for(const gt of t.geometry)if(gt.length>1){const pt=ul(gt,Re),nt=Jd(pt,ve,a.vertical||U,o,24,oe);nt&&tt(pt,nt)}}else if(t.type==="Polygon")for(const gt of Il(t.geometry,0)){const pt=ep(gt,16);tt(ul(gt[0],Re,!0),new ms(pt.x,pt.y,0))}else if(t.type==="LineString")for(const gt of t.geometry){const pt=ul(gt,Re);tt(pt,new ms(pt[0].x,pt[0].y,0))}else if(t.type==="Point")for(const gt of t.geometry)for(const pt of gt)tt([pt],new ms(pt.x,pt.y,0))}function rf(r,t,a,o,h,_,g,v,w,M,C,A,R,k,O){const U=function(oe,J,L,Z,ee,ve,je,Se){const Ae=Z.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Ze=[];for(const Ue of J.positionedLines)for(const Ge of Ue.positionedGlyphs){if(!Ge.rect)continue;const Re=Ge.rect||{};let tt=nh+1,gt=!0,pt=1,nt=0;const Ut=(ee||Se)&&Ge.vertical,Ui=Ge.metrics.advance*Ge.scale/2;if(Se&&J.verticalizable&&(nt=Ue.lineOffset/2-(Ge.imageName?-(Xi-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Xi)),Ge.imageName){const Zn=je[Ge.imageName];gt=Zn.sdf,pt=Zn.pixelRatio,tt=va/pt}const fn=ee?[Ge.x+Ui,Ge.y]:[0,0];let Yi=ee?[0,0]:[Ge.x+Ui+L[0],Ge.y+L[1]-nt],Nn=[0,0];Ut&&(Nn=Yi,Yi=[0,0]);const Tn=Ge.metrics.isDoubleResolution?2:1,pn=(Ge.metrics.left-tt)*Ge.scale-Ui+Yi[0],vi=(-Ge.metrics.top-tt)*Ge.scale+Yi[1],Ri=pn+Re.w/Tn*Ge.scale/pt,ea=vi+Re.h/Tn*Ge.scale/pt,Un=new at(pn,vi),Vn=new at(Ri,vi),Pr=new at(pn,ea),In=new at(Ri,ea);if(Ut){const Zn=new at(-Ui,Ui-ah),mn=-Math.PI/2,Qi=Xi/2-Ui,Si=new at(5-ah-Qi,-(Ge.imageName?Qi:0)),$a=new at(...Nn);Un._rotateAround(mn,Zn)._add(Si)._add($a),Vn._rotateAround(mn,Zn)._add(Si)._add($a),Pr._rotateAround(mn,Zn)._add(Si)._add($a),In._rotateAround(mn,Zn)._add(Si)._add($a)}if(Ae){const Zn=Math.sin(Ae),mn=Math.cos(Ae),Qi=[mn,-Zn,Zn,mn];Un._matMult(Qi),Vn._matMult(Qi),Pr._matMult(Qi),In._matMult(Qi)}const sa=new at(0,0),Sn=new at(0,0);Ze.push({tl:Un,tr:Vn,bl:Pr,br:In,tex:Re,writingMode:J.writingMode,glyphOffset:fn,sectionIndex:Ge.sectionIndex,isSDF:gt,pixelOffsetTL:sa,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}return Ze}(0,a,v,h,_,g,o,r.allowVerticalPlacement),q=r.textSizeData;let Q=null;q.kind==="source"?(Q=[Hs*h.layout.get("text-size").evaluate(g,{})],Q[0]>Eo&&Ci(`${r.layerIds[0]}: Value for "text-size" is >= ${pu}. Reduce your "text-size".`)):q.kind==="composite"&&(Q=[Hs*k.compositeTextSizes[0].evaluate(g,{},O),Hs*k.compositeTextSizes[1].evaluate(g,{},O)],(Q[0]>Eo||Q[1]>Eo)&&Ci(`${r.layerIds[0]}: Value for "text-size" is >= ${pu}. Reduce your "text-size".`)),r.addSymbols(r.text,U,Q,v,_,g,M,t,w.lineStartIndex,w.lineLength,R,O);for(const oe of C)A[oe]=r.text.placedSymbolArray.length-1;return 4*U.length}function fh(r){for(const t in r)return r[t];return null}function Ao(r,t,a,o){const h=r.compareText;if(t in h){const _=h[t];for(let g=_.length-1;g>=0;g--)if(o.dist(_[g])<a)return!0}else h[t]=[];return h[t].push(o),!1}const Nf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,o]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const _=Nf[15&o];if(!_)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new sf(v,g,_,t)}constructor(t,a=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Nf.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=a,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return bl(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:g,nodeSize:v}=this,w=[0,_.length-1,0],M=[];for(;w.length;){const C=w.pop()||0,A=w.pop()||0,R=w.pop()||0;if(A-R<=v){for(let q=R;q<=A;q++){const Q=g[2*q],oe=g[2*q+1];Q>=t&&Q<=o&&oe>=a&&oe<=h&&M.push(_[q])}continue}const k=R+A>>1,O=g[2*k],U=g[2*k+1];O>=t&&O<=o&&U>=a&&U<=h&&M.push(_[k]),(C===0?t<=O:a<=U)&&(w.push(R),w.push(k-1),w.push(1-C)),(C===0?o>=O:h>=U)&&(w.push(k+1),w.push(A),w.push(1-C))}return M}within(t,a,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:_,nodeSize:g}=this,v=[0,h.length-1,0],w=[],M=o*o;for(;v.length;){const C=v.pop()||0,A=v.pop()||0,R=v.pop()||0;if(A-R<=g){for(let q=R;q<=A;q++)Uf(_[2*q],_[2*q+1],t,a)<=M&&w.push(h[q]);continue}const k=R+A>>1,O=_[2*k],U=_[2*k+1];Uf(O,U,t,a)<=M&&w.push(h[k]),(C===0?t-o<=O:a-o<=U)&&(v.push(R),v.push(k-1),v.push(1-C)),(C===0?t+o>=O:a+o>=U)&&(v.push(k+1),v.push(A),v.push(1-C))}return w}}function bl(r,t,a,o,h,_){if(h-o<=a)return;const g=o+h>>1;of(r,t,g,o,h,_),bl(r,t,a,o,g-1,1-_),bl(r,t,a,g+1,h,1-_)}function of(r,t,a,o,h,_){for(;h>o;){if(h-o>600){const M=h-o+1,C=a-o+1,A=Math.log(M),R=.5*Math.exp(2*A/3),k=.5*Math.sqrt(A*R*(M-R)/M)*(C-M/2<0?-1:1);of(r,t,a,Math.max(o,Math.floor(a-C*R/M+k)),Math.min(h,Math.floor(a+(M-C)*R/M+k)),_)}const g=t[2*a+_];let v=o,w=h;for(ph(r,t,o,a),t[2*h+_]>g&&ph(r,t,o,h);v<w;){for(ph(r,t,v,w),v++,w--;t[2*v+_]<g;)v++;for(;t[2*w+_]>g;)w--}t[2*o+_]===g?ph(r,t,o,w):(w++,ph(r,t,w,h)),w<=a&&(o=w+1),a<=w&&(h=w-1)}}function ph(r,t,a,o){lf(r,a,o),lf(t,2*a,2*o),lf(t,2*a+1,2*o+1)}function lf(r,t,a){const o=r[t];r[t]=r[a],r[a]=o}function Uf(r,t,a,o){const h=r-a,_=t-o;return h*h+_*_}var cf;F.cg=void 0,(cf=F.cg||(F.cg={})).create="create",cf.load="load",cf.fullLoad="fullLoad";let ud=null,mh=[];const uf=1e3/60,hd="loadTime",wl="fullLoadTime",_h={mark(r){performance.mark(r)},frame(r){const t=r;ud!=null&&mh.push(t-ud),ud=t},clearMetrics(){ud=null,mh=[],performance.clearMeasures(hd),performance.clearMeasures(wl);for(const r in F.cg)performance.clearMarks(F.cg[r])},getPerformanceMetrics(){performance.measure(hd,F.cg.create,F.cg.load),performance.measure(wl,F.cg.create,F.cg.fullLoad);const r=performance.getEntriesByName(hd)[0].duration,t=performance.getEntriesByName(wl)[0].duration,a=mh.length,o=1/(mh.reduce((_,g)=>_+g,0)/a/1e3),h=mh.filter(_=>_>uf).reduce((_,g)=>_+(g-uf)/uf,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:h/(a+h)*100,totalFrames:a}}};F.$=qt,F.A=ri,F.B=Fa,F.C=Ei,F.D=ct,F.E=pe,F.F=Hc,F.G=function(r){if(Li==null){const t=r.navigator?r.navigator.userAgent:null;Li=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Li},F.H=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Xd(()=>this.process()),this.subscription=Ya(this.target,"message",a=>this.receive(a),!1),this.globalScope=ta(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((a,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?Ya(t.signal,"abort",()=>{_==null||_.unsubscribe(),delete this.resolveRejects[h];const w={id:h,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},If):null;this.resolveRejects[h]={resolve:w=>{_==null||_.unsubscribe(),a(w)},reject:w=>{_==null||_.unsubscribe(),o(w)}};const g=[],v=Object.assign(Object.assign({},r),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Ps(r.data,g)});this.target.postMessage(v,{transfer:g})})}receive(r){const t=r.data,a=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[a];const o=this.abortControllers[a];return delete this.abortControllers[a],void(o&&o.abort())}if(ta(self)||t.mustQueue)return this.tasks[a]=t,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[r];return delete this.resolveRejects[r],h?void(t.error?h.reject($l(t.error)):h.resolve($l(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=$l(t.data),o=new AbortController;this.abortControllers[r]=o;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,a,o);this.completeTask(r,null,h)}catch(h){this.completeTask(r,h)}})}completeTask(r,t,a){const o=[];delete this.abortControllers[r];const h={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ps(t):null,data:Ps(a,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},F.I=hc,F.J=_s,F.K=function(){var r=new ri(16);return ri!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},F.L=function(r,t,a){var o,h,_,g,v,w,M,C,A,R,k,O,U=a[0],q=a[1],Q=a[2];return t===r?(r[12]=t[0]*U+t[4]*q+t[8]*Q+t[12],r[13]=t[1]*U+t[5]*q+t[9]*Q+t[13],r[14]=t[2]*U+t[6]*q+t[10]*Q+t[14],r[15]=t[3]*U+t[7]*q+t[11]*Q+t[15]):(h=t[1],_=t[2],g=t[3],v=t[4],w=t[5],M=t[6],C=t[7],A=t[8],R=t[9],k=t[10],O=t[11],r[0]=o=t[0],r[1]=h,r[2]=_,r[3]=g,r[4]=v,r[5]=w,r[6]=M,r[7]=C,r[8]=A,r[9]=R,r[10]=k,r[11]=O,r[12]=o*U+v*q+A*Q+t[12],r[13]=h*U+w*q+R*Q+t[13],r[14]=_*U+M*q+k*Q+t[14],r[15]=g*U+C*q+O*Q+t[15]),r},F.M=function(r,t,a){var o=a[0],h=a[1],_=a[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*h,r[5]=t[5]*h,r[6]=t[6]*h,r[7]=t[7]*h,r[8]=t[8]*_,r[9]=t[9]*_,r[10]=t[10]*_,r[11]=t[11]*_,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},F.N=function(r,t,a){var o=t[0],h=t[1],_=t[2],g=t[3],v=t[4],w=t[5],M=t[6],C=t[7],A=t[8],R=t[9],k=t[10],O=t[11],U=t[12],q=t[13],Q=t[14],oe=t[15],J=a[0],L=a[1],Z=a[2],ee=a[3];return r[0]=J*o+L*v+Z*A+ee*U,r[1]=J*h+L*w+Z*R+ee*q,r[2]=J*_+L*M+Z*k+ee*Q,r[3]=J*g+L*C+Z*O+ee*oe,r[4]=(J=a[4])*o+(L=a[5])*v+(Z=a[6])*A+(ee=a[7])*U,r[5]=J*h+L*w+Z*R+ee*q,r[6]=J*_+L*M+Z*k+ee*Q,r[7]=J*g+L*C+Z*O+ee*oe,r[8]=(J=a[8])*o+(L=a[9])*v+(Z=a[10])*A+(ee=a[11])*U,r[9]=J*h+L*w+Z*R+ee*q,r[10]=J*_+L*M+Z*k+ee*Q,r[11]=J*g+L*C+Z*O+ee*oe,r[12]=(J=a[12])*o+(L=a[13])*v+(Z=a[14])*A+(ee=a[15])*U,r[13]=J*h+L*w+Z*R+ee*q,r[14]=J*_+L*M+Z*k+ee*Q,r[15]=J*g+L*C+Z*O+ee*oe,r},F.O=function(r,t){const a={};for(let o=0;o<t.length;o++){const h=t[o];h in r&&(a[h]=r[h])}return a},F.P=at,F.Q=gl,F.R=Aa,F.S=kf,F.T=ui,F.U=Rf,F.V=ca,F.W=Ki,F.X=Da,F.Y=ur,F.Z=qe,F._=d,F.a=ia,F.a$=function(){const r=new Float32Array(16);return Mt(r),r},F.a0=gu,F.a1=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(a=>{t.onloadstart=()=>{a(t)};for(const o of r){const h=window.document.createElement("source");Qr(o)||(t.crossOrigin="Anonymous"),h.src=o,t.appendChild(h)}})},F.a2=_e,F.a3=function(){return kt++},F.a4=y,F.a5=Co,F.a6=pa,F.a7=Ca,F.a8=mc,F.a9=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,o,h,_)=>{const g=h||_;return t[o]=!g||g.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},F.aA=oh,F.aB=sf,F.aC=Gi,F.aD=Ku,F.aE=Y,F.aF=dt,F.aG=Ye,F.aH=function(r){return Math.pow(2,r)},F.aI=85.051129,F.aJ=_u,F.aK=We,F.aL=Ia,F.aM=Qd,F.aN=function(r,t,a){return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r},F.aO=function(r,t,a){return r[0]=t[0]+a[0],r[1]=t[1]+a[1],r[2]=t[2]+a[2],r},F.aP=function(r){var t=new ri(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},F.aQ=function(r,t,a){return r[0]=t[0]*a[0],r[1]=t[1]*a[1],r[2]=t[2]*a[2],r[3]=t[3]*a[3],r},F.aR=function(r,t,a){return r[0]=t[0]-a[0],r[1]=t[1]-a[1],r[2]=t[2]-a[2],r},F.aS=function(r,t){var a=t[0],o=t[1],h=t[2],_=a*a+o*o+h*h;return _>0&&(_=1/Math.sqrt(_)),r[0]=t[0]*_,r[1]=t[1]*_,r[2]=t[2]*_,r},F.aT=function(r,t,a){var o=t[0],h=t[1],_=t[2],g=a[0],v=a[1],w=a[2];return r[0]=h*w-_*v,r[1]=_*g-o*w,r[2]=o*v-h*g,r},F.aU=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},F.aV=ad,F.aW=yl,F.aX=function(r,t,a,o,h){var _,g=1/Math.tan(t/2);return r[0]=g/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+o)*(_=1/(o-h)),r[14]=2*h*o*_):(r[10]=-1,r[14]=-2*o),r},F.aY=function(r){var t=new ri(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},F.aZ=function(r,t,a){var o=Math.sin(a),h=Math.cos(a),_=t[0],g=t[1],v=t[2],w=t[3],M=t[4],C=t[5],A=t[6],R=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=_*h+M*o,r[1]=g*h+C*o,r[2]=v*h+A*o,r[3]=w*h+R*o,r[4]=M*h-_*o,r[5]=C*h-g*o,r[6]=A*h-v*o,r[7]=R*h-w*o,r},F.a_=function(r,t,a){var o=Math.sin(a),h=Math.cos(a),_=t[4],g=t[5],v=t[6],w=t[7],M=t[8],C=t[9],A=t[10],R=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=_*h+M*o,r[5]=g*h+C*o,r[6]=v*h+A*o,r[7]=w*h+R*o,r[8]=M*h-_*o,r[9]=C*h-g*o,r[10]=A*h-v*o,r[11]=R*h-w*o,r},F.aa=function(r){return Math.log(r)/Math.LN2},F.ab=function(r){var t=r[0],a=r[1];return t*t+a*a},F.ac=function(r){return r*Math.PI/180},F.ad=mt,F.ae=function(r,t){const a=[];for(const o in r)o in t||a.push(o);return a},F.af=function(r,t){let a=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:_,maxZoom:g}=r,v=h?mt(Yn.interpolationFactor(h,t,_,g),0,1):0;r.kind==="camera"?o=Fa.number(r.minSize,r.maxSize,v):a=v}return{uSizeT:a,uSize:o}},F.ah=function(r,{uSize:t,uSizeT:a},{lowerSize:o,upperSize:h}){return r.kind==="source"?o/Hs:r.kind==="composite"?Fa.number(o/Hs,h/Hs,a):t},F.ai=function(r,t){var a=t[0],o=t[1],h=t[2],_=t[3],g=t[4],v=t[5],w=t[6],M=t[7],C=t[8],A=t[9],R=t[10],k=t[11],O=t[12],U=t[13],q=t[14],Q=t[15],oe=a*v-o*g,J=a*w-h*g,L=a*M-_*g,Z=o*w-h*v,ee=o*M-_*v,ve=h*M-_*w,je=C*U-A*O,Se=C*q-R*O,Ae=C*Q-k*O,Ze=A*q-R*U,Ue=A*Q-k*U,Ge=R*Q-k*q,Re=oe*Ge-J*Ue+L*Ze+Z*Ae-ee*Se+ve*je;return Re?(r[0]=(v*Ge-w*Ue+M*Ze)*(Re=1/Re),r[1]=(h*Ue-o*Ge-_*Ze)*Re,r[2]=(U*ve-q*ee+Q*Z)*Re,r[3]=(R*ee-A*ve-k*Z)*Re,r[4]=(w*Ae-g*Ge-M*Se)*Re,r[5]=(a*Ge-h*Ae+_*Se)*Re,r[6]=(q*L-O*ve-Q*J)*Re,r[7]=(C*ve-R*L+k*J)*Re,r[8]=(g*Ue-v*Ae+M*je)*Re,r[9]=(o*Ae-a*Ue-_*je)*Re,r[10]=(O*ee-U*L+Q*oe)*Re,r[11]=(A*L-C*ee-k*oe)*Re,r[12]=(v*Se-g*Ze-w*je)*Re,r[13]=(a*Ze-o*Se+h*je)*Re,r[14]=(U*J-O*Z-q*oe)*Re,r[15]=(C*Z-A*J+R*oe)*Re,r):null},F.aj=ki,F.ak=function(r){return Math.hypot(r[0],r[1])},F.al=function(r){return r[0]=0,r[1]=0,r},F.am=function(r,t,a){return r[0]=t[0]*a,r[1]=t[1]*a,r},F.an=Kh,F.ao=qn,F.ap=function(r,t,a,o){const h=t.y-r.y,_=t.x-r.x,g=o.y-a.y,v=o.x-a.x,w=g*_-v*h;if(w===0)return null;const M=(v*(r.y-a.y)-g*(r.x-a.x))/w;return new at(r.x+M*_,r.y+M*h)},F.aq=Wd,F.ar=tl,F.as=Mt,F.at=function(r){let t=1/0,a=1/0,o=-1/0,h=-1/0;for(const _ of r)t=Math.min(t,_.x),a=Math.min(a,_.y),o=Math.max(o,_.x),h=Math.max(h,_.y);return[t,a,o,h]},F.au=Xi,F.av=Pt,F.aw=function(r,t,a,o,h=!1){if(!a[0]&&!a[1])return[0,0];const _=h?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(_){const g=Math.sin(_),v=Math.cos(_);a=[a[0]*v-a[1]*g,a[0]*g+a[1]*v]}return[h?a[0]:Pt(t,a[0],r.zoom),h?a[1]:Pt(t,a[1],r.zoom)]},F.ay=Yh,F.az=cd,F.b=Dr,F.b$=r=>r.type==="circle",F.b0=function(){const r=new Float64Array(16);return Mt(r),r},F.b1=function(){return new Float64Array(16)},F.b2=function(r,t,a){const o=new Float64Array(4);return function(h,_,g,v){var w=.5*Math.PI/180;_*=w,g*=w,v*=w;var M=Math.sin(_),C=Math.cos(_),A=Math.sin(g),R=Math.cos(g),k=Math.sin(v),O=Math.cos(v);h[0]=M*R*O-C*A*k,h[1]=C*A*O+M*R*k,h[2]=C*R*k-M*A*O,h[3]=C*R*O+M*A*k}(o,r,t-90,a),o},F.b3=function(r,t,a,o){var h,_,g,v,w,M=t[0],C=t[1],A=t[2],R=t[3],k=a[0],O=a[1],U=a[2],q=a[3];return(_=M*k+C*O+A*U+R*q)<0&&(_=-_,k=-k,O=-O,U=-U,q=-q),1-_>Xt?(h=Math.acos(_),g=Math.sin(h),v=Math.sin((1-o)*h)/g,w=Math.sin(o*h)/g):(v=1-o,w=o),r[0]=v*M+w*k,r[1]=v*C+w*O,r[2]=v*A+w*U,r[3]=v*R+w*q,r},F.b4=function(r){const t=new Float64Array(9);var a,o,h,_,g,v,w,M,C,A,R,k,O,U,q,Q,oe,J;A=(h=(o=r)[0])*(w=h+h),R=(_=o[1])*w,O=(g=o[2])*w,U=g*(M=_+_),Q=(v=o[3])*w,oe=v*M,J=v*(C=g+g),(a=t)[0]=1-(k=_*M)-(q=g*C),a[3]=R-J,a[6]=O+oe,a[1]=R+J,a[4]=1-A-q,a[7]=U-Q,a[2]=O-oe,a[5]=U+Q,a[8]=1-A-k;const L=Ia(-Math.asin(mt(t[2],-1,1)));let Z,ee;return Math.hypot(t[5],t[8])<.001?(Z=0,ee=-Ia(Math.atan2(t[3],t[4]))):(Z=Ia(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ee=Ia(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Z,pitch:L+90,bearing:ee}},F.b5=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},F.b6=Zt,F.b7=Fs,F.b8=$i,F.b9=ya,F.bA=function(r){const t=[],a=r.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},F.bB=function r(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],a[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const o in t)if(!r(t[o],a[o]))return!1;return!0}return t===a},F.bC=sn,F.bD=Yt,F.bE=class extends Ga{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},F.bF=qr,F.bG=class extends Ga{constructor(r,t){super(r,t),this.current=qa}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},F.bH=Mr,F.bI=class extends Ga{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},F.bJ=class extends Ga{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},F.bK=pi,F.bL=function(r,t){var a=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=a,r[2]=0,r[3]=-a,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},F.bM=function(r,t,a){var o=t[0],h=t[1],_=t[2];return r[0]=o*a[0]+h*a[3]+_*a[6],r[1]=o*a[1]+h*a[4]+_*a[7],r[2]=o*a[2]+h*a[5]+_*a[8],r},F.bN=function(r,t,a,o,h,_,g){var v=1/(t-a),w=1/(o-h),M=1/(_-g);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*M,r[11]=0,r[12]=(t+a)*v,r[13]=(h+o)*w,r[14]=(g+_)*M,r[15]=1,r},F.bO=class extends Kl{},F.bP=wn,F.bQ=class extends Wl{},F.bR=aa,F.bS=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},F.bT=rl,F.bU=function(r,t,a){var o=t[0],h=t[1],_=t[2],g=a[3]*o+a[7]*h+a[11]*_+a[15];return r[0]=(a[0]*o+a[4]*h+a[8]*_+a[12])/(g=g||1),r[1]=(a[1]*o+a[5]*h+a[9]*_+a[13])/g,r[2]=(a[2]*o+a[6]*h+a[10]*_+a[14])/g,r},F.bV=class extends ho{},F.bW=class extends l{},F.bX=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},F.bY=function(r,t){var a=r[0],o=r[1],h=r[2],_=r[3],g=r[4],v=r[5],w=r[6],M=r[7],C=r[8],A=r[9],R=r[10],k=r[11],O=r[12],U=r[13],q=r[14],Q=r[15],oe=t[0],J=t[1],L=t[2],Z=t[3],ee=t[4],ve=t[5],je=t[6],Se=t[7],Ae=t[8],Ze=t[9],Ue=t[10],Ge=t[11],Re=t[12],tt=t[13],gt=t[14],pt=t[15];return Math.abs(a-oe)<=Xt*Math.max(1,Math.abs(a),Math.abs(oe))&&Math.abs(o-J)<=Xt*Math.max(1,Math.abs(o),Math.abs(J))&&Math.abs(h-L)<=Xt*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(_-Z)<=Xt*Math.max(1,Math.abs(_),Math.abs(Z))&&Math.abs(g-ee)<=Xt*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(v-ve)<=Xt*Math.max(1,Math.abs(v),Math.abs(ve))&&Math.abs(w-je)<=Xt*Math.max(1,Math.abs(w),Math.abs(je))&&Math.abs(M-Se)<=Xt*Math.max(1,Math.abs(M),Math.abs(Se))&&Math.abs(C-Ae)<=Xt*Math.max(1,Math.abs(C),Math.abs(Ae))&&Math.abs(A-Ze)<=Xt*Math.max(1,Math.abs(A),Math.abs(Ze))&&Math.abs(R-Ue)<=Xt*Math.max(1,Math.abs(R),Math.abs(Ue))&&Math.abs(k-Ge)<=Xt*Math.max(1,Math.abs(k),Math.abs(Ge))&&Math.abs(O-Re)<=Xt*Math.max(1,Math.abs(O),Math.abs(Re))&&Math.abs(U-tt)<=Xt*Math.max(1,Math.abs(U),Math.abs(tt))&&Math.abs(q-gt)<=Xt*Math.max(1,Math.abs(q),Math.abs(gt))&&Math.abs(Q-pt)<=Xt*Math.max(1,Math.abs(Q),Math.abs(pt))},F.bZ=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},F.b_=r=>r.type==="symbol",F.ba=ac,F.bb=si,F.bc=ue,F.bd=xa,F.be=function(r,t,a,o,h){return si(o,h,mt((r-t)/(a-t),0,1))},F.bf=Tt,F.bg=function(){return new Float64Array(4)},F.bh=function(){return new Float64Array(3)},F.bi=function(r,t,a,o){var h=[],_=[];return h[0]=t[0]-a[0],h[1]=t[1]-a[1],h[2]=t[2]-a[2],_[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),_[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),_[2]=h[2],r[0]=_[0]+a[0],r[1]=_[1]+a[1],r[2]=_[2]+a[2],r},F.bj=function(r,t,a,o){var h=[],_=[];return h[0]=t[0]-a[0],h[1]=t[1]-a[1],h[2]=t[2]-a[2],_[0]=h[0],_[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),_[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),r[0]=_[0]+a[0],r[1]=_[1]+a[1],r[2]=_[2]+a[2],r},F.bk=function(r,t,a,o){var h=[],_=[];return h[0]=t[0]-a[0],h[1]=t[1]-a[1],h[2]=t[2]-a[2],_[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),_[1]=h[1],_[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),r[0]=_[0]+a[0],r[1]=_[1]+a[1],r[2]=_[2]+a[2],r},F.bl=function(r,t,a){var o=Math.sin(a),h=Math.cos(a),_=t[0],g=t[1],v=t[2],w=t[3],M=t[8],C=t[9],A=t[10],R=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=_*h-M*o,r[1]=g*h-C*o,r[2]=v*h-A*o,r[3]=w*h-R*o,r[8]=_*o+M*h,r[9]=g*o+C*h,r[10]=v*o+A*h,r[11]=w*o+R*h,r},F.bm=function(r,t){const a=Tt(r,360),o=Tt(t,360),h=o-a,_=o>a?h-360:h+360;return Math.abs(h)<Math.abs(_)?h:_},F.bn=function(r){return r[0]=0,r[1]=0,r[2]=0,r},F.bo=function(r,t,a,o){const h=Math.sqrt(r*r+t*t),_=Math.sqrt(a*a+o*o);r/=h,t/=h,a/=_,o/=_;const g=Math.acos(r*a+t*o);return-t*a+r*o>0?g:-g},F.bp=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},F.bq=ed,F.br=function(r,t){const a=Tt(r,2*Math.PI),o=Tt(t,2*Math.PI);return Math.min(Math.abs(a-o),Math.abs(a-o+2*Math.PI),Math.abs(a-o-2*Math.PI))},F.bs=function(r){return Math.hypot(r[0],r[1],r[2])},F.bt=function(){const r={},t=P.$version;for(const a in P.$root){const o=P.$root[a];if(o.required){let h=null;h=a==="version"?t:o.type==="array"?[]:{},h!=null&&(r[a]=h)}}return r},F.bu=$c,F.bv=Qa,F.bw=function(r){r=r.slice();const t=Object.create(null);for(let a=0;a<r.length;a++)t[r[a].id]=r[a];for(let a=0;a<r.length;a++)"ref"in r[a]&&(r[a]=H(r[a],t[r[a].ref]));return r},F.bx=function(r){if(r.type==="custom")return new Jf(r);switch(r.type){case"background":return new Wf(r);case"circle":return new mf(r);case"fill":return new wo(r);case"fill-extrusion":return new Ld(r);case"heatmap":return new Oh(r);case"hillshade":return new Sd(r);case"line":return new Ni(r);case"raster":return new Df(r);case"symbol":return new $s(r)}},F.by=oi,F.bz=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let a=[];try{if(!K(r.version,t.version))return[{command:"setStyle",args:[t]}];K(r.center,t.center)||a.push({command:"setCenter",args:[t.center]}),K(r.centerAltitude,t.centerAltitude)||a.push({command:"setCenterAltitude",args:[t.centerAltitude]}),K(r.zoom,t.zoom)||a.push({command:"setZoom",args:[t.zoom]}),K(r.bearing,t.bearing)||a.push({command:"setBearing",args:[t.bearing]}),K(r.pitch,t.pitch)||a.push({command:"setPitch",args:[t.pitch]}),K(r.roll,t.roll)||a.push({command:"setRoll",args:[t.roll]}),K(r.sprite,t.sprite)||a.push({command:"setSprite",args:[t.sprite]}),K(r.glyphs,t.glyphs)||a.push({command:"setGlyphs",args:[t.glyphs]}),K(r.transition,t.transition)||a.push({command:"setTransition",args:[t.transition]}),K(r.light,t.light)||a.push({command:"setLight",args:[t.light]}),K(r.terrain,t.terrain)||a.push({command:"setTerrain",args:[t.terrain]}),K(r.sky,t.sky)||a.push({command:"setSky",args:[t.sky]}),K(r.projection,t.projection)||a.push({command:"setProjection",args:[t.projection]});const o={},h=[];(function(g,v,w,M){let C;for(C in v=v||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(v,C)||be(C,w,M));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(g,C)?K(g[C],v[C])||(g[C].type==="geojson"&&v[C].type==="geojson"&&Pe(g,v,C)?re(w,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):ce(C,v,w,M)):he(C,v,w))})(r.sources,t.sources,h,o);const _=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?a.push({command:"removeLayer",args:[g.id]}):_.push(g)}),a=a.concat(h),function(g,v,w){v=v||[];const M=(g=g||[]).map(me),C=v.map(me),A=g.reduce(Be,{}),R=v.reduce(Be,{}),k=M.slice(),O=Object.create(null);let U,q,Q,oe,J;for(let L=0,Z=0;L<M.length;L++)U=M[L],Object.prototype.hasOwnProperty.call(R,U)?Z++:(re(w,{command:"removeLayer",args:[U]}),k.splice(k.indexOf(U,Z),1));for(let L=0,Z=0;L<C.length;L++)U=C[C.length-1-L],k[k.length-1-L]!==U&&(Object.prototype.hasOwnProperty.call(A,U)?(re(w,{command:"removeLayer",args:[U]}),k.splice(k.lastIndexOf(U,k.length-Z),1)):Z++,oe=k[k.length-L],re(w,{command:"addLayer",args:[R[U],oe]}),k.splice(k.length-L,0,U),O[U]=!0);for(let L=0;L<C.length;L++)if(U=C[L],q=A[U],Q=R[U],!O[U]&&!K(q,Q))if(K(q.source,Q.source)&&K(q["source-layer"],Q["source-layer"])&&K(q.type,Q.type)){for(J in Me(q.layout,Q.layout,w,U,null,"setLayoutProperty"),Me(q.paint,Q.paint,w,U,null,"setPaintProperty"),K(q.filter,Q.filter)||re(w,{command:"setFilter",args:[U,Q.filter]}),K(q.minzoom,Q.minzoom)&&K(q.maxzoom,Q.maxzoom)||re(w,{command:"setLayerZoomRange",args:[U,Q.minzoom,Q.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Me(q[J],Q[J],w,U,J.slice(6),"setPaintProperty"):K(q[J],Q[J])||re(w,{command:"setLayerProperty",args:[U,J,Q[J]]}));for(J in Q)Object.prototype.hasOwnProperty.call(Q,J)&&!Object.prototype.hasOwnProperty.call(q,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Me(q[J],Q[J],w,U,J.slice(6),"setPaintProperty"):K(q[J],Q[J])||re(w,{command:"setLayerProperty",args:[U,J,Q[J]]}))}else re(w,{command:"removeLayer",args:[U]}),oe=k[k.lastIndexOf(U)+1],re(w,{command:"addLayer",args:[Q,oe]})}(_,t.layers,a)}catch(o){console.warn("Unable to compute style diff:",o),a=[{command:"setStyle",args:[t]}]}return a},F.c=Ys,F.c0=r=>r.type==="heatmap",F.c1=r=>r.type==="line",F.c2=r=>r.type==="fill",F.c3=r=>r.type==="fill-extrusion",F.c4=r=>r.type==="hillshade",F.c5=r=>r.type==="raster",F.c6=r=>r.type==="background",F.c7=r=>r.type==="custom",F.c8=Xe,F.c9=function(r,t,a){const o=kn(t.x-a.x,t.y-a.y),h=kn(r.x-a.x,r.y-a.y);var _,g;return Ia(Math.atan2(o[0]*h[1]-o[1]*h[0],(_=o)[0]*(g=h)[0]+_[1]*g[1]))},F.cA=ai,F.cB=Rd,F.cC=Zh,F.cD=Vr,F.cE=wr,F.ca=vt,F.cb=function(r,t,a){var o=t[0],h=t[1];return r[0]=a[0]*o+a[4]*h+a[12],r[1]=a[1]*o+a[5]*h+a[13],r},F.cc=function(r,t){const{x:a,y:o}=qt.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||a<0||a>=1)},F.cd=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},F.ce=class extends uo{},F.cf=_h,F.ch=function(r){return r.message===Po},F.ci=Rr,F.cj=function(r,t){ia.REGISTERED_PROTOCOLS[r]=t},F.ck=function(r){delete ia.REGISTERED_PROTOCOLS[r]},F.cl=function(r,t){const a={};for(let h=0;h<r.length;h++){const _=t&&t[r[h].id]||Qn(r[h]);t&&(t[r[h].id]=_);let g=a[_];g||(g=a[_]=[]),g.push(r[h])}const o=[];for(const h in a)o.push(a[h]);return o},F.cm=Ke,F.cn=uh,F.co=Kd,F.cp=Hh,F.cq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=qe/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],a=t.layout,o=t._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ei(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ei(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ei(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=r.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ei(M),r.canonical),o["text-size"].possiblyEvaluate(new Ei(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=r.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ei(M),r.canonical),o["icon-size"].possiblyEvaluate(new Ei(C),r.canonical)]}const _=a.get("text-line-height")*Xi,g=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",v=a.get("text-keep-upright"),w=a.get("text-size");for(const M of r.bucket.features){const C=a.get("text-font").evaluate(M,{},r.canonical).join(","),A=w.evaluate(M,{},r.canonical),R=h.layoutTextSize.evaluate(M,{},r.canonical),k=h.layoutIconSize.evaluate(M,{},r.canonical),O={horizontal:{},vertical:void 0},U=M.text;let q,Q=[0,0];if(U){const L=U.toString(),Z=a.get("text-letter-spacing").evaluate(M,{},r.canonical)*Xi,ee=Wo(L)?Z:0,ve=a.get("text-anchor").evaluate(M,{},r.canonical),je=af(t,M,r.canonical);if(!je){const Ue=a.get("text-radial-offset").evaluate(M,{},r.canonical);Q=Ue?Xr(ve,[Ue*Xi,nf]):a.get("text-offset").evaluate(M,{},r.canonical).map(Ge=>Ge*Xi)}let Se=g?"center":a.get("text-justify").evaluate(M,{},r.canonical);const Ae=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(M,{},r.canonical)*Xi:1/0,Ze=()=>{r.bucket.allowVerticalPlacement&&Ko(L)&&(O.vertical=hu(U,r.glyphMap,r.glyphPositions,r.imagePositions,C,Ae,_,ve,"left",ee,Q,F.ag.vertical,!0,R,A))};if(!g&&je){const Ue=new Set;if(Se==="auto")for(let Re=0;Re<je.values.length;Re+=2)Ue.add(cd(je.values[Re]));else Ue.add(Se);let Ge=!1;for(const Re of Ue)if(!O.horizontal[Re])if(Ge)O.horizontal[Re]=O.horizontal[0];else{const tt=hu(U,r.glyphMap,r.glyphPositions,r.imagePositions,C,Ae,_,"center",Re,ee,Q,F.ag.horizontal,!1,R,A);tt&&(O.horizontal[Re]=tt,Ge=tt.positionedLines.length===1)}Ze()}else{Se==="auto"&&(Se=cd(ve));const Ue=hu(U,r.glyphMap,r.glyphPositions,r.imagePositions,C,Ae,_,ve,Se,ee,Q,F.ag.horizontal,!1,R,A);Ue&&(O.horizontal[Se]=Ue),Ze(),Ko(L)&&g&&v&&(O.vertical=hu(U,r.glyphMap,r.glyphPositions,r.imagePositions,C,Ae,_,ve,Se,ee,Q,F.ag.vertical,!1,R,A))}}let oe=!1;if(M.icon&&M.icon.name){const L=r.imageMap[M.icon.name];L&&(q=fu(r.imagePositions[M.icon.name],a.get("icon-offset").evaluate(M,{},r.canonical),a.get("icon-anchor").evaluate(M,{},r.canonical)),oe=!!L.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=oe:r.bucket.sdfIcons!==oe&&Ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(L.pixelRatio!==r.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const J=fh(O.horizontal)||O.vertical;r.bucket.iconsInText=!!J&&J.iconsInText,(J||q)&&Yr(r.bucket,M,O,q,r.imageMap,h,R,k,Q,oe,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},F.cr=Od,F.cs=Ar,F.ct=eh,F.cu=dl,F.cv=cu,F.cw=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},F.cx=function(r,t,a,o,h){return d(this,void 0,void 0,function*(){if(Ki())try{return yield Da(r,t,a,o,h)}catch{}return function(_,g,v,w,M){const C=_.width,A=_.height;fr&&Ir||(fr=new OffscreenCanvas(C,A),Ir=fr.getContext("2d",{willReadFrequently:!0})),fr.width=C,fr.height=A,Ir.drawImage(_,0,0,C,A);const R=Ir.getImageData(g,v,w,M);return Ir.clearRect(0,0,C,A),R.data}(r,t,a,o,h)})},F.cy=yu,F.cz=ot,F.d=Qr,F.e=Ct,F.f=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),F.g=Do,F.h=r=>new Promise((t,a)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Xa})},o.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(h):Xa}),F.i=ta,F.j=(r,t)=>gs(Ct(r,{type:"json"}),t),F.k=on,F.l=Kr,F.m=gs,F.n=(r,t)=>gs(Ct(r,{type:"arrayBuffer"}),t),F.o=function(r){return new cu(r).readFields(_l,[])},F.p=qh,F.q=go,F.r=na,F.s=Ya,F.t=Qo,F.u=yt,F.v=P,F.w=Ci,F.x=Za,F.y=hs,F.z=function([r,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(a),y:r*Math.sin(t)*Math.sin(a),z:r*Math.cos(a)}}}),Ot("worker",["./shared"],function(F){class d{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,V){for(const K of P){this._layerConfigs[K.id]=K;const re=this._layers[K.id]=F.bx(K);re._featureFilter=F.a6(re.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of V)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const H=F.cl(Object.values(this._layerConfigs),this.keyCache);for(const K of H){const re=K.map(me=>this._layers[me.id]),he=re[0];if(he.visibility==="none")continue;const be=he.source||"";let ce=this.familiesBySource[be];ce||(ce=this.familiesBySource[be]={});const Pe=he.sourceLayer||"_geojsonTileLayer";let Me=ce[Pe];Me||(Me=ce[Pe]=[]),Me.push(re)}}}class ot{constructor(P){const V={},H=[];for(const be in P){const ce=P[be],Pe=V[be]={};for(const Me in ce){const me=ce[+Me];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const Be={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};H.push(Be),Pe[Me]={rect:Be,metrics:me.metrics}}}const{w:K,h:re}=F.p(H),he=new F.q({width:K||1,height:re||1});for(const be in P){const ce=P[be];for(const Pe in ce){const Me=ce[+Pe];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const me=V[be][Pe].rect;F.q.copy(Me.bitmap,he,{x:0,y:0},{x:me.x+1,y:me.y+1},Me.bitmap)}}this.image=he,this.positions=V}}F.cm("GlyphAtlas",ot);class Ve{constructor(P){this.tileID=new F.Y(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId,this.inFlightDependencies=[]}parse(P,V,H,K,re){return F._(this,void 0,void 0,function*(){this.status="parsing",this.data=P,this.collisionBoxArray=new F.a4;const he=new F.cn(Object.keys(P.layers).sort()),be=new F.co(this.tileID,this.promoteId);be.bucketLayerIDs=[];const ce={},Pe={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H,subdivisionGranularity:re},Me=V.familiesBySource[this.source];for(const _t in Me){const xt=P.layers[_t];if(!xt)continue;xt.version===1&&F.w(`Vector tile source "${this.source}" layer "${_t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const et=he.encode(_t),Ka=[];for(let Wi=0;Wi<xt.length;Wi++){const Cn=xt.feature(Wi),Mi=be.getId(Cn,_t);Ka.push({feature:Cn,id:Mi,index:Wi,sourceLayerIndex:et})}for(const Wi of Me[_t]){const Cn=Wi[0];Cn.source!==this.source&&F.w(`layer.source = ${Cn.source} does not equal this.source = ${this.source}`),Cn.minzoom&&this.zoom<Math.floor(Cn.minzoom)||Cn.maxzoom&&this.zoom>=Cn.maxzoom||Cn.visibility!=="none"&&(Ft(Wi,this.zoom,H),(ce[Cn.id]=Cn.createBucket({index:be.bucketLayerIDs.length,layers:Wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:et,sourceID:this.source})).populate(Ka,Pe,this.tileID.canonical),be.bucketLayerIDs.push(Wi.map(Mi=>Mi.id)))}}const me=F.bC(Pe.glyphDependencies,_t=>Object.keys(_t).map(Number));this.inFlightDependencies.forEach(_t=>_t==null?void 0:_t.abort()),this.inFlightDependencies=[];let Be=Promise.resolve({});if(Object.keys(me).length){const _t=new AbortController;this.inFlightDependencies.push(_t),Be=K.sendAsync({type:"GG",data:{stacks:me,source:this.source,tileID:this.tileID,type:"glyphs"}},_t)}const _e=Object.keys(Pe.iconDependencies);let Qe=Promise.resolve({});if(_e.length){const _t=new AbortController;this.inFlightDependencies.push(_t),Qe=K.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},_t)}const lt=Object.keys(Pe.patternDependencies);let At=Promise.resolve({});if(lt.length){const _t=new AbortController;this.inFlightDependencies.push(_t),At=K.sendAsync({type:"GI",data:{icons:lt,source:this.source,tileID:this.tileID,type:"patterns"}},_t)}const[wt,ke,it]=yield Promise.all([Be,Qe,At]),Je=new ot(wt),Bt=new F.cp(ke,it);for(const _t in ce){const xt=ce[_t];xt instanceof F.a5?(Ft(xt.layers,this.zoom,H),F.cq({bucket:xt,glyphMap:wt,glyphPositions:Je.positions,imageMap:ke,imagePositions:Bt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Pe.subdivisionGranularity})):xt.hasPattern&&(xt instanceof F.cr||xt instanceof F.cs||xt instanceof F.ct)&&(Ft(xt.layers,this.zoom,H),xt.addFeatures(Pe,this.tileID.canonical,Bt.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(_t=>!_t.isEmpty()),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Je.image,imageAtlas:Bt,glyphMap:this.returnDependencies?wt:null,iconMap:this.returnDependencies?ke:null,glyphPositions:this.returnDependencies?Je.positions:null}})}}function Ft(pe,P,V){const H=new F.C(P);for(const K of pe)K.recalculate(H,V)}class ai{constructor(P,V,H){this.actor=P,this.layerIndex=V,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(P,V){return F._(this,void 0,void 0,function*(){const H=yield F.n(P.request,V);try{return{vectorTile:new F.cu.VectorTile(new F.cv(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(K){const re=new Uint8Array(H.data);let he=`Unable to parse the tile at ${P.request.url}, `;throw he+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${K.message}`,new Error(he)}})}loadTile(P){return F._(this,void 0,void 0,function*(){const V=P.uid,H=!!(P&&P.request&&P.request.collectResourceTiming)&&new F.cw(P.request),K=new Ve(P);this.loading[V]=K;const re=new AbortController;K.abort=re;try{const he=yield this.loadVectorTile(P,re);if(delete this.loading[V],!he)return null;const be=he.rawData,ce={};he.expires&&(ce.expires=he.expires),he.cacheControl&&(ce.cacheControl=he.cacheControl);const Pe={};if(H){const me=H.finish();me&&(Pe.resourceTiming=JSON.parse(JSON.stringify(me)))}K.vectorTile=he.vectorTile;const Me=K.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,P.subdivisionGranularity);this.loaded[V]=K,this.fetching[V]={rawTileData:be,cacheControl:ce,resourceTiming:Pe};try{const me=yield Me;return F.e({rawTileData:be.slice(0)},me,ce,Pe)}finally{delete this.fetching[V]}}catch(he){throw delete this.loading[V],K.status="done",this.loaded[V]=K,he}})}reloadTile(P){return F._(this,void 0,void 0,function*(){const V=P.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[V];if(H.showCollisionBoxes=P.showCollisionBoxes,H.status==="parsing"){const K=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,P.subdivisionGranularity);let re;if(this.fetching[V]){const{rawTileData:he,cacheControl:be,resourceTiming:ce}=this.fetching[V];delete this.fetching[V],re=F.e({rawTileData:he.slice(0)},K,be,ce)}else re=K;return re}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,P.subdivisionGranularity)})}abortTile(P){return F._(this,void 0,void 0,function*(){const V=this.loading,H=P.uid;V&&V[H]&&V[H].abort&&(V[H].abort.abort(),delete V[H])})}removeTile(P){return F._(this,void 0,void 0,function*(){this.loaded&&this.loaded[P.uid]&&delete this.loaded[P.uid]})}}class ut{constructor(){this.loaded={}}loadTile(P){return F._(this,void 0,void 0,function*(){const{uid:V,encoding:H,rawImageData:K,redFactor:re,greenFactor:he,blueFactor:be,baseShift:ce}=P,Pe=K.width+2,Me=K.height+2,me=F.b(K)?new F.R({width:Pe,height:Me},yield F.cx(K,-1,-1,Pe,Me)):K,Be=new F.cy(V,me,H,re,he,be,ce);return this.loaded=this.loaded||{},this.loaded[V]=Be,Be})}removeTile(P){const V=this.loaded,H=P.uid;V&&V[H]&&delete V[H]}}var xe,at,Rn=function(){if(at)return xe;function pe(V,H){if(V.length!==0){P(V[0],H);for(var K=1;K<V.length;K++)P(V[K],!H)}}function P(V,H){for(var K=0,re=0,he=0,be=V.length,ce=be-1;he<be;ce=he++){var Pe=(V[he][0]-V[ce][0])*(V[ce][1]+V[he][1]),Me=K+Pe;re+=Math.abs(K)>=Math.abs(Pe)?K-Me+Pe:Pe-Me+K,K=Me}K+re>=0!=!!H&&V.reverse()}return at=1,xe=function V(H,K){var re,he=H&&H.type;if(he==="FeatureCollection")for(re=0;re<H.features.length;re++)V(H.features[re],K);else if(he==="GeometryCollection")for(re=0;re<H.geometries.length;re++)V(H.geometries[re],K);else if(he==="Feature")V(H.geometry,K);else if(he==="Polygon")pe(H.coordinates,K);else if(he==="MultiPolygon")for(re=0;re<H.coordinates.length;re++)pe(H.coordinates[re],K);return H}}(),gn=F.cz(Rn);const la=F.cu.VectorTileFeature.prototype.toGeoJSON;class an{constructor(P){this._feature=P,this.extent=F.Z,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(this._feature.type===1){const P=[];for(const V of this._feature.geometry)P.push([new F.P(V[0],V[1])]);return P}{const P=[];for(const V of this._feature.geometry){const H=[];for(const K of V)H.push(new F.P(K[0],K[1]));P.push(H)}return P}}toGeoJSON(P,V,H){return la.call(this,P,V,H)}}class ca{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=F.Z,this.length=P.length,this._features=P}feature(P){return new an(this._features[P])}}var Ki,Vt,Xt,ri={exports:{}},pi=function(){if(Xt)return ri.exports;Xt=1;var pe=F.cC(),P=function(){if(Vt)return Ki;Vt=1;var Me=F.cA(),me=F.cB().VectorTileFeature;function Be(Qe,lt){this.options=lt||{},this.features=Qe,this.length=Qe.length}function _e(Qe,lt){this.id=typeof Qe.id=="number"?Qe.id:void 0,this.type=Qe.type,this.rawGeometry=Qe.type===1?[Qe.geometry]:Qe.geometry,this.properties=Qe.tags,this.extent=lt||4096}return Ki=Be,Be.prototype.feature=function(Qe){return new _e(this.features[Qe],this.options.extent)},_e.prototype.loadGeometry=function(){var Qe=this.rawGeometry;this.geometry=[];for(var lt=0;lt<Qe.length;lt++){for(var At=Qe[lt],wt=[],ke=0;ke<At.length;ke++)wt.push(new Me(At[ke][0],At[ke][1]));this.geometry.push(wt)}return this.geometry},_e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qe=this.geometry,lt=1/0,At=-1/0,wt=1/0,ke=-1/0,it=0;it<Qe.length;it++)for(var Je=Qe[it],Bt=0;Bt<Je.length;Bt++){var _t=Je[Bt];lt=Math.min(lt,_t.x),At=Math.max(At,_t.x),wt=Math.min(wt,_t.y),ke=Math.max(ke,_t.y)}return[lt,wt,At,ke]},_e.prototype.toGeoJSON=me.prototype.toGeoJSON,Ki}();function V(Me){var me=new pe;return function(Be,_e){for(var Qe in Be.layers)_e.writeMessage(3,H,Be.layers[Qe])}(Me,me),me.finish()}function H(Me,me){var Be;me.writeVarintField(15,Me.version||1),me.writeStringField(1,Me.name||""),me.writeVarintField(5,Me.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(Be=0;Be<Me.length;Be++)_e.feature=Me.feature(Be),me.writeMessage(2,K,_e);var Qe=_e.keys;for(Be=0;Be<Qe.length;Be++)me.writeStringField(3,Qe[Be]);var lt=_e.values;for(Be=0;Be<lt.length;Be++)me.writeMessage(4,Pe,lt[Be])}function K(Me,me){var Be=Me.feature;Be.id!==void 0&&me.writeVarintField(1,Be.id),me.writeMessage(2,re,Me),me.writeVarintField(3,Be.type),me.writeMessage(4,ce,Be)}function re(Me,me){var Be=Me.feature,_e=Me.keys,Qe=Me.values,lt=Me.keycache,At=Me.valuecache;for(var wt in Be.properties){var ke=Be.properties[wt],it=lt[wt];if(ke!==null){it===void 0&&(_e.push(wt),lt[wt]=it=_e.length-1),me.writeVarint(it);var Je=typeof ke;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(ke=JSON.stringify(ke));var Bt=Je+":"+ke,_t=At[Bt];_t===void 0&&(Qe.push(ke),At[Bt]=_t=Qe.length-1),me.writeVarint(_t)}}}function he(Me,me){return(me<<3)+(7&Me)}function be(Me){return Me<<1^Me>>31}function ce(Me,me){for(var Be=Me.loadGeometry(),_e=Me.type,Qe=0,lt=0,At=Be.length,wt=0;wt<At;wt++){var ke=Be[wt],it=1;_e===1&&(it=ke.length),me.writeVarint(he(1,it));for(var Je=_e===3?ke.length-1:ke.length,Bt=0;Bt<Je;Bt++){Bt===1&&_e!==1&&me.writeVarint(he(2,Je-1));var _t=ke[Bt].x-Qe,xt=ke[Bt].y-lt;me.writeVarint(be(_t)),me.writeVarint(be(xt)),Qe+=_t,lt+=xt}_e===3&&me.writeVarint(he(7,1))}}function Pe(Me,me){var Be=typeof Me;Be==="string"?me.writeStringField(1,Me):Be==="boolean"?me.writeBooleanField(7,Me):Be==="number"&&(Me%1!=0?me.writeDoubleField(3,Me):Me<0?me.writeSVarintField(6,Me):me.writeVarintField(5,Me))}return ri.exports=V,ri.exports.fromVectorTileJs=V,ri.exports.fromGeojsonVt=function(Me,me){me=me||{};var Be={};for(var _e in Me)Be[_e]=new P(Me[_e].features,me),Be[_e].name=_e,Be[_e].version=me.version,Be[_e].extent=me.extent;return V({layers:Be})},ri.exports.GeoJSONWrapper=P,ri.exports}(),Mt=F.cz(pi);const ti={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},En=Math.fround||(qn=new Float32Array(1),pe=>(qn[0]=+pe,qn[0]));var qn;const rn=3,ki=5,kn=6;class qe{constructor(P){this.options=Object.assign(Object.create(ti),P),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(P){const{log:V,minZoom:H,maxZoom:K}=this.options;V&&console.time("total time");const re=`prepare ${P.length} points`;V&&console.time(re),this.points=P;const he=[];for(let ce=0;ce<P.length;ce++){const Pe=P[ce];if(!Pe.geometry)continue;const[Me,me]=Pe.geometry.coordinates,Be=En(si(Me)),_e=En(ue(me));he.push(Be,_e,1/0,ce,-1,1),this.options.reduce&&he.push(0)}let be=this.trees[K+1]=this._createTree(he);V&&console.timeEnd(re);for(let ce=K;ce>=H;ce--){const Pe=+Date.now();be=this.trees[ce]=this._createTree(this._cluster(be,ce)),V&&console.log("z%d: %d clusters in %dms",ce,be.numItems,+Date.now()-Pe)}return V&&console.timeEnd("total time"),this}getClusters(P,V){let H=((P[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,P[1]));let re=P[2]===180?180:((P[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)H=-180,re=180;else if(H>re){const me=this.getClusters([H,K,180,he],V),Be=this.getClusters([-180,K,re,he],V);return me.concat(Be)}const be=this.trees[this._limitZoom(V)],ce=be.range(si(H),ue(he),si(re),ue(K)),Pe=be.data,Me=[];for(const me of ce){const Be=this.stride*me;Me.push(Pe[Be+ki]>1?Pt(Pe,Be,this.clusterProps):this.points[Pe[Be+rn]])}return Me}getChildren(P){const V=this._getOriginId(P),H=this._getOriginZoom(P),K="No cluster with the specified id.",re=this.trees[H];if(!re)throw new Error(K);const he=re.data;if(V*this.stride>=he.length)throw new Error(K);const be=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ce=re.within(he[V*this.stride],he[V*this.stride+1],be),Pe=[];for(const Me of ce){const me=Me*this.stride;he[me+4]===P&&Pe.push(he[me+ki]>1?Pt(he,me,this.clusterProps):this.points[he[me+rn]])}if(Pe.length===0)throw new Error(K);return Pe}getLeaves(P,V,H){const K=[];return this._appendLeaves(K,P,V=V||10,H=H||0,0),K}getTile(P,V,H){const K=this.trees[this._limitZoom(P)],re=Math.pow(2,P),{extent:he,radius:be}=this.options,ce=be/he,Pe=(H-ce)/re,Me=(H+1+ce)/re,me={features:[]};return this._addTileFeatures(K.range((V-ce)/re,Pe,(V+1+ce)/re,Me),K.data,V,H,re,me),V===0&&this._addTileFeatures(K.range(1-ce/re,Pe,1,Me),K.data,re,H,re,me),V===re-1&&this._addTileFeatures(K.range(0,Pe,ce/re,Me),K.data,-1,H,re,me),me.features.length?me:null}getClusterExpansionZoom(P){let V=this._getOriginZoom(P)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(P);if(V++,H.length!==1)break;P=H[0].properties.cluster_id}return V}_appendLeaves(P,V,H,K,re){const he=this.getChildren(V);for(const be of he){const ce=be.properties;if(ce&&ce.cluster?re+ce.point_count<=K?re+=ce.point_count:re=this._appendLeaves(P,ce.cluster_id,H,K,re):re<K?re++:P.push(be),P.length===H)break}return re}_createTree(P){const V=new F.aB(P.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<P.length;H+=this.stride)V.add(P[H],P[H+1]);return V.finish(),V.data=P,V}_addTileFeatures(P,V,H,K,re,he){for(const be of P){const ce=be*this.stride,Pe=V[ce+ki]>1;let Me,me,Be;if(Pe)Me=Tt(V,ce,this.clusterProps),me=V[ce],Be=V[ce+1];else{const lt=this.points[V[ce+rn]];Me=lt.properties;const[At,wt]=lt.geometry.coordinates;me=si(At),Be=ue(wt)}const _e={type:1,geometry:[[Math.round(this.options.extent*(me*re-H)),Math.round(this.options.extent*(Be*re-K))]],tags:Me};let Qe;Qe=Pe||this.options.generateId?V[ce+rn]:this.points[V[ce+rn]].id,Qe!==void 0&&(_e.id=Qe),he.features.push(_e)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(Math.floor(+P),this.options.maxZoom+1))}_cluster(P,V){const{radius:H,extent:K,reduce:re,minPoints:he}=this.options,be=H/(K*Math.pow(2,V)),ce=P.data,Pe=[],Me=this.stride;for(let me=0;me<ce.length;me+=Me){if(ce[me+2]<=V)continue;ce[me+2]=V;const Be=ce[me],_e=ce[me+1],Qe=P.within(ce[me],ce[me+1],be),lt=ce[me+ki];let At=lt;for(const wt of Qe){const ke=wt*Me;ce[ke+2]>V&&(At+=ce[ke+ki])}if(At>lt&&At>=he){let wt,ke=Be*lt,it=_e*lt,Je=-1;const Bt=((me/Me|0)<<5)+(V+1)+this.points.length;for(const _t of Qe){const xt=_t*Me;if(ce[xt+2]<=V)continue;ce[xt+2]=V;const et=ce[xt+ki];ke+=ce[xt]*et,it+=ce[xt+1]*et,ce[xt+4]=Bt,re&&(wt||(wt=this._map(ce,me,!0),Je=this.clusterProps.length,this.clusterProps.push(wt)),re(wt,this._map(ce,xt)))}ce[me+4]=Bt,Pe.push(ke/At,it/At,1/0,Bt,-1,At),re&&Pe.push(Je)}else{for(let wt=0;wt<Me;wt++)Pe.push(ce[me+wt]);if(At>1)for(const wt of Qe){const ke=wt*Me;if(!(ce[ke+2]<=V)){ce[ke+2]=V;for(let it=0;it<Me;it++)Pe.push(ce[ke+it])}}}}return Pe}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,V,H){if(P[V+ki]>1){const he=this.clusterProps[P[V+kn]];return H?Object.assign({},he):he}const K=this.points[P[V+rn]].properties,re=this.options.map(K);return H&&re===K?Object.assign({},re):re}}function Pt(pe,P,V){return{type:"Feature",id:pe[P+rn],properties:Tt(pe,P,V),geometry:{type:"Point",coordinates:[(H=pe[P],360*(H-.5)),Xe(pe[P+1])]}};var H}function Tt(pe,P,V){const H=pe[P+ki],K=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,re=pe[P+kn],he=re===-1?{}:Object.assign({},V[re]);return Object.assign(he,{cluster:!0,cluster_id:pe[P+rn],point_count:H,point_count_abbreviated:K})}function si(pe){return pe/360+.5}function ue(pe){const P=Math.sin(pe*Math.PI/180),V=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return V<0?0:V>1?1:V}function Xe(pe){const P=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function vt(pe,P,V,H){let K=H;const re=P+(V-P>>1);let he,be=V-P;const ce=pe[P],Pe=pe[P+1],Me=pe[V],me=pe[V+1];for(let Be=P+3;Be<V;Be+=3){const _e=mt(pe[Be],pe[Be+1],ce,Pe,Me,me);if(_e>K)he=Be,K=_e;else if(_e===K){const Qe=Math.abs(Be-re);Qe<be&&(he=Be,be=Qe)}}K>H&&(he-P>3&&vt(pe,P,he,H),pe[he+2]=K,V-he>3&&vt(pe,he,V,H))}function mt(pe,P,V,H,K,re){let he=K-V,be=re-H;if(he!==0||be!==0){const ce=((pe-V)*he+(P-H)*be)/(he*he+be*be);ce>1?(V=K,H=re):ce>0&&(V+=he*ce,H+=be*ce)}return he=pe-V,be=P-H,he*he+be*be}function We(pe,P,V,H){const K={id:pe??null,type:P,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(P==="Point"||P==="MultiPoint"||P==="LineString")Ct(K,V);else if(P==="Polygon")Ct(K,V[0]);else if(P==="MultiLineString")for(const re of V)Ct(K,re);else if(P==="MultiPolygon")for(const re of V)Ct(K,re[0]);return K}function Ct(pe,P){for(let V=0;V<P.length;V+=3)pe.minX=Math.min(pe.minX,P[V]),pe.minY=Math.min(pe.minY,P[V+1]),pe.maxX=Math.max(pe.maxX,P[V]),pe.maxY=Math.max(pe.maxY,P[V+1])}function kt(pe,P,V,H){if(!P.geometry)return;const K=P.geometry.coordinates;if(K&&K.length===0)return;const re=P.geometry.type,he=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let be=[],ce=P.id;if(V.promoteId?ce=P.properties[V.promoteId]:V.generateId&&(ce=H||0),re==="Point")sn(K,be);else if(re==="MultiPoint")for(const Pe of K)sn(Pe,be);else if(re==="LineString")Yt(K,be,he,!1);else if(re==="MultiLineString"){if(V.lineMetrics){for(const Pe of K)be=[],Yt(Pe,be,he,!1),pe.push(We(ce,"LineString",be,P.properties));return}oi(K,be,he,!1)}else if(re==="Polygon")oi(K,be,he,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(const Pe of P.geometry.geometries)kt(pe,{id:ce,geometry:Pe,properties:P.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Pe of K){const Me=[];oi(Pe,Me,he,!0),be.push(Me)}}pe.push(We(ce,re,be,P.properties))}function sn(pe,P){P.push(_i(pe[0]),Ci(pe[1]),0)}function Yt(pe,P,V,H){let K,re,he=0;for(let ce=0;ce<pe.length;ce++){const Pe=_i(pe[ce][0]),Me=Ci(pe[ce][1]);P.push(Pe,Me,0),ce>0&&(he+=H?(K*Me-Pe*re)/2:Math.sqrt(Math.pow(Pe-K,2)+Math.pow(Me-re,2))),K=Pe,re=Me}const be=P.length-3;P[2]=1,vt(P,0,be,V),P[be+2]=1,P.size=Math.abs(he),P.start=0,P.end=P.size}function oi(pe,P,V,H){for(let K=0;K<pe.length;K++){const re=[];Yt(pe[K],re,V,H),P.push(re)}}function _i(pe){return pe/360+.5}function Ci(pe){const P=Math.sin(pe*Math.PI/180),V=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return V<0?0:V>1?1:V}function Vi(pe,P,V,H,K,re,he,be){if(H/=P,re>=(V/=P)&&he<H)return pe;if(he<V||re>=H)return null;const ce=[];for(const Pe of pe){const Me=Pe.geometry;let me=Pe.type;const Be=K===0?Pe.minX:Pe.minY,_e=K===0?Pe.maxX:Pe.maxY;if(Be>=V&&_e<H){ce.push(Pe);continue}if(_e<V||Be>=H)continue;let Qe=[];if(me==="Point"||me==="MultiPoint")ta(Me,Qe,V,H,K);else if(me==="LineString")Li(Me,Qe,V,H,K,!1,be.lineMetrics);else if(me==="MultiLineString")Xa(Me,Qe,V,H,K,!1);else if(me==="Polygon")Xa(Me,Qe,V,H,K,!0);else if(me==="MultiPolygon")for(const lt of Me){const At=[];Xa(lt,At,V,H,K,!0),At.length&&Qe.push(At)}if(Qe.length){if(be.lineMetrics&&me==="LineString"){for(const lt of Qe)ce.push(We(Pe.id,me,lt,Pe.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(Qe.length===1?(me="LineString",Qe=Qe[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=Qe.length===3?"Point":"MultiPoint"),ce.push(We(Pe.id,me,Qe,Pe.tags))}}return ce.length?ce:null}function ta(pe,P,V,H,K){for(let re=0;re<pe.length;re+=3){const he=pe[re+K];he>=V&&he<=H&&Da(P,pe[re],pe[re+1],pe[re+2])}}function Li(pe,P,V,H,K,re,he){let be=Dr(pe);const ce=K===0?fr:Ir;let Pe,Me,me=pe.start;for(let At=0;At<pe.length-3;At+=3){const wt=pe[At],ke=pe[At+1],it=pe[At+2],Je=pe[At+3],Bt=pe[At+4],_t=K===0?wt:ke,xt=K===0?Je:Bt;let et=!1;he&&(Pe=Math.sqrt(Math.pow(wt-Je,2)+Math.pow(ke-Bt,2))),_t<V?xt>V&&(Me=ce(be,wt,ke,Je,Bt,V),he&&(be.start=me+Pe*Me)):_t>H?xt<H&&(Me=ce(be,wt,ke,Je,Bt,H),he&&(be.start=me+Pe*Me)):Da(be,wt,ke,it),xt<V&&_t>=V&&(Me=ce(be,wt,ke,Je,Bt,V),et=!0),xt>H&&_t<=H&&(Me=ce(be,wt,ke,Je,Bt,H),et=!0),!re&&et&&(he&&(be.end=me+Pe*Me),P.push(be),be=Dr(pe)),he&&(me+=Pe)}let Be=pe.length-3;const _e=pe[Be],Qe=pe[Be+1],lt=K===0?_e:Qe;lt>=V&&lt<=H&&Da(be,_e,Qe,pe[Be+2]),Be=be.length-3,re&&Be>=3&&(be[Be]!==be[0]||be[Be+1]!==be[1])&&Da(be,be[0],be[1],be[2]),be.length&&P.push(be)}function Dr(pe){const P=[];return P.size=pe.size,P.start=pe.start,P.end=pe.end,P}function Xa(pe,P,V,H,K,re){for(const he of pe)Li(he,P,V,H,K,re,!1)}function Da(pe,P,V,H){pe.push(P,V,H)}function fr(pe,P,V,H,K,re){const he=(re-P)/(H-P);return Da(pe,re,V+(K-V)*he,1),he}function Ir(pe,P,V,H,K,re){const he=(re-V)/(K-V);return Da(pe,P+(H-P)*he,re,1),he}function Ya(pe,P){const V=[];for(let H=0;H<pe.length;H++){const K=pe[H],re=K.type;let he;if(re==="Point"||re==="MultiPoint"||re==="LineString")he=Ia(K.geometry,P);else if(re==="MultiLineString"||re==="Polygon"){he=[];for(const be of K.geometry)he.push(Ia(be,P))}else if(re==="MultiPolygon"){he=[];for(const be of K.geometry){const ce=[];for(const Pe of be)ce.push(Ia(Pe,P));he.push(ce)}}V.push(We(K.id,re,he,K.tags))}return V}function Ia(pe,P){const V=[];V.size=pe.size,pe.start!==void 0&&(V.start=pe.start,V.end=pe.end);for(let H=0;H<pe.length;H+=3)V.push(pe[H]+P,pe[H+1],pe[H+2]);return V}function Po(pe,P){if(pe.transformed)return pe;const V=1<<pe.z,H=pe.x,K=pe.y;for(const re of pe.features){const he=re.geometry,be=re.type;if(re.geometry=[],be===1)for(let ce=0;ce<he.length;ce+=2)re.geometry.push(Ys(he[ce],he[ce+1],P,V,H,K));else for(let ce=0;ce<he.length;ce++){const Pe=[];for(let Me=0;Me<he[ce].length;Me+=2)Pe.push(Ys(he[ce][Me],he[ce][Me+1],P,V,H,K));re.geometry.push(Pe)}}return pe.transformed=!0,pe}function Ys(pe,P,V,H,K,re){return[Math.round(V*(pe*H-K)),Math.round(V*(P*H-re))]}function ia(pe,P,V,H,K){const re=P===K.maxZoom?0:K.tolerance/((1<<P)*K.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:pe.length,source:null,x:V,y:H,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const be of pe)Do(he,be,re,K);return he}function Do(pe,P,V,H){const K=P.geometry,re=P.type,he=[];if(pe.minX=Math.min(pe.minX,P.minX),pe.minY=Math.min(pe.minY,P.minY),pe.maxX=Math.max(pe.maxX,P.maxX),pe.maxY=Math.max(pe.maxY,P.maxY),re==="Point"||re==="MultiPoint")for(let be=0;be<K.length;be+=3)he.push(K[be],K[be+1]),pe.numPoints++,pe.numSimplified++;else if(re==="LineString")_s(he,K,pe,V,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(let be=0;be<K.length;be++)_s(he,K[be],pe,V,re==="Polygon",be===0);else if(re==="MultiPolygon")for(let be=0;be<K.length;be++){const ce=K[be];for(let Pe=0;Pe<ce.length;Pe++)_s(he,ce[Pe],pe,V,!0,Pe===0)}if(he.length){let be=P.tags||null;if(re==="LineString"&&H.lineMetrics){be={};for(const Pe in P.tags)be[Pe]=P.tags[Pe];be.mapbox_clip_start=K.start/K.size,be.mapbox_clip_end=K.end/K.size}const ce={geometry:he,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:be};P.id!==null&&(ce.id=P.id),pe.features.push(ce)}}function _s(pe,P,V,H,K,re){const he=H*H;if(H>0&&P.size<(K?he:H))return void(V.numPoints+=P.length/3);const be=[];for(let ce=0;ce<P.length;ce+=3)(H===0||P[ce+2]>he)&&(V.numSimplified++,be.push(P[ce],P[ce+1])),V.numPoints++;K&&function(ce,Pe){let Me=0;for(let me=0,Be=ce.length,_e=Be-2;me<Be;_e=me,me+=2)Me+=(ce[me]-ce[_e])*(ce[me+1]+ce[_e+1]);if(Me>0===Pe)for(let me=0,Be=ce.length;me<Be/2;me+=2){const _e=ce[me],Qe=ce[me+1];ce[me]=ce[Be-2-me],ce[me+1]=ce[Be-1-me],ce[Be-2-me]=_e,ce[Be-1-me]=Qe}}(be,re),pe.push(be)}const Rr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qa{constructor(P,V){const H=(V=this.options=function(re,he){for(const be in he)re[be]=he[be];return re}(Object.create(Rr),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let K=function(re,he){const be=[];if(re.type==="FeatureCollection")for(let ce=0;ce<re.features.length;ce++)kt(be,re.features[ce],he,ce);else kt(be,re.type==="Feature"?re:{geometry:re},he);return be}(P,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(re,he){const be=he.buffer/he.extent;let ce=re;const Pe=Vi(re,1,-1-be,be,0,-1,2,he),Me=Vi(re,1,1-be,2+be,0,-1,2,he);return(Pe||Me)&&(ce=Vi(re,1,-be,1+be,0,-1,2,he)||[],Pe&&(ce=Ya(Pe,1).concat(ce)),Me&&(ce=ce.concat(Ya(Me,-1)))),ce}(K,V),K.length&&this.splitTile(K,0,0,0),H&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(P,V,H,K,re,he,be){const ce=[P,V,H,K],Pe=this.options,Me=Pe.debug;for(;ce.length;){K=ce.pop(),H=ce.pop(),V=ce.pop(),P=ce.pop();const me=1<<V,Be=gs(V,H,K);let _e=this.tiles[Be];if(!_e&&(Me>1&&console.time("creation"),_e=this.tiles[Be]=ia(P,V,H,K,Pe),this.tileCoords.push({z:V,x:H,y:K}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,K,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));const et=`z${V}`;this.stats[et]=(this.stats[et]||0)+1,this.total++}if(_e.source=P,re==null){if(V===Pe.indexMaxZoom||_e.numPoints<=Pe.indexMaxPoints)continue}else{if(V===Pe.maxZoom||V===re)continue;if(re!=null){const et=re-V;if(H!==he>>et||K!==be>>et)continue}}if(_e.source=null,P.length===0)continue;Me>1&&console.time("clipping");const Qe=.5*Pe.buffer/Pe.extent,lt=.5-Qe,At=.5+Qe,wt=1+Qe;let ke=null,it=null,Je=null,Bt=null,_t=Vi(P,me,H-Qe,H+At,0,_e.minX,_e.maxX,Pe),xt=Vi(P,me,H+lt,H+wt,0,_e.minX,_e.maxX,Pe);P=null,_t&&(ke=Vi(_t,me,K-Qe,K+At,1,_e.minY,_e.maxY,Pe),it=Vi(_t,me,K+lt,K+wt,1,_e.minY,_e.maxY,Pe),_t=null),xt&&(Je=Vi(xt,me,K-Qe,K+At,1,_e.minY,_e.maxY,Pe),Bt=Vi(xt,me,K+lt,K+wt,1,_e.minY,_e.maxY,Pe),xt=null),Me>1&&console.timeEnd("clipping"),ce.push(ke||[],V+1,2*H,2*K),ce.push(it||[],V+1,2*H,2*K+1),ce.push(Je||[],V+1,2*H+1,2*K),ce.push(Bt||[],V+1,2*H+1,2*K+1)}}getTile(P,V,H){P=+P,V=+V,H=+H;const K=this.options,{extent:re,debug:he}=K;if(P<0||P>24)return null;const be=1<<P,ce=gs(P,V=V+be&be-1,H);if(this.tiles[ce])return Po(this.tiles[ce],re);he>1&&console.log("drilling down to z%d-%d-%d",P,V,H);let Pe,Me=P,me=V,Be=H;for(;!Pe&&Me>0;)Me--,me>>=1,Be>>=1,Pe=this.tiles[gs(Me,me,Be)];return Pe&&Pe.source?(he>1&&(console.log("found parent tile z%d-%d-%d",Me,me,Be),console.time("drilling down")),this.splitTile(Pe.source,Me,me,Be,P,V,H),he>1&&console.timeEnd("drilling down"),this.tiles[ce]?Po(this.tiles[ce],re):null):null}}function gs(pe,P,V){return 32*((1<<pe)*V+P)+pe}function Qr(pe,P){return P?pe.properties[P]:pe.id}function Ml(pe,P){if(pe==null)return!0;if(pe.type==="Feature")return Qr(pe,P)!=null;if(pe.type==="FeatureCollection"){const V=new Set;for(const H of pe.features){const K=Qr(H,P);if(K==null||V.has(K))return!1;V.add(K)}return!0}return!1}function Io(pe,P){const V=new Map;if(pe!=null)if(pe.type==="Feature")V.set(Qr(pe,P),pe);else for(const H of pe.features)V.set(Qr(H,P),H);return V}class Kr extends ai{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(P,V){return F._(this,void 0,void 0,function*(){const H=P.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const K=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!K)return null;const re=new ca(K.features);let he=Mt(re);return he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),{vectorTile:re,rawData:he.buffer}})}loadData(P){return F._(this,void 0,void 0,function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const H=!!(P&&P.request&&P.request.collectResourceTiming)&&new F.cw(P.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(P,this._pendingRequest),this._geoJSONIndex=P.cluster?new qe(function({superclusterOptions:he,clusterProperties:be}){if(!be||!he)return he;const ce={},Pe={},Me={accumulated:null,zoom:0},me={properties:null},Be=Object.keys(be);for(const _e of Be){const[Qe,lt]=be[_e],At=F.cD(lt),wt=F.cD(typeof Qe=="string"?[Qe,["accumulated"],["get",_e]]:Qe);ce[_e]=At.value,Pe[_e]=wt.value}return he.map=_e=>{me.properties=_e;const Qe={};for(const lt of Be)Qe[lt]=ce[lt].evaluate(Me,me);return Qe},he.reduce=(_e,Qe)=>{me.properties=Qe;for(const lt of Be)Me.accumulated=_e[lt],_e[lt]=Pe[lt].evaluate(Me,me)},he}(P)).load((yield this._pendingData).features):(K=yield this._pendingData,new Qa(K,P.geojsonVtOptions)),this.loaded={};const re={};if(H){const he=H.finish();he&&(re.resourceTiming={},re.resourceTiming[P.source]=JSON.parse(JSON.stringify(he)))}return re}catch(re){if(delete this._pendingRequest,F.ch(re))return{abandoned:!0};throw re}var K})}getData(){return F._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(P){const V=this.loaded;return V&&V[P.uid]?super.reloadTile(P):this.loadTile(P)}loadAndProcessGeoJSON(P,V){return F._(this,void 0,void 0,function*(){let H=yield this.loadGeoJSON(P,V);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`);if(gn(H,!0),P.filter){const K=F.cD(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(he=>`${he.key}: ${he.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(he=>K.value.evaluate({zoom:0},he))}}return H})}loadGeoJSON(P,V){return F._(this,void 0,void 0,function*(){const{promoteId:H}=P;if(P.request){const K=yield F.j(P.request,V);return this._dataUpdateable=Ml(K.data,H)?Io(K.data,H):void 0,K.data}if(typeof P.data=="string")try{const K=JSON.parse(P.data);return this._dataUpdateable=Ml(K,H)?Io(K,H):void 0,K}catch{throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`)}if(!P.dataDiff)throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${P.source}`);return function(K,re,he){var be,ce,Pe,Me;if(re.removeAll&&K.clear(),re.remove)for(const me of re.remove)K.delete(me);if(re.add)for(const me of re.add){const Be=Qr(me,he);Be!=null&&K.set(Be,me)}if(re.update)for(const me of re.update){let Be=K.get(me.id);if(Be==null)continue;const _e=!me.removeAllProperties&&(((be=me.removeProperties)===null||be===void 0?void 0:be.length)>0||((ce=me.addOrUpdateProperties)===null||ce===void 0?void 0:ce.length)>0);if((me.newGeometry||me.removeAllProperties||_e)&&(Be=Object.assign({},Be),K.set(me.id,Be),_e&&(Be.properties=Object.assign({},Be.properties))),me.newGeometry&&(Be.geometry=me.newGeometry),me.removeAllProperties)Be.properties={};else if(((Pe=me.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const Qe of me.removeProperties)Object.prototype.hasOwnProperty.call(Be.properties,Qe)&&delete Be.properties[Qe];if(((Me=me.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0)for(const{key:Qe,value:lt}of me.addOrUpdateProperties)Be.properties[Qe]=lt}}(this._dataUpdateable,P.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(P){return F._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(P){return this._geoJSONIndex.getClusterExpansionZoom(P.clusterId)}getClusterChildren(P){return this._geoJSONIndex.getChildren(P.clusterId)}getClusterLeaves(P){return this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset)}}class on{constructor(P){this.self=P,this.actor=new F.H(P),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,H)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=H},this.self.addProtocol=F.cj,this.self.removeProtocol=F.ck,this.self.registerRTLTextPlugin=V=>{F.cE.setMethods(V)},this.actor.registerMessageHandler("LDT",(V,H)=>this._getDEMWorkerSource(V,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(V,H)=>F._(this,void 0,void 0,function*(){this._getDEMWorkerSource(V,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(V,H)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(V,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(V,H)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(V,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(V,H)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(V,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(V,H)=>this._getWorkerSource(V,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("GD",(V,H)=>this._getWorkerSource(V,H.type,H.source).getData()),this.actor.registerMessageHandler("LT",(V,H)=>this._getWorkerSource(V,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(V,H)=>this._getWorkerSource(V,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(V,H)=>this._getWorkerSource(V,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(V,H)=>this._getWorkerSource(V,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(V,H)=>F._(this,void 0,void 0,function*(){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const K=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],K.removeSource!==void 0&&K.removeSource(H)})),this.actor.registerMessageHandler("RM",V=>F._(this,void 0,void 0,function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})),this.actor.registerMessageHandler("SR",(V,H)=>F._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(V,H)=>this._syncRTLPluginState(V,H)),this.actor.registerMessageHandler("IS",(V,H)=>F._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(V,H)=>this._setImages(V,H)),this.actor.registerMessageHandler("UL",(V,H)=>F._(this,void 0,void 0,function*(){this._getLayerIndex(V).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(V,H)=>F._(this,void 0,void 0,function*(){this._getLayerIndex(V).replace(H)}))}_setImages(P,V){return F._(this,void 0,void 0,function*(){this.availableImages[P]=V;for(const H in this.workerSources[P]){const K=this.workerSources[P][H];for(const re in K)K[re].availableImages=V}})}_syncRTLPluginState(P,V){return F._(this,void 0,void 0,function*(){return yield F.cE.syncState(V,this.self.importScripts)})}_getAvailableImages(P){let V=this.availableImages[P];return V||(V=[]),V}_getLayerIndex(P){let V=this.layerIndexes[P];return V||(V=this.layerIndexes[P]=new d),V}_getWorkerSource(P,V,H){if(this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][V]||(this.workerSources[P][V]={}),!this.workerSources[P][V][H]){const K={sendAsync:(re,he)=>(re.targetMapId=P,this.actor.sendAsync(re,he))};switch(V){case"vector":this.workerSources[P][V][H]=new ai(K,this._getLayerIndex(P),this._getAvailableImages(P));break;case"geojson":this.workerSources[P][V][H]=new Kr(K,this._getLayerIndex(P),this._getAvailableImages(P));break;default:this.workerSources[P][V][H]=new this.externalWorkerSourceTypes[V](K,this._getLayerIndex(P),this._getAvailableImages(P))}}return this.workerSources[P][V][H]}_getDEMWorkerSource(P,V){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][V]||(this.demWorkerSources[P][V]=new ut),this.demWorkerSources[P][V]}}return F.i(self)&&(self.worker=new on(self)),on}),Ot("index",["exports","./shared"],function(F,d){var ot="5.2.0";function Ve(){var f=new d.A(4);return d.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}let Ft,ai;const ut={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f,e,n){const l=requestAnimationFrame(m=>{u(),e(m)}),{unsubscribe:u}=d.s(f.signal,"abort",()=>{u(),cancelAnimationFrame(l),n(d.c())},!1)},frameAsync(f){return new Promise((e,n)=>{this.frame(f,e,n)})},getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,n.drawImage(f,0,0,f.width,f.height),n},resolveURL:f=>(Ft||(Ft=document.createElement("a")),Ft.href=f,Ft.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ai==null&&(ai=matchMedia("(prefers-reduced-motion: reduce)")),ai.matches)}};class xe{static testProp(e){if(!xe.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in xe.docStyle)return e[n];return e[0]}static create(e,n,l){const u=window.document.createElement(e);return n!==void 0&&(u.className=n),l&&l.appendChild(u),u}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){xe.docStyle&&xe.selectProp&&(xe.userSelect=xe.docStyle[xe.selectProp],xe.docStyle[xe.selectProp]="none")}static enableDrag(){xe.docStyle&&xe.selectProp&&(xe.docStyle[xe.selectProp]=xe.userSelect)}static setTransform(e,n){e.style[xe.transformProp]=n}static addEventListener(e,n,l,u={}){e.addEventListener(n,l,"passive"in u?u:u.capture)}static removeEventListener(e,n,l,u={}){e.removeEventListener(n,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",xe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",xe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",xe.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,l){const u=n.boundingClientRect;return new d.P((l.clientX-u.left)/n.x-e.clientLeft,(l.clientY-u.top)/n.y-e.clientTop)}static mousePos(e,n){const l=xe.getScale(e);return xe.getPoint(e,l,n)}static touchPos(e,n){const l=[],u=xe.getScale(e);for(let m=0;m<n.length;m++)l.push(xe.getPoint(e,u,n[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const u of l)u.remove();return xe.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const n=e.children;for(const l of n)xe.removeAttributes(l),xe.clean(l)}static removeAttributes(e){for(const{name:n,value:l}of e.attributes)xe.isPossiblyDangerous(n,l)&&e.removeAttribute(n)}}xe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,xe.selectProp=xe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),xe.transformProp=xe.testProp(["transform","WebkitTransform"]);const at={supported:!1,testSupport:function(f){!la&&gn&&(an?ca(f):Rn=f)}};let Rn,gn,la=!1,an=!1;function ca(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,gn),f.isContextLost())return;at.supported=!0}catch{}f.deleteTexture(e),la=!0}var Ki;typeof document<"u"&&(gn=document.createElement("img"),gn.onload=()=>{Rn&&ca(Rn),Rn=null,an=!0},gn.onerror=()=>{la=!0,Rn=null},gn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,n,l,u;f.resetRequestQueue=()=>{e=[],n=0,l=0,u={}},f.addThrottleControl=T=>{const E=l++;return u[E]=T,E},f.removeThrottleControl=T=>{delete u[T],y()},f.getImage=(T,E,z=!0)=>new Promise((D,I)=>{at.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:z,state:"queued",onError:j=>{I(j)},onSuccess:j=>{D(j)}}),y()});const m=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:z,onError:D,onSuccess:I,abortController:j}=T,N=z===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((Y,W)=>Y&&W==="accept",!0));n++;const X=N?b(E,j):d.m(E,j);try{const Y=yield X;delete T.abortController,T.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?I(Y):Y.data&&I({data:yield($=Y.data,typeof createImageBitmap=="function"?d.f($):d.h($)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete T.abortController,D(Y)}finally{n--,y()}var $}),y=()=>{const T=(()=>{for(const E of Object.keys(u))if(u[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=n;E<T&&e.length>0;E++){const z=e.shift();z.abortController.signal.aborted?E--:m(z)}},b=(T,E)=>new Promise((z,D)=>{const I=new Image,j=T.url,N=T.credentials;N&&N==="include"?I.crossOrigin="use-credentials":(N&&N==="same-origin"||!d.d(j))&&(I.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{I.src="",D(d.c())}),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,z({data:I})},I.onerror=()=>{I.onerror=I.onload=null,E.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=j})}(Ki||(Ki={})),Ki.resetRequestQueue();class Vt{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Xt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const n=[];for(const{id:l,url:u}of f){const m=`${l}${u}`;n.indexOf(m)===-1&&(n.push(m),e.push({id:l,url:u}))}}return e}function ri(f,e,n){try{const l=new URL(f);return l.pathname+=`${e}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${f}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class pi{constructor(e,n,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,l){const{width:u,height:m}=e,y=!(this.size&&this.size[0]===u&&this.size[1]===m||l),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[u,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,m,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:E,y:z}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,E,z,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,E,z,u,m,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,n,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Mt(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class ti extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let l=!0;const u=n.data||n.spriteData;return this._validateStretch(n.stretchX,u&&u.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,u&&u.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,n){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||n<u[1])return!1;l=u[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const l=n.spriteData,u=l&&l.width||n.data.width,m=l&&l.height||n.data.height;return!(e[0]<0||u<e[0]||e[1]<0||m<e[1]||e[2]<0||u<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==n.data.width||u.data.height!==n.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=u.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,l)=>{let u=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(u=!1);this.isLoaded()||u?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.l("styleimagemissing",{id:l})),u=this.getImage(l)),u?n[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],l=this.getImage(e);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new d.I(u,l);this.patterns[e]={bin:u,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new pi(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:n,h:l}=d.p(e),u=this.atlasImage;u.resize({width:n||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],b=y.x+1,T=y.y+1,E=this.getImage(m).data,z=E.width,D=E.height;d.R.copy(E,u,{x:0,y:0},{x:b,y:T},{width:z,height:D}),d.R.copy(E,u,{x:0,y:D-1},{x:b,y:T-1},{width:z,height:1}),d.R.copy(E,u,{x:0,y:0},{x:b,y:T+D},{width:z,height:1}),d.R.copy(E,u,{x:z-1,y:0},{x:b-1,y:T},{width:1,height:D}),d.R.copy(E,u,{x:0,y:0},{x:b+z,y:T},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||d.w(`Image with ID: "${n}" was not found`),Mt(l)&&this.updateImage(n,l)}}}const En=1e20;function qn(f,e,n,l,u,m,y,b,T){for(let E=e;E<e+l;E++)rn(f,n*m+E,m,u,y,b,T);for(let E=n;E<n+u;E++)rn(f,E*m+e,1,l,y,b,T)}function rn(f,e,n,l,u,m,y){m[0]=0,y[0]=-1e20,y[1]=En,u[0]=f[e];for(let b=1,T=0,E=0;b<l;b++){u[b]=f[e+b*n];const z=b*b;do{const D=m[T];E=(u[b]-u[D]+z-D*D)/(b-D)/2}while(E<=y[T]&&--T>-1);T++,m[T]=b,y[T]=E,y[T+1]=En}for(let b=0,T=0;b<l;b++){for(;y[T+1]<b;)T++;const E=m[T],z=b-E;f[e+b*n]=u[E]+z*z}}class ki{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const n=[];for(const m in e)for(const y of e[m])n.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(n),u={};for(const{stack:m,id:y,glyph:b}of l)u[m]||(u[m]={}),u[m][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return u})}_getAndCacheGlyphsPromise(e,n){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[n];if(u!==void 0)return{stack:e,id:n,glyph:u};if(u=this._tinySDF(l,e,n),u)return l.glyphs[n]=u,{stack:e,id:n,glyph:u};const m=Math.floor(n/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:n,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const b=ki.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=b}const y=yield l.requests[m];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=y[+b]);return l.ranges[m]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||d.u["CJK Unified Ideographs"](e)||d.u["Hangul Syllables"](e)||d.u.Hiragana(e)||d.u.Katakana(e)||d.u["CJK Symbols and Punctuation"](e)||d.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),m=e.tinySDF=new ki.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:b})}const y=m.draw(String.fromCharCode(l));return{id:l,bitmap:new d.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}ki.loadGlyphRange=function(f,e,n,l){return d._(this,void 0,void 0,function*(){const u=256*e,m=u+255,y=l.transformRequest(n.replace("{fontstack}",f).replace("{range}",`${u}-${m}`),"Glyphs"),b=yield d.n(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${m}`);const T={};for(const E of d.o(b.data))T[E.id]=E;return T})},ki.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const b=this.size=f+4*e,T=this._createCanvas(b),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${m} ${f}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(f),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=b+2*this.buffer,z=T+2*this.buffer,D=Math.max(E*z,0),I=new Uint8ClampedArray(D),j={data:I,width:E,height:z,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return j;const{ctx:N,buffer:X,gridInner:$,gridOuter:Y}=this;N.clearRect(X,X,b,T),N.fillText(f,X,X+y);const W=N.getImageData(X,X,b,T);Y.fill(En,0,D),$.fill(0,0,D);for(let ie=0;ie<T;ie++)for(let ne=0;ne<b;ne++){const ae=W.data[4*(ie*b+ne)+3]/255;if(ae===0)continue;const le=(ie+X)*E+ne+X;if(ae===1)Y[le]=0,$[le]=En;else{const se=.5-ae;Y[le]=se>0?se*se:0,$[le]=se<0?se*se:0}}qn(Y,0,0,E,z,E,this.f,this.v,this.z),qn($,X,X,b,T,E,this.f,this.v,this.z);for(let ie=0;ie<D;ie++){const ne=Math.sqrt(Y[ie])-Math.sqrt($[ie]);I[ie]=Math.round(255-255*(ne/this.radius+this.cutoff))}return j}};class kn{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,n){return d.z(e.expression.evaluate(n))}interpolate(e,n,l){return{x:d.B.number(e.x,n.x,l),y:d.B.number(e.y,n.y,l),z:d.B.number(e.z,n.z,l)}}}let qe;class Pt extends d.E{constructor(e){super(),qe=qe||new d.r({anchor:new d.D(d.v.light.anchor),position:new kn,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(qe),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(d.t,e,n))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l){return(!l||l.validate!==!1)&&d.x(this,e.call(d.y,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Tt=new d.r({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class si extends d.E{constructor(e){super(),this._transitionable=new d.T(Tt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.C(0))}setSky(e,n={}){if(!this._validate(d.F,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l={}){return(l==null?void 0:l.validate)!==!1&&d.x(this,e.call(d.y,d.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ue{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const l=e.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,n)),this.dashEntry[l]}getDashRanges(e,n,l){const u=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,b=!0;u.push({left:m,right:y,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){b=!b;const z=e[E];m=T*l,T+=z,y=T*l,u.push({left:m,right:y,isDash:b,zeroLength:z===0})}return u}addRoundDash(e,n,l){const u=n/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let b=0,T=e[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++b]);const z=Math.abs(E-T.left),D=Math.abs(E-T.right),I=Math.min(z,D);let j;const N=m/l*(u+1);if(T.isDash){const X=u-Math.abs(N);j=Math.sqrt(I*I+X*X)}else j=u-Math.sqrt(I*I+N*N);this.data[y+E]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const T=Math.abs(b-y.left),E=Math.abs(b-y.right),z=Math.min(T,E);this.data[u+b]=Math.max(0,Math.min(255,(y.isDash?z:-z)+128))}}addDash(e,n){const l=n?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<e.length;b++)m+=e[b];if(m!==0){const b=this.width/m,T=this.getDashRanges(e,this.width,b);n?this.addRoundDash(T,b,l):this.addRegularDash(T)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=u,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Xe="maplibre_preloaded_worker_pool";class vt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vt.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xe]}numActive(){return Object.keys(this.active).length}}const mt=Math.floor(ut.hardwareConcurrency/2);let We,Ct;function kt(){return We||(We=new vt),We}vt.workerCount=d.G(globalThis)?Math.max(Math.min(mt,3),1):1;class sn{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let u=0;u<l.length;u++){const m=new d.H(l[u],n);m.name=`Worker ${u}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const l of this.actors)l.registerMessageHandler(e,n)}}function Yt(){return Ct||(Ct=new sn(kt(),d.J),Ct.registerMessageHandler("GR",(f,e,n)=>d.m(e,n))),Ct}function oi(f,e){const n=d.K();return d.L(n,n,[1,1,0]),d.M(n,n,[.5*f.width,.5*f.height,1]),f.calculatePosMatrix?d.N(n,n,f.calculatePosMatrix(e.toUnwrapped())):n}function _i(f,e,n,l,u,m){var y;const b=function(D,I,j){if(D)for(const N of D){const X=I[N];if(X&&X.source===j&&X.type==="fill-extrusion")return!0}else for(const N in I){const X=I[N];if(X.source===j&&X.type==="fill-extrusion")return!0}return!1}((y=u==null?void 0:u.layers)!==null&&y!==void 0?y:null,e,f.id),T=m.maxPitchScaleFactor(),E=f.tilesIn(l,T,b);E.sort(Ci);const z=[];for(const D of E)z.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,n,f._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,u,m,T,oi(f.transform,D.tileID))});return function(D,I){for(const j in D)for(const N of D[j])Vi(N,I);return D}(function(D){const I={},j={};for(const N of D){const X=N.queryResults,$=N.wrappedTileID,Y=j[$]=j[$]||{};for(const W in X){const ie=X[W],ne=Y[W]=Y[W]||{},ae=I[W]=I[W]||[];for(const le of ie)ne[le.featureIndex]||(ne[le.featureIndex]=!0,ae.push(le))}}return I}(z),f)}function Ci(f,e){const n=f.tileID,l=e.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function Vi(f,e){const n=f.feature,l=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function ta(f,e,n){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.j(e.transformRequest(f.url,"Source"),n)).data:yield ut.frameAsync(n),!l)return null;const u=d.O(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(m=>m.id)),u})}class Li{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.Q?new d.Q(e.lng,e.lat):d.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.Q?new d.Q(e.lng,e.lat):d.Q.convert(e),this}extend(e){const n=this._sw,l=this._ne;let u,m;if(e instanceof d.Q)u=e,m=e;else{if(!(e instanceof Li))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Li.convert(e)):this.extend(d.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.Q.convert(e)):this;if(u=e._sw,m=e._ne,!u||!m)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new d.Q(u.lng,u.lat),this._ne=new d.Q(m.lng,m.lat)),this}getCenter(){return new d.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.Q(this.getWest(),this.getNorth())}getSouthEast(){return new d.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=d.Q.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof Li?e:e&&new Li(e)}static fromLngLat(e,n=0){const l=360*n/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new Li(new d.Q(e.lng-u,e.lat-l),new d.Q(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.Q(this._sw.lng,this._sw.lat),n=new d.Q(this._ne.lng,this._ne.lat);return new Li(e,e.lng>n.lng?new d.Q(n.lng+360,n.lat):n)}}class Dr{constructor(e,n,l){this.bounds=Li.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),l=Math.floor(d.U(this.bounds.getWest())*n),u=Math.floor(d.S(this.bounds.getNorth())*n),m=Math.ceil(d.U(this.bounds.getEast())*n),y=Math.ceil(d.S(this.bounds.getSouth())*n);return e.x>=l&&e.x<m&&e.y>=u&&e.y<y}}class Xa extends d.E{constructor(e,n,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.O(n,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ta(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Dr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Da extends d.E{constructor(e,n,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},n),d.e(this,d.O(n,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield ta(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(d.e(this,n),n.bounds&&(this.tileBounds=new Dr(n.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new d.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ki.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,m=u.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new pi(u,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class fr extends Da{constructor(e,n,l,u){super(e,n,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Ki.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const m=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const y=d.b(m)&&d.V()?m:yield this.readImageNow(m),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.W()){const n=e.width+2,l=e.height+2;try{return new d.R({width:n,height:l},yield d.X(e,-1,-1,n,l))}catch{}}return ut.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,l=Math.pow(2,n.z),u=(n.x-1+l)%l,m=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+l)%l,b=n.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.Y(e.overscaledZ,m,n.z,u,n.y).key]={backfilled:!1},T[new d.Y(e.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(T[new d.Y(e.overscaledZ,m,n.z,u,n.y-1).key]={backfilled:!1},T[new d.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new d.Y(e.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<l&&(T[new d.Y(e.overscaledZ,m,n.z,u,n.y+1).key]={backfilled:!1},T[new d.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new d.Y(e.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ir extends d.E{constructor(e,n,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=n.data,this._options=d.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:d.Z,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:d.Z,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(d.Z/this.tileSize)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const n=d.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(ut.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(m,{resourceTiming:u}),this.fire(new d.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:n,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,n==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ya extends d.E{constructor(e,n,l,u){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ki.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new d.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(d.$.fromLngLat);var l;return this.tileID=function(u){let m=1/0,y=1/0,b=-1/0,T=-1/0;for(const I of u)m=Math.min(m,I.x),y=Math.min(y,I.y),b=Math.max(b,I.x),T=Math.max(T,I.y);const E=Math.max(b-m,T-y),z=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),D=Math.pow(2,z);return new d.a0(z,Math.floor((m+b)/2*D),Math.floor((y+T)/2*D))}(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(u=>this.tileID.getTilePoint(u)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new pi(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ia extends Ya{constructor(e,n,l,u){super(e,n,l,u),this.roundZoom=!0,this.type="video",this.options=n}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield d.a1(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new d.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new d.k(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new pi(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Po extends Ya{constructor(e,n,l,u){super(e,n,l,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new d.k(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new d.k(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new pi(n,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ys={},ia=f=>{switch(f){case"geojson":return Ir;case"image":return Ya;case"raster":return Da;case"raster-dem":return fr;case"vector":return Xa;case"video":return Ia;case"canvas":return Po}return Ys[f]},Do="RTLPluginLoaded";class _s extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ut.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(Do))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Rr=null;function Qa(){return Rr||(Rr=new _s),Rr}class gs{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,m){const y={};if(!m)return y;for(const b of u){const T=b.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>T.filter(z=>z.id===E)[0]));for(const E of T)y[E.id]=b}}return y}(e.buckets,n==null?void 0:n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.a5){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.a5&&m.hasRTLText){this.hasRTLText=!0,Qa().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pi(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pi(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,l,u,m,y,b,T,E,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:b,queryPadding:this.queryPadding*E},e,n,l):{}}querySourceFeatures(e,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),m=n&&n.sourceLayer?n.sourceLayer:"",y=u._geojsonTileLayer||u[m];if(!y)return;const b=d.a6(n&&n.filter),{z:T,x:E,y:z}=this.tileID.canonical,D={z:T,x:E,y:z};for(let I=0;I<y.length;I++){const j=y.feature(I);if(b.needGeometry){const $=d.a7(j,!0);if(!b.filter(new d.C(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!b.filter(new d.C(this.tileID.overscaledZ),j))continue;const N=l.getId(j,m),X=new d.a8(j,T,E,z,N);X.tile=D,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const l=d.a9(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const m=this.buckets[u],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[y],T=e[y];if(!b||!T||Object.keys(T).length===0)continue;m.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=n&&n.style&&n.style.getLayer(u);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ut.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ut.now()+e}setDependencies(e,n){const l={};for(const u of n)l[u]=!0;this.dependencies[e]=l}hasDependency(e,n){for(const l of e){const u=this.dependencies[l];if(u){for(const m of n)if(u[m])return!0}}return!1}}class Qr{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const l=e.wrapped().key,u=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][u];return this.data[l].splice(u,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||n.push(u);for(const l of n)this.remove(l.value.tileID,l)}}class Ml{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==u&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const m in this.state[e][u])l[m]||(this.deletedStates[e][u][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][m]===null&&delete this.deletedStates[e][u][m]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const l=String(n),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][n];if(m===null)return{};for(const y in m)delete u[y]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),d.e(this.state[u][y],this.stateChanges[u][y]),m[y]=this.state[u][y];l[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(this.deletedStates[u]===null)for(const y in this.state[u])m[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(this.deletedStates[u][y]===null)this.state[u][y]={};else for(const b of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][b];m[y]=this.state[u][y]}l[u]=l[u]||{},d.e(l[u],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,n)}}function Io(f,e,n){const l=e.intersectsFrustum(f);if(!n)return l;const u=e.intersectsPlane(n);return l===0||u===0?0:l===2&&u===2?2:1}function Kr(f,e,n,l,u){let m=f;const y=Math.atan(e/n),b=Math.hypot(e,n);return m=f+d.aa(l/b/Math.max(.5,Math.cos(d.ac(u/2)))),m+=1*d.aa(Math.cos(y))/2,m+=d.ad(f-m,-0,0),m}function on(f,e){const n=(e.roundZoom?Math.round:Math.floor)(f.zoom+d.aa(f.tileSize/e.tileSize));return Math.max(0,n)}function pe(f,e){const n=f.getCameraFrustum(),l=f.getClippingPlane(),u=f.screenPointToMercatorCoordinate(f.getCameraPoint()),m=d.$.fromLngLat(f.center,f.elevation);u.z=m.z+Math.cos(f.pitchInRadians)*f.cameraToCenterDistance/f.worldSize;const y=f.getCoveringTilesDetailsProvider(),b=y.allowVariableZoom(f,e),T=on(f,e),E=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:f.maxZoom,D=Math.min(Math.max(0,T),z),I=Math.pow(2,D),j=[I*u.x,I*u.y,0],N=[I*m.x,I*m.y,0],X=Math.hypot(m.x-u.x,m.y-u.y),$=Math.abs(m.z-u.z),Y=Math.hypot(X,$),W=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),ie=[],ne=[];if(f.renderWorldCopies&&y.allowWorldCopies())for(let ae=1;ae<=3;ae++)ie.push(W(-ae)),ie.push(W(ae));for(ie.push(W(0));ie.length>0;){const ae=ie.pop(),le=ae.x,se=ae.y;let ye=ae.fullyVisible;const we={x:le,y:se,z:ae.zoom},De=y.getTileAABB(we,ae.wrap,f.elevation,e);if(!ye){const $e=Io(n,De,l);if($e===0)continue;ye=$e===2}const Ie=y.distanceToTile2d(u.x,u.y,we,De);let ze=T;b&&(ze=(e.calculateTileZoom||Kr)(f.zoom+d.aa(f.tileSize/e.tileSize),Ie,$,Y,f.fov)),ze=(e.roundZoom?Math.round:Math.floor)(ze),ze=Math.max(0,ze);const Ye=Math.min(ze,z);if(ae.wrap=y.getWrap(m,we,ae.wrap),ae.zoom>=Ye){if(ae.zoom<E)continue;const $e=D-ae.zoom,Fe=j[0]-.5-(le<<$e),rt=j[1]-.5-(se<<$e),dt=e.reparseOverscaled?Math.max(ae.zoom,ze):ae.zoom;ne.push({tileID:new d.Y(ae.zoom===z?dt:ae.zoom,ae.wrap,ae.zoom,le,se),distanceSq:d.ab([N[0]-.5-le,N[1]-.5-se]),tileDistanceToCamera:Math.sqrt(Fe*Fe+rt*rt)})}else for(let $e=0;$e<4;$e++)ie.push({zoom:ae.zoom+1,x:(le<<1)+$e%2,y:(se<<1)+($e>>1),wrap:ae.wrap,fullyVisible:ye})}return ne.sort((ae,le)=>ae.distanceSq-le.distanceSq).map(ae=>ae.tileID)}class P extends d.E{constructor(e,n,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,m,y,b)=>{const T=new(ia(m.type))(u,m,y,b);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,n,l,this),this._tiles={},this._cache=new Qr(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ml,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.k(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(V).map(e=>e.key)}getRenderableIds(e){const n=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&n.push(this._tiles[l]);return e?n.sort((l,u)=>{const m=l.tileID,y=u.tileID,b=new d.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),T=new d.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(V).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)(e||this._tiles[n].state!=="errored")&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,e,n))})}_tileLoaded(e,n,l){e.timeAdded=ut.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const m=n[u];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(u,m){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-u.tileID.canonical.x;const b=m.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),E=m.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,y,b),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,u){for(const m in this._tiles){let y=this._tiles[m];if(u[m]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>l)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(b=E)}let T=b;for(;T.overscaledZ>n;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]||e[T.canonical.key]){u[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){const u=e.scaledTo(l),m=this._getLoadedTile(u);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(m)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const l={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,n,l,u,m,y){const b={},T={},E=Object.keys(e),z=ut.now();for(const D of E){const I=e[D],j=this._tiles[D];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=z)continue;const N=this.findLoadedParent(I,n),X=this.findLoadedSibling(I),$=N||X||null;$&&(this._addTile($.tileID),b[$.tileID.key]=$.tileID),T[D]=I}this._retainLoadedChildren(T,u,l,e);for(const D in b)e[D]||(this._coveredTiles[D]=!0,e[D]=b[D]);if(y){const D={},I={};for(const j of m)this._tiles[j.key].hasData()?D[j.key]=j:I[j.key]=j;for(const j in I){const N=I[j].children(this._source.maxzoom);this._tiles[N[0].key]&&this._tiles[N[1].key]&&this._tiles[N[2].key]&&this._tiles[N[3].key]&&(D[N[0].key]=e[N[0].key]=N[0],D[N[1].key]=e[N[1].key]=N[1],D[N[2].key]=e[N[2].key]=N[2],D[N[3].key]=e[N[3].key]=N[3],delete I[j])}for(const j in I){const N=I[j],X=this.findLoadedParent(N,this._source.minzoom),$=this.findLoadedSibling(N),Y=X||$||null;if(Y){D[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const W in D)D[W].isChildOf(Y.tileID)&&delete D[W]}}for(const j in this._tiles)D[j]||(this._coveredTiles[j]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new d.Y(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=pe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const u=on(e,this._source),m=Math.max(u-P.maxOverzooming,this._source.minzoom),y=Math.max(u+P.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const D of l)if(D.canonical.z>this._source.minzoom){const I=D.scaledTo(D.canonical.z-1);z[I.key]=I;const j=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));z[j.key]=j}l=l.concat(Object.values(z))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);H(this._source.type)&&this._updateCoveredAndRetainedTiles(T,m,y,u,l,n);for(const z in T)this._tiles[z].clearFadeHold();const E=d.ae(this._tiles,T);for(const z of E){const D=this._tiles[z];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var l;const u={},m={},y=Math.max(n-P.maxOverzooming,this._source.minzoom),b=Math.max(n+P.maxUnderzooming,this._source.minzoom),T={};for(const E of e){const z=this._addTile(E);u[E.key]=E,z.hasData()||n<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,n,b,u);for(const E of e){let z=this._tiles[E.key];if(z.hasData())continue;if(n+1>this._source.maxzoom){const I=E.children(this._source.maxzoom)[0],j=this.getTile(I);if(j&&j.hasData()){u[I.key]=I;continue}}else{const I=E.children(this._source.maxzoom);if(u[I[0].key]&&u[I[1].key]&&u[I[2].key]&&u[I[3].key])continue}let D=z.wasRequested();for(let I=E.overscaledZ-1;I>=y;--I){const j=E.scaledTo(I);if(m[j.key])break;if(m[j.key]=!0,z=this.getTile(j),!z&&D&&(z=this._addTile(j)),z){const N=z.hasData();if((N||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||D)&&(u[j.key]=j),D=z.wasRequested(),N)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}n.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;u=m}for(const m of n)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,l=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const l=n;return n||(n=new gs(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,l||this._source.fire(new d.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,l){const u=[],m=this.transform;if(!m)return u;const y=l?m.getCameraQueryGeometry(e):e,b=e.map(N=>m.screenPointToMercatorCoordinate(N,this.terrain)),T=y.map(N=>m.screenPointToMercatorCoordinate(N,this.terrain)),E=this.getIds();let z=1/0,D=1/0,I=-1/0,j=-1/0;for(const N of T)z=Math.min(z,N.x),D=Math.min(D,N.y),I=Math.max(I,N.x),j=Math.max(j,N.y);for(let N=0;N<E.length;N++){const X=this._tiles[E[N]];if(X.holdingForFade())continue;const $=X.tileID,Y=Math.pow(2,m.zoom-X.tileID.overscaledZ),W=n*X.queryPadding*d.Z/X.tileSize/Y,ie=[$.getTilePoint(new d.$(z,D)),$.getTilePoint(new d.$(I,j))];if(ie[0].x-W<d.Z&&ie[0].y-W<d.Z&&ie[1].x+W>=0&&ie[1].y+W>=0){const ne=b.map(le=>$.getTilePoint(le)),ae=T.map(le=>$.getTilePoint(le));u.push({tile:X,tileID:$,queryGeometry:ne,cameraQueryGeometry:ae,scale:Y})}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(H(this._source.type)){const e=ut.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){const u=this._tiles[e];u&&u.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(const l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}}function V(f,e){const n=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-n||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function H(f){return f==="raster"||f==="image"||f==="video"}P.maxOverzooming=10,P.maxUnderzooming=3;class K{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ad(e,0,1);let n=1,l=this._distances[n];const u=e*this.paddedLength+this.padding;for(;l<u&&n<this._distances.length;)l=this._distances[++n];const m=n-1,y=this._distances[m],b=l-y,T=b>0?(u-y)/b:0;return this.points[m].mult(1-T).add(this.points[n].mult(T))}}function re(f,e){let n=!0;return f==="always"||f!=="never"&&e!=="never"||(n=!1),n}class he{constructor(e,n,l){const u=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(n/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)u.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,l,u,m){this._forEachCell(n,l,u,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(m)}insertCircle(e,n,l,u){this._forEachCell(n-u,l-u,n+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,n,l,u,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,n,l,u,m,y){this.circleCells[m].push(y)}_query(e,n,l,u,m,y,b){if(l<0||e>this.width||u<0||n>this.height)return[];const T=[];if(e<=0&&n<=0&&this.width<=l&&this.height<=u){if(m)return[{key:null,x1:e,y1:n,x2:l,y2:u}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const z=this.circles[3*E],D=this.circles[3*E+1],I=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:z-I,y1:D-I,x2:z+I,y2:D+I})}}else this._forEachCell(e,n,l,u,this._queryCell,T,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},b);return T}query(e,n,l,u){return this._query(e,n,l,u,!1,null)}hitTest(e,n,l,u,m,y){return this._query(e,n,l,u,!0,m,y).length>0}hitTestCircle(e,n,l,u,m){const y=e-l,b=e+l,T=n-l,E=n+l;if(b<0||y>this.width||E<0||T>this.height)return!1;const z=[];return this._forEachCell(y,T,b,E,this._queryCellCircle,z,{hitTest:!0,overlapMode:u,circle:{x:e,y:n,radius:l},seenUids:{box:{},circle:{}}},m),z.length>0}_queryCell(e,n,l,u,m,y,b,T){const{seenUids:E,hitTest:z,overlapMode:D}=b,I=this.boxCells[m];if(I!==null){const N=this.bboxes;for(const X of I)if(!E.box[X]){E.box[X]=!0;const $=4*X,Y=this.boxKeys[X];if(e<=N[$+2]&&n<=N[$+3]&&l>=N[$+0]&&u>=N[$+1]&&(!T||T(Y))&&(!z||!re(D,Y.overlapMode))&&(y.push({key:Y,x1:N[$],y1:N[$+1],x2:N[$+2],y2:N[$+3]}),z))return!0}}const j=this.circleCells[m];if(j!==null){const N=this.circles;for(const X of j)if(!E.circle[X]){E.circle[X]=!0;const $=3*X,Y=this.circleKeys[X];if(this._circleAndRectCollide(N[$],N[$+1],N[$+2],e,n,l,u)&&(!T||T(Y))&&(!z||!re(D,Y.overlapMode))){const W=N[$],ie=N[$+1],ne=N[$+2];if(y.push({key:Y,x1:W-ne,y1:ie-ne,x2:W+ne,y2:ie+ne}),z)return!0}}}return!1}_queryCellCircle(e,n,l,u,m,y,b,T){const{circle:E,seenUids:z,overlapMode:D}=b,I=this.boxCells[m];if(I!==null){const N=this.bboxes;for(const X of I)if(!z.box[X]){z.box[X]=!0;const $=4*X,Y=this.boxKeys[X];if(this._circleAndRectCollide(E.x,E.y,E.radius,N[$+0],N[$+1],N[$+2],N[$+3])&&(!T||T(Y))&&!re(D,Y.overlapMode))return y.push(!0),!0}}const j=this.circleCells[m];if(j!==null){const N=this.circles;for(const X of j)if(!z.circle[X]){z.circle[X]=!0;const $=3*X,Y=this.circleKeys[X];if(this._circlesCollide(N[$],N[$+1],N[$+2],E.x,E.y,E.radius)&&(!T||T(Y))&&!re(D,Y.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,l,u,m,y,b,T){const E=this._convertToXCellCoord(e),z=this._convertToYCellCoord(n),D=this._convertToXCellCoord(l),I=this._convertToYCellCoord(u);for(let j=E;j<=D;j++)for(let N=z;N<=I;N++)if(m.call(this,e,n,l,u,this.xCellCount*N+j,y,b,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,l,u,m,y){const b=u-e,T=m-n,E=l+y;return E*E>b*b+T*T}_circleAndRectCollide(e,n,l,u,m,y,b){const T=(y-u)/2,E=Math.abs(e-(u+T));if(E>T+l)return!1;const z=(b-m)/2,D=Math.abs(n-(m+z));if(D>z+l)return!1;if(E<=T||D<=z)return!0;const I=E-T,j=D-z;return I*I+j*j<=l*l}}function be(f,e,n){const l=d.K();if(!f){const{vecSouth:D,vecEast:I}=Pe(e),j=Ve();j[0]=I[0],j[1]=I[1],j[2]=D[0],j[3]=D[1],u=j,(z=(y=(m=j)[0])*(E=m[3])-(T=m[2])*(b=m[1]))&&(u[0]=E*(z=1/z),u[1]=-b*z,u[2]=-T*z,u[3]=y*z),l[0]=j[0],l[1]=j[1],l[4]=j[2],l[5]=j[3]}var u,m,y,b,T,E,z;return d.M(l,l,[1/n,1/n,1]),l}function ce(f,e,n,l){if(f){const u=d.K();if(!e){const{vecSouth:m,vecEast:y}=Pe(n);u[0]=y[0],u[1]=y[1],u[4]=m[0],u[5]=m[1]}return d.M(u,u,[l,l,1]),u}return n.pixelsToClipSpaceMatrix}function Pe(f){const e=Math.cos(f.rollInRadians),n=Math.sin(f.rollInRadians),l=Math.cos(f.pitchInRadians),u=Math.cos(f.bearingInRadians),m=Math.sin(f.bearingInRadians),y=d.aj();y[0]=-u*l*n-m*e,y[1]=-m*l*n+u*e;const b=d.ak(y);b<1e-9?d.al(y):d.am(y,y,1/b);const T=d.aj();T[0]=u*l*e-m*n,T[1]=m*l*e+u*n;const E=d.ak(T);return E<1e-9?d.al(T):d.am(T,T,1/E),{vecEast:T,vecSouth:y}}function Me(f,e,n,l){let u;l?(u=[f,e,l(f,e),1],d.ao(u,u,n)):(u=[f,e,0,1],Cn(u,u,n));const m=u[3];return{point:new d.P(u[0]/m,u[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function me(f,e){return .5+f/e*.5}function Be(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function _e(f,e,n,l,u,m,y,b,T,E,z,D,I){const j=n?f.textSizeData:f.iconSizeData,N=d.af(j,e.transform.zoom),X=[256/e.width*2+1,256/e.height*2+1],$=n?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();const Y=f.lineVertexArray,W=n?f.text.placedSymbolArray:f.icon.placedSymbolArray,ie=e.transform.width/e.transform.height;let ne=!1;for(let ae=0;ae<W.length;ae++){const le=W.get(ae);if(le.hidden||le.writingMode===d.ag.vertical&&!ne){Wi(le.numGlyphs,$);continue}ne=!1;const se=new d.P(le.anchorX,le.anchorY),ye={getElevation:I,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:se,unwrappedTileID:T,width:E,height:z,translation:D},we=Bt(le.anchorX,le.anchorY,ye);if(!Be(we.point,X)){Wi(le.numGlyphs,$);continue}const De=me(e.transform.cameraToCenterDistance,we.signedDistanceFromCamera),Ie=d.ah(j,N,le),ze=m?Ie*e.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,T)/De:Ie*De,Ye=At({projectionContext:ye,pitchedLabelPlaneMatrixInverse:u,symbol:le,fontSize:ze,flip:!1,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:ie,rotateToLine:b});ne=Ye.useVertical,(Ye.notEnoughRoom||ne||Ye.needsFlipping&&At({projectionContext:ye,pitchedLabelPlaneMatrixInverse:u,symbol:le,fontSize:ze,flip:!0,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:ie,rotateToLine:b}).notEnoughRoom)&&Wi(le.numGlyphs,$)}n?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function Qe(f,e,n,l,u,m,y,b){const T=m.glyphStartIndex+m.numGlyphs,E=m.lineStartIndex,z=m.lineStartIndex+m.lineLength,D=e.getoffsetX(m.glyphStartIndex),I=e.getoffsetX(T-1),j=et(f*D,n,l,u,m.segment,E,z,b,y);if(!j)return null;const N=et(f*I,n,l,u,m.segment,E,z,b,y);return N?b.projectionCache.anyProjectionOccluded?null:{first:j,last:N}:null}function lt(f,e,n,l){return f===d.ag.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*l?{useVertical:!0}:(f===d.ag.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function At(f){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:u,flip:m,keepUpright:y,glyphOffsetArray:b,dynamicLayoutVertexArray:T,aspectRatio:E,rotateToLine:z}=f,D=u/24,I=l.lineOffsetX*D,j=l.lineOffsetY*D;let N;if(l.numGlyphs>1){const X=l.glyphStartIndex+l.numGlyphs,$=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,W=Qe(D,b,I,j,m,l,z,e);if(!W)return{notEnoughRoom:!0};const ie=Je(W.first.point.x,W.first.point.y,e,n),ne=Je(W.last.point.x,W.last.point.y,e,n);if(y&&!m){const ae=lt(l.writingMode,ie,ne,E);if(ae)return ae}N=[W.first];for(let ae=l.glyphStartIndex+1;ae<X-1;ae++)N.push(et(D*b.getoffsetX(ae),I,j,m,l.segment,$,Y,e,z));N.push(W.last)}else{if(y&&!m){const $=it(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Y=l.lineStartIndex+l.segment+1,W=new d.P(e.lineVertexArray.getx(Y),e.lineVertexArray.gety(Y)),ie=it(W.x,W.y,e),ne=ie.signedDistanceFromCamera>0?ie.point:wt(e.tileAnchorPoint,W,$,1,e),ae=Je($.x,$.y,e,n),le=Je(ne.x,ne.y,e,n),se=lt(l.writingMode,ae,le,E);if(se)return se}const X=et(D*b.getoffsetX(l.glyphStartIndex),I,j,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,z);if(!X||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[X]}for(const X of N)d.an(T,X.point,X.angle);return{}}function wt(f,e,n,l,u){const m=f.add(f.sub(e)._unit()),y=it(m.x,m.y,u).point,b=n.sub(y);return n.add(b._mult(l/b.mag()))}function ke(f,e,n){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),m=it(u.x,u.y,e);if(m.signedDistanceFromCamera>0)return l.projections[f]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=f-n.direction;return wt(n.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),u,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function it(f,e,n){const l=f+n.translation[0],u=e+n.translation[1];let m;return n.pitchWithMap?(m=Me(l,u,n.pitchedLabelPlaneMatrix,n.getElevation),m.isOccluded=!1):(m=n.transform.projectTileCoordinates(l,u,n.unwrappedTileID,n.getElevation),m.point.x=(.5*m.point.x+.5)*n.width,m.point.y=(.5*-m.point.y+.5)*n.height),m}function Je(f,e,n,l){if(n.pitchWithMap){const u=[f,e,0,1];return d.ao(u,u,l),n.transform.projectTileCoordinates(u[0]/u[3],u[1]/u[3],n.unwrappedTileID,n.getElevation).point}return{x:f/n.width*2-1,y:e/n.height*2-1}}function Bt(f,e,n){return n.transform.projectTileCoordinates(f,e,n.unwrappedTileID,n.getElevation)}function _t(f,e,n){return f._unit()._perp()._mult(e*n)}function xt(f,e,n,l,u,m,y,b,T){if(b.projectionCache.offsets[f])return b.projectionCache.offsets[f];const E=n.add(e);if(f+T.direction<l||f+T.direction>=u)return b.projectionCache.offsets[f]=E,E;const z=ke(f+T.direction,b,T),D=_t(z.sub(n),y,T.direction),I=n.add(D),j=z.add(D);return b.projectionCache.offsets[f]=d.ap(m,E,I,j)||E,b.projectionCache.offsets[f]}function et(f,e,n,l,u,m,y,b,T){const E=l?f-e:f+e;let z=E>0?1:-1,D=0;l&&(z*=-1,D=Math.PI),z<0&&(D+=Math.PI);let I,j=z>0?m+u:m+u+1;b.projectionCache.cachedAnchorPoint?I=b.projectionCache.cachedAnchorPoint:(I=it(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=I);let N,X,$=I,Y=I,W=0,ie=0;const ne=Math.abs(E),ae=[];let le;for(;W+ie<=ne;){if(j+=z,j<m||j>=y)return null;W+=ie,Y=$,X=N;const we={absOffsetX:ne,direction:z,distanceFromAnchor:W,previousVertex:Y};if($=ke(j,b,we),n===0)ae.push(Y),le=$.sub(Y);else{let De;const Ie=$.sub(Y);De=Ie.mag()===0?_t(ke(j+z,b,we).sub($),n,z):_t(Ie,n,z),X||(X=Y.add(De)),N=xt(j,De,$,m,y,X,n,b,we),ae.push(X),le=N.sub(X)}ie=le.mag()}const se=le._mult((ne-W)/ie)._add(X||Y),ye=D+Math.atan2($.y-Y.y,$.x-Y.x);return ae.push(se),{point:se,angle:T?ye:0,path:ae}}const Ka=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wi(f,e){for(let n=0;n<f;n++){const l=e.length;e.resize(l+4),e.float32.set(Ka,3*l)}}function Cn(f,e,n){const l=e[0],u=e[1];return f[0]=n[0]*l+n[4]*u+n[12],f[1]=n[1]*l+n[5]*u+n[13],f[3]=n[3]*l+n[7]*u+n[15],f}const Mi=100;class El{constructor(e,n=new he(e.width+200,e.height+200,25),l=new he(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Mi,this.screenBottomBoundary=e.height+Mi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,l,u,m,y,b,T,E,z,D,I){const j=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],m,z,I),N=l*j.perspectiveRatio;let X;if(y||b)X=this._projectCollisionBox(e,N,u,m,y,b,T,j,z,D,I);else{const le=j.x+(D?D.x*N:0),se=j.y+(D?D.y*N:0);X={allPointsOccluded:!1,box:[le+e.x1*N,se+e.y1*N,le+e.x2*N,se+e.y2*N]}}const[$,Y,W,ie]=X.box,ne=y?X.allPointsOccluded:j.isOccluded;let ae=ne;return ae||(ae=j.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid($,Y,W,ie)),ae||n!=="always"&&this.grid.hitTest($,Y,W,ie,n,E)?{box:[$,Y,W,ie],placeable:!1,offscreen:!1,occluded:ne}:{box:[$,Y,W,ie],placeable:!0,offscreen:this.isOffscreen($,Y,W,ie),occluded:ne}}placeCollisionCircles(e,n,l,u,m,y,b,T,E,z,D,I,j,N){const X=[],$=new d.P(n.anchorX,n.anchorY),Y=this.getPerspectiveRatio($.x,$.y,y,N),W=(E?m*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,y)/Y:m*Y)/d.au,ie={getElevation:N,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:$,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:j},ne=Qe(W,u,n.lineOffsetX*W,n.lineOffsetY*W,!1,n,!1,ie);let ae=!1,le=!1,se=!0;if(ne){const ye=.5*D*Y+I,we=new d.P(-100,-100),De=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ie=new K,ze=ne.first,Ye=ne.last;let $e=[];for(let dt=ze.path.length-1;dt>=1;dt--)$e.push(ze.path[dt]);for(let dt=1;dt<Ye.path.length;dt++)$e.push(Ye.path[dt]);const Fe=2.5*ye;if(E){const dt=this.projectPathToScreenSpace($e,ie);$e=dt.some(ni=>ni.signedDistanceFromCamera<=0)?[]:dt.map(ni=>ni.point)}let rt=[];if($e.length>0){const dt=$e[0].clone(),ni=$e[0].clone();for(let bi=1;bi<$e.length;bi++)dt.x=Math.min(dt.x,$e[bi].x),dt.y=Math.min(dt.y,$e[bi].y),ni.x=Math.max(ni.x,$e[bi].x),ni.y=Math.max(ni.y,$e[bi].y);rt=dt.x>=we.x&&ni.x<=De.x&&dt.y>=we.y&&ni.y<=De.y?[$e]:ni.x<we.x||dt.x>De.x||ni.y<we.y||dt.y>De.y?[]:d.aq([$e],we.x,we.y,De.x,De.y)}for(const dt of rt){Ie.reset(dt,.25*ye);let ni=0;ni=Ie.length<=.5*ye?1:Math.ceil(Ie.paddedLength/Fe)+1;for(let bi=0;bi<ni;bi++){const hi=bi/Math.max(ni-1,1),mi=Ie.lerp(hi),gi=mi.x+Mi,Kt=mi.y+Mi;X.push(gi,Kt,ye,0);const di=gi-ye,zn=Kt-ye,wi=gi+ye,Pi=Kt+ye;if(se=se&&this.isOffscreen(di,zn,wi,Pi),le=le||this.isInsideGrid(di,zn,wi,Pi),e!=="always"&&this.grid.hitTestCircle(gi,Kt,ye,e,z)&&(ae=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!T&&ae||!le||Y<this.perspectiveRatioCutoff?[]:X,offscreen:se,collisionDetected:ae}}projectPathToScreenSpace(e,n){const l=function(u,m){const y=d.K();return d.ai(y,m.pitchedLabelPlaneMatrix),u.map(b=>{const T=Me(b.x,b.y,y,m.getElevation),E=m.transform.projectTileCoordinates(T.point.x,T.point.y,m.unwrappedTileID,m.getElevation);return E.point.x=(.5*E.point.x+.5)*m.width,E.point.y=(.5*-E.point.y+.5)*m.height,E})}(e,n);return function(u){let m=0,y=0,b=0,T=0;for(let E=0;E<u.length;E++)u[E].isOccluded?(b=E+1,T=0):(T++,T>y&&(y=T,m=b));return u.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let l=1/0,u=1/0,m=-1/0,y=-1/0;for(const z of e){const D=new d.P(z.x+Mi,z.y+Mi);l=Math.min(l,D.x),u=Math.min(u,D.y),m=Math.max(m,D.x),y=Math.max(y,D.y),n.push(D)}const b=this.grid.query(l,u,m,y).concat(this.ignoredGrid.query(l,u,m,y)),T={},E={};for(const z of b){const D=z.key;if(T[D.bucketInstanceId]===void 0&&(T[D.bucketInstanceId]={}),T[D.bucketInstanceId][D.featureIndex])continue;const I=[new d.P(z.x1,z.y1),new d.P(z.x2,z.y1),new d.P(z.x2,z.y2),new d.P(z.x1,z.y2)];d.ar(n,I)&&(T[D.bucketInstanceId][D.featureIndex]=!0,E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]=[]),E[D.bucketInstanceId].push(D.featureIndex))}return E}insertCollisionBox(e,n,l,u,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,l,u,m,y){const b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:m,collisionGroupID:y,overlapMode:n};for(let E=0;E<e.length;E+=4)b.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,n,l,u,m){if(m){let y;u?(y=[e,n,u(e,n),1],d.ao(y,y,m)):(y=[e,n,0,1],Cn(y,y,m));const b=y[3];return{x:(y[0]/b+1)/2*this.transform.width+Mi,y:(-y[1]/b+1)/2*this.transform.height+Mi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const y=this.transform.projectTileCoordinates(e,n,l,u);return{x:(y.point.x+1)/2*this.transform.width+Mi,y:(1-y.point.y)/2*this.transform.height+Mi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,l,u){const m=this.transform.projectTileCoordinates(e,n,l,u);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,n,l,u){return l<Mi||e>=this.screenRightBoundary||u<Mi||n>this.screenBottomBoundary}isInsideGrid(e,n,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=d.as([]);return d.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,l,u,m,y,b,T,E,z,D){let I=1,j=0,N=0,X=1;const $=e.anchorPointX+b[0],Y=e.anchorPointY+b[1];if(y&&!m){const $e=this.projectAndGetPerspectiveRatio($+1,Y,u,E,D),Fe=$e.x-T.x,rt=Math.atan(($e.y-T.y)/Fe)+(Fe<0?Math.PI:0),dt=Math.sin(rt),ni=Math.cos(rt);I=ni,j=dt,N=-dt,X=ni}else if(!y&&m){const $e=Pe(this.transform);I=$e.vecEast[0],j=$e.vecEast[1],N=$e.vecSouth[0],X=$e.vecSouth[1]}let W=T.x,ie=T.y,ne=n;m&&(W=$,ie=Y,ne=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),ne*=this.transform.getPitchedTextCorrection($,Y,u),z||(ne*=d.ad(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(W+=I*z.x*ne+N*z.y*ne,ie+=j*z.x*ne+X*z.y*ne);const ae=e.x1*ne,le=e.x2*ne,se=(ae+le)/2,ye=e.y1*ne,we=e.y2*ne,De=(ye+we)/2,Ie=[{offsetX:ae,offsetY:ye},{offsetX:se,offsetY:ye},{offsetX:le,offsetY:ye},{offsetX:le,offsetY:De},{offsetX:le,offsetY:we},{offsetX:se,offsetY:we},{offsetX:ae,offsetY:we},{offsetX:ae,offsetY:De}];let ze=[];for(const{offsetX:$e,offsetY:Fe}of Ie)ze.push(new d.P(W+I*$e+N*Fe,ie+j*$e+X*Fe));let Ye=!1;if(m){const $e=ze.map(Fe=>this.projectAndGetPerspectiveRatio(Fe.x,Fe.y,u,E,D));Ye=$e.some(Fe=>!Fe.isOccluded),ze=$e.map(Fe=>new d.P(Fe.x,Fe.y))}else Ye=!0;return{box:d.at(ze),allPointsOccluded:!Ye}}}class Ln{constructor(e,n,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ci{constructor(e,n,l,u,m){this.text=new Ln(e?e.text:null,n,l,m),this.icon=new Ln(e?e.icon:null,n,u,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ys{constructor(e,n,l){this.text=e,this.icon=n,this.skipFade=l}}class kr{constructor(e,n,l,u,m){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=m}}class Qs{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[e]}}function Ra(f,e,n,l,u){const{horizontalAlign:m,verticalAlign:y}=d.aA(f);return new d.P(-(m-.5)*e+l[0]*u,-(y-.5)*n+l[1]*u)}class Zi{constructor(e,n,l,u,m){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new El(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Qs(u),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(l,u)=>n.getElevation(e,l,u):null}getBucketParts(e,n,l,u){const m=l.getBucket(n),y=l.latestFeatureIndex;if(!m||!y||n.id!==m.layerIds[0])return;const b=l.collisionBoxArray,T=m.layers[0].layout,E=m.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),D=l.tileSize/d.Z,I=l.tileID.toUnwrapped(),j=T.get("text-rotation-alignment")==="map",N=d.av(l,1,this.transform.zoom),X=d.aw(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),$=d.aw(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),Y=be(j,this.transform,N);this.retainedQueryData[m.bucketInstanceId]=new kr(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const W={bucket:m,layout:T,translationText:X,translationIcon:$,unwrappedTileID:I,pitchedLabelPlaneMatrix:Y,scale:z,textPixelRatio:D,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.af(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(u)for(const ie of m.sortKeyRanges){const{sortKey:ne,symbolInstanceStart:ae,symbolInstanceEnd:le}=ie;e.push({sortKey:ne,symbolInstanceStart:ae,symbolInstanceEnd:le,parameters:W})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:W})}attemptAnchorPlacement(e,n,l,u,m,y,b,T,E,z,D,I,j,N,X,$,Y,W,ie,ne){const ae=d.ax[e.textAnchor],le=[e.textOffset0,e.textOffset1],se=Ra(ae,l,u,le,m),ye=this.collisionIndex.placeCollisionBox(n,I,T,E,z,b,y,$,D.predicate,ie,se,ne);if((!W||this.collisionIndex.placeCollisionBox(W,I,T,E,z,b,y,Y,D.predicate,ie,se,ne).placeable)&&ye.placeable){let we;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(we=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:le,width:l,height:u,anchor:ae,textBoxScale:m,prevAnchor:we},this.markUsedJustification(N,ae,j,X),N.allowVerticalPlacement&&(this.markUsedOrientation(N,X,j),this.placedOrientations[j.crossTileID]=X),{shift:se,placedGlyphBoxes:ye}}}placeLayerBucketPart(e,n,l){const{bucket:u,layout:m,translationText:y,translationIcon:b,unwrappedTileID:T,pitchedLabelPlaneMatrix:E,textPixelRatio:z,holdingForFade:D,collisionBoxArray:I,partiallyEvaluatedTextSize:j,collisionGroup:N}=e.parameters,X=m.get("text-optional"),$=m.get("icon-optional"),Y=d.ay(m,"text-overlap","text-allow-overlap"),W=Y==="always",ie=d.ay(m,"icon-overlap","icon-allow-overlap"),ne=ie==="always",ae=m.get("text-rotation-alignment")==="map",le=m.get("text-pitch-alignment")==="map",se=m.get("icon-text-fit")!=="none",ye=m.get("symbol-z-order")==="viewport-y",we=W&&(ne||!u.hasIconData()||$),De=ne&&(W||!u.hasTextData()||X);!u.collisionArrays&&I&&u.deserializeCollisionBoxes(I);const Ie=this.retainedQueryData[u.bucketInstanceId].tileID,ze=this._getTerrainElevationFunc(Ie),Ye=this.transform.getFastPathSimpleProjectionMatrix(Ie),$e=(Fe,rt,dt)=>{var ni,bi;if(n[Fe.crossTileID])return;if(D)return void(this.placements[Fe.crossTileID]=new ys(!1,!1,!1));let hi=!1,mi=!1,gi=!0,Kt=null,di={box:null,placeable:!1,offscreen:null,occluded:!1},zn={placeable:!1},wi=null,Pi=null,ji=null,Ea=0,Sr=0,sr=0;rt.textFeatureIndex?Ea=rt.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(Ea=Fe.featureIndex),rt.verticalTextFeatureIndex&&(Sr=rt.verticalTextFeatureIndex);const Ga=rt.textBox;if(Ga){const qa=yi=>{let fi=d.ag.horizontal;if(u.allowVerticalPlacement&&!yi&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[Fe.crossTileID];xn&&(this.placedOrientations[Fe.crossTileID]=xn,fi=xn,this.markUsedOrientation(u,fi,Fe))}return fi},Er=(yi,fi)=>{if(u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const xn of u.writingModes)if(xn===d.ag.vertical?(di=fi(),zn=di):di=yi(),di&&di.placeable)break}else di=yi()},or=Fe.textAnchorOffsetStartIndex,Ha=Fe.textAnchorOffsetEndIndex;if(Ha===or){const yi=(fi,xn)=>{const bn=this.collisionIndex.placeCollisionBox(fi,Y,z,Ie,T,le,ae,y,N.predicate,ze,void 0,Ye);return bn&&bn.placeable&&(this.markUsedOrientation(u,xn,Fe),this.placedOrientations[Fe.crossTileID]=xn),bn};Er(()=>yi(Ga,d.ag.horizontal),()=>{const fi=rt.verticalTextBox;return u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&fi?yi(fi,d.ag.vertical):{box:null,offscreen:null}}),qa(di&&di.placeable)}else{let yi=d.ax[(bi=(ni=this.prevPlacement)===null||ni===void 0?void 0:ni.variableOffsets[Fe.crossTileID])===null||bi===void 0?void 0:bi.anchor];const fi=(bn,_o,Ih)=>{const Pn=bn.x2-bn.x1,Dn=bn.y2-bn.y1,Uu=Fe.textBoxScale,js=se&&ie==="never"?_o:null;let Ca=null,eu=Y==="never"?1:2,Vu="never";yi&&eu++;for(let Ns=0;Ns<eu;Ns++){for(let tl=or;tl<Ha;tl++){const Zu=u.textAnchorOffsets.get(tl);if(yi&&Zu.textAnchor!==yi)continue;const tc=this.attemptAnchorPlacement(Zu,bn,Pn,Dn,Uu,ae,le,z,Ie,T,N,Vu,Fe,u,Ih,y,b,js,ze);if(tc&&(Ca=tc.placedGlyphBoxes,Ca&&Ca.placeable))return hi=!0,Kt=tc.shift,Ca}yi?yi=null:Vu=Y}return l&&!Ca&&(Ca={box:this.collisionIndex.placeCollisionBox(Ga,"always",z,Ie,T,le,ae,y,N.predicate,ze,void 0,Ye).box,offscreen:!1,placeable:!1,occluded:!1}),Ca};Er(()=>fi(Ga,rt.iconBox,d.ag.horizontal),()=>{const bn=rt.verticalTextBox;return u.allowVerticalPlacement&&(!di||!di.placeable)&&Fe.numVerticalGlyphVertices>0&&bn?fi(bn,rt.verticalIconBox,d.ag.vertical):{box:null,occluded:!0,offscreen:null}}),di&&(hi=di.placeable,gi=di.offscreen);const xn=qa(di&&di.placeable);if(!hi&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[Fe.crossTileID];bn&&(this.variableOffsets[Fe.crossTileID]=bn,this.markUsedJustification(u,bn.anchor,Fe,xn))}}}if(wi=di,hi=wi&&wi.placeable,gi=wi&&wi.offscreen,Fe.useRuntimeCollisionCircles){const qa=u.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),Er=d.ah(u.textSizeData,j,qa),or=m.get("text-padding");Pi=this.collisionIndex.placeCollisionCircles(Y,qa,u.lineVertexArray,u.glyphOffsetArray,Er,T,E,l,le,N.predicate,Fe.collisionCircleDiameter,or,y,ze),Pi.circles.length&&Pi.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),hi=W||Pi.circles.length>0&&!Pi.collisionDetected,gi=gi&&Pi.offscreen}if(rt.iconFeatureIndex&&(sr=rt.iconFeatureIndex),rt.iconBox){const qa=Er=>this.collisionIndex.placeCollisionBox(Er,ie,z,Ie,T,le,ae,b,N.predicate,ze,se&&Kt?Kt:void 0,Ye);zn&&zn.placeable&&rt.verticalIconBox?(ji=qa(rt.verticalIconBox),mi=ji.placeable):(ji=qa(rt.iconBox),mi=ji.placeable),gi=gi&&ji.offscreen}const Fs=X||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,Mr=$||Fe.numIconVertices===0;Fs||Mr?Mr?Fs||(mi=mi&&hi):hi=mi&&hi:mi=hi=mi&&hi;const qr=mi&&ji.placeable;if(hi&&wi.placeable&&this.collisionIndex.insertCollisionBox(wi.box,Y,m.get("text-ignore-placement"),u.bucketInstanceId,zn&&zn.placeable&&Sr?Sr:Ea,N.ID),qr&&this.collisionIndex.insertCollisionBox(ji.box,ie,m.get("icon-ignore-placement"),u.bucketInstanceId,sr,N.ID),Pi&&hi&&this.collisionIndex.insertCollisionCircles(Pi.circles,Y,m.get("text-ignore-placement"),u.bucketInstanceId,Ea,N.ID),l&&this.storeCollisionData(u.bucketInstanceId,dt,rt,wi,ji,Pi),Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new ys((hi||we)&&!(wi!=null&&wi.occluded),(mi||De)&&!(ji!=null&&ji.occluded),gi||u.justReloaded),n[Fe.crossTileID]=!0};if(ye){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=u.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let rt=Fe.length-1;rt>=0;--rt){const dt=Fe[rt];$e(u.symbolInstances.get(dt),u.collisionArrays[dt],dt)}}else for(let Fe=e.symbolInstanceStart;Fe<e.symbolInstanceEnd;Fe++)$e(u.symbolInstances.get(Fe),u.collisionArrays[Fe],Fe);u.justReloaded=!1}storeCollisionData(e,n,l,u,m,y){if(l.textBox||l.iconBox){let b,T;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(n)?T=b.get(n):(T={text:null,icon:null},b.set(n,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=m.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)b.push(y.circles[T+0]-Mi),b.push(y.circles[T+1]-Mi),b.push(y.circles[T+2]),b.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,l,u){let m;m=u===d.ag.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.az(n)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(e,n,l){const u=n===d.ag.horizontal||n===d.ag.horizontalOnly?n:0,m=n===d.ag.vertical?n:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(e):1,m=n?n.opacities:{},y=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],z=m[T];z?(this.opacities[T]=new ci(z,u,E.text,E.icon),l=l||E.text!==z.text.placed||E.icon!==z.icon.placed):(this.opacities[T]=new ci(null,u,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in m){const E=m[T];if(!this.opacities[T]){const z=new ci(E,u,!1,!1);z.isHidden()||(this.opacities[T]=z,l=l||E.text.placed||E.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const l={};for(const u of n){const m=u.getBucket(e);m&&u.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,n,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,b=new ci(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),z=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=y.get("text-rotation-alignment")==="map",I=y.get("text-pitch-alignment")==="map",j=y.get("icon-text-fit")!=="none",N=new ci(null,0,T&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const X=(Y,W,ie)=>{for(let ne=0;ne<W/4;ne++)Y.opacityVertexArray.emplaceBack(ie);Y.hasVisibleVertices=Y.hasVisibleVertices||ie!==Wr},$=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const W=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:ne,crossTileID:ae}=W;let le=this.opacities[ae];l[ae]?le=b:le||(le=N,this.opacities[ae]=le),l[ae]=!0;const se=W.numIconVertices>0,ye=this.placedOrientations[W.crossTileID],we=ye===d.ag.vertical,De=ye===d.ag.horizontal||ye===d.ag.horizontalOnly;if(ie>0||ne>0){const ze=Tu(le.text);X(e.text,ie,we?Wr:ze),X(e.text,ne,De?Wr:ze);const Ye=le.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(e.text.placedSymbolArray.get(rt).hidden=Ye||we?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ye||De?1:0);const $e=this.variableOffsets[W.crossTileID];$e&&this.markUsedJustification(e,$e.anchor,W,ye);const Fe=this.placedOrientations[W.crossTileID];Fe&&(this.markUsedJustification(e,"left",W,Fe),this.markUsedOrientation(e,Fe,W))}if(se){const ze=Tu(le.icon),Ye=!(j&&W.verticalPlacedIconSymbolIndex&&we);W.placedIconSymbolIndex>=0&&(X(e.icon,W.numIconVertices,Ye?ze:Wr),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=le.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,W.numVerticalIconVertices,Ye?Wr:ze),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Ie=$&&$.has(Y)?$.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ze=e.collisionArrays[Y];if(ze){let Ye=new d.P(0,0);if(ze.textBox||ze.verticalTextBox){let $e=!0;if(z){const Fe=this.variableOffsets[ae];Fe?(Ye=Ra(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),D&&Ye._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):$e=!1}if(ze.textBox||ze.verticalTextBox){let Fe;ze.textBox&&(Fe=we),ze.verticalTextBox&&(Fe=De),gc(e.textCollisionBox.collisionVertexArray,le.text.placed,!$e||Fe,Ie.text,Ye.x,Ye.y)}}if(ze.iconBox||ze.verticalIconBox){const $e=!!(!De&&ze.verticalIconBox);let Fe;ze.iconBox&&(Fe=$e),ze.verticalIconBox&&(Fe=!$e),gc(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Fe,Ie.icon,j?Ye.x:0,j?Ye.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function gc(f,e,n,l,u,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Mi,b=l[1]-Mi,T=l[2]-Mi,E=l[3]-Mi;f.emplaceBack(e?1:0,n?1:0,u||0,m||0,y,b),f.emplaceBack(e?1:0,n?1:0,u||0,m||0,T,b),f.emplaceBack(e?1:0,n?1:0,u||0,m||0,T,E),f.emplaceBack(e?1:0,n?1:0,u||0,m||0,y,E)}const wu=Math.pow(2,25),vs=Math.pow(2,24),pr=Math.pow(2,17),Lr=Math.pow(2,16),dd=Math.pow(2,9),yh=Math.pow(2,8),vh=Math.pow(2,1);function Tu(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,n=Math.floor(127*f.opacity);return n*wu+e*vs+n*pr+e*Lr+n*dd+e*yh+n*vh+e}const Wr=0;class Ro{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,l,u,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,T)=>b.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class mr{constructor(e,n,l,u,m,y,b,T){this.placement=new Zi(e,n,y,b,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,n,l){const u=ut.now(),m=()=>!this._forceFullPlacement&&ut.now()-u>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Ro(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Hn=512/d.Z/2;class yc{constructor(e,n,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let m=0;m<n.length;m++){const y=n.get(m),b=y.key,T=u.get(b);T?T.push(y):u.set(b,[y])}for(const[m,y]of u){const b={positions:y.map(T=>({x:Math.floor(T.anchorX*Hn),y:Math.floor(T.anchorY*Hn)})),crossTileIDs:y.map(T=>T.crossTileID)};if(b.positions.length>128){const T=new d.aB(b.positions.length,16,Uint16Array);for(const{x:E,y:z}of b.positions)T.add(E,z);T.finish(),delete b.positions,b.index=T}this._symbolsByKey[m]=b}}getScaledCoordinates(e,n){const{x:l,y:u,z:m}=this.tileID.canonical,{x:y,y:b,z:T}=n.canonical,E=Hn/Math.pow(2,T-m),z=(b*d.Z+e.anchorY)*E,D=u*d.Z*Hn;return{x:Math.floor((y*d.Z+e.anchorX)*E-l*d.Z*Hn),y:Math.floor(z-D)}}findMatches(e,n,l){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const T=this.getScaledCoordinates(y,n);if(b.index){const E=b.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const z of E){const D=b.crossTileIDs[z];if(!l[D]){l[D]=!0,y.crossTileID=D;break}}}else if(b.positions)for(let E=0;E<b.positions.length;E++){const z=b.positions[E],D=b.crossTileIDs[E];if(Math.abs(z.x-T.x)<=u&&Math.abs(z.y-T.y)<=u&&!l[D]){l[D]=!0,y.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Su{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ks{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const l in this.indexes){const u=this.indexes[l],m={};for(const y in u){const b=u[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=e}addBucket(e,n,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const b in y){const T=y[b];T.tileID.isChildOf(e)&&T.findMatches(n.symbolInstances,e,u)}else{const b=y[e.scaledTo(Number(m)).key];b&&b.findMatches(n.symbolInstances,e,u)}}for(let m=0;m<n.symbolInstances.length;m++){const y=n.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),u[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new yc(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const l of n.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let n=!1;for(const l in this.indexes){const u=this.indexes[l];for(const m in u)e[u[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[m]),delete u[m],n=!0)}return n}}class vc{constructor(){this.layerIndexes={},this.crossTileIDs=new Su,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Ks);let m=!1;const y={};u.handleWrapJump(l);for(const b of n){const T=b.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(b.tileID,T,this.crossTileIDs)&&(m=!0),y[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const n={};e.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var Br="void main() {fragColor=vec4(1.0);}";const _r={prelude:It(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:It("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:It("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:It(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:It(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:It(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:It(Br,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:It(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:It(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:It("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:It("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:It("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:It(Br,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:It(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:It(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:It(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:It(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:It(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:It(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:It(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:It(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:It(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:It(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:It(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:It("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:It("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:It("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:It("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:It(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:It("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function It(f,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(u):u,b={};return{fragmentSource:f=f.replace(n,(T,E,z,D,I)=>(b[I]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${z} ${D} ${I};
#else
uniform ${z} ${D} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${z} ${D} ${I} = u_${I};
#endif
`)),vertexSource:e=e.replace(n,(T,E,z,D,I)=>{const j=D==="float"?"vec2":"vec4",N=I.match(/color/)?"color":j;return b[I]?E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${j} a_${I};
out ${z} ${D} ${I};
#else
uniform ${z} ${D} u_${I};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${z} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${N}(a_${I}, u_${I}_t);
#else
    ${z} ${D} ${I} = u_${I};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${j} a_${I};
#else
uniform ${z} ${D} u_${I};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${D} ${I} = a_${I};
#else
    ${z} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${D} ${I} = unpack_mix_${N}(a_${I}, u_${I}_t);
#else
    ${z} ${D} ${I} = u_${I};
#endif
`}),staticAttributes:l,staticUniforms:y}}class ua{constructor(e,n,l){this.vertexBuffer=e,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ka=d.aC([{name:"a_pos",type:"Int16",components:2}]);const Zt="#define PROJECTION_MERCATOR",Jr="mercator";class xc{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Jr}get shaderDefine(){return Zt}get shaderPreludeCode(){return _r.projectionMercator}get vertexShaderPreludeCode(){return _r.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aD.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,l,u,m){if(this._cachedMesh)return this._cachedMesh;const y=new d.aE;y.emplaceBack(0,0),y.emplaceBack(d.Z,0),y.emplaceBack(0,d.Z),y.emplaceBack(d.Z,d.Z);const b=e.createVertexBuffer(y,ka.members),T=d.aF.simpleSegment(0,0,4,2),E=new d.aG;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const z=e.createIndexBuffer(E);return this._cachedMesh=new ua(b,z,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function La(f,e){const n=d.ad(e.lat,-85.051129,d.aI);return new d.P(d.U(e.lng)*f,d.S(n)*f)}function Ji(f,e){return new d.$(e.x/f,e.y/f).toLngLat()}function Bn(f){return f.cameraToCenterDistance*Math.min(.85*Math.tan(d.ac(90-f.pitch)),Math.tan(d.ac(89.25-f.pitch)))}function Bi(f,e){const n=f.canonical,l=e/d.aH(n.z),u=n.x+Math.pow(2,n.z)*f.wrap,m=d.as(new Float64Array(16));return d.L(m,m,[u*l,n.y*l,0]),d.M(m,m,[l/d.Z,l/d.Z,1]),m}function bc(f,e,n,l,u){const m=d.$.fromLngLat(f,e),y=u*d.aJ(1,f.lat),b=y*Math.cos(d.ac(n)),T=Math.sqrt(y*y-b*b),E=T*Math.sin(d.ac(-l)),z=T*Math.cos(d.ac(-l));return new d.$(m.x+E,m.y+z,m.z+b)}class yn{constructor(e=0,n=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=l,this.right=u}interpolate(e,n,l){return n.top!=null&&e.top!=null&&(this.top=d.B.number(e.top,n.top,l)),n.bottom!=null&&e.bottom!=null&&(this.bottom=d.B.number(e.bottom,n.bottom,l)),n.left!=null&&e.left!=null&&(this.left=d.B.number(e.left,n.left,l)),n.right!=null&&e.right!=null&&(this.right=d.B.number(e.right,n.right,l)),this}getCenter(e,n){const l=d.ad((this.left+e-this.right)/2,0,e),u=d.ad((this.top+n-this.bottom)/2,0,n);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new yn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ha(f,e){if(!f.renderWorldCopies||f.lngRange)return;const n=e.lng-f.center.lng;e.lng+=n>180?-360:n<-180?360:0}function xa(f){return Math.max(0,Math.floor(f))}class Ws{constructor(e,n,l,u,m,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=u??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=xa(this._zoom),this._scale=d.aH(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new yn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=xa(this._zoom),this._scale=d.aH(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new yn(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=d.aK(e,-180,180)*Math.PI/180;var l,u,m,y,b,T,E,z,D;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=Ve(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(u=this._rotationMatrix)[0],b=u[1],T=u[2],E=u[3],z=Math.sin(m),D=Math.cos(m),l[0]=y*D+T*z,l[1]=b*D+E*z,l[2]=y*-z+T*D,l[3]=b*-z+E*D)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=d.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aL(this._fovInRadians)}setFov(e){e=d.ad(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ac(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=d.aH(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,l){this._unmodified=!1,this._edgeInsets.interpolate(e,n,l),this._constrain(),this._calcMatrices()}resize(e,n,l=!0){this._width=e,this._height=n,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Li([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,d.aI])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{let l=e.x,u=e.y,m=e.x,y=e.y;for(const b of n)l=Math.min(l,b.x),u=Math.min(u,b.y),m=Math.max(m,b.x),y=Math.max(y,b.y);return[new d.P(l,u),new d.P(m,u),new d.P(m,y),new d.P(l,y),new d.P(l,u)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.as(new Float64Array(16));d.M(e,e,[this._width/2,-this._height/2,1]),d.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.as(new Float64Array(16)),d.M(e,e,[1,-1,1]),d.L(e,e,[-1,-1,0]),d.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,l,u){const m=l!==void 0?l:this.bearing,y=u=u!==void 0?u:this.pitch,b=d.$.fromLngLat(e,n),T=-Math.cos(d.ac(y)),E=Math.sin(d.ac(y)),z=E*Math.sin(d.ac(m)),D=-E*Math.cos(d.ac(m));let I=this.elevation;const j=n-I;let N;T*j>=0||Math.abs(T)<.1?(N=1e4,I=n+N*T):N=-j/T;let X,$,Y=d.aM(1,b.y),W=0;do{if(W+=1,W>10)break;$=N/Y,X=new d.$(b.x+z*$,b.y+D*$),Y=1/X.meterInMercatorCoordinateUnits()}while(Math.abs(N-$*Y)>1e-12);return{center:X.toLngLat(),elevation:I,zoom:d.aa(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=d.aJ(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/n,u=d.$.fromLngLat(this.center,this.elevation),m=bc(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),d.aM(m.z,u.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.aJ(1,this.center.lat)*this.worldSize;return bc(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/d.Z,1/n/d.Z]}}class Ba{constructor(e,n){this.min=e,this.max=n,this.center=d.aN([],d.aO([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=d.aP(this.min),u=d.aP(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],u[m]=n[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new Ba(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let l=0;l<e.planes.length;l++){const u=this.intersectsPlane(e.planes[l]);if(u===0)return 0;u===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],l=e[3];for(let u=0;u<3;u++)e[u]>0?(n+=e[u]*this.min[u],l+=e[u]*this.max[u]):(l+=e[u]*this.min[u],n+=e[u]*this.max[u]);return n>=0?2:l<0?0:1}}class en{distanceToTile2d(e,n,l,u){const m=u.distanceX([e,n]),y=u.distanceY([e,n]);return Math.hypot(m,y)}getWrap(e,n,l){return l}getTileAABB(e,n,l,u){var m,y;let b=l,T=l;if(u.terrain){const z=new d.Y(e.z,n,e.z,e.x,e.y),D=u.terrain.getMinMaxElevation(z);b=(m=D.minElevation)!==null&&m!==void 0?m:l,T=(y=D.maxElevation)!==null&&y!==void 0?y:l}const E=1<<e.z;return new Ba([n+e.x/E,e.y/E,b],[n+(e.x+1)/E,(e.y+1)/E,T])}allowVariableZoom(e,n){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,u=d.ad(78.5-l/2,0,60);return!!n.terrain||e.pitch>u}allowWorldCopies(){return!0}recalculateCache(){}}class Oa{constructor(e,n,l){this.points=e,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(e,n=1,l=0){const u=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const z=1/(E=d.ao([],E,e))[3]/n*u;return d.aQ(E,E,[z,z,1/E[3],z])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const z=d.aR([],m[E[0]],m[E[1]]),D=d.aR([],m[E[2]],m[E[1]]),I=d.aS([],d.aT([],z,D)),j=-d.aU(I,m[E[1]]);return I.concat(j)}),b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],T=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const E of m)for(let z=0;z<3;z++)b[z]=Math.min(b[z],E[z]),T[z]=Math.max(T[z],E[z]);return new Oa(m,y,new Ba(b,T))}}class $n{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,l,u,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,b)=>this.getConstrained(y,b)},e,n,l,u,m),this._coveringTilesDetailsProvider=new en}clone(){const e=new $n;return e.apply(this),e}apply(e,n,l){this._helper.apply(e,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new d.aV(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),u=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,u.x,m.x,y.x)),T=Math.floor(Math.max(l.x,u.x,m.x,y.x)),E=1;for(let z=b-E;z<=T+E;z++)z!==0&&n.push(new d.aV(z,e))}return n}getCameraFrustum(){return Oa.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const n=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,n){const l=d.aJ(this.elevation,this.center.lat),u=this.screenPointToMercatorCoordinateAtZ(n,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=d.$.fromLngLat(e),b=new d.$(y.x-(u.x-m.x),y.y-(u.y-m.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(d.$.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.$.fromLngLat(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const l=n||0,u=[e.x,e.y,0,1],m=[e.x,e.y,1,1];d.ao(u,u,this._pixelMatrixInverse),d.ao(m,m,this._pixelMatrixInverse);const y=u[3],b=m[3],T=u[1]/y,E=m[1]/b,z=u[2]/y,D=m[2]/b,I=z===D?0:(l-z)/(D-z);return new d.$(d.B.number(u[0]/y,m[0]/b,I)/this.worldSize,d.B.number(T,E,I)/this.worldSize,l)}coordinatePoint(e,n=0,l=this._pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,n,1];return d.ao(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Bn(this));return new Li().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-Bn(this)}calculatePosMatrix(e,n=!1,l){var u;const m=(u=e.key)!==null&&u!==void 0?u:d.aW(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=n?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const E=y.get(m);return l?E.f32:E.f64}const b=Bi(e,this.worldSize);d.N(b,n?this._alignedProjMatrix:this._viewProjMatrix,b);const T={f64:b,f32:new Float32Array(b)};return y.set(m,T),l?T.f32:T.f64}calculateFogMatrix(e){const n=e.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const u=Bi(e,this.worldSize);return d.N(u,this._fogMatrix,u),l.set(n,new Float32Array(u)),l.get(n)}getConstrained(e,n){n=d.ad(+n,this.minZoom,this.maxZoom);const l={center:new d.Q(e.lng,e.lat),zoom:n};let u=this._helper._lngRange;this._helper._renderWorldCopies||u!==null||(u=[-179.9999999999,180-1e-10]);const m=this.tileSize*d.aH(l.zoom);let y=0,b=m,T=0,E=m,z=0,D=0;const{x:I,y:j}=this.size;if(this._helper._latRange){const ie=this._helper._latRange;y=d.S(ie[1])*m,b=d.S(ie[0])*m,b-y<j&&(z=j/(b-y))}u&&(T=d.aK(d.U(u[0])*m,0,m),E=d.aK(d.U(u[1])*m,0,m),E<T&&(E+=m),E-T<I&&(D=I/(E-T)));const{x:N,y:X}=La(m,e);let $,Y;const W=Math.max(D||0,z||0);if(W){const ie=new d.P(D?(E+T)/2:N,z?(b+y)/2:X);return l.center=Ji(m,ie).wrap(),l.zoom+=d.aa(W),l}if(this._helper._latRange){const ie=j/2;X-ie<y&&(Y=y+ie),X+ie>b&&(Y=b-ie)}if(u){const ie=(T+E)/2;let ne=N;this._helper._renderWorldCopies&&(ne=d.aK(N,ie-m/2,ie+m/2));const ae=I/2;ne-ae<T&&($=T+ae),ne+ae>E&&($=E-ae)}if($!==void 0||Y!==void 0){const ie=new d.P($??N,Y??X);l.center=Ji(m,ie).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}_calculateNearFarZIfNeeded(e,n,l){if(!this._helper.autoCalculateNearFarZ)return;const u=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-u*this._helper._pixelPerMeter/Math.cos(n),y=u<0?m:e,b=Math.PI/2+this.pitchInRadians,T=d.ac(this.fov)*(Math.abs(Math.cos(d.ac(this.roll)))*this.height+Math.abs(Math.sin(d.ac(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(T)*y/Math.sin(d.ad(Math.PI-b-T,.01,Math.PI-.01)),z=Bn(this),D=Math.atan(z/this._helper.cameraToCenterDistance),I=d.ac(.75),j=D>I?2*D*(.5+l.y/(2*z)):I,N=Math.sin(j)*y/Math.sin(d.ad(Math.PI-b-j,.01,Math.PI-.01)),X=Math.min(E,N);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*X+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=La(this.worldSize,this.center),l=n.x,u=n.y;this._helper._pixelPerMeter=d.aJ(1,this.center.lat)*this.worldSize;const m=d.ac(Math.min(this.pitch,89.25)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let b;this._calculateNearFarZIfNeeded(y,m,e),b=new Float64Array(16),d.aX(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.ai(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=d.aY(b),d.M(b,b,[1,-1,1]),d.L(b,b,[0,0,-this._helper.cameraToCenterDistance]),d.aZ(b,b,-this.rollInRadians),d.a_(b,b,this.pitchInRadians),d.aZ(b,b,-this.bearingInRadians),d.L(b,b,[-l,-u,0]),this._mercatorMatrix=d.M([],b,[this.worldSize,this.worldSize,this.worldSize]),d.M(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),d.L(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=d.ai([],b);const T=[0,0,-1,1];d.ao(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),d.aX(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.aZ(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.a_(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.aZ(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.L(this._fogMatrix,this._fogMatrix,[-l,-u,0]),d.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const E=this._helper._width%2/2,z=this._helper._height%2/2,D=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),j=l-Math.round(l)+D*E+I*z,N=u-Math.round(u)+D*z+I*E,X=new Float64Array(b);if(d.L(X,X,[j>.5?j-1:j,N>.5?N-1:N,0]),this._alignedProjMatrix=X,b=d.ai(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.ao(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.aJ(1,this.center.lat)*this.worldSize;return bc(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const l=d.$.fromLngLat(e),u=[l.x*this.worldSize,l.y*this.worldSize,n,1];return d.ao(u,u,this._viewProjMatrix),u[2]/u[3]}getProjectionData(e){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:u}=e,m=this._helper.getMercatorTileCoordinates(n),y=n?this.calculatePosMatrix(n,l,!0):null;let b;return b=n&&n.terrainRttPosMatrix32f&&u?n.terrainRttPosMatrix32f:y||d.a$(),{mainMatrix:b,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,l){return 1}transformLightDirection(e){return d.aP(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,l,u){const m=this.calculatePosMatrix(l);let y;u?(y=[e,n,u(e,n),1],d.ao(y,y,m)):(y=[e,n,0,1],Cn(y,y,m));const b=y[3];return{point:new d.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){const l=d.$.fromLngLat(e,n),u=l.meterInMercatorCoordinateUnits(),m=d.b0();return d.L(m,m,[l.x,l.y,l.z]),d.aZ(m,m,Math.PI),d.a_(m,m,Math.PI/2),d.M(m,m,[-u,u,u]),m}getProjectionDataForCustomLayer(e=!0){const n=new d.Y(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),u=Bi(n,this.worldSize);d.N(u,this._viewProjMatrix,u),l.tileMercatorCoords=[0,0,1,1];const m=[d.Z,d.Z,this.worldSize/this._helper.pixelsPerMeter],y=d.b1();return d.M(y,u,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ko(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ba(f){if(f.useSlerp)if(f.k<1){const e=d.b2(f.startEulerAngles.roll,f.startEulerAngles.pitch,f.startEulerAngles.bearing),n=d.b2(f.endEulerAngles.roll,f.endEulerAngles.pitch,f.endEulerAngles.bearing),l=new Float64Array(4);d.b3(l,e,n,f.k);const u=d.b4(l);f.tr.setRoll(u.roll),f.tr.setPitch(u.pitch),f.tr.setBearing(u.bearing)}else f.tr.setRoll(f.endEulerAngles.roll),f.tr.setPitch(f.endEulerAngles.pitch),f.tr.setBearing(f.endEulerAngles.bearing);else f.tr.setRoll(d.B.number(f.startEulerAngles.roll,f.endEulerAngles.roll,f.k)),f.tr.setPitch(d.B.number(f.startEulerAngles.pitch,f.endEulerAngles.pitch,f.k)),f.tr.setBearing(d.B.number(f.startEulerAngles.bearing,f.endEulerAngles.bearing,f.k))}function wc(f,e,n,l,u){const m=u.padding,y=La(u.worldSize,n.getNorthWest()),b=La(u.worldSize,n.getNorthEast()),T=La(u.worldSize,n.getSouthEast()),E=La(u.worldSize,n.getSouthWest()),z=d.ac(-l),D=y.rotate(z),I=b.rotate(z),j=T.rotate(z),N=E.rotate(z),X=new d.P(Math.max(D.x,I.x,N.x,j.x),Math.max(D.y,I.y,N.y,j.y)),$=new d.P(Math.min(D.x,I.x,N.x,j.x),Math.min(D.y,I.y,N.y,j.y)),Y=X.sub($),W=(u.width-(m.left+m.right+e.left+e.right))/Y.x,ie=(u.height-(m.top+m.bottom+e.top+e.bottom))/Y.y;if(ie<0||W<0)return void ko();const ne=Math.min(d.aa(u.scale*Math.min(W,ie)),f.maxZoom),ae=d.P.convert(f.offset),le=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ac(l)),se=ae.add(le).mult(u.scale/d.aH(ne));return{center:Ji(u.worldSize,y.add(T).div(2).sub(se)),zoom:ne,bearing:l}}class da{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,l){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,n,l,u,m){return wc(e,n,l,u,m)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(d.Q.convert(n.center))}handleEaseTo(e,n){const l=e.zoom,u=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},b=n.zoom!==void 0,T=!e.isPaddingEqual(n.padding);let E=!1;const z=b?+n.zoom:e.zoom;let D=e.centerPoint.add(n.offsetAsPoint);const I=e.screenPointToLocation(D),{center:j,zoom:N}=e.getConstrained(d.Q.convert(n.center||I),z??l);ha(e,j);const X=La(e.worldSize,I),$=La(e.worldSize,j).sub(X),Y=d.aH(N-l);return E=N!==l,{easeFunc:W=>{if(E&&e.setZoom(d.B.number(l,N,W)),d.b5(m,y)||ba({startEulerAngles:m,endEulerAngles:y,tr:e,k:W,useSlerp:m.roll!=y.roll}),T&&(e.interpolatePadding(u,n.padding,W),D=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const ie=d.aH(e.zoom-l),ne=N>l?Math.min(2,Y):Math.max(.5,Y),ae=Math.pow(ne,1-W),le=Ji(e.worldSize,X.add($.mult(W*ae)).mult(ie));e.setLocationAtPoint(e.renderWorldCopies?le.wrap():le,D)}},isZooming:E,elevationCenter:j}}handleFlyTo(e,n){const l=n.zoom!==void 0,u=e.zoom,m=e.getConstrained(d.Q.convert(n.center||n.locationAtOffset),l?+n.zoom:u),y=m.center,b=m.zoom;ha(e,y);const T=La(e.worldSize,n.locationAtOffset),E=La(e.worldSize,y).sub(T),z=E.mag(),D=d.aH(b-u);let I;if(n.minZoom!==void 0){const j=Math.min(+n.minZoom,u,b),N=e.getConstrained(y,j).zoom;I=d.aH(N-u)}return{easeFunc:(j,N,X,$)=>{e.setZoom(j===1?b:u+d.aa(N));const Y=j===1?y:Ji(e.worldSize,T.add(E.mult(X)).mult(N));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,$)},scaleOfZoom:D,targetCenter:y,scaleOfMinZoom:I,pixelPathLength:z}}}class xi{constructor(e,n,l){this.blendFunction=e,this.blendColor=n,this.mask=l}}xi.Replace=[1,0],xi.disabled=new xi(xi.Replace,d.b6.transparent,[!1,!1,!1,!1]),xi.unblended=new xi(xi.Replace,d.b6.transparent,[!0,!0,!0,!0]),xi.alphaBlended=new xi([1,771],d.b6.transparent,[!0,!0,!0,!0]);const xs=2305;class Lt{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}Lt.disabled=new Lt(!1,1029,xs),Lt.backCCW=new Lt(!0,1029,xs),Lt.frontCCW=new Lt(!0,1028,xs);class Dt{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const es=7680;class Gt{constructor(e,n,l,u,m,y){this.test=e,this.ref=n,this.mask=l,this.fail=u,this.depthFail=m,this.pass=y}}Gt.disabled=new Gt({func:519,mask:0},0,0,es,es,es);const bs=new WeakMap;function fa(f){var e;if(bs.has(f))return bs.get(f);{const n=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return bs.set(f,n),n}}class Lo{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const u=new d.aE;u.emplaceBack(-1,-1),u.emplaceBack(2,-1),u.emplaceBack(-1,2);const m=new d.aG;m.emplaceBack(0,1,2),this._fullscreenTriangle=new ua(n.createVertexBuffer(u,ka.members),n.createIndexBuffer(m),d.aF.simpleSegment(0,0,u.length,m.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),fa(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const l=this._cachedRenderContext.context,u=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.b6.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,u.TRIANGLES,Dt.disabled,Gt.disabled,xi.unblended,Lt.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&fa(u)){u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.readBuffer(u.COLOR_ATTACHMENT0),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);const m=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&fa(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Lo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}const Xn=d.Z/128;function gr(f,e){const n=f.granularity!==void 0?Math.max(f.granularity,1):1,l=n+(f.generateBorders?2:0),u=n+(f.extendToNorthPole||f.generateBorders?1:0)+(f.extendToSouthPole||f.generateBorders?1:0),m=l+1,y=u+1,b=f.generateBorders?-1:0,T=f.generateBorders||f.extendToNorthPole?-1:0,E=n+(f.generateBorders?1:0),z=n+(f.generateBorders||f.extendToSouthPole?1:0),D=m*y,I=l*u*6,j=m*y>65536;if(j&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const N=j||e==="32bit",X=new Int16Array(2*D);let $=0;for(let ie=T;ie<=z;ie++)for(let ne=b;ne<=E;ne++){let ae=ne/n*d.Z;ne===-1&&(ae=-64),ne===n+1&&(ae=d.Z+Xn);let le=ie/n*d.Z;ie===-1&&(le=f.extendToNorthPole?d.b8:-64),ie===n+1&&(le=f.extendToSouthPole?d.b9:d.Z+Xn),X[$++]=ae,X[$++]=le}const Y=N?new Uint32Array(I):new Uint16Array(I);let W=0;for(let ie=0;ie<u;ie++)for(let ne=0;ne<l;ne++){const ae=ne+1+ie*m,le=ne+(ie+1)*m,se=ne+1+(ie+1)*m;Y[W++]=ne+ie*m,Y[W++]=le,Y[W++]=ae,Y[W++]=ae,Y[W++]=le,Y[W++]=se}return{vertices:X.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:N}}const ts=new d.aD({fill:new d.ba(128,2),line:new d.ba(512,0),tile:new d.ba(128,32),stencil:new d.ba(128,1),circle:3});class Or{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return _r.projectionGlobe}get vertexShaderPreludeCode(){return _r.projectionMercator.vertexSource}get subdivisionGranularity(){return ts}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Lo(e));const n=d.S(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,u=this._errorMeasurement.updateErrorLoop(n,l),m=ut.now();u!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=u,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bb(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bc(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,l,u,m){const y=(m==="stencil"?ts.stencil:ts.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:n.y===0&&u,extendToSouthPole:n.y===(1<<n.z)-1&&u})}_getMesh(e,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const u=function(m,y){const b=gr(y,"16bit"),T=d.aE.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),E=d.aG.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new ua(m.createVertexBuffer(T,ka.members),m.createIndexBuffer(E),d.aF.simpleSegment(0,0,T.length,E.length))}(e,n);return this._tileMeshCache[l]=u,u}recalculate(e){}hasTransition(){const e=ut.now();let n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const fd=new d.r({type:new d.D(d.v.projection.type)});class Bo extends d.E{constructor(e){super(),this._transitionable=new d.T(fd),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.C(0)),this._mercatorProjection=new xc,this._verticalPerspectiveProjection=new Or}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bd){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,l,u,m){return this.currentProjection.getMeshFromTileID(e,n,l,u,m)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Cl(f){const e=Yn(f.worldSize,f.center.lat);return 2*Math.PI*e}function is(f,e,n,l,u){const m=1/(1<<u),y=e/d.Z*m+l*m,b=d.bf((f/d.Z*m+n*m)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,E=Math.cos(T),z=new Float64Array(3);return z[0]=Math.sin(b)*E,z[1]=Math.sin(T),z[2]=Math.cos(b)*E,z}function An(f){return function(e,n){const l=Math.cos(n),u=new Float64Array(3);return u[0]=Math.sin(e)*l,u[1]=Math.sin(n),u[2]=Math.cos(e)*l,u}(f.lng*Math.PI/180,f.lat*Math.PI/180)}function Yn(f,e){return f/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Tc(f){const e=Math.asin(f[1])/Math.PI*180,n=Math.sqrt(f[0]*f[0]+f[2]*f[2]);if(n>1e-6){const l=f[0]/n,u=Math.acos(f[2]/n),m=(l>0?u:-u)/Math.PI*180;return new d.Q(d.aK(m,-180,180),e)}return new d.Q(0,e)}function Fa(f){return Math.cos(f*Math.PI/180)}function ln(f,e){const n=Fa(f),l=Fa(e);return d.aa(l/n)}function Al(f,e){const n=f.rotate(e.bearingInRadians),l=e.zoom+ln(e.center.lat,0),u=d.bb(1/Fa(e.center.lat),1/Fa(Math.min(Math.abs(e.center.lat),60)),d.be(l,7,3,0,1)),m=360/Cl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.Q(e.center.lng-n.x*m*u,d.ad(e.center.lat+n.y*m,-85.051129,d.aI))}function Sc(f){const e=.5*f,n=Math.sin(e),l=Math.cos(e);return Math.log(n+l)-Math.log(l-n)}function Js(f,e,n,l){const u=f.lat+n*l;if(Math.abs(n)>1){const m=(Math.sign(f.lat+n)!==Math.sign(f.lat)?-Math.abs(f.lat):Math.abs(f.lat))*Math.PI/180,y=Math.abs(f.lat+n)*Math.PI/180,b=Sc(m+l*(y-m)),T=Sc(m),E=Sc(y);return new d.Q(f.lng+e*((b-T)/(E-T)),u)}return new d.Q(f.lng+e*l,u)}class pd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,n,l,u){const m=`${e.z}_${e.x}_${e.y}`,y=this._cache.get(m);if(y)return y;const b=this._cachePrevious.get(m);if(b)return this._cache.set(m,b),b;const T=this._aabbFactory(e,n,l,u);return this._cache.set(m,T),this._hadAnyChanges=!0,T}}function Mc(f,e,n){const l=f-e;return l<0?-l:Math.max(0,l-n)}function Mu(f,e,n,l,u){const m=f-n;let y;return y=m<0?Math.min(-m,1+m-u):m>1?Math.min(Math.max(m-u,0),1-m):0,Math.max(y,Mc(e,l,u))}class xh{constructor(){this._aabbCache=new pd(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,n,l,u){const m=1<<l.z,y=1/m,b=l.x/m,T=l.y/m;let E=2;return E=Math.min(E,Mu(e,n,b,T,y)),E=Math.min(E,Mu(e,n,b+.5,-T-y,y)),E=Math.min(E,Mu(e,n,b+.5,2-T-y,y)),E}getWrap(e,n,l){const u=1<<n.z,m=1/u,y=n.x/u,b=Mc(e.x,y,m),T=Mc(e.x,y-1,m),E=Mc(e.x,y+1,m),z=Math.min(b,T,E);return z===E?1:z===T?-1:0}allowVariableZoom(e,n){return on(e,n)>4}allowWorldCopies(){return!1}getTileAABB(e,n,l,u){return this._aabbCache.getTileAABB(e,n,l,u)}_computeTileAABB(e,n,l,u){if(e.z<=0)return new Ba([-1,-1,-1],[1,1,1]);if(e.z===1)return new Ba([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const m=[is(0,0,e.x,e.y,e.z),is(d.Z,0,e.x,e.y,e.z),is(d.Z,d.Z,e.x,e.y,e.z),is(0,d.Z,e.x,e.y,e.z)],y=[1,1,1],b=[-1,-1,-1];for(const T of m)for(let E=0;E<3;E++)y[E]=Math.min(y[E],T[E]),b[E]=Math.max(b[E],T[E]);if(e.y===0||e.y===(1<<e.z)-1){const T=[0,e.y===0?1:-1,0];for(let E=0;E<3;E++)y[E]=Math.min(y[E],T[E]),b[E]=Math.max(b[E],T[E])}return new Ba(y,b)}}}class Ec{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=d.bg(),this._projectionMatrix=d.b0(),this._globeViewProjMatrix32f=d.a$(),this._globeViewProjMatrixNoCorrection=d.b0(),this._globeViewProjMatrixNoCorrectionInverted=d.b0(),this._globeProjMatrixInverted=d.b0(),this._cameraPosition=d.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new xh}clone(){const e=new Ec;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:n,applyGlobeMatrix:l}=e,u=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:u,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,l=this.cameraToCenterDistance/e,u=Math.sin(n)*l,m=Math.cos(n)*l+1,y=1/Math.sqrt(u*u+m*m)*1;let b=-u,T=m;const E=Math.sqrt(b*b+T*T);b/=E,T/=E;const z=[0,b,T];return d.bi(z,z,[0,0,0],-this.bearingInRadians),d.bj(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bk(z,z,[0,0,0],this.center.lng*Math.PI/180),d.aN(z,z,.25),[...z,.25*-y]}isLocationOccluded(e){return!this.isSurfacePointVisible(An(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,u=Math.cos(l),m=[Math.sin(n)*u,Math.sin(l),Math.cos(n)*u],y=[m[2],0,-m[0]],b=[0,0,0];d.aT(b,y,m),d.aS(y,y),d.aS(b,b);const T=[0,0,0];return d.aS(T,[y[0]*e[0]+b[0]*e[1]+m[0]*e[2],y[1]*e[0]+b[1]*e[1]+m[1]*e[2],y[2]*e[0]+b[2]*e[1]+m[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,l){const u=function(b,T,E){const z=1/(1<<E.z);return new d.$(b/d.Z*z+E.x*z,T/d.Z*z+E.y*z)}(e,n,l.canonical),m=(y=u.y,[d.bf(u.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,n,l,u){const m=l.canonical,y=is(e,n,m.x,m.y,m.z),b=1+(u?u(e,n):0)/d.bq,T=[y[0]*b,y[1]*b,y[2]*b,1];d.ao(T,T,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,z=E[0]*y[0]+E[1]*y[1]+E[2]*y[2]+E[3]<0;return{point:new d.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Yn(this.worldSize,this.center.lat),n=d.b1(),l=d.b1();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.aX(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const u=this.centerOffset;n[8]=2*-u.x/this._helper._width,n[9]=2*u.y/this._helper._height,this._projectionMatrix=d.aY(n),this._globeProjMatrixInverted=d.b1(),d.ai(this._globeProjMatrixInverted,n),d.L(n,n,[0,0,-this.cameraToCenterDistance]),d.aZ(n,n,this.rollInRadians),d.a_(n,n,-this.pitchInRadians),d.aZ(n,n,this.bearingInRadians),d.L(n,n,[0,0,-e]);const m=d.bh();m[0]=e,m[1]=e,m[2]=e,d.a_(l,n,this.center.lat*Math.PI/180),d.bl(l,l,-this.center.lng*Math.PI/180),d.M(l,l,m),this._globeViewProjMatrixNoCorrection=l,d.a_(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bl(n,n,-this.center.lng*Math.PI/180),d.M(n,n,m),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=d.b1(),d.ai(this._globeViewProjMatrixNoCorrectionInverted,l);const y=d.bh();this._cameraPosition=d.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bi(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),d.bj(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),d.bi(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),d.aO(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bj(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),d.bk(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=d.aY(this._globeViewProjMatrixNoCorrectionInverted);d.M(b,b,[1,1,-1]),this._cachedFrustum=Oa.fromInvProjectionMatrix(b)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const n=d.b1();return d.as(n),n}getVisibleUnwrappedCoordinates(e){return[new d.aV(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=An(e);d.aN(l,l,1+n/d.bq);const u=d.bg();return d.ao(u,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),u[2]/u[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,l=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,n),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,n)],u=[];for(const D of l)u.push(this.unprojectScreenPoint(D));let m=0,y=0,b=0,T=0;const E=this.center;for(const D of u){const I=d.bm(E.lng,D.lng),j=d.bm(E.lat,D.lat);I<y&&(y=I),I>m&&(m=I),j<T&&(T=j),j>b&&(b=j)}const z=[E.lng+y,E.lat+T,E.lng+m,E.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new Li(z)}getConstrained(e,n){const l=d.ad(e.lat,-85.051129,d.aI),u=d.ad(+n,this.minZoom+ln(0,l),this.maxZoom);return{center:new d.Q(e.lng,l),zoom:u}}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}setLocationAtPoint(e,n){const l=An(this.unprojectScreenPoint(n)),u=An(e),m=d.bh();d.bn(m);const y=d.bh();d.bk(y,l,m,-this.center.lng*Math.PI/180),d.bj(y,y,m,this.center.lat*Math.PI/180);const b=u[0]*u[0]+u[2]*u[2],T=y[0]*y[0];if(b<T)return;const E=Math.sqrt(b-T),z=-E,D=d.bo(u[0],u[2],y[0],E),I=d.bo(u[0],u[2],y[0],z),j=d.bh();d.bk(j,u,m,-D);const N=d.bo(j[1],j[2],y[1],y[2]),X=d.bh();d.bk(X,u,m,-I);const $=d.bo(X[1],X[2],y[1],y[2]),Y=.5*Math.PI,W=N>=-Y&&N<=Y,ie=$>=-Y&&$<=Y;let ne,ae;if(W&&ie){const we=this.center.lng*Math.PI/180,De=this.center.lat*Math.PI/180;d.br(D,we)+d.br(N,De)<d.br(I,we)+d.br($,De)?(ne=D,ae=N):(ne=I,ae=$)}else if(W)ne=D,ae=N;else{if(!ie)return;ne=I,ae=$}const le=ne/Math.PI*180,se=ae/Math.PI*180,ye=this.center.lat;this.setCenter(new d.Q(le,d.ad(se,-90,90))),this.setZoom(this.zoom+ln(ye,this.center.lat))}locationToScreenPoint(e,n){const l=An(e);if(n){const u=n.getElevationForLngLatZoom(e,this._helper._tileZoom);d.aN(l,l,1+u/d.bq)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const n=d.bg();return d.ao(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new d.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l)return l}return d.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,n){const l=this._cameraPosition,u=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,u)}getRayDirectionFromPixel(e){const n=d.bg();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,d.ao(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=d.bh();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const u=d.bh();return d.aS(u,l),u}isSurfacePointVisible(e){const n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=d.bg();return d.ao(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const l=d.aU(e,n),u=d.bh(),m=d.bh();d.aN(m,n,l),d.aR(u,e,m);const y=1-d.aU(u,u);if(y<0)return null;const b=d.aU(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),E=b/T,z=T;return{tMin:Math.min(E,z),tMax:Math.max(E,z)}}unprojectScreenPoint(e){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(e),u=this.rayPlanetIntersection(n,l);if(u){const E=d.bh();d.aO(E,n,[l[0]*u.tMin,l[1]*u.tMin,l[2]*u.tMin]);const z=d.bh();return d.aS(z,E),Tc(z)}const m=this._cachedClippingPlane[0]*l[0]+this._cachedClippingPlane[1]*l[1]+this._cachedClippingPlane[2]*l[2],y=-d.bp(this._cachedClippingPlane,n)/m,b=d.bh();if(y>0)d.aO(b,n,[l[0]*y,l[1]*y,l[2]*y]);else{const E=d.bh();d.aO(E,n,[2*l[0],2*l[1],2*l[2]]);const z=d.bp(this._cachedClippingPlane,E);d.aR(b,E,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const T=d.bh();return d.aS(T,b),Tc(T)}getMatrixForModel(e,n){const l=d.Q.convert(e),u=1/d.bq,m=d.b0();return d.bl(m,m,l.lng/180*Math.PI),d.a_(m,m,-l.lat/180*Math.PI),d.L(m,m,[0,0,1+n/d.bq]),d.a_(m,m,.5*Math.PI),d.M(m,m,[u,u,u]),m}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new d.Y(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class Cc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new $n,this._verticalPerspectiveTransform=new Ec}clone(){const e=new Cc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const n=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bb(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bb(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,l){const u=this._mercatorTransform.getPitchedTextCorrection(e,n,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,l);return d.bb(u,m,this._globeness)}projectTileCoordinates(e,n,l,u){return this.currentTransform.projectTileCoordinates(e,n,l,u)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class wa{get useGlobeControls(){return!0}handlePanInertia(e,n){const l=Al(e,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const l=e.around,u=n.screenPointToLocation(l);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const m=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const y=n.zoom-m;if(y===0)return;const b=d.bm(n.center.lng,u.lng),T=b/(Math.abs(b/180)+1),E=d.bm(n.center.lat,u.lat),z=n.getRayDirectionFromPixel(l),D=n.cameraPosition,I=-1*d.aU(D,z),j=d.bh();d.aO(j,D,[z[0]*I,z[1]*I,z[2]*I]);const N=d.bs(j)-1,X=Math.exp(.5*-Math.max(N-.3,0)),$=Yn(n.worldSize,n.center.lat)/Math.min(n.width,n.height),Y=d.be($,.9,.5,1,.25),W=(1-d.aH(-y))*Math.min(X,Y),ie=n.center.lat,ne=n.zoom,ae=new d.Q(n.center.lng+T*W,d.ad(n.center.lat+E*W,-85.051129,d.aI));n.setLocationAtPoint(u,l);const le=n.center,se=d.be(Math.abs(b),45,85,0,1),ye=d.be($,.75,.35,0,1),we=Math.pow(Math.max(se,ye),.25),De=d.bm(le.lng,ae.lng),Ie=d.bm(le.lat,ae.lat);n.setCenter(new d.Q(le.lng+De*we,le.lat+Ie*we).wrap()),n.setZoom(ne+ln(ie,n.center.lat))}handleMapControlsPan(e,n,l){if(!e.panDelta)return;const u=n.center.lat,m=n.zoom;n.setCenter(Al(e.panDelta,n).wrap()),n.setZoom(m+ln(u,n.center.lat))}cameraForBoxAndBearing(e,n,l,u,m){const y=wc(e,n,l,u,m),b=n.left/m.width*2-1,T=(m.width-n.right)/m.width*2-1,E=n.top/m.height*-2+1,z=(m.height-n.bottom)/m.height*-2+1,D=d.bm(l.getWest(),l.getEast())<0,I=D?l.getEast():l.getWest(),j=D?l.getWest():l.getEast(),N=Math.max(l.getNorth(),l.getSouth()),X=Math.min(l.getNorth(),l.getSouth()),$=I+.5*d.bm(I,j),Y=N+.5*d.bm(N,X),W=m.clone();W.setCenter(y.center),W.setBearing(y.bearing),W.setPitch(0),W.setRoll(0),W.setZoom(y.zoom);const ie=W.modelViewProjectionMatrix,ne=[An(l.getNorthWest()),An(l.getNorthEast()),An(l.getSouthWest()),An(l.getSouthEast()),An(new d.Q(j,Y)),An(new d.Q(I,Y)),An(new d.Q($,N)),An(new d.Q($,X))],ae=An(y.center);let le=Number.POSITIVE_INFINITY;for(const se of ne)b<0&&(le=wa.getLesserNonNegativeNonNull(le,wa.solveVectorScale(se,ae,ie,"x",b))),T>0&&(le=wa.getLesserNonNegativeNonNull(le,wa.solveVectorScale(se,ae,ie,"x",T))),E>0&&(le=wa.getLesserNonNegativeNonNull(le,wa.solveVectorScale(se,ae,ie,"y",E))),z<0&&(le=wa.getLesserNonNegativeNonNull(le,wa.solveVectorScale(se,ae,ie,"y",z)));if(Number.isFinite(le)&&le!==0)return y.zoom=W.zoom+d.aa(le),y;ko()}handleJumpToCenterZoom(e,n){const l=e.center.lat,u=e.getConstrained(n.center?d.Q.convert(n.center):e.center,e.zoom).center;e.setCenter(u.wrap());const m=n.zoom!==void 0?+n.zoom:e.zoom+ln(l,u.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,n){const l=e.zoom,u=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},T=n.zoom!==void 0,E=!e.isPaddingEqual(n.padding);let z=!1;const D=n.center?d.Q.convert(n.center):u,I=e.getConstrained(D,l).center;ha(e,I);const j=e.clone();j.setCenter(I),j.setZoom(T?+n.zoom:l+ln(u.lat,D.lat)),j.setBearing(n.bearing);const N=new d.P(d.ad(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),d.ad(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));j.setLocationAtPoint(I,N);const X=(n.offset&&n.offsetAsPoint.mag())>0?j.center:I,$=T?+n.zoom:l+ln(u.lat,X.lat),Y=l+ln(u.lat,0),W=$+ln(X.lat,0),ie=d.bm(u.lng,X.lng),ne=d.bm(u.lat,X.lat),ae=d.aH(W-Y);return z=$!==l,{easeFunc:le=>{if(d.b5(y,b)||ba({startEulerAngles:y,endEulerAngles:b,tr:e,k:le,useSlerp:y.roll!=b.roll}),E&&e.interpolatePadding(m,n.padding,le),n.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const se=W>Y?Math.min(2,ae):Math.max(.5,ae),ye=Math.pow(se,1-le),we=Js(u,ie,ne,le*ye);e.setCenter(we.wrap())}if(z){const se=d.B.number(Y,W,le)+ln(0,e.center.lat);e.setZoom(se)}},isZooming:z,elevationCenter:X}}handleFlyTo(e,n){const l=n.zoom!==void 0,u=e.center,m=e.zoom,y=e.padding,b=!e.isPaddingEqual(n.padding),T=e.getConstrained(d.Q.convert(n.center||n.locationAtOffset),m).center,E=l?+n.zoom:e.zoom+ln(e.center.lat,T.lat),z=e.clone();z.setCenter(T),z.setZoom(E),z.setBearing(n.bearing);const D=new d.P(d.ad(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),d.ad(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(T,D);const I=z.center;ha(e,I);const j=function(ne,ae,le){const se=An(ae),ye=An(le),we=d.aU(se,ye),De=Math.acos(we),Ie=Cl(ne);return De/(2*Math.PI)*Ie}(e,u,I),N=m+ln(u.lat,0),X=E+ln(I.lat,0),$=d.aH(X-N);let Y;if(typeof n.minZoom=="number"){const ne=+n.minZoom+ln(I.lat,0),ae=Math.min(ne,N,X)+ln(0,I.lat),le=e.getConstrained(I,ae).zoom+ln(I.lat,0);Y=d.aH(le-N)}const W=d.bm(u.lng,I.lng),ie=d.bm(u.lat,I.lat);return{easeFunc:(ne,ae,le,se)=>{const ye=Js(u,W,ie,le);b&&e.interpolatePadding(y,n.padding,ne);const we=ne===1?I:ye;e.setCenter(we.wrap());const De=N+d.aa(ae);e.setZoom(ne===1?E:De+ln(0,we.lat))},scaleOfZoom:$,targetCenter:I,scaleOfMinZoom:Y,pixelPathLength:j}}static solveVectorScale(e,n,l,u,m){const y=u==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],E=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],z=n[0]*y[0]+n[1]*y[1]+n[2]*y[2],D=n[0]*b[0]+n[1]*b[1]+n[2]*b[2];return z+m*E===T+m*D||b[3]*(T-z)+y[3]*(D-E)+T*D==z*E?null:(z+y[3]-m*D-m*b[3])/(z-T-m*D+m*E)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class Ac{constructor(e){this._globe=e,this._mercatorCameraHelper=new da,this._verticalPerspectiveCameraHelper=new wa}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,l){this.currentHelper.handleMapControlsPan(e,n,l)}cameraForBoxAndBearing(e,n,l,u,m){return this.currentHelper.cameraForBoxAndBearing(e,n,l,u,m)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}const ns=(f,e)=>d.x(f,e&&e.filter(n=>n.identifier!=="source.canvas")),Eu=d.bt();class zl extends d.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new sn(kt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new ti,this.imageManager.setEventedParent(this),this.glyphManager=new ki(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ue(256,512),this.crossTileSymbolIndex=new vc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.bu,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.bv()),Qa().on(Do,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const m=u.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===m.id&&this._validateLayer(b)}})}loadURL(e,n={},l){this.fire(new d.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;d.j(u,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new d.k(y))})}loadJSON(e,n={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ut.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(Eu,{validate:!1})}_load(e,n,l){var u,m;const y=n.transformStyle?n.transformStyle(l,e):e;if(!n.validate||!ns(this,d.y(y))){this._loaded=!0,this.stylesheet=y;for(const b in y.sources)this.addSource(b,y.sources[b],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Pt(this.stylesheet.light),this._setProjectionInternal(((u=this.stylesheet.projection)===null||u===void 0?void 0:u.type)||"mercator"),this.sky=new si(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){const e=d.bw(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const l=d.bx(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(e,n=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,b,T){return d._(this,void 0,void 0,function*(){const E=Xt(m),z=b>1?"@2x":"",D={},I={};for(const{id:j,url:N}of E){const X=y.transformRequest(ri(N,z,".json"),"SpriteJSON");D[j]=d.j(X,T);const $=y.transformRequest(ri(N,z,".png"),"SpriteImage");I[j]=Ki.getImage($,T)}return yield Promise.all([...Object.values(D),...Object.values(I)]),function(j,N){return d._(this,void 0,void 0,function*(){const X={};for(const $ in j){X[$]={};const Y=ut.getImageCanvasContext((yield N[$]).data),W=(yield j[$]).data;for(const ie in W){const{width:ne,height:ae,x:le,y:se,sdf:ye,pixelRatio:we,stretchX:De,stretchY:Ie,content:ze,textFitWidth:Ye,textFitHeight:$e}=W[ie];X[$][ie]={data:null,pixelRatio:we,sdf:ye,stretchX:De,stretchY:Ie,content:ze,textFitWidth:Ye,textFitHeight:$e,spriteData:{width:ne,height:ae,x:le,y:se,context:Y}}}}return X})}(D,I)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in m)):[];for(const T of b)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in m[y]){const E=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,m[y][T],!1):this.imageManager.addImage(E,m[y][T]),n&&(this._changedImages[E]=!0)}}}).catch(m=>{this._spriteRequest=null,u=m,this.fire(new d.k(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const l=e.sourceLayer;if(!l)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?d.by(l):l);const u=[];for(const m of e)if(l[m]){const y=n?d.by(l[m]):l[m];u.push(y)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){var e,n,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const u=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(u.length||m.length)&&this._updateWorkerLayers(u,m);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const m=this.sourceCaches[u];l[u]=m.used,m.used=!1}for(const u of this._order){const m=this._layers[u];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const u in l){const m=this.sourceCaches[u];!!l[u]!=!!m.used&&m.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var l;this._checkLoaded();const u=this.serialize();if(e=n.transformStyle?n.transformStyle(u,e):e,((l=n.validate)===null||l===void 0||l)&&ns(this,d.y(e)))return!1;(e=d.by(e)).layers=d.bw(e.layers);const m=d.bz(u,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":n.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":n.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,u.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setSky":n.push(()=>this.setSky.apply(this,u.args));break;case"setProjection":this.setProjection.apply(this,u.args);break;case"setTransition":n.push(()=>{});break;default:l.push(u.command)}return{operations:n,unimplemented:l}}addImage(e,n){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(d.y.source,`sources.${e}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[e]=new P(e,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.k(new Error(`Layer "${u}" already exists on this map.`)));let m;if(e.type==="custom"){if(ns(this,d.bA(e)))return;m=d.bx(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.by(e),e=d.e(e,{source:u})),this._validate(d.y.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;m=d.bx(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:u}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new d.k(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,u),this._layerOrderChanged=!0,this._layers[u]=m,this._removedLayers[u]&&m.source&&m.type!=="custom"){const b=this._removedLayers[u];delete this._removedLayers[u],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===n&&u.maxzoom===l||(n!=null&&(u.minzoom=n),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.bB(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.y.filter,`layers.${u.id}.filter`,n,null,l)||(u.filter=d.by(n),this._updateLayer(u)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.by(this.getLayer(e).filter)}setLayoutProperty(e,n,l,u={}){this._checkLoaded();const m=this.getLayer(e);m?d.bB(m.getLayoutProperty(n),l)||(m.setLayoutProperty(n,l,u),this._updateLayer(m)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const l=this.getLayer(e);if(l)return l.getLayoutProperty(n);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,l,u={}){this._checkLoaded();const m=this.getLayer(e);m?d.bB(m.getPaintProperty(n),l)||(m.setPaintProperty(n,l,u)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const l=e.source,u=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&u?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||u?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(u,e.id,n)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=u.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(y,e.id,n):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,l=e.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bC(this.sourceCaches,m=>m.serialize()),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.bD({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,projection:u.projection,sources:e,layers:n,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",l={},u=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b)){l[b]=y;for(const T of e){const E=T[b];if(E)for(const z of E)u.push(z)}}}u.sort((y,b)=>b.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b))for(let T=u.length-1;T>=0;T--){const E=u[T].feature;if(l[E.layer.id]<y)break;m.push(E),u.pop()}else for(const T of e){const E=T[b];if(E)for(const z of E)m.push(z.feature)}}return m}queryRenderedFeatures(e,n,l){n&&n.filter&&this._validate(d.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of n.layers){const z=this._layers[E];if(!z)return this.fire(new d.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];u[z.source]=!0}}const m=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers(),b=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,T=Object.assign(Object.assign({},n),{layers:b});for(const E in this.sourceCaches)n.layers&&!u[E]||m.push(_i(this.sourceCaches[E],this._layers,y,e,T,l));return this.placement&&m.push(function(E,z,D,I,j,N,X){const $={},Y=N.queryRenderedSymbols(I),W=[];for(const ie of Object.keys(Y).map(Number))W.push(X[ie]);W.sort(Ci);for(const ie of W){const ne=ie.featureIndex.lookupSymbolFeatures(Y[ie.bucketInstanceId],z,ie.bucketIndex,ie.sourceLayerIndex,j.filter,j.layers,j.availableImages,E);for(const ae in ne){const le=$[ae]=$[ae]||[],se=ne[ae];se.sort((ye,we)=>{const De=ie.featureSortOrder;if(De){const Ie=De.indexOf(ye.featureIndex);return De.indexOf(we.featureIndex)-Ie}return we.featureIndex-ye.featureIndex});for(const ye of se)le.push(ye)}}return function(ie,ne,ae){for(const le in ie)for(const se of ie[le])Vi(se,ae[ne[le].source]);return ie}($,E,D)}(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,n){n&&n.filter&&this._validate(d.y.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[e];return l?function(u,m){const y=u.getRenderableIds().map(E=>u.getTileByID(E)),b=[],T={};for(let E=0;E<y.length;E++){const z=y[E],D=z.tileID.canonical.key;T[D]||(T[D]=!0,z.querySourceFeatures(b,m))}return b}(l,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const y in e)if(!d.bB(e[y],l[y])){u=!0;break}if(!u)return;const m={now:ut.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const y in e)if(!d.bB(e[y],l[y])){u=!0;break}if(!u)return;const m={now:ut.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(m)}_setProjectionInternal(e){const n=function(l){if(Array.isArray(l)){const u=new Bo({type:l});return{projection:u,transform:new Cc,cameraHelper:new Ac(u)}}switch(l){case"mercator":return{projection:new xc,transform:new $n,cameraHelper:new da};case"globe":{const u=new Bo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:u,transform:new Cc,cameraHelper:new Ac(u)}}case"vertical-perspective":return{projection:new Or,transform:new Ec,cameraHelper:new wa};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new xc,transform:new $n,cameraHelper:new da}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,n,l,u,m={}){return(!m||m.validate!==!1)&&ns(this,e.call(d.y,d.e({key:n,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Qa().off(Do,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,l,u,m=!1){let y=!1,b=!1;const T={};for(const E of this._order){const z=this._layers[E];if(z.type!=="symbol")continue;if(!T[z.source]){const I=this.sourceCaches[z.source];T[z.source]=I.getRenderableIds(!0).map(j=>I.getTileByID(j)).sort((j,N)=>N.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(N.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(z,T[z.source],e.center.lng);y=y||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ut.now(),e.zoom))&&(this.pauseablePlacement=new mr(e,this.map.terrain,this._order,m,n,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ut.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const E of this._order){const z=this._layers[E];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ut.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];return u&&u.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(e,n){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),u=this.sourceCaches[n.source];return u&&u.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(d.y.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,l={},u){this._checkLoaded();const m=[{id:e,url:n}],y=[...Xt(this.stylesheet.sprite),...m];this._validate(d.y.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,u))}removeSprite(e){this._checkLoaded();const n=Xt(this.stylesheet.sprite);if(n.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Xt(this.stylesheet.sprite)}setSprite(e,n={},l){this._checkLoaded(),e&&this._validate(d.y.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Fr=d.aC([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class bh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,l,u,m,y,b,T,E){this.context=e;let z=this.boundPaintVertexBuffers.length!==u.length;for(let D=0;!z&&D<u.length;D++)this.boundPaintVertexBuffers[D]!==u[D]&&(z=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(n,l,u,m,y,b,T,E):(e.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,n,l,u,m,y,b,T){const E=e.numAttributes,z=this.context,D=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=T,n.enableAttributes(D,e);for(const I of l)I.enableAttributes(D,e);y&&y.enableAttributes(D,e),b&&b.enableAttributes(D,e),T&&T.enableAttributes(D,e),n.bind(),n.setVertexAttribPointers(D,e,m);for(const I of l)I.bind(),I.setVertexAttribPointers(D,e,m);y&&(y.bind(),y.setVertexAttribPointers(D,e,m)),u&&u.bind(),b&&(b.bind(),b.setVertexAttribPointers(D,e,m)),T&&(T.bind(),T.setVertexAttribPointers(D,e,m)),z.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Cu=(f,e,n,l,u)=>({u_texture:0,u_ele_delta:f,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):d.b6.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):d.b6.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:u?1:0}),Pl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ws(f){const e=[];for(let n=0;n<f.length;n++){if(f[n]===null)continue;const l=f[n].split(" ");e.push(l.pop())}return e}class md{constructor(e,n,l,u,m,y,b,T){const E=e.gl;this.program=E.createProgram();const z=ws(n.staticAttributes),D=l?l.getBinderAttributes():[],I=z.concat(D),j=_r.prelude.staticUniforms?ws(_r.prelude.staticUniforms):[],N=b.staticUniforms?ws(b.staticUniforms):[],X=n.staticUniforms?ws(n.staticUniforms):[],$=l?l.getBinderUniforms():[],Y=j.concat(N).concat(X).concat($),W=[];for(const we of Y)W.indexOf(we)<0&&W.push(we);const ie=l?l.defines():[];fa(E)&&ie.unshift("#version 300 es"),m&&ie.push("#define OVERDRAW_INSPECTOR;"),y&&ie.push("#define TERRAIN3D;"),T&&ie.push(T);let ne=ie.concat(_r.prelude.fragmentSource,b.fragmentSource,n.fragmentSource).join(`
`),ae=ie.concat(_r.prelude.vertexSource,b.vertexSource,n.vertexSource).join(`
`);fa(E)||(ne=function(we){return we.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ne),ae=function(we){return we.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ae));const le=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(le,ne),E.compileShader(le),!E.getShaderParameter(le,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(le)}`);E.attachShader(this.program,le);const se=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(se,ae),E.compileShader(se),!E.getShaderParameter(se,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(se)}`);E.attachShader(this.program,se),this.attributes={};const ye={};this.numAttributes=I.length;for(let we=0;we<this.numAttributes;we++)I[we]&&(E.bindAttribLocation(this.program,we,I[we]),this.attributes[I[we]]=we);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(se),E.deleteShader(le);for(let we=0;we<W.length;we++){const De=W[we];if(De&&!ye[De]){const Ie=E.getUniformLocation(this.program,De);Ie&&(ye[De]=Ie)}}this.fixedUniforms=u(e,ye),this.terrainUniforms=((we,De)=>({u_depth:new d.bE(we,De.u_depth),u_terrain:new d.bE(we,De.u_terrain),u_terrain_dim:new d.b7(we,De.u_terrain_dim),u_terrain_matrix:new d.bG(we,De.u_terrain_matrix),u_terrain_unpack:new d.bH(we,De.u_terrain_unpack),u_terrain_exaggeration:new d.b7(we,De.u_terrain_exaggeration)}))(e,ye),this.projectionUniforms=((we,De)=>({u_projection_matrix:new d.bG(we,De.u_projection_matrix),u_projection_tile_mercator_coords:new d.bH(we,De.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.bH(we,De.u_projection_clipping_plane),u_projection_transition:new d.b7(we,De.u_projection_transition),u_projection_fallback_matrix:new d.bG(we,De.u_projection_fallback_matrix)}))(e,ye),this.binderUniforms=l?l.getUniforms(e,ye):[]}draw(e,n,l,u,m,y,b,T,E,z,D,I,j,N,X,$,Y,W,ie){const ne=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(m),e.setCullFace(y),T){e.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,T.depthTexture),e.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,T.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(T[le])}if(E)for(const le in E)this.projectionUniforms[Pl[le]].set(E[le]);if(b)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(b[le]);$&&$.setUniforms(e,this.binderUniforms,N,{zoom:X});let ae=0;switch(n){case ne.LINES:ae=2;break;case ne.TRIANGLES:ae=3;break;case ne.LINE_STRIP:ae=1}for(const le of j.get()){const se=le.vaos||(le.vaos={});(se[z]||(se[z]=new bh)).bind(e,this,D,$?$.getPaintVertexBuffers():[],I,le.vertexOffset,Y,W,ie),ne.drawElements(n,le.primitiveLength*ae,ne.UNSIGNED_SHORT,le.primitiveOffset*ae*2)}}}function Dl(f,e,n){const l=1/d.av(n,1,e.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,e.transform.tileZoom)/u,y=m*(n.tileID.canonical.x+n.tileID.wrap*u),b=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const wh=(f,e,n,l)=>{const u=f.style.light,m=u.properties.get("position"),y=[m.x,m.y,m.z],b=d.bK();u.properties.get("anchor")==="viewport"&&d.bL(b,f.transform.bearingInRadians),d.bM(y,y,b);const T=f.transform.transformLightDirection(y),E=u.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:l}},Oo=(f,e,n,l,u,m,y)=>d.e(wh(f,e,n,l),Dl(m,f,y),{u_height_factor:-Math.pow(2,u.overscaledZ)/y.tileSize/8}),Th=(f,e,n,l)=>d.e(Dl(e,f,n),{u_fill_translate:l}),Sh=(f,e)=>({u_world:f,u_fill_translate:e}),Au=(f,e,n,l,u)=>d.e(Th(f,e,n,u),{u_world:l}),Fo=(f,e,n,l,u)=>{const m=f.transform;let y,b,T=0;if(n.paint.get("circle-pitch-alignment")==="map"){const E=d.av(e,1,m.zoom);y=!0,b=[E,E],T=E/(d.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*u}else y=!1,b=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:T,u_translate:l}},zu=f=>({u_pixel_extrude_scale:[1/f.width,1/f.height]}),Pu=f=>({u_viewport_size:[f.width,f.height]}),zc=(f,e=1)=>({u_color:f,u_overlay:0,u_overlay_scale:e}),Pc=(f,e,n,l)=>{const u=d.av(f,1,e)/(d.Z*Math.pow(2,f.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.av(f,1,e),u_intensity:n,u_globe_extrude_scale:u}},Dc=(f,e,n,l)=>{const u=d.K();d.bN(u,0,f.width,f.height,0,0,1);const m=f.context.gl;return{u_matrix:u,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Ts=(f,e,n)=>{const l=n.paint.get("hillshade-shadow-color"),u=n.paint.get("hillshade-highlight-color"),m=n.paint.get("hillshade-accent-color");let y=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);return n.paint.get("hillshade-illumination-anchor")==="viewport"&&(y+=f.transform.bearingInRadians),{u_image:0,u_latrange:Mh(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),y],u_shadow:l,u_highlight:u,u_accent:m}},eo=(f,e)=>{const n=e.stride,l=d.K();return d.bN(l,0,d.Z,-8192,0,0,1),d.L(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:f.overscaledZ,u_unpack:e.getUnpackVector()}};function Mh(f,e){const n=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.$(0,l/n).toLngLat().lat,new d.$(0,(l+1)/n).toLngLat().lat]}const to=(f,e,n,l)=>{const u=f.transform;return{u_translation:io(f,e,n),u_ratio:l/d.av(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},_d=(f,e,n,l,u)=>d.e(to(f,e,n,l),{u_image:0,u_image_height:u}),Il=(f,e,n,l,u)=>{const m=f.transform,y=jo(e,m);return{u_translation:io(f,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:l/d.av(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[y,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Eh=(f,e,n,l,u,m)=>{const y=f.lineAtlas,b=jo(e,f.transform),T=n.layout.get("line-cap")==="round",E=y.getDash(u.from,T),z=y.getDash(u.to,T),D=E.width*m.fromScale,I=z.width*m.toScale;return d.e(to(f,e,n,l),{u_patternscale_a:[b/D,-E.height/2],u_patternscale_b:[b/I,-z.height/2],u_sdfgamma:y.width/(256*Math.min(D,I)*f.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:z.y,u_mix:m.t})};function jo(f,e){return 1/d.av(f,1,e.tileZoom)}function io(f,e,n){return d.aw(f.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ch=(f,e,n,l,u)=>{return{u_tl_parent:f,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:Rl(l.paint.get("raster-hue-rotate")),u_coords_top:[u[0].x,u[0].y,u[1].x,u[1].y],u_coords_bottom:[u[3].x,u[3].y,u[2].x,u[2].y]};var m,y};function Rl(f){f*=Math.PI/180;const e=Math.sin(f),n=Math.cos(f);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const kl=(f,e,n,l,u,m,y,b,T,E,z,D,I)=>{const j=y.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:j.width/j.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:m,u_texsize:D,u_texture:0,u_translation:E,u_pitched_scale:I}},Ic=(f,e,n,l,u,m,y,b,T,E,z,D,I,j)=>{const N=y.transform;return d.e(kl(f,e,n,l,u,m,y,b,T,E,z,D,j),{u_gamma_scale:l?Math.cos(N.pitch*Math.PI/180)*N.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},No=(f,e,n,l,u,m,y,b,T,E,z,D,I)=>d.e(Ic(f,e,n,l,u,m,y,b,T,E,!0,z,0,I),{u_texsize_icon:D,u_texture_icon:1}),yr=(f,e)=>({u_opacity:f,u_color:e}),Rc=(f,e,n,l,u)=>d.e(function(m,y,b,T){const E=b.imageManager.getPattern(m.from.toString()),z=b.imageManager.getPattern(m.to.toString()),{width:D,height:I}=b.imageManager.getPixelSize(),j=Math.pow(2,T.tileID.overscaledZ),N=T.tileSize*Math.pow(2,b.transform.tileZoom)/j,X=N*(T.tileID.canonical.x+T.tileID.wrap*j),$=N*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[D,I],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/d.av(T,1,b.transform.tileZoom),u_pixel_coord_upper:[X>>16,$>>16],u_pixel_coord_lower:[65535&X,65535&$]}}(n,u,e,l),{u_opacity:f}),Ll=(f,e)=>{},kc={fillExtrusion:(f,e)=>({u_lightpos:new d.bI(f,e.u_lightpos),u_lightpos_globe:new d.bI(f,e.u_lightpos_globe),u_lightintensity:new d.b7(f,e.u_lightintensity),u_lightcolor:new d.bI(f,e.u_lightcolor),u_vertical_gradient:new d.b7(f,e.u_vertical_gradient),u_opacity:new d.b7(f,e.u_opacity),u_fill_translate:new d.bJ(f,e.u_fill_translate)}),fillExtrusionPattern:(f,e)=>({u_lightpos:new d.bI(f,e.u_lightpos),u_lightpos_globe:new d.bI(f,e.u_lightpos_globe),u_lightintensity:new d.b7(f,e.u_lightintensity),u_lightcolor:new d.bI(f,e.u_lightcolor),u_vertical_gradient:new d.b7(f,e.u_vertical_gradient),u_height_factor:new d.b7(f,e.u_height_factor),u_opacity:new d.b7(f,e.u_opacity),u_fill_translate:new d.bJ(f,e.u_fill_translate),u_image:new d.bE(f,e.u_image),u_texsize:new d.bJ(f,e.u_texsize),u_pixel_coord_upper:new d.bJ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bJ(f,e.u_pixel_coord_lower),u_scale:new d.bI(f,e.u_scale),u_fade:new d.b7(f,e.u_fade)}),fill:(f,e)=>({u_fill_translate:new d.bJ(f,e.u_fill_translate)}),fillPattern:(f,e)=>({u_image:new d.bE(f,e.u_image),u_texsize:new d.bJ(f,e.u_texsize),u_pixel_coord_upper:new d.bJ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bJ(f,e.u_pixel_coord_lower),u_scale:new d.bI(f,e.u_scale),u_fade:new d.b7(f,e.u_fade),u_fill_translate:new d.bJ(f,e.u_fill_translate)}),fillOutline:(f,e)=>({u_world:new d.bJ(f,e.u_world),u_fill_translate:new d.bJ(f,e.u_fill_translate)}),fillOutlinePattern:(f,e)=>({u_world:new d.bJ(f,e.u_world),u_image:new d.bE(f,e.u_image),u_texsize:new d.bJ(f,e.u_texsize),u_pixel_coord_upper:new d.bJ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bJ(f,e.u_pixel_coord_lower),u_scale:new d.bI(f,e.u_scale),u_fade:new d.b7(f,e.u_fade),u_fill_translate:new d.bJ(f,e.u_fill_translate)}),circle:(f,e)=>({u_camera_to_center_distance:new d.b7(f,e.u_camera_to_center_distance),u_scale_with_map:new d.bE(f,e.u_scale_with_map),u_pitch_with_map:new d.bE(f,e.u_pitch_with_map),u_extrude_scale:new d.bJ(f,e.u_extrude_scale),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.b7(f,e.u_globe_extrude_scale),u_translate:new d.bJ(f,e.u_translate)}),collisionBox:(f,e)=>({u_pixel_extrude_scale:new d.bJ(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_viewport_size:new d.bJ(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.bF(f,e.u_color),u_overlay:new d.bE(f,e.u_overlay),u_overlay_scale:new d.b7(f,e.u_overlay_scale)}),depth:Ll,clippingMask:Ll,heatmap:(f,e)=>({u_extrude_scale:new d.b7(f,e.u_extrude_scale),u_intensity:new d.b7(f,e.u_intensity),u_globe_extrude_scale:new d.b7(f,e.u_globe_extrude_scale)}),heatmapTexture:(f,e)=>({u_matrix:new d.bG(f,e.u_matrix),u_world:new d.bJ(f,e.u_world),u_image:new d.bE(f,e.u_image),u_color_ramp:new d.bE(f,e.u_color_ramp),u_opacity:new d.b7(f,e.u_opacity)}),hillshade:(f,e)=>({u_image:new d.bE(f,e.u_image),u_latrange:new d.bJ(f,e.u_latrange),u_light:new d.bJ(f,e.u_light),u_shadow:new d.bF(f,e.u_shadow),u_highlight:new d.bF(f,e.u_highlight),u_accent:new d.bF(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.bG(f,e.u_matrix),u_image:new d.bE(f,e.u_image),u_dimension:new d.bJ(f,e.u_dimension),u_zoom:new d.b7(f,e.u_zoom),u_unpack:new d.bH(f,e.u_unpack)}),line:(f,e)=>({u_translation:new d.bJ(f,e.u_translation),u_ratio:new d.b7(f,e.u_ratio),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bJ(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_translation:new d.bJ(f,e.u_translation),u_ratio:new d.b7(f,e.u_ratio),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bJ(f,e.u_units_to_pixels),u_image:new d.bE(f,e.u_image),u_image_height:new d.b7(f,e.u_image_height)}),linePattern:(f,e)=>({u_translation:new d.bJ(f,e.u_translation),u_texsize:new d.bJ(f,e.u_texsize),u_ratio:new d.b7(f,e.u_ratio),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_image:new d.bE(f,e.u_image),u_units_to_pixels:new d.bJ(f,e.u_units_to_pixels),u_scale:new d.bI(f,e.u_scale),u_fade:new d.b7(f,e.u_fade)}),lineSDF:(f,e)=>({u_translation:new d.bJ(f,e.u_translation),u_ratio:new d.b7(f,e.u_ratio),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bJ(f,e.u_units_to_pixels),u_patternscale_a:new d.bJ(f,e.u_patternscale_a),u_patternscale_b:new d.bJ(f,e.u_patternscale_b),u_sdfgamma:new d.b7(f,e.u_sdfgamma),u_image:new d.bE(f,e.u_image),u_tex_y_a:new d.b7(f,e.u_tex_y_a),u_tex_y_b:new d.b7(f,e.u_tex_y_b),u_mix:new d.b7(f,e.u_mix)}),raster:(f,e)=>({u_tl_parent:new d.bJ(f,e.u_tl_parent),u_scale_parent:new d.b7(f,e.u_scale_parent),u_buffer_scale:new d.b7(f,e.u_buffer_scale),u_fade_t:new d.b7(f,e.u_fade_t),u_opacity:new d.b7(f,e.u_opacity),u_image0:new d.bE(f,e.u_image0),u_image1:new d.bE(f,e.u_image1),u_brightness_low:new d.b7(f,e.u_brightness_low),u_brightness_high:new d.b7(f,e.u_brightness_high),u_saturation_factor:new d.b7(f,e.u_saturation_factor),u_contrast_factor:new d.b7(f,e.u_contrast_factor),u_spin_weights:new d.bI(f,e.u_spin_weights),u_coords_top:new d.bH(f,e.u_coords_top),u_coords_bottom:new d.bH(f,e.u_coords_bottom)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.bE(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bE(f,e.u_is_size_feature_constant),u_size_t:new d.b7(f,e.u_size_t),u_size:new d.b7(f,e.u_size),u_camera_to_center_distance:new d.b7(f,e.u_camera_to_center_distance),u_pitch:new d.b7(f,e.u_pitch),u_rotate_symbol:new d.bE(f,e.u_rotate_symbol),u_aspect_ratio:new d.b7(f,e.u_aspect_ratio),u_fade_change:new d.b7(f,e.u_fade_change),u_label_plane_matrix:new d.bG(f,e.u_label_plane_matrix),u_coord_matrix:new d.bG(f,e.u_coord_matrix),u_is_text:new d.bE(f,e.u_is_text),u_pitch_with_map:new d.bE(f,e.u_pitch_with_map),u_is_along_line:new d.bE(f,e.u_is_along_line),u_is_variable_anchor:new d.bE(f,e.u_is_variable_anchor),u_texsize:new d.bJ(f,e.u_texsize),u_texture:new d.bE(f,e.u_texture),u_translation:new d.bJ(f,e.u_translation),u_pitched_scale:new d.b7(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.bE(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bE(f,e.u_is_size_feature_constant),u_size_t:new d.b7(f,e.u_size_t),u_size:new d.b7(f,e.u_size),u_camera_to_center_distance:new d.b7(f,e.u_camera_to_center_distance),u_pitch:new d.b7(f,e.u_pitch),u_rotate_symbol:new d.bE(f,e.u_rotate_symbol),u_aspect_ratio:new d.b7(f,e.u_aspect_ratio),u_fade_change:new d.b7(f,e.u_fade_change),u_label_plane_matrix:new d.bG(f,e.u_label_plane_matrix),u_coord_matrix:new d.bG(f,e.u_coord_matrix),u_is_text:new d.bE(f,e.u_is_text),u_pitch_with_map:new d.bE(f,e.u_pitch_with_map),u_is_along_line:new d.bE(f,e.u_is_along_line),u_is_variable_anchor:new d.bE(f,e.u_is_variable_anchor),u_texsize:new d.bJ(f,e.u_texsize),u_texture:new d.bE(f,e.u_texture),u_gamma_scale:new d.b7(f,e.u_gamma_scale),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_is_halo:new d.bE(f,e.u_is_halo),u_translation:new d.bJ(f,e.u_translation),u_pitched_scale:new d.b7(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.bE(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bE(f,e.u_is_size_feature_constant),u_size_t:new d.b7(f,e.u_size_t),u_size:new d.b7(f,e.u_size),u_camera_to_center_distance:new d.b7(f,e.u_camera_to_center_distance),u_pitch:new d.b7(f,e.u_pitch),u_rotate_symbol:new d.bE(f,e.u_rotate_symbol),u_aspect_ratio:new d.b7(f,e.u_aspect_ratio),u_fade_change:new d.b7(f,e.u_fade_change),u_label_plane_matrix:new d.bG(f,e.u_label_plane_matrix),u_coord_matrix:new d.bG(f,e.u_coord_matrix),u_is_text:new d.bE(f,e.u_is_text),u_pitch_with_map:new d.bE(f,e.u_pitch_with_map),u_is_along_line:new d.bE(f,e.u_is_along_line),u_is_variable_anchor:new d.bE(f,e.u_is_variable_anchor),u_texsize:new d.bJ(f,e.u_texsize),u_texsize_icon:new d.bJ(f,e.u_texsize_icon),u_texture:new d.bE(f,e.u_texture),u_texture_icon:new d.bE(f,e.u_texture_icon),u_gamma_scale:new d.b7(f,e.u_gamma_scale),u_device_pixel_ratio:new d.b7(f,e.u_device_pixel_ratio),u_is_halo:new d.bE(f,e.u_is_halo),u_translation:new d.bJ(f,e.u_translation),u_pitched_scale:new d.b7(f,e.u_pitched_scale)}),background:(f,e)=>({u_opacity:new d.b7(f,e.u_opacity),u_color:new d.bF(f,e.u_color)}),backgroundPattern:(f,e)=>({u_opacity:new d.b7(f,e.u_opacity),u_image:new d.bE(f,e.u_image),u_pattern_tl_a:new d.bJ(f,e.u_pattern_tl_a),u_pattern_br_a:new d.bJ(f,e.u_pattern_br_a),u_pattern_tl_b:new d.bJ(f,e.u_pattern_tl_b),u_pattern_br_b:new d.bJ(f,e.u_pattern_br_b),u_texsize:new d.bJ(f,e.u_texsize),u_mix:new d.b7(f,e.u_mix),u_pattern_size_a:new d.bJ(f,e.u_pattern_size_a),u_pattern_size_b:new d.bJ(f,e.u_pattern_size_b),u_scale_a:new d.b7(f,e.u_scale_a),u_scale_b:new d.b7(f,e.u_scale_b),u_pixel_coord_upper:new d.bJ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bJ(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.b7(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_texture:new d.bE(f,e.u_texture),u_ele_delta:new d.b7(f,e.u_ele_delta),u_fog_matrix:new d.bG(f,e.u_fog_matrix),u_fog_color:new d.bF(f,e.u_fog_color),u_fog_ground_blend:new d.b7(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.b7(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.bF(f,e.u_horizon_color),u_horizon_fog_blend:new d.b7(f,e.u_horizon_fog_blend),u_is_globe_mode:new d.b7(f,e.u_is_globe_mode)}),terrainDepth:(f,e)=>({u_ele_delta:new d.b7(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_texture:new d.bE(f,e.u_texture),u_terrain_coords_id:new d.b7(f,e.u_terrain_coords_id),u_ele_delta:new d.b7(f,e.u_ele_delta)}),projectionErrorMeasurement:(f,e)=>({u_input:new d.b7(f,e.u_input),u_output_expected:new d.b7(f,e.u_output_expected)}),atmosphere:(f,e)=>({u_sun_pos:new d.bI(f,e.u_sun_pos),u_atmosphere_blend:new d.b7(f,e.u_atmosphere_blend),u_globe_position:new d.bI(f,e.u_globe_position),u_globe_radius:new d.b7(f,e.u_globe_radius),u_inv_proj_matrix:new d.bG(f,e.u_inv_proj_matrix)}),sky:(f,e)=>({u_sky_color:new d.bF(f,e.u_sky_color),u_horizon_color:new d.bF(f,e.u_horizon_color),u_horizon:new d.bJ(f,e.u_horizon),u_horizon_normal:new d.bJ(f,e.u_horizon_normal),u_sky_horizon_blend:new d.b7(f,e.u_sky_horizon_blend),u_sky_blend:new d.b7(f,e.u_sky_blend)})};class Ah{constructor(e,n,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Du={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class no{constructor(e,n,l,u){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let l=0;l<this.attributes.length;l++){const u=n.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,n,l){for(let u=0;u<this.attributes.length;u++){const m=this.attributes[u],y=n.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[Du[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ii{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gd extends ii{getDefault(){return d.b6.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ja extends ii{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Bl extends ii{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class zh extends ii{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Iu extends ii{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ph extends ii{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ru extends ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Uo extends ii{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Lc extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Bc extends ii{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ss extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class as extends ii{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class jr extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Ta extends ii{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ku extends ii{getDefault(){return d.b6.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ms extends ii{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Es extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class rs extends ii{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ol extends ii{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Nr extends ii{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Vo extends ii{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Fl extends ii{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Lu extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Zo extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Go extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Dh extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Oc extends ii{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Qt extends ii{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const l=this.gl;fa(l)?l.bindVertexArray(e):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class jl extends ii{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class vr extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Na extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Wa extends ii{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Bu extends Wa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Fc extends Wa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nl extends Wa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const jc="Framebuffer is not complete";class Ur{constructor(e,n,l,u,m){this.context=e,this.width=n,this.height=l;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Bu(e,b),u)this.depthAttachment=m?new Nl(e,b):new Fc(e,b);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(jc)}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Ul{constructor(e){var n,l;if(this.gl=e,this.clearColor=new gd(this),this.clearDepth=new ja(this),this.clearStencil=new Bl(this),this.colorMask=new zh(this),this.depthMask=new Iu(this),this.stencilMask=new Ph(this),this.stencilFunc=new Ru(this),this.stencilOp=new Uo(this),this.stencilTest=new Lc(this),this.depthRange=new Bc(this),this.depthTest=new Ss(this),this.depthFunc=new as(this),this.blend=new jr(this),this.blendFunc=new Ta(this),this.blendColor=new ku(this),this.blendEquation=new Ms(this),this.cullFace=new Es(this),this.cullFaceSide=new rs(this),this.frontFace=new Ol(this),this.program=new Nr(this),this.activeTexture=new Vo(this),this.viewport=new Fl(this),this.bindFramebuffer=new Lu(this),this.bindRenderbuffer=new Zo(this),this.bindTexture=new Go(this),this.bindVertexBuffer=new Dh(this),this.bindElementBuffer=new Oc(this),this.bindVertexArray=new Qt(this),this.pixelStoreUnpack=new jl(this),this.pixelStoreUnpackPremultiplyAlpha=new vr(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),fa(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Ah(this,e,n)}createVertexBuffer(e,n,l){return new no(this,e,n,l)}createRenderbuffer(e,n,l){const u=this.gl,m=u.createRenderbuffer();return this.bindRenderbuffer.set(m),u.renderbufferStorage(u.RENDERBUFFER,e,n,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,n,l,u){return new Ur(this,e,n,l,u)}clear({color:e,depth:n,stencil:l}){const u=this.gl;let m=0;e&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(m|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bB(e.blendFunction,xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return fa(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return fa(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Vr;function ss(f,e,n,l,u){const m=f.context,y=f.transform,b=m.gl,T=f.useProgram("collisionBox"),E=[];let z=0,D=0;for(let Y=0;Y<l.length;Y++){const W=l[Y],ie=e.getTile(W).getBucket(n);if(!ie)continue;const ne=u?ie.textCollisionBox:ie.iconCollisionBox,ae=ie.collisionCircleArray;ae.length>0&&(E.push({circleArray:ae,circleOffset:D,coord:W}),z+=ae.length/4,D=z),ne&&T.draw(m,b.LINES,Dt.disabled,Gt.disabled,f.colorModeForRenderPass(),Lt.disabled,zu(f.transform),f.style.map.terrain&&f.style.map.terrain.getTerrainData(W),y.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,f.transform.zoom,null,null,ne.collisionVertexBuffer)}if(!u||!E.length)return;const I=f.useProgram("collisionCircle"),j=new d.bO;j.resize(4*z),j._trim();let N=0;for(const Y of E)for(let W=0;W<Y.circleArray.length/4;W++){const ie=4*W,ne=Y.circleArray[ie+0],ae=Y.circleArray[ie+1],le=Y.circleArray[ie+2],se=Y.circleArray[ie+3];j.emplace(N++,ne,ae,le,se,0),j.emplace(N++,ne,ae,le,se,1),j.emplace(N++,ne,ae,le,se,2),j.emplace(N++,ne,ae,le,se,3)}(!Vr||Vr.length<2*z)&&(Vr=function(Y){const W=2*Y,ie=new d.bQ;ie.resize(W),ie._trim();for(let ne=0;ne<W;ne++){const ae=6*ne;ie.uint16[ae+0]=4*ne+0,ie.uint16[ae+1]=4*ne+1,ie.uint16[ae+2]=4*ne+2,ie.uint16[ae+3]=4*ne+2,ie.uint16[ae+4]=4*ne+3,ie.uint16[ae+5]=4*ne+0}return ie}(z));const X=m.createIndexBuffer(Vr,!0),$=m.createVertexBuffer(j,d.bP.members,!0);for(const Y of E){const W=Pu(f.transform);I.draw(m,b.TRIANGLES,Dt.disabled,Gt.disabled,f.colorModeForRenderPass(),Lt.disabled,W,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y.coord),null,n.id,$,X,d.aF.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,f.transform.zoom,null,null,null)}$.destroy(),X.destroy()}const Nc=d.as(new Float32Array(16));function Ua(f,e,n,l,u,m){const{horizontalAlign:y,verticalAlign:b}=d.aA(f);return new d.P((-(y-.5)*e/u+l[0])*m,(-(b-.5)*n/u+l[1])*m)}function os(f,e,n,l,u,m){const y=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=l.mult(m);n||(b=b.rotate(-u));const T=y.add(b);return Me(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){const b=it(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function ls(f,e,n,l,u,m,y,b,T,E,z,D){const I=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,N=f.icon.dynamicLayoutVertexArray,X={};j.clear();for(let $=0;$<I.length;$++){const Y=I.get($),W=Y.hidden||!Y.crossTileID||f.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(W){const ie=new d.P(Y.anchorX,Y.anchorY),ne={getElevation:D,width:u.width,height:u.height,pitchedLabelPlaneMatrix:m,pitchWithMap:n,transform:u,tileAnchorPoint:ie,translation:E,unwrappedTileID:z},ae=n?Bt(ie.x,ie.y,ne):it(ie.x,ie.y,ne),le=me(u.cameraToCenterDistance,ae.signedDistanceFromCamera);let se=d.ah(f.textSizeData,b,Y)*le/d.au;n&&(se*=f.tilePixelRatio/y);const{width:ye,height:we,anchor:De,textOffset:Ie,textBoxScale:ze}=W,Ye=Ua(De,ye,we,Ie,ze,se),$e=u.getPitchedTextCorrection(ie.x+E[0],ie.y+E[1],z),Fe=os(ae.point,ne,e,Ye,-u.bearingInRadians,$e),rt=f.allowVerticalPlacement&&Y.placedOrientation===d.ag.vertical?Math.PI/2:0;for(let dt=0;dt<Y.numGlyphs;dt++)d.an(j,Fe,rt);T&&Y.associatedIconIndex>=0&&(X[Y.associatedIconIndex]={shiftedAnchor:Fe,angle:rt})}else Wi(Y.numGlyphs,j)}if(T){N.clear();const $=f.icon.placedSymbolArray;for(let Y=0;Y<$.length;Y++){const W=$.get(Y);if(W.hidden)Wi(W.numGlyphs,N);else{const ie=X[Y];if(ie)for(let ne=0;ne<W.numGlyphs;ne++)d.an(N,ie.shiftedAnchor,ie.angle);else Wi(W.numGlyphs,N)}}f.icon.dynamicLayoutVertexBuffer.updateData(N)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function qo(f,e,n){return n.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Vl(f,e,n,l,u,m,y,b,T,E,z,D,I){const j=f.context,N=j.gl,X=f.transform,$=b==="map",Y=T==="map",W=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",ie=$&&!Y&&!W,ne=!n.layout.get("symbol-sort-key").isConstant();let ae=!1;const le=f.getDepthModeForSublayer(0,Dt.ReadOnly),se=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ye=[],we=X.getCircleRadiusCorrection();for(const De of l){const Ie=e.getTile(De),ze=Ie.getBucket(n);if(!ze)continue;const Ye=u?ze.text:ze.icon;if(!Ye||!Ye.segments.get().length||!Ye.hasVisibleVertices)continue;const $e=Ye.programConfigurations.get(n.id),Fe=u||ze.sdfIcons,rt=u?ze.textSizeData:ze.iconSizeData,dt=Y||X.pitch!==0,ni=f.useProgram(qo(Fe,u,ze),$e),bi=d.af(rt,X.zoom),hi=f.style.map.terrain&&f.style.map.terrain.getTerrainData(De);let mi,gi,Kt,di,zn=[0,0],wi=null;if(u)gi=Ie.glyphAtlasTexture,Kt=N.LINEAR,mi=Ie.glyphAtlasTexture.size,ze.iconsInText&&(zn=Ie.imageAtlasTexture.size,wi=Ie.imageAtlasTexture,di=dt||f.options.rotating||f.options.zooming||rt.kind==="composite"||rt.kind==="camera"?N.LINEAR:N.NEAREST);else{const yi=n.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;gi=Ie.imageAtlasTexture,Kt=Fe||f.options.rotating||f.options.zooming||yi||dt?N.LINEAR:N.NEAREST,mi=Ie.imageAtlasTexture.size}const Pi=d.av(Ie,1,f.transform.zoom),ji=be($,f.transform,Pi),Ea=d.K();d.ai(Ea,ji);const Sr=ce(Y,$,f.transform,Pi),sr=d.aw(X,Ie,m,y),Ga=X.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Fs=se&&ze.hasTextData(),Mr=n.layout.get("icon-text-fit")!=="none"&&Fs&&ze.hasIconData();if(W){const yi=f.style.map.terrain?(xn,bn)=>f.style.map.terrain.getElevation(De,xn,bn):null,fi=n.layout.get("text-rotation-alignment")==="map";_e(ze,f,u,ji,Ea,Y,E,fi,De.toUnwrapped(),X.width,X.height,sr,yi)}const qr=u&&se||Mr,qa=W||qr?Nc:Y?ji:f.transform.clipSpaceToPixelsMatrix,Er=Fe&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Fe?ze.iconsInText?No(rt.kind,bi,ie,Y,W,qr,f,qa,Sr,sr,mi,zn,we):Ic(rt.kind,bi,ie,Y,W,qr,f,qa,Sr,sr,u,mi,0,we):kl(rt.kind,bi,ie,Y,W,qr,f,qa,Sr,sr,u,mi,we);const Ha={program:ni,buffers:Ye,uniformValues:or,projectionData:Ga,atlasTexture:gi,atlasTextureIcon:wi,atlasInterpolation:Kt,atlasInterpolationIcon:di,isSDF:Fe,hasHalo:Er};if(ne&&ze.canOverlap){ae=!0;const yi=Ye.segments.get();for(const fi of yi)ye.push({segments:new d.aF([fi]),sortKey:fi.sortKey,state:Ha,terrainData:hi})}else ye.push({segments:Ye.segments,sortKey:0,state:Ha,terrainData:hi})}ae&&ye.sort((De,Ie)=>De.sortKey-Ie.sortKey);for(const De of ye){const Ie=De.state;if(j.activeTexture.set(N.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,N.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(j.activeTexture.set(N.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Ie.isSDF){const ze=Ie.uniformValues;Ie.hasHalo&&(ze.u_is_halo=1,pa(Ie.buffers,De.segments,n,f,Ie.program,le,z,D,ze,Ie.projectionData,De.terrainData)),ze.u_is_halo=0}pa(Ie.buffers,De.segments,n,f,Ie.program,le,z,D,Ie.uniformValues,Ie.projectionData,De.terrainData)}}function pa(f,e,n,l,u,m,y,b,T,E,z){const D=l.context;u.draw(D,D.gl.TRIANGLES,m,y,b,Lt.backCCW,T,z,E,n.id,f.layoutVertexBuffer,f.indexBuffer,e,n.paint,l.transform.zoom,f.programConfigurations.get(n.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ja(f,e,n,l,u){const m=f.context,y=m.gl,b=Gt.disabled,T=new xi([y.ONE,y.ONE],d.b6.transparent,[!0,!0,!0,!0]),E=e.getBucket(n);if(!E)return;const z=l.key;let D=n.heatmapFbos.get(z);D||(D=Va(m,e.tileSize,e.tileSize),n.heatmapFbos.set(z,D)),m.bindFramebuffer.set(D.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:d.b6.transparent});const I=E.programConfigurations.get(n.id),j=f.useProgram("heatmap",I,!u),N=f.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=f.style.map.terrain.getTerrainData(l);j.draw(m,y.TRIANGLES,Dt.disabled,b,T,Lt.disabled,Pc(e,f.transform.zoom,n.paint.get("heatmap-intensity"),1),X,N,n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,f.transform.zoom,I)}function Cs(f,e,n,l,u){const m=f.context,y=m.gl,b=f.transform;m.setColorMode(f.colorModeForRenderPass());const T=er(m,e),E=n.key,z=e.heatmapFbos.get(E);if(!z)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,z.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const D=b.getProjectionData({overscaledTileID:n,applyTerrainMatrix:u,applyGlobeMatrix:!l});f.useProgram("heatmapTexture").draw(m,y.TRIANGLES,Dt.disabled,Gt.disabled,f.colorModeForRenderPass(),Lt.disabled,Dc(f,e,0,1),null,D,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,b.zoom),z.destroy(),e.heatmapFbos.delete(E)}function Va(f,e,n){var l,u;const m=f.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const b=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,T,e,n,0,m.RGBA,b,null);const E=f.createFramebuffer(e,n,!1,!1);return E.colorAttachment.set(y),E}function er(f,e){return e.colorRampTexture||(e.colorRampTexture=new pi(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function cs(f,e,n,l,u){if(!n||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[n.to.toString()],b=m[n.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const T=u.getPaintProperty(e);y=m[T],b=m[T]}y&&b&&f.setConstantPatternPositions(y,b)}function Uc(f,e,n,l,u,m,y,b){const T=f.context.gl,E="fill-pattern",z=n.paint.get(E),D=z&&z.constantOr(1),I=n.getCrossfadeParameters();let j,N,X,$,Y;const W=f.transform,ie=n.paint.get("fill-translate"),ne=n.paint.get("fill-translate-anchor");y?(N=D&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=T.LINES):(N=D?"fillPattern":"fill",j=T.TRIANGLES);const ae=z.constantOr(null);for(const le of l){const se=e.getTile(le);if(D&&!se.patternsLoaded())continue;const ye=se.getBucket(n);if(!ye)continue;const we=ye.programConfigurations.get(n.id),De=f.useProgram(N,we),Ie=f.style.map.terrain&&f.style.map.terrain.getTerrainData(le);D&&(f.context.activeTexture.set(T.TEXTURE0),se.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),we.updatePaintBuffers(I)),cs(we,E,ae,se,n);const ze=W.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),Ye=d.aw(W,se,ie,ne);if(y){$=ye.indexBuffer2,Y=ye.segments2;const Fe=[T.drawingBufferWidth,T.drawingBufferHeight];X=N==="fillOutlinePattern"&&D?Au(f,I,se,Fe,Ye):Sh(Fe,Ye)}else $=ye.indexBuffer,Y=ye.segments,X=D?Th(f,I,se,Ye):{u_fill_translate:Ye};let $e;if(f.renderPass==="translucent"&&b){const[Fe]=f.getStencilConfigForOverlapAndUpdateStencilID(l);$e=Fe[le.overscaledZ]}else $e=f.stencilModeForClipping(le);De.draw(f.context,j,u,$e,m,Lt.backCCW,X,Ie,ze,n.id,ye.layoutVertexBuffer,$,Y,n.paint,f.transform.zoom,we)}}function As(f,e,n,l,u,m,y,b){const T=f.context,E=T.gl,z="fill-extrusion-pattern",D=n.paint.get(z),I=D.constantOr(1),j=n.getCrossfadeParameters(),N=n.paint.get("fill-extrusion-opacity"),X=D.constantOr(null),$=f.transform;for(const Y of l){const W=e.getTile(Y),ie=W.getBucket(n);if(!ie)continue;const ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y),ae=ie.programConfigurations.get(n.id),le=f.useProgram(I?"fillExtrusionPattern":"fillExtrusion",ae);I&&(f.context.activeTexture.set(E.TEXTURE0),W.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ae.updatePaintBuffers(j));const se=$.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!b,applyTerrainMatrix:!0});cs(ae,z,X,W,n);const ye=d.aw($,W,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),we=n.paint.get("fill-extrusion-vertical-gradient"),De=I?Oo(f,we,N,ye,Y,j,W):wh(f,we,N,ye);le.draw(T,T.gl.TRIANGLES,u,m,y,Lt.backCCW,De,ne,se,n.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,n.paint,f.transform.zoom,ae,f.style.map.terrain&&ie.centroidVertexBuffer)}}function ao(f,e,n,l,u,m,y,b,T){var E;const z=f.style.projection,D=f.context,I=f.transform,j=D.gl,N=f.useProgram("hillshade"),X=!f.options.moving;for(const $ of l){const Y=e.getTile($),W=Y.fbo;if(!W)continue;const ie=z.getMeshFromTileID(D,$.canonical,b,!0,"raster"),ne=(E=f.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData($);D.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,W.colorAttachment.get());const ae=I.getProjectionData({overscaledTileID:$,aligned:X,applyGlobeMatrix:!T,applyTerrainMatrix:!0});N.draw(D,j.TRIANGLES,m,u[$.overscaledZ],y,Lt.backCCW,Ts(f,Y,n),ne,ae,n.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}const Qn=[new d.P(0,0),new d.P(d.Z,0),new d.P(d.Z,d.Z),new d.P(0,d.Z)];function cn(f,e,n,l,u,m,y,b,T=!1,E=!1){const z=l[l.length-1].overscaledZ,D=f.context,I=D.gl,j=f.useProgram("raster"),N=f.transform,X=f.style.projection,$=f.colorModeForRenderPass(),Y=!f.options.moving;for(const W of l){const ie=f.getDepthModeForSublayer(W.overscaledZ-z,n.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,I.LESS),ne=e.getTile(W);ne.registerFadeDuration(n.paint.get("raster-fade-duration"));const ae=e.findLoadedParent(W,0),le=e.findLoadedSibling(W),se=Et(ne,ae||le||null,e,n,f.transform,f.style.map.terrain);let ye,we;const De=n.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;D.activeTexture.set(I.TEXTURE0),ne.texture.bind(De,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(I.TEXTURE1),ae?(ae.texture.bind(De,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),ye=Math.pow(2,ae.tileID.overscaledZ-ne.tileID.overscaledZ),we=[ne.tileID.canonical.x*ye%1,ne.tileID.canonical.y*ye%1]):ne.texture.bind(De,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),ne.texture.useMipmap&&D.extTextureFilterAnisotropic&&f.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Ie=f.style.map.terrain&&f.style.map.terrain.getTerrainData(W),ze=N.getProjectionData({overscaledTileID:W,aligned:Y,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),Ye=Ch(we||[0,0],ye||1,se,n,b),$e=X.getMeshFromTileID(D,W.canonical,m,y,"raster");j.draw(D,I.TRIANGLES,ie,u?u[W.overscaledZ]:Gt.disabled,$,T?Lt.frontCCW:Lt.backCCW,Ye,Ie,ze,n.id,$e.vertexBuffer,$e.indexBuffer,$e.segments)}}function Et(f,e,n,l,u,m){const y=l.paint.get("raster-fade-duration");if(!m&&y>0){const b=ut.now(),T=(b-f.timeAdded)/y,E=e?(b-e.timeAdded)/y:-1,z=n.getSource(),D=on(u,{tileSize:z.tileSize,roundZoom:z.roundZoom}),I=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),j=I&&f.refreshedUponExpiration?1:d.ad(I?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Kn=new d.b6(1,0,0,1),un=new d.b6(0,1,0,1),Zl=new d.b6(0,0,1,1),us=new d.b6(1,0,1,1),Ou=new d.b6(0,1,1,1);function zs(f,e,n,l){Gr(f,0,e+n/2,f.transform.width,n,l)}function Zr(f,e,n,l){Gr(f,e-n/2,0,n,f.transform.height,l)}function Gr(f,e,n,l,u,m){const y=f.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*f.pixelRatio,n*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),y.clear({color:m}),b.disable(b.SCISSOR_TEST)}function Ho(f,e,n){const l=f.context,u=l.gl,m=f.useProgram("debug"),y=Dt.disabled,b=Gt.disabled,T=f.colorModeForRenderPass(),E="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(n);l.activeTexture.set(u.TEXTURE0);const D=e.getTileByID(n.key).latestRawTileData,I=Math.floor((D&&D.byteLength||0)/1024),j=e.getTile(n).tileSize,N=512/Math.min(j,512)*(n.overscaledZ/f.transform.zoom)*.5;let X=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(X+=` => ${n.overscaledZ}`),function(Y,W){Y.initDebugOverlayCanvas();const ie=Y.debugOverlayCanvas,ne=Y.context.gl,ae=Y.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,ie.width,ie.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(W,5,5),ae.strokeText(W,5,5),Y.debugOverlayTexture.update(ie),Y.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(f,`${X} ${I}kB`);const $=f.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,u.TRIANGLES,y,b,xi.alphaBlended,Lt.disabled,zc(d.b6.transparent,N),null,$,E,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),m.draw(l,u.LINE_STRIP,y,b,T,Lt.disabled,zc(d.b6.red),z,$,E,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function ro(f,e,n,l){const{isRenderingGlobe:u}=l,m=f.context,y=m.gl,b=f.transform,T=f.colorModeForRenderPass(),E=f.getDepthModeFor3D(),z=f.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,f.width,f.height]);for(const D of n){const I=e.getTerrainMesh(D.tileID),j=f.renderToTexture.getTexture(D),N=e.getTerrainData(D.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,j.texture);const X=e.getMeshFrameDelta(b.zoom),$=b.calculateFogMatrix(D.tileID.toUnwrapped()),Y=Cu(X,$,f.style.sky,b.pitch,u),W=b.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(m,y.TRIANGLES,E,Gt.disabled,T,Lt.backCCW,Y,N,W,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function Vc(f,e){if(!e.mesh){const n=new d.aE;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new d.aG;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new ua(f.createVertexBuffer(n,ka.members),f.createIndexBuffer(l),d.aF.simpleSegment(0,0,n.length,l.length))}return e.mesh}class Zc{constructor(e,n){this.context=new Ul(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=P.maxUnderzooming+P.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vc}resize(e,n,l){if(this.width=Math.floor(e*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,n=new d.aE;n.emplaceBack(0,0),n.emplaceBack(d.Z,0),n.emplaceBack(0,d.Z),n.emplaceBack(d.Z,d.Z),this.tileExtentBuffer=e.createVertexBuffer(n,ka.members),this.tileExtentSegments=d.aF.simpleSegment(0,0,4,2);const l=new d.aE;l.emplaceBack(0,0),l.emplaceBack(d.Z,0),l.emplaceBack(0,d.Z),l.emplaceBack(d.Z,d.Z),this.debugBuffer=e.createVertexBuffer(l,ka.members),this.debugSegments=d.aF.simpleSegment(0,0,4,5);const u=new d.bV;u.emplaceBack(0,0,0,0),u.emplaceBack(d.Z,0,d.Z,0),u.emplaceBack(0,d.Z,0,d.Z),u.emplaceBack(d.Z,d.Z,d.Z,d.Z),this.rasterBoundsBuffer=e.createVertexBuffer(u,Fr.members),this.rasterBoundsSegments=d.aF.simpleSegment(0,0,4,2);const m=new d.aE;m.emplaceBack(0,0),m.emplaceBack(d.Z,0),m.emplaceBack(0,d.Z),m.emplaceBack(d.Z,d.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,ka.members),this.rasterBoundsSegmentsPosOnly=d.aF.simpleSegment(0,0,4,5);const y=new d.aE;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,ka.members),this.viewportSegments=d.aF.simpleSegment(0,0,4,2);const b=new d.bW;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const T=new d.aG;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const E=this.context.gl;this.stencilClearMode=new Gt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new ua(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.K();d.bN(l,0,this.width,this.height,0,0,1),d.M(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const u={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Dt.disabled,this.stencilClearMode,xi.disabled,Lt.disabled,null,null,u,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();const u=this.context;u.setColorMode(xi.disabled),u.setDepthMode(Dt.disabled);const m={};for(const y of n)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,n,l,!0),this._renderTileMasks(m,n,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,n,l,u){const m=this.context,y=m.gl,b=this.style.projection,T=this.transform,E=this.useProgram("clippingMask");for(const z of n){const D=e[z.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),j=b.getMeshFromTileID(this.context,z.canonical,u,!0,"stencil"),N=T.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});E.draw(m,y.TRIANGLES,Dt.disabled,new Gt({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),xi.disabled,l?Lt.disabled:Lt.backCCW,null,I,N,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){const e=this.context,n=e.gl,l=this.style.projection,u=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),b=pe(u,{tileSize:u.tileSize});for(const T of b){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),z=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),D=u.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,n.TRIANGLES,y,Gt.disabled,xi.disabled,Lt.backCCW,null,E,D,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Gt({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Gt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const n=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),u=l[l.length-1].overscaledZ,m=l[0].overscaledZ-u+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let b=0;b<m;b++)y[b+u]=new Gt({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[u]:Gt.disabled},l]}stencilConfigForOverlapTwoPass(e){const n=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),u=l[l.length-1].overscaledZ,m=l[0].overscaledZ-u+1;if(this.clearStencil(),m>1){const y={},b={};for(let T=0;T<m;T++)y[T+u]=new Gt({func:n.GREATER,mask:255},m+1+T,255,n.KEEP,n.KEEP,n.REPLACE),b[T+u]=new Gt({func:n.GREATER,mask:255},1+T,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*m+1,[y,b,l]}return this.nextStencilID=3,[{[u]:new Gt({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[u]:new Gt({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new xi([e.CONSTANT_COLOR,e.ONE],new d.b6(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xi.unblended:xi.alphaBlended}getDepthModeForSublayer(e,n,l){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Dt(l||this.context.gl.LEQUAL,n,[u,u])}getDepthModeFor3D(){return new Dt(this.context.gl.LEQUAL,Dt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var l,u;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ut.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,b={},T={},E={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const I in y){const j=y[I];j.used&&j.prepare(this.context),b[I]=j.getVisibleCoordinates(!1),T[I]=b[I].slice().reverse(),E[I]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<m.length;I++)if(this.style._layers[m[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of m){const j=this.style._layers[I];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const N=T[j.source];(j.type==="custom"||N.length)&&this.renderLayer(this,y[j.source],j,N,z)}if((u=this.style.projection)===null||u===void 0||u.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?d.b6.black:d.b6.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(I,j){const N=I.context,X=N.gl,$=((le,se,ye)=>{const we=Math.cos(se.rollInRadians),De=Math.sin(se.rollInRadians),Ie=Bn(se),ze=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(se.width/2-Ie*De)*ye,(se.height/2+Ie*we)*ye],u_horizon_normal:[-De,we],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*se.height/2*ye,u_sky_blend:ze}})(j,I.style.map.transform,I.pixelRatio),Y=new Dt(X.LEQUAL,Dt.ReadWrite,[0,1]),W=Gt.disabled,ie=I.colorModeForRenderPass(),ne=I.useProgram("sky"),ae=Vc(N,j);ne.draw(N,X.TRIANGLES,Y,W,ie,Lt.disabled,$,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[m[this.currentLayer]],j=y[I.source],N=b[I.source];this._renderTileClippingMasks(I,N,!1),this.renderLayer(this,j,I,N,z)}this.renderPass="translucent";let D=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const I=this.style._layers[m[this.currentLayer]],j=y[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,z))continue;this.opaquePassEnabledForLayer()||D||(D=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const N=(I.type==="symbol"?E:T)[I.source];this._renderTileClippingMasks(I,b[I.source],!1),this.renderLayer(this,j,I,N,z)}if(z.isRenderingGlobe&&function(I,j,N){const X=I.context,$=X.gl,Y=I.useProgram("atmosphere"),W=new Dt($.LEQUAL,Dt.ReadOnly,[0,1]),ie=I.transform,ne=function(ze,Ye){const $e=ze.properties.get("position"),Fe=[-$e.x,-$e.y,-$e.z],rt=d.as(new Float64Array(16));return ze.properties.get("anchor")==="map"&&(d.aZ(rt,rt,Ye.rollInRadians),d.a_(rt,rt,-Ye.pitchInRadians),d.aZ(rt,rt,Ye.bearingInRadians),d.a_(rt,rt,Ye.center.lat*Math.PI/180),d.bl(rt,rt,-Ye.center.lng*Math.PI/180)),d.bU(Fe,Fe,rt),Fe}(N,I.transform),ae=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=j.properties.get("atmosphere-blend")*ae.projectionTransition;if(le===0)return;const se=Yn(ie.worldSize,ie.center.lat),ye=ie.inverseProjectionMatrix,we=new Float64Array(4);we[3]=1,d.ao(we,we,ie.modelViewProjectionMatrix),we[0]/=we[3],we[1]/=we[3],we[2]/=we[3],we[3]=1,d.ao(we,we,ye),we[0]/=we[3],we[1]/=we[3],we[2]/=we[3],we[3]=1;const De=((ze,Ye,$e,Fe,rt)=>({u_sun_pos:ze,u_atmosphere_blend:Ye,u_globe_position:$e,u_globe_radius:Fe,u_inv_proj_matrix:rt}))(ne,le,[we[0],we[1],we[2]],se,ye),Ie=Vc(X,j);Y.draw(X,$.TRIANGLES,W,Gt.disabled,xi.alphaBlended,Lt.disabled,De,null,null,"atmosphere",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=function(j,N){let X=null;const $=Object.values(j._layers).flatMap(ne=>ne.source&&!ne.isHidden(N)?[j.sourceCaches[ne.source]]:[]),Y=$.filter(ne=>ne.getSource().type==="vector"),W=$.filter(ne=>ne.getSource().type!=="vector"),ie=ne=>{(!X||X.getSource().maxzoom<ne.getSource().maxzoom)&&(X=ne)};return Y.forEach(ne=>ie(ne)),X||W.forEach(ne=>ie(ne)),X}(this.style,this.transform.zoom);I&&function(j,N,X){for(let $=0;$<X.length;$++)Ho(j,N,X[$])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const j=I.transform.padding;zs(I,I.transform.height-(j.top||0),3,Kn),zs(I,j.bottom||0,3,un),Zr(I,j.left||0,3,Zl),Zr(I,I.transform.width-(j.right||0),3,us);const N=I.transform.centerPoint;(function(X,$,Y,W){Gr(X,$-1,Y-10,2,20,W),Gr(X,$-10,Y-1,20,2,W)})(I,N.x,I.transform.height-N.y,Ou)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.bX(n,l):!d.bY(n,l)),u||(u=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),u&&(d.bZ(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const b=m.context,T=b.gl,E=m.transform,z=xi.unblended,D=new Dt(T.LEQUAL,Dt.ReadWrite,[0,1]),I=y.sourceCache.getRenderableTiles(),j=m.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.b6.transparent,depth:1});for(const N of I){const X=y.getTerrainMesh(N.tileID),$=y.getTerrainData(N.tileID),Y=E.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),W={u_ele_delta:y.getMeshFrameDelta(E.zoom)};j.draw(b,T.TRIANGLES,D,Gt.disabled,z,Lt.backCCW,W,$,Y,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const b=m.context,T=b.gl,E=m.transform,z=xi.unblended,D=new Dt(T.LEQUAL,Dt.ReadWrite,[0,1]),I=y.getCoordsTexture(),j=y.sourceCache.getRenderableTiles(),N=m.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.b6.transparent,depth:1}),y.coordsIndex=[];for(const X of j){const $=y.getTerrainMesh(X.tileID),Y=y.getTerrainData(X.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.texture);const W={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(E.zoom)},ie=E.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(b,T.TRIANGLES,D,Gt.disabled,z,Lt.backCCW,W,Y,ie,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),y.coordsIndex.push(X.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,n,l,u,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(u||[]).length)&&(this.id=l.id,d.b_(l)?function(y,b,T,E,z,D){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=D,j=Gt.disabled,N=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,$,Y,W,ie,ne,ae,le,se){const ye=$.transform,we=$.style.map.terrain,De=ie==="map",Ie=ne==="map";for(const ze of X){const Ye=W.getTile(ze),$e=Ye.getBucket(Y);if(!$e||!$e.text||!$e.text.segments.get().length)continue;const Fe=d.af($e.textSizeData,ye.zoom),rt=d.av(Ye,1,$.transform.zoom),dt=be(De,$.transform,rt),ni=Y.layout.get("icon-text-fit")!=="none"&&$e.hasIconData();if(Fe){const bi=Math.pow(2,ye.zoom-Ye.tileID.overscaledZ),hi=we?(mi,gi)=>we.getElevation(ze,mi,gi):null;ls($e,De,Ie,se,ye,dt,bi,Fe,ni,d.aw(ye,Ye,ae,le),ze.toUnwrapped(),hi)}}}(E,y,T,b,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),z),T.paint.get("icon-opacity").constantOr(1)!==0&&Vl(y,b,T,E,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),j,N,I),T.paint.get("text-opacity").constantOr(1)!==0&&Vl(y,b,T,E,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),j,N,I),b.map.showCollisionBoxes&&(ss(y,b,T,E,!0),ss(y,b,T,E,!1))}(e,n,l,u,this.style.placement.variableOffsets,m):d.b$(l)?function(y,b,T,E,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=z,I=T.paint.get("circle-opacity"),j=T.paint.get("circle-stroke-width"),N=T.paint.get("circle-stroke-opacity"),X=!T.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(j.constantOr(1)===0||N.constantOr(1)===0))return;const $=y.context,Y=$.gl,W=y.transform,ie=y.getDepthModeForSublayer(0,Dt.ReadOnly),ne=Gt.disabled,ae=y.colorModeForRenderPass(),le=[],se=W.getCircleRadiusCorrection();for(let ye=0;ye<E.length;ye++){const we=E[ye],De=b.getTile(we),Ie=De.getBucket(T);if(!Ie)continue;const ze=T.paint.get("circle-translate"),Ye=T.paint.get("circle-translate-anchor"),$e=d.aw(W,De,ze,Ye),Fe=Ie.programConfigurations.get(T.id),rt=y.useProgram("circle",Fe),dt=Ie.layoutVertexBuffer,ni=Ie.indexBuffer,bi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(we),hi={programConfiguration:Fe,program:rt,layoutVertexBuffer:dt,indexBuffer:ni,uniformValues:Fo(y,De,T,$e,se),terrainData:bi,projectionData:W.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!D,applyTerrainMatrix:!0})};if(X){const mi=Ie.segments.get();for(const gi of mi)le.push({segments:new d.aF([gi]),sortKey:gi.sortKey,state:hi})}else le.push({segments:Ie.segments,sortKey:0,state:hi})}X&&le.sort((ye,we)=>ye.sortKey-we.sortKey);for(const ye of le){const{programConfiguration:we,program:De,layoutVertexBuffer:Ie,indexBuffer:ze,uniformValues:Ye,terrainData:$e,projectionData:Fe}=ye.state;De.draw($,Y.TRIANGLES,ie,ne,ae,Lt.backCCW,Ye,$e,Fe,T.id,Ie,ze,ye.segments,T.paint,y.transform.zoom,we)}}(e,n,l,u,m):d.c0(l)?function(y,b,T,E,z){if(T.paint.get("heatmap-opacity")===0)return;const D=y.context,{isRenderingToTexture:I,isRenderingGlobe:j}=z;if(y.style.map.terrain){for(const N of E){const X=b.getTile(N);b.hasRenderableParent(N)||(y.renderPass==="offscreen"?Ja(y,X,T,N,j):y.renderPass==="translucent"&&Cs(y,T,N,I,j))}D.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(N,X,$,Y){const W=N.context,ie=W.gl,ne=N.transform,ae=Gt.disabled,le=new xi([ie.ONE,ie.ONE],d.b6.transparent,[!0,!0,!0,!0]);(function(se,ye,we){const De=se.gl;se.activeTexture.set(De.TEXTURE1),se.viewport.set([0,0,ye.width/4,ye.height/4]);let Ie=we.heatmapFbos.get(d.bR);Ie?(De.bindTexture(De.TEXTURE_2D,Ie.colorAttachment.get()),se.bindFramebuffer.set(Ie.framebuffer)):(Ie=Va(se,ye.width/4,ye.height/4),we.heatmapFbos.set(d.bR,Ie))})(W,N,$),W.clear({color:d.b6.transparent});for(let se=0;se<Y.length;se++){const ye=Y[se];if(X.hasRenderableParent(ye))continue;const we=X.getTile(ye),De=we.getBucket($);if(!De)continue;const Ie=De.programConfigurations.get($.id),ze=N.useProgram("heatmap",Ie),Ye=ne.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),$e=ne.getCircleRadiusCorrection();ze.draw(W,ie.TRIANGLES,Dt.disabled,ae,le,Lt.backCCW,Pc(we,ne.zoom,$.paint.get("heatmap-intensity"),$e),null,Ye,$.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,$.paint,ne.zoom,Ie)}W.viewport.set([0,0,N.width,N.height])}(y,b,T,E):y.renderPass==="translucent"&&function(N,X){const $=N.context,Y=$.gl;$.setColorMode(N.colorModeForRenderPass());const W=X.heatmapFbos.get(d.bR);W&&($.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,W.colorAttachment.get()),$.activeTexture.set(Y.TEXTURE1),er($,X).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw($,Y.TRIANGLES,Dt.disabled,Gt.disabled,N.colorModeForRenderPass(),Lt.disabled,Dc(N,X,0,1),null,null,X.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,X.paint,N.transform.zoom))}(y,T)}(e,n,l,u,m):d.c1(l)?function(y,b,T,E,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=z,I=T.paint.get("line-opacity"),j=T.paint.get("line-width");if(I.constantOr(1)===0||j.constantOr(1)===0)return;const N=y.getDepthModeForSublayer(0,Dt.ReadOnly),X=y.colorModeForRenderPass(),$=T.paint.get("line-dasharray"),Y=T.paint.get("line-pattern"),W=Y.constantOr(1),ie=T.paint.get("line-gradient"),ne=T.getCrossfadeParameters(),ae=W?"linePattern":$?"lineSDF":ie?"lineGradient":"line",le=y.context,se=le.gl,ye=y.transform;let we=!0;for(const De of E){const Ie=b.getTile(De);if(W&&!Ie.patternsLoaded())continue;const ze=Ie.getBucket(T);if(!ze)continue;const Ye=ze.programConfigurations.get(T.id),$e=y.context.program.get(),Fe=y.useProgram(ae,Ye),rt=we||Fe.program!==$e,dt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),ni=Y.constantOr(null);if(ni&&Ie.imageAtlas){const Kt=Ie.imageAtlas,di=Kt.patternPositions[ni.to.toString()],zn=Kt.patternPositions[ni.from.toString()];di&&zn&&Ye.setConstantPatternPositions(di,zn)}const bi=ye.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),hi=ye.getPixelScale(),mi=W?Il(y,Ie,T,hi,ne):$?Eh(y,Ie,T,hi,$,ne):ie?_d(y,Ie,T,hi,ze.lineClipsArray.length):to(y,Ie,T,hi);if(W)le.activeTexture.set(se.TEXTURE0),Ie.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ye.updatePaintBuffers(ne);else if($&&(rt||y.lineAtlas.dirty))le.activeTexture.set(se.TEXTURE0),y.lineAtlas.bind(le);else if(ie){const Kt=ze.gradients[T.id];let di=Kt.texture;if(T.gradientVersion!==Kt.version){let zn=256;if(T.stepInterpolant){const wi=b.getSource().maxzoom,Pi=De.canonical.z===wi?Math.ceil(1<<y.transform.maxZoom-De.canonical.z):1;zn=d.ad(d.bS(ze.maxLineLength/d.Z*1024*Pi),256,le.maxTextureSize)}Kt.gradient=d.bT({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:Kt.gradient||void 0,clips:ze.lineClipsArray}),Kt.texture?Kt.texture.update(Kt.gradient):Kt.texture=new pi(le,Kt.gradient,se.RGBA),Kt.version=T.gradientVersion,di=Kt.texture}le.activeTexture.set(se.TEXTURE0),di.bind(T.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}let gi;if(D){const[Kt]=y.getStencilConfigForOverlapAndUpdateStencilID(E);gi=Kt[De.overscaledZ]}else gi=y.stencilModeForClipping(De);Fe.draw(le,se.TRIANGLES,N,gi,X,Lt.disabled,mi,dt,bi,T.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,T.paint,y.transform.zoom,Ye,ze.layoutVertexBuffer2),we=!1}}(e,n,l,u,m):d.c2(l)?function(y,b,T,E,z){const D=T.paint.get("fill-color"),I=T.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:j}=z,N=y.colorModeForRenderPass(),X=T.paint.get("fill-pattern"),$=y.opaquePassEnabledForLayer()&&!X.constantOr(1)&&D.constantOr(d.b6.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===$){const Y=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Uc(y,b,T,E,Y,N,!1,j)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const Y=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Uc(y,b,T,E,Y,N,!0,j)}}(e,n,l,u,m):d.c3(l)?function(y,b,T,E,z){const D=T.paint.get("fill-extrusion-opacity");if(D===0)return;const{isRenderingToTexture:I}=z;if(y.renderPass==="translucent"){const j=new Dt(y.context.gl.LEQUAL,Dt.ReadWrite,y.depthRangeFor3D);if(D!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))As(y,b,T,E,j,Gt.disabled,xi.disabled,I),As(y,b,T,E,j,y.stencilModeFor3D(),y.colorModeForRenderPass(),I);else{const N=y.colorModeForRenderPass();As(y,b,T,E,j,Gt.disabled,N,I)}}}(e,n,l,u,m):d.c4(l)?function(y,b,T,E,z){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=z,I=y.context,j=y.style.projection.useSubdivision,N=y.getDepthModeForSublayer(0,Dt.ReadOnly),X=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function($,Y,W,ie,ne,ae,le){const se=$.context,ye=se.gl;for(const we of W){const De=Y.getTile(we),Ie=De.dem;if(!Ie||!Ie.data||!De.needsHillshadePrepare)continue;const ze=Ie.dim,Ye=Ie.stride,$e=Ie.getPixels();if(se.activeTexture.set(ye.TEXTURE1),se.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||$.getTileTexture(Ye),De.demTexture){const rt=De.demTexture;rt.update($e,{premultiply:!1}),rt.bind(ye.NEAREST,ye.CLAMP_TO_EDGE)}else De.demTexture=new pi(se,$e,ye.RGBA,{premultiply:!1}),De.demTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);se.activeTexture.set(ye.TEXTURE0);let Fe=De.fbo;if(!Fe){const rt=new pi(se,{width:ze,height:ze,data:null},ye.RGBA);rt.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Fe=De.fbo=se.createFramebuffer(ze,ze,!0,!1),Fe.colorAttachment.set(rt.texture)}se.bindFramebuffer.set(Fe.framebuffer),se.viewport.set([0,0,ze,ze]),$.useProgram("hillshadePrepare").draw(se,ye.TRIANGLES,ne,ae,le,Lt.disabled,eo(De.tileID,Ie),null,null,ie.id,$.rasterBoundsBuffer,$.quadTriangleIndexBuffer,$.rasterBoundsSegments),De.needsHillshadePrepare=!1}})(y,b,E,T,N,Gt.disabled,X),I.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(j){const[$,Y,W]=y.stencilConfigForOverlapTwoPass(E);ao(y,b,T,W,$,N,X,!1,D),ao(y,b,T,W,Y,N,X,!0,D)}else{const[$,Y]=y.getStencilConfigForOverlapAndUpdateStencilID(E);ao(y,b,T,Y,$,N,X,!1,D)}}(e,n,l,u,m):d.c5(l)?function(y,b,T,E,z){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:D}=z,I=b.getSource(),j=y.style.projection.useSubdivision;if(I instanceof Ya)cn(y,b,T,E,null,!1,!1,I.tileCoords,I.flippedWindingOrder,D);else if(j){const[N,X,$]=y.stencilConfigForOverlapTwoPass(E);cn(y,b,T,$,N,!1,!0,Qn,!1,D),cn(y,b,T,$,X,!0,!0,Qn,!1,D)}else{const[N,X]=y.getStencilConfigForOverlapAndUpdateStencilID(E);cn(y,b,T,X,N,!1,!0,Qn,!1,D)}}(e,n,l,u,m):d.c6(l)?function(y,b,T,E,z){const D=T.paint.get("background-color"),I=T.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:j}=z,N=y.context,X=N.gl,$=y.style.projection,Y=y.transform,W=Y.tileSize,ie=T.paint.get("background-pattern");if(y.isPatternMissing(ie))return;const ne=!ie&&D.a===1&&I===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ne)return;const ae=Gt.disabled,le=y.getDepthModeForSublayer(0,ne==="opaque"?Dt.ReadWrite:Dt.ReadOnly),se=y.colorModeForRenderPass(),ye=y.useProgram(ie?"backgroundPattern":"background"),we=E||pe(Y,{tileSize:W,terrain:y.style.map.terrain});ie&&(N.activeTexture.set(X.TEXTURE0),y.imageManager.bind(y.context));const De=T.getCrossfadeParameters();for(const Ie of we){const ze=Y.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Ye=ie?Rc(I,y,ie,{tileID:Ie,tileSize:W},De):yr(I,D),$e=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie),Fe=$.getMeshFromTileID(N,Ie.canonical,!1,!0,"raster");ye.draw(N,X.TRIANGLES,le,ae,se,Lt.backCCW,Ye,$e,ze,T.id,Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}}(e,0,l,u,m):d.c7(l)&&function(y,b,T,E){const{isRenderingGlobe:z}=E,D=y.context,I=T.implementation,j=y.style.projection,N=y.transform,X=N.getProjectionDataForCustomLayer(z),$={farZ:N.farZ,nearZ:N.nearZ,fov:N.fov*Math.PI/180,modelViewProjectionMatrix:N.modelViewProjectionMatrix,projectionMatrix:N.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:X},Y=I.renderingMode?I.renderingMode:"2d";if(y.renderPass==="offscreen"){const W=I.prerender;W&&(y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),W.call(I,D.gl,$),D.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),D.setStencilMode(Gt.disabled);const W=Y==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Dt.ReadOnly);D.setDepthMode(W),I.render(D.gl,$),D.setDirty(),y.setBaseState(),D.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!n||!l}useProgram(e,n,l=!1){this.cache=this.cache||{};const u=!!this.style.map.terrain,m=this.style.projection,y=e+(n?n.cacheKey:"")+`/${l?Jr:m.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(u?"/terrain":"");return this.cache[y]||(this.cache[y]=new md(this.context,_r[e],n,kc[e],this._showOverdrawInspector,u,l?_r.projectionMercator:m.shaderPreludeCode,l?Zt:m.shaderDefine)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new pi(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function Gc(f,e){let n,l=!1,u=null,m=null;const y=()=>{u=null,l&&(f.apply(m,n),u=setTimeout(y,e),l=!1)};return(...b)=>(l=!0,m=this,n=b,u||y(),u)}class xr{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let m=window.location.hash.replace(u,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Gc(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,u),y=Math.round(n.lng*m)/m,b=Math.round(n.lat*m)/m,T=this._map.getBearing(),E=this._map.getPitch();let z="";if(z+=e?`/${y}/${b}/${l}`:`${l}/${b}/${y}`,(T||E)&&(z+="/"+Math.round(10*T)/10),E&&(z+=`/${Math.round(E)}`),this._hashName){const D=this._hashName;let I=!1;const j=window.location.hash.slice(1).split("&").map(N=>{const X=N.split("=")[0];return X===D?(I=!0,`${X}=${z}`):N}).filter(N=>N);return I||j.push(`${D}=${z}`),`#${j.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.Q(+e[2],+e[1])}catch{return!1}const n=+e[0],l=+(e[3]||0),u=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&u>=this._map.getMinPitch()&&u<=this._map.getMaxPitch()}}const so={linearity:.3,easing:d.c8(0,0,.3,1)},$o=d.e({deceleration:2500,maxSpeed:1400},so),Fu=d.e({deceleration:20,maxSpeed:1400},so),oo=d.e({deceleration:1e3,maxSpeed:360},so),Xo=d.e({deceleration:1e3,maxSpeed:90},so),Gl=d.e({deceleration:1e3,maxSpeed:360},so);class Yo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ut.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=ut.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,n.roll+=m.rollDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const m=lo(n.pan.mag(),l,d.e({},$o,e||{})),y=n.pan.mult(m.amount/n.pan.mag()),b=this._map.cameraHelper.handlePanInertia(y,this._map.transform);u.center=b.easingCenter,u.offset=b.easingOffset,br(u,m)}if(n.zoom){const m=lo(n.zoom,l,Fu);u.zoom=this._map.transform.zoom+m.amount,br(u,m)}if(n.bearing){const m=lo(n.bearing,l,oo);u.bearing=this._map.transform.bearing+d.ad(m.amount,-179,179),br(u,m)}if(n.pitch){const m=lo(n.pitch,l,Xo);u.pitch=this._map.transform.pitch+m.amount,br(u,m)}if(n.roll){const m=lo(n.roll,l,Gl);u.roll=this._map.transform.roll+d.ad(m.amount,-179,179),br(u,m)}if(u.zoom||u.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;u.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function br(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function lo(f,e,n){const{maxSpeed:l,linearity:u,deceleration:m}=n,y=d.ad(f*u/(e/1e3),-l,l),b=Math.abs(y)/(m*u);return{easing:n.easing,duration:1e3*b,amount:y*(b/2)}}class Oi extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l,u={}){const m=xe.mousePos(n.getCanvas(),l),y=n.unproject(m);super(e,d.e({point:m,lngLat:y,originalEvent:l},u)),this._defaultPrevented=!1,this.target=n}}class vn extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){const u=e==="touchend"?l.changedTouches:l.touches,m=xe.touchPos(n.getCanvasContainer(),u),y=m.map(T=>n.unproject(T)),b=m.reduce((T,E,z,D)=>T.add(E.div(D.length)),new d.P(0,0));super(e,{points:m,point:b,lngLats:y,lngLat:n.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class qc extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class ma{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new qc(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Oi(e.type,this._map,e))}mouseup(e){this._map.fire(new Oi(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Oi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Oi(e.type,this._map,e))}mouseover(e){this._map.fire(new Oi(e.type,this._map,e))}mouseout(e){this._map.fire(new Oi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new vn(e.type,this._map,e))}touchmove(e){this._map.fire(new vn(e.type,this._map,e))}touchend(e){this._map.fire(new vn(e.type,this._map,e))}touchcancel(e){this._map.fire(new vn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hs{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Oi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Oi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Oi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class Hc{constructor(e,n){this._map=e,this._tr=new Qo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(xe.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=xe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(u.x,l.x),y=Math.max(u.x,l.x),b=Math.min(u.y,l.y),T=Math.max(u.y,l.y);xe.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=y-m+"px",this._box.style.height=T-b+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const l=this._startPos,u=n;if(this.reset(),xe.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(xe.remove(this._box),this._box=null),xe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new d.l(e,{originalEvent:n}))}}function ql(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const n={};for(let l=0;l<f.length;l++)n[f[l].identifier]=e[l];return n}class tr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const m=new d.P(0,0);for(const y of u)m._add(y);return m.div(u.length)}(n),this.touches=ql(l,n)))}touchmove(e,n,l){if(this.aborted||!this.centroid)return;const u=ql(l,n);for(const m in this.touches){const y=u[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,n,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Za{constructor(e){this.singleTap=new tr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,l){this.singleTap.touchstart(e,n,l)}touchmove(e,n,l){this.singleTap.touchmove(e,n,l)}touchend(e,n,l){const u=this.singleTap.touchend(e,n,l);if(u){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(u)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class ir{constructor(e){this._tr=new Qo(e),this._zoomIn=new Za({numTouches:1,numTaps:2}),this._zoomOut=new Za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,l){this._zoomIn.touchstart(e,n,l),this._zoomOut.touchstart(e,n,l)}touchmove(e,n,l){this._zoomIn.touchmove(e,n,l),this._zoomOut.touchmove(e,n,l)}touchend(e,n,l){const u=this._zoomIn.touchend(e,n,l),m=this._zoomOut.touchend(e,n,l),y=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(u)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sa{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=Array.isArray(n)?n[0]:n;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&xe.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ke={0:1,2:2};class Ma{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=xe.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,l){const u=Ke[l];return n.buttons===void 0||(n.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return xe.mouseButton(e)===this._eventButton}}class hn{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Hl{constructor(e=new Ma({checkCorrectEvent:()=>!0}),n=new hn){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,l){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}const Ps=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}};class $l{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,l){return this._calculateTransform(e,n,l)}touchmove(e,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,l){this._calculateTransform(e,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,l){l.length>0&&(this._active=!0);const u=ql(l,n),m=new d.P(0,0),y=new d.P(0,0);let b=0;for(const E in u){const z=u[E],D=this._touches[E];D&&(m._add(z),y._add(z.sub(D)),b++,u[E]=z)}if(this._touches=u,this._shouldBePrevented(b)||!y.mag())return;const T=y.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $c{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,m]=this._firstTwoTouches,y=yt(l,n,u),b=yt(l,n,m);if(!y||!b)return;const T=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],T,e)}touchend(e,n,l){if(!this._firstTwoTouches)return;const[u,m]=this._firstTwoTouches,y=yt(l,n,u),b=yt(l,n,m);y&&b||(this._active&&xe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function yt(f,e,n){for(let l=0;l<f.length;l++)if(f[l].identifier===n)return e[l]}function Ko(f,e){return Math.log(f/e)/Math.LN2}class Wo extends $c{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ko(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ko(this._distance,l),pinchAround:n}}}function Ds(f,e){return 180*f.angleWith(e)/Math.PI}class Xc extends $c{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ds(this._vector,u),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,l=Ds(e,this._startVector);return Math.abs(l)<n}}function Is(f){return Math.abs(f.y)>Math.abs(f.x)}class Rs extends $c{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,l){super.touchstart(e,n,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Is(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,m=n.mag()>=2;if(!u&&!m)return;if(!u||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return Is(e)&&Is(n)&&y}}const ju={panStep:100,bearingStep:15,pitchStep:10};class Yc{constructor(e){this._tr=new Qo(e);const n=ju;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,l=0,u=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:b=>{const T=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:yd,zoom:n?Math.round(T.zoom)+n*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yd(f){return f*(2-f)}const Qc=4.000244140625;class ks{constructor(e,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Qo(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=ut.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Qc==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=xe.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.Q.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Qc?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom!="number"?e.scale:d.aH(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,d.aa(E*T))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,u=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&u){const b=ut.now()-this._lastWheelEventTime,T=Math.min((b+5)/200,1),E=u(T);m=d.B.number(l,n,E),T<1?this._frameId||(this._frameId=!0):y=!0}else m=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=d.ca;if(this._prevEase){const l=this._prevEase,u=(ut.now()-l.start)/l.duration,m=l.easing(u+.01)-l.easing(u),y=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-y*y);n=d.c8(y,b,.25,1)}return this._prevEase={start:ut.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kc{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wr{constructor(e){this._tr=new Qo(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ei{constructor(){this._tap=new Za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,l){if(!this._swipePoint)if(this._tapTime){const u=n[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(u)<30;m&&y?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,n,l)}touchmove(e,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=n[0],m=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,n,l)}touchend(e,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,n,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nr{constructor(e,n,l){this._el=e,this._mousePan=n,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jt{constructor(e,n,l,u){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ui{constructor(e,n,l,u){this._el=e,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class tn{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=xe.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=n,this._container.appendChild(u);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(xe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ls=f=>f.zoom||f.drag||f.roll||f.pitch||f.rotate;class Jo extends d.l{}function On(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta||f.rollDelta}class co{constructor(e,n){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,m)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=u.type==="renderFrame"?void 0:u,b={needsRenderFrame:!1},T={},E={},z=u.touches,D=z?this._getMapTouches(z):void 0,I=D?xe.touchPos(this._map.getCanvas(),D):xe.mousePos(this._map.getCanvas(),u);for(const{handlerName:X,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let W;this._blockedByActive(E,Y,X)?$.reset():$[m||u.type]&&(W=$[m||u.type](u,I,D),this.mergeHandlerResult(b,T,W,X,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||$.isActive())&&(E[X]=$)}const j={};for(const X in this._previousActiveHandlers)E[X]||(j[X]=y);this._previousActiveHandlers=E,(Object.keys(j).length||On(b))&&(this._changes.push([b,T,j]),this._triggerRenderFrame()),(Object.keys(E).length||On(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yo(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,m,y]of this._listeners)xe.addEventListener(u,m,u===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,l]of this._listeners)xe.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new ma(n,e));const u=n.boxZoom=new Hc(n,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const m=n.cooperativeGestures=new tn(n,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new ir(n),b=new wr(n);n.doubleClickZoom=new Kc(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const T=new Ei;this._add("tapDragZoom",T);const E=n.touchPitch=new Rs(n);this._add("touchPitch",E),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const z=()=>n.project(n.getCenter()),D=function({enable:ne,clickTolerance:ae,aroundCenter:le=!0,minPixelCenterThreshold:se=100,rotateDegreesPerPixelMoved:ye=.8},we){const De=new Ma({checkCorrectEvent:Ie=>xe.mouseButton(Ie)===0&&Ie.ctrlKey||xe.mouseButton(Ie)===2&&!Ie.ctrlKey});return new Sa({clickTolerance:ae,move:(Ie,ze)=>{const Ye=we();if(le&&Math.abs(Ye.y-Ie.y)>se)return{bearingDelta:d.c9(new d.P(Ie.x,ze.y),ze,Ye)};let $e=(ze.x-Ie.x)*ye;return le&&ze.y<Ye.y&&($e=-$e),{bearingDelta:$e}},moveStateManager:De,enable:ne,assignEvents:Ps})}(e,z),I=function({enable:ne,clickTolerance:ae,pitchDegreesPerPixelMoved:le=-.5}){const se=new Ma({checkCorrectEvent:ye=>xe.mouseButton(ye)===0&&ye.ctrlKey||xe.mouseButton(ye)===2});return new Sa({clickTolerance:ae,move:(ye,we)=>({pitchDelta:(we.y-ye.y)*le}),moveStateManager:se,enable:ne,assignEvents:Ps})}(e),j=function({enable:ne,clickTolerance:ae,rollDegreesPerPixelMoved:le=.3},se){const ye=new Ma({checkCorrectEvent:we=>xe.mouseButton(we)===2&&we.ctrlKey});return new Sa({clickTolerance:ae,move:(we,De)=>{const Ie=se();let ze=(De.x-we.x)*le;return De.y<Ie.y&&(ze=-ze),{rollDelta:ze}},moveStateManager:ye,enable:ne,assignEvents:Ps})}(e,z);n.dragRotate=new jt(e,D,I,j),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const N=function({enable:ne,clickTolerance:ae}){const le=new Ma({checkCorrectEvent:se=>xe.mouseButton(se)===0&&!se.ctrlKey});return new Sa({clickTolerance:ae,move:(se,ye)=>({around:ye,panDelta:ye.sub(se)}),activateOnStart:!0,moveStateManager:le,enable:ne,assignEvents:Ps})}(e),X=new $l(e,n);n.dragPan=new nr(l,N,X),this._add("mousePan",N),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const $=new Xc,Y=new Wo;n.touchZoomRotate=new ui(l,Y,$,T),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const W=n.scrollZoom=new ks(n,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const ie=n.keyboard=new Yc(n);this._add("keyboard",ie),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new hs(n))}_add(e,n,l){this._handlers.push({handlerName:e,handler:n,allowed:l}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ls(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,l){for(const u in e)if(u!==l&&(!n||n.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const l of e)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(e,n,l,u,m){if(!l)return;d.e(e,l);const y={handlerName:u,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(n.zoom=y),l.panDelta!==void 0&&(n.drag=y),l.rollDelta!==void 0&&(n.roll=y),l.pitchDelta!==void 0&&(n.pitch=y),l.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},l={};for(const[u,m,y]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.rollDelta&&(e.rollDelta=(e.rollDelta||0)+u.rollDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(n,m),d.e(l,y);this._updateMapTransform(e,n,l),this._changes=[]}_updateMapTransform(e,n,l){const u=this._map,m=u._getTransformForUpdate(),y=u.terrain;if(!(On(e)||y&&this._terrainMovement))return this._fireEvents(n,l,!0);u._stop(!0);let{panDelta:b,zoomDelta:T,bearingDelta:E,pitchDelta:z,rollDelta:D,around:I,pinchAround:j}=e;j!==void 0&&(I=j),I=I||u.transform.centerPoint,y&&!m.isPointOnMapSurface(I)&&(I=m.centerPoint);const N={panDelta:b,zoomDelta:T,rollDelta:D,pitchDelta:z,bearingDelta:E,around:I};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(I)&&(I=m.centerPoint);const X=I.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(b?I.sub(b):I);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,m),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan(N,m,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(N,m,X))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,m),this._map.cameraHelper.handleMapControlsPan(N,m,X)),u._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,l,!0)}_fireEvents(e,n,l){const u=Ls(this._eventsInProgress),m=Ls(e),y={};for(const D in e){const{originalEvent:I}=e[D];this._eventsInProgress[D]||(y[`${D}start`]=I),this._eventsInProgress[D]=e[D]}!u&&m&&this._fireEvent("movestart",m.originalEvent);for(const D in y)this._fireEvent(D,y[D]);m&&this._fireEvent("move",m.originalEvent);for(const D in e){const{originalEvent:I}=e[D];this._fireEvent(D,I)}const b={};let T;for(const D in this._eventsInProgress){const{handlerName:I,originalEvent:j}=this._eventsInProgress[D];this._handlersById[I].isActive()||(delete this._eventsInProgress[D],T=n[I]||j,b[`${D}end`]=T)}for(const D in b)this._fireEvent(D,b[D]);const E=Ls(this._eventsInProgress),z=(u||m)&&!E;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const D=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&D.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(D)}if(l&&z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!D||!D.essential&&ut.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:T})),I(this._map.getBearing())&&this._map.resetNorth()):(I(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new d.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Jo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ct extends d.E{constructor(e,n,l){super(),this._renderFrameCallback=()=>{const u=Math.min((ut.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new d.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},n),l)}panTo(e,n,l){return this.easeTo(d.e({center:e},n),l)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,l){return this.easeTo(d.e({zoom:e},n),l)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",n)).fire(new d.l("move",n)).fire(new d.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,l){return this.easeTo(d.e({bearing:e},n),l)}resetNorth(e,n){return this.rotateTo(0,d.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=Li.convert(e).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,n)}_cameraForBoxAndBearing(e,n,l,u){const m={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const E=u.padding;u.padding={top:E,bottom:E,right:E,left:E}}const y=d.e(m,u.padding);u.padding=y;const b=this.transform,T=new Li(e,n);return this.cameraHelper.cameraForBoxAndBearing(u,y,T,l,b)}fitBounds(e,n,l){return this._fitInternal(this.cameraForBounds(e,n),n,l)}fitScreenCoordinates(e,n,l,u,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(n)),l,u),u,m)}_fitInternal(e,n,l){return e?(delete(n=d.e(e,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(e,n){this.stop();const l=this._getTransformForUpdate();let u=!1,m=!1,y=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==b;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(u=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",n)).fire(new d.l("move",n)),T&&this.fire(new d.l("zoomstart",n)).fire(new d.l("zoom",n)).fire(new d.l("zoomend",n)),u&&this.fire(new d.l("rotatestart",n)).fire(new d.l("rotate",n)).fire(new d.l("rotateend",n)),m&&this.fire(new d.l("pitchstart",n)).fire(new d.l("pitch",n)).fire(new d.l("pitchend",n)),y&&this.fire(new d.l("rollstart",n)).fire(new d.l("roll",n)).fire(new d.l("rollend",n)),this.fire(new d.l("moveend",n))}calculateCameraOptionsFromTo(e,n,l,u=0){const m=d.$.fromLngLat(e,n),y=d.$.fromLngLat(l,u),b=y.x-m.x,T=y.y-m.y,E=y.z-m.z,z=Math.hypot(b,T,E);if(z===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(b,T),I=d.aa(this.transform.cameraToCenterDistance/z/this.transform.tileSize),j=180*Math.atan2(b,-T)/Math.PI;let N=180*Math.acos(D/z)/Math.PI;return N=E<0?90-N:90+N,{center:y.toLngLat(),elevation:u,zoom:I,pitch:N,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,l,u,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,n,l,u);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:u,roll:m}}easeTo(e,n){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.ca},e)).animate===!1||!e.essential&&ut.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),u=this.getBearing(),m=l.pitch,y=l.roll,b="bearing"in e?this._normalizeBearing(e.bearing,u):u,T="pitch"in e?+e.pitch:m,E="roll"in e?this._normalizeBearing(e.roll,y):y,z="padding"in e?e.padding:l.padding,D=d.P.convert(e.offset);let I,j;e.around&&(I=d.Q.convert(e.around),j=l.locationToScreenPoint(I));const N={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:T,roll:E,padding:z,around:I,aroundPoint:j,offsetAsPoint:D,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||u!==b,this._pitching=this._pitching||T!==m,this._rolling=this._rolling||E!==y,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||X.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,N),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease($=>{X.easeFunc($),this.terrain&&!e.freezeElevation&&this._updateElevation($),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},$=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,$)},e),this}_prepareEase(e,n,l={}){this._moving=!0,n||l.moving||this.fire(new d.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(n-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(d.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const n=e.getCameraLngLat(),l=e.getCameraAltitude(),u=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(l<u){const m=this.calculateCameraOptionsFromTo(n,u,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(n.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&n.push(u=>this.transformCameraUpdate(u)),!n.length)return;const l=e.clone();for(const u of n){const m=l.clone(),{center:y,zoom:b,roll:T,pitch:E,bearing:z,elevation:D}=u(m);y&&m.setCenter(y),D!==void 0&&m.setElevation(D),b!==void 0&&m.setZoom(b),T!==void 0&&m.setRoll(T),E!==void 0&&m.setPitch(E),z!==void 0&&m.setBearing(z),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,u=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",e)),u&&this.fire(new d.l("rotateend",e)),m&&this.fire(new d.l("pitchend",e)),y&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,n){if(!e.essential&&ut.prefersReducedMotion){const ze=d.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ze,n)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.ca},e);const l=this._getTransformForUpdate(),u=l.bearing,m=l.pitch,y=l.roll,b=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,u):u,E="pitch"in e?+e.pitch:m,z="roll"in e?this._normalizeBearing(e.roll,y):y,D="padding"in e?e.padding:l.padding,I=d.P.convert(e.offset);let j=l.centerPoint.add(I);const N=l.screenPointToLocation(j),X=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:E,roll:z,padding:D,locationAtOffset:N,offsetAsPoint:I,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let $=e.curve;const Y=Math.max(l.width,l.height),W=Y/X.scaleOfZoom,ie=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&($=Math.sqrt(Y/X.scaleOfMinZoom/ie*2));const ne=$*$;function ae(ze){const Ye=(W*W-Y*Y+(ze?-1:1)*ne*ne*ie*ie)/(2*(ze?W:Y)*ne*ie);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function le(ze){return(Math.exp(ze)-Math.exp(-ze))/2}function se(ze){return(Math.exp(ze)+Math.exp(-ze))/2}const ye=ae(!1);let we=function(ze){return se(ye)/se(ye+$*ze)},De=function(ze){return Y*((se(ye)*(le(Ye=ye+$*ze)/se(Ye))-le(ye))/ne)/ie;var Ye},Ie=(ae(!0)-ye)/$;if(Math.abs(ie)<2e-6||!isFinite(Ie)){if(Math.abs(Y-W)<1e-6)return this.easeTo(e,n);const ze=W<Y?-1:1;Ie=Math.abs(Math.log(W/Y))/$,De=()=>0,we=Ye=>Math.exp(ze*$*Ye)}return e.duration="duration"in e?+e.duration:1e3*Ie/("screenSpeed"in e?+e.screenSpeed/$:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=u!==T,this._pitching=E!==m,this._rolling=z!==y,this._padding=!l.isPaddingEqual(D),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease(ze=>{const Ye=ze*Ie,$e=1/we(Ye),Fe=De(Ye);this._rotating&&l.setBearing(d.B.number(u,T,ze)),this._pitching&&l.setPitch(d.B.number(m,E,ze)),this._rolling&&l.setRoll(d.B.number(y,z,ze)),this._padding&&(l.interpolatePadding(b,D,ze),j=l.centerPoint.add(I)),X.easeFunc(ze,$e,Fe,j),this.terrain&&!e.freezeElevation&&this._updateElevation(ze),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,n)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,n,l){l.animate===!1||l.duration===0?(e(1),n()):(this._easeStart=ut.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=d.aK(e,-180,180);const l=Math.abs(e-n);return Math.abs(e-360-n)<l&&(e-=360),Math.abs(e+360-n)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.Q.convert(e),this.transform.tileZoom):null}}const ft={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Xl{constructor(e=ft){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=xe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=xe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){xe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,n){const l=this._map._getUIString(`AttributionControl.${n}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const m=n[u];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,m)=>u.length-m.length),e=e.filter((u,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=xe.sanitize(l),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fi{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=xe.create("div","maplibregl-ctrl");const n=xe.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){xe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var na=d.aC([{name:"a_pos3d",type:"Int16",components:3}]);class Nu extends d.E{constructor(e){super(),this._lastTilesetChange=ut.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const l={};for(const u of pe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.terrainRttPosMatrix32f=new Float64Array(16),d.bN(u.terrainRttPosMatrix32f,0,d.Z,d.Z,0,0,1),this._tiles[u.key]=new gs(u,this.tileSize),this._lastTilesetChange=ut.now());for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const n in this._tiles){const l=this._tiles[n];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID,m=e.clone(),y=d.b1();if(u.canonical.equals(e.canonical))d.bN(y,0,d.Z,d.Z,0,0,1);else if(u.canonical.isChildOf(e.canonical)){const b=u.canonical.z-e.canonical.z,T=u.canonical.x-(u.canonical.x>>b<<b),E=u.canonical.y-(u.canonical.y>>b<<b),z=d.Z>>b;d.bN(y,0,z,z,0,0,1),d.L(y,y,[-T*z,-E*z,0])}else{if(!e.canonical.isChildOf(u.canonical))continue;{const b=e.canonical.z-u.canonical.z,T=e.canonical.x-(e.canonical.x>>b<<b),E=e.canonical.y-(e.canonical.y>>b<<b),z=d.Z>>b;d.bN(y,0,d.Z,d.Z,0,0,1),d.L(y,y,[T*z,E*z,0]),d.M(y,y,[1/2**b,1/2**b,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),n[l]=m}return n}getSourceTile(e,n){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&n)for(;u>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(u--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class Tr{constructor(e,n,l){this._meshCache={},this.painter=e,this.sourceCache=new Nu(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,l,u=d.Z){var m;if(!(n>=0&&n<u&&l>=0&&l<u))return 0;const y=this.getTerrainData(e),b=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const T=d.cb([],[n/u*d.Z,l/u*d.Z],y.u_terrain_matrix),E=[T[0]*b.dim,T[1]*b.dim],z=Math.floor(E[0]),D=Math.floor(E[1]),I=E[0]-z,j=E[1]-D;return b.get(z,D)*(1-I)*(1-j)+b.get(z+1,D)*I*(1-j)+b.get(z,D+1)*(1-I)*j+b.get(z+1,D+1)*I*j}getElevationForLngLatZoom(e,n){if(!d.cc(n,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(l,u%d.Z,m%d.Z,d.Z)}getElevation(e,n,l,u=d.Z){return this.getDEMElevation(e,n,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new pi(u,m,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new pi(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.as([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const u=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new pi(u,n.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),n.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?m=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),b=e.canonical.y-(e.canonical.y>>m<<m),T=d.cd(new Float64Array(16),[1/(d.Z<<m),1/(d.Z<<m),0]);d.L(T,T,[y*d.Z,b*d.Z,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,l=n.width/devicePixelRatio,u=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new pi(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new pi(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)n[y+0]=255&b,n[y+1]=255&m,n[y+2]=b>>8<<4|m>>8,n[y+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),u=new pi(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,u=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(m,b-y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const T=n[0]+(n[2]>>4<<8),E=n[1]+((15&n[2])<<8),z=this.coordsIndex[255-n[3]],D=z&&this.sourceCache.getTileByID(z);if(!D)return null;const I=this._coordsTextureSize,j=(1<<D.tileID.canonical.z)*I;return new d.$((D.tileID.canonical.x*I+T)/j+D.tileID.wrap,(D.tileID.canonical.y*I+E)/j,this.getElevation(D.tileID,T,E,I))}depthAtPoint(e){const n=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,u=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${u?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const b=this.painter.context,T=new d.ce,E=new d.aG,z=this.meshSize,D=d.Z/z,I=z*z;for(let se=0;se<=z;se++)for(let ye=0;ye<=z;ye++)T.emplaceBack(ye*D,se*D,0);for(let se=0;se<I;se+=z+1)for(let ye=0;ye<z;ye++)E.emplaceBack(ye+se,z+ye+se+1,z+ye+se+2),E.emplaceBack(ye+se,z+ye+se+2,ye+se+1);const j=T.length,N=j+(z+1),X=(z+1)*z,$=u?d.b8:0,Y=u?0:1,W=m?d.b9:d.Z,ie=m?0:1;for(let se=0;se<=z;se++)T.emplaceBack(se*D,$,Y);for(let se=0;se<=z;se++)T.emplaceBack(se*D,W,ie);for(let se=0;se<z;se++)E.emplaceBack(X+se,N+se,N+se+1),E.emplaceBack(X+se,N+se+1,X+se+1),E.emplaceBack(0+se,j+se+1,j+se),E.emplaceBack(0+se,0+se+1,j+se+1);const ne=T.length,ae=ne+2*(z+1);for(const se of[0,1])for(let ye=0;ye<=z;ye++)for(const we of[0,1])T.emplaceBack(se*d.Z,ye*D,we);for(let se=0;se<2*z;se+=2)E.emplaceBack(ne+se,ne+se+1,ne+se+3),E.emplaceBack(ne+se,ne+se+3,ne+se+2),E.emplaceBack(ae+se,ae+se+3,ae+se+1),E.emplaceBack(ae+se,ae+se+2,ae+se+3);const le=new ua(b.createVertexBuffer(T,na.members),b.createIndexBuffer(E),d.aF.simpleSegment(0,0,T.length,E.length));return this._meshCache[y]=le,le}getMeshFrameDelta(e){return 2*Math.PI*d.bq/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,n){const l=d.$.fromLngLat(e.wrap()),u=(1<<n)*d.Z,m=l.x*u,y=l.y*u,b=Math.floor(m/d.Z),T=Math.floor(y/d.Z);return{tileID:new d.Y(n,0,n,b,T),mercatorX:m,mercatorY:y}}}class vd{constructor(e,n,l){this._context=e,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new pi(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:e,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const ar={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ai{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new vd(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(n)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const m of u){const y=this.terrain.sourceCache.getTerrainCoords(m);for(const b in y)this._coordsAscending[l][b]||(this._coordsAscending[l][b]=[]),this._coordsAscending[l][b].push(y[b])}}this._coordsAscendingStr={};for(const l of e._order){const u=e._layers[l],m=u.source;if(ar[u.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsAscendingStr){const m=this._coordsAscendingStr[u][l.tileID.key];m&&m!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),u=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ar[u]&&(this._prevType&&ar[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(ar[this._prevType]||ar[u]&&y){this._prevType=u;const b=this._stacks.length-1,T=this._stacks[b]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(ro(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[b]){const D=this.pool.getObjectForId(E.rtt[b].id);if(D.stamp===E.rtt[b].stamp){this.pool.useObject(D);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),E.rtt[b]={id:z.id,stamp:z.stamp},m.context.bindFramebuffer.set(z.fbo.framebuffer),m.context.clear({color:d.b6.transparent,stencil:0}),m.currentStencilSource=void 0;for(let D=0;D<T.length;D++){const I=m.style._layers[T[D]],j=I.source?this._coordsAscending[I.source][E.tileID.key]:[E.tileID];m.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),m._renderTileClippingMasks(I,j,!0),m.renderLayer(m,m.style.sourceCaches[I.source],I,j,l),I.source&&(E.rttCoords[I.source]=this._coordsAscendingStr[I.source][E.tileID.key])}}return ro(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),ar[u]}return!1}}const Gi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},_a=ot,zi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ft,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},uo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ho{constructor(e,n,l=!1){this.mousedown=m=>{this.startMove(m,xe.mousePos(this.element,m)),xe.addEventListener(window,"mousemove",this.mousemove),xe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,xe.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xe.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),xe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),xe.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=xe.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const u=new Hl;this._rotatePitchHanlder=new Sa({clickTolerance:3,move:(m,y)=>{const b=n.getBoundingClientRect(),T=new d.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:d.c9(new d.P(m.x,y.y),y,T),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:u,enable:!0,assignEvents:()=>{}}),this.map=e,xe.addEventListener(n,"mousedown",this.mousedown),xe.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),xe.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHanlder.dragStart(e,n),xe.disableDrag()}move(e,n){const l=this.map,{bearingDelta:u,pitchDelta:m}=this._rotatePitchHanlder.dragMove(e,n)||{};u&&l.setBearing(l.getBearing()+u),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;xe.removeEventListener(e,"mousedown",this.mousedown),xe.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),xe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),xe.removeEventListener(window,"touchend",this.touchend),xe.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){xe.enableDrag(),xe.removeEventListener(window,"mousemove",this.mousemove),xe.removeEventListener(window,"mouseup",this.mouseup),xe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),xe.removeEventListener(window,"touchend",this.touchend)}}let rr;function el(f,e,n){const l=new d.Q(f.lng,f.lat);if(f=new d.Q(f.lng,f.lat),e){const u=new d.Q(f.lng-360,f.lat),m=new d.Q(f.lng+360,f.lat),y=n.locationToScreenPoint(f).distSqr(e);n.locationToScreenPoint(u).distSqr(e)<y?f=u:n.locationToScreenPoint(m).distSqr(e)<y&&(f=m)}for(;Math.abs(f.lng-n.center.lng)>180;){const u=n.locationToScreenPoint(f);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;f.lng>n.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(f))?f:l}const ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fo(f,e,n){const l=f.classList;for(const u in ga)l.remove(`maplibregl-${n}-anchor-${u}`);l.add(`maplibregl-${n}-anchor-${e}`)}class po extends d.E{constructor(e){if(super(),this._onKeyPress=n=>{const l=n.code,u=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=n=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?el(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),xe.setTransform(this._element,`${ga[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${m}`),ut.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe.create("div");const n=xe.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${u}px`),n.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const m=xe.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=xe.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=xe.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of T){const W=xe.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",Y.rx),W.setAttributeNS(null,"ry",Y.ry),b.appendChild(W)}const E=xe.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const z=xe.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(z);const D=xe.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const I=xe.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(I);const j=xe.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const N=xe.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=xe.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const $=xe.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),N.appendChild(X),N.appendChild($),y.appendChild(b),y.appendChild(E),y.appendChild(D),y.appendChild(j),y.appendChild(N),n.appendChild(y),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(n),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),fo(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),xe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,l;if(!(!((n=this._map)===null||n===void 0)&&n.terrain)){const D=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==D&&(this._element.style.opacity=D))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,m=u.terrain.depthAtPoint(this._pos),y=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,y)-m<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/u.transform.pixelsPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*b,E=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),z=u.transform.lngLatToCameraDepth(this._lngLat,y+T)-E>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Ql={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mo=0,Bs=!1;const Wc={maxWidth:100,unit:"metric"};function Kl(f,e,n){const l=n&&n.maxWidth||100,u=f._container.clientHeight/2,m=f._container.clientWidth/2,y=f.unproject([m-l/2,u]),b=f.unproject([m+l/2,u]),T=Math.round(f.project(b).x-f.project(y).x),E=Math.min(l,T,f._container.clientWidth),z=y.distanceTo(b);if(n&&n.unit==="imperial"){const D=3.2808*z;D>5280?Os(e,E,D/5280,f._getUIString("ScaleControl.Miles")):Os(e,E,D,f._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Os(e,E,z/1852,f._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Os(e,E,z/1e3,f._getUIString("ScaleControl.Kilometers")):Os(e,E,z,f._getUIString("ScaleControl.Meters"))}function Os(f,e,n,l){const u=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(b),y*b}(n);f.style.width=e*(u/n)+"px",f.innerHTML=`${u}&nbsp;${l}`}const Wl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Jl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ec(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return ec(new d.P(0,0))}const Jc=ot;F.AJAXError=d.ci,F.Event=d.l,F.Evented=d.E,F.LngLat=d.Q,F.MercatorCoordinate=d.$,F.Point=d.P,F.addProtocol=d.cj,F.config=d.a,F.removeProtocol=d.ck,F.AttributionControl=Xl,F.BoxZoomHandler=Hc,F.CanvasSource=Po,F.CooperativeGesturesHandler=tn,F.DoubleClickZoomHandler=Kc,F.DragPanHandler=nr,F.DragRotateHandler=jt,F.EdgeInsets=yn,F.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){xe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=xe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);xe.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},F.GeoJSONSource=Ir,F.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new d.Q(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),m=d.e({bearing:u},this.options.fitBoundsOptions),y=Li.fromLngLat(n,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new d.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Bs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=xe.create("button","maplibregl-ctrl-geolocate",this._container),xe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new po({element:this._dotElement}),this._circleElement=xe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new po({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))})}},this.options=d.e({},Ql,f)}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(rr!==void 0&&!e)return rr;if(window.navigator.permissions===void 0)return rr=!!window.navigator.geolocation,rr;try{rr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rr=!!window.navigator.geolocation}return rr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),xe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mo=0,Bs=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),n=f.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),n=f.getNorthEast(),l=e.distanceTo(n),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mo--,Bs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mo++,mo>1?(f={maximumAge:6e5,timeout:0},Bs=!0):(f=this.options.positionOptions,Bs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},F.GlobeControl=class{constructor(){this._toggleProjection=()=>{var f;const e=(f=this._map.getProjection())===null||f===void 0?void 0:f.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var f;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((f=this._map.getProjection())===null||f===void 0?void 0:f.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=xe.create("button","maplibregl-ctrl-globe",this._container),xe.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){xe.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},F.Hash=xr,F.ImageSource=Ya,F.KeyboardHandler=Yc,F.LngLatBounds=Li,F.LogoControl=Fi,F.Map=class extends ct{constructor(f){var e,n;d.cf.mark(d.cg.create);const l=Object.assign(Object.assign(Object.assign({},zi),f),{canvasContextAttributes:Object.assign(Object.assign({},zi.canvasContextAttributes),f.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const u=new $n,m=new da;if(l.minZoom!==void 0&&u.setMinZoom(l.minZoom),l.maxZoom!==void 0&&u.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&u.setMinPitch(l.minPitch),l.maxPitch!==void 0&&u.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&u.setRenderWorldCopies(l.renderWorldCopies),super(u,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Yl,this._controls=[],this._mapId=d.a3(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Gi),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ki.addThrottleControl(()=>this.isMoving()),this._requestManager=new Vt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const T=Gc(E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())},50);this._resizeObserver=new ResizeObserver(E=>{b?T(E):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new co(this,l),this._hash=l.hash&&new xr(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((n=(e=l.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Xl(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Fi,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const b=d.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new d.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new d.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new d.l("sourcedataabort",b))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,n,l)}resize(f,e=!0){const[n,l]=this._containerDimensions(),u=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,u),this.painter.resize(n,l,u),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const b=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,b),this.painter.resize(n,l,b)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new d.l("movestart",f)).fire(new d.l("move",f))),this.fire(new d.l("resize",f)),m&&this.fire(new d.l("moveend",f)),this}_resizeTransform(f=!0){var e;const[n,l]=this._containerDimensions();this.transform.resize(n,l,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,l,f)}_getClampedPixelRatio(f,e){const{0:n,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),m=f*u,y=e*u;return Math.min(m>n?n/m:1,y>l?l/y:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Li.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.setMinZoom(f),this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.setMaxZoom(f),this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.setMinPitch(f),this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(f>=this.transform.minPitch)return this.transform.setMaxPitch(f),this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.setRenderWorldCopies(f),this._update()}project(f){return this.transform.locationToScreenPoint(d.Q.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.screenPointToLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,n){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:m=>{const y=e.filter(T=>this.getLayer(T)),b=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length?l||(l=!0,n.call(this,new Oi(f,this,m.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const b=e.filter(T=>this.getLayer(T));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?l=!0:l&&(l=!1,n.call(this,new Oi(f,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,n.call(this,new Oi(f,this,y.originalEvent)))}}}}{const l=u=>{const m=e.filter(b=>this.getLayer(b)),y=m.length!==0?this.queryRenderedFeatures(u.point,{layers:m}):[];y.length&&(u.features=y,n.call(this,u),delete u.features)};return{layers:e,listener:n,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,n){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const m=l[u];if(m.listener===n&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(u,1)}}}on(f,e,n){if(n===void 0)return super.on(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,n);this._saveDelegatedListener(f,u);for(const m in u.delegates)this.on(m,u.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(f,l,n)}}}once(f,e,n){if(n===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,n);for(const m in u.delegates){const y=u.delegates[m];u.delegates[m]=(...b)=>{this._removeDelegatedListener(f,l,n),y(...b)}}this._saveDelegatedListener(f,u);for(const m in u.delegates)this.once(m,u.delegates[m]);return this}off(f,e,n){return n===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let n;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")n=[d.P.convert(u)];else{const m=d.P.convert(u[0]),y=d.P.convert(u[1]);n=[m,new d.P(y.x,m.y),y,new d.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){var n,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const u=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new zl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,u):this.style.loadJSON(f,e,u),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const n=this._requestManager.transformRequest(f,"Style");d.j(n,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.k(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(n){d.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Tr(this.painter,e,f),this.painter.renderToTexture=new Ai(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==f.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const n=f[e]._tiles;for(const l in n){const u=n[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,n={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:D,data:I}=e,j=e;return this.style.addImage(f,{data:new d.R({width:z,height:D},new Uint8Array(I)),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E,sdf:u,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f),this}}{const{width:z,height:D,data:I}=ut.getImageData(e);this.style.addImage(f,{data:new d.R({width:z,height:D},I),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E,sdf:u,version:0})}}updateImage(f,e){const n=this.style.getImage(f);if(!n)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?ut.getImageData(e):e,{width:u,height:m,data:y}=l;if(u===void 0||m===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||m!==n.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||d.b(e));return n.data.replace(y,b),this.style.updateImage(f,n),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return Ki.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,n){return this.style.setLayerZoomRange(f,e,n),this._update(!0)}setFilter(f,e,n={}){return this.style.setFilter(f,e,n),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,n,l={}){return this.style.setPaintProperty(f,e,n,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,n,l={}){return this.style.setLayoutProperty(f,e,n,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,n,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,n=>{n||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(f,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=xe.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=xe.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const u=this._controlContainer=xe.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=xe.create("div",`maplibregl-ctrl-${y} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,n){this._canvas.width=Math.floor(n*f),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,f):this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f),!n){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Zc(n,this.transform),at.testSupport(n)}migrateProjection(f,e){super.migrateProjection(f,e),this.painter.transform=f,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){var e,n,l,u,m;const y=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,I=ut.now();this.style.zoomHistory.update(D,I);const j=new d.C(D,{now:I,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=j.crossFadingFactor();N===1&&N===this._crossFadingFactor||(T=!0,this._crossFadingFactor=N),this.style.update(j)}const E=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((u=this.style.projection)===null||u===void 0?void 0:u.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cf.mark(d.cg.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cf.mark(d.cg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ki.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),xe.remove(this._canvasContainer),xe.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cf.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ut.frame(this._frameRequest,f=>{d.cf.frame(f),this._frameRequest=null;try{this._render(f)}catch(e){if(!d.ch(e)&&!function(n){return n.message===jc}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return _a}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),this.style.setProjection(f),this._update(!0)}},F.MapMouseEvent=Oi,F.MapTouchEvent=vn,F.MapWheelEvent=qc,F.Marker=po,F.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},uo,f),this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),xe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),xe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=xe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ho(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){xe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const n=xe.create("button",f,this._container);return n.type="button",n.addEventListener("click",e),n}},F.Popup=class extends d.E{constructor(f){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&xe.remove(this._content),this._container&&(xe.remove(this._container),delete this._container),this._closeButton&&this._closeButton.removeEventListener("click",this._onClose),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=xe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=xe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?el(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const m=ec(this.options.offset);if(!u){const b=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=l.y+m.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<b/2?E.push("left"):l.x>this._map.transform.width-b/2&&E.push("right"),u=E.length===0?"bottom":E.join("-")}let y=l.add(m[u]);this.options.subpixelPositioning||(y=y.round()),xe.setTransform(this._container,`${ga[u]} translate(${y.x}px,${y.y}px)`),fo(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Wl),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.Q.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=f;l=n.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=xe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=xe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Jl);f&&f.focus()}},F.RasterDEMTileSource=fr,F.RasterTileSource=Da,F.ScaleControl=class{constructor(f){this._onMove=()=>{Kl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Kl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Wc),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){xe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},F.ScrollZoomHandler=ks,F.Style=zl,F.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=xe.create("button","maplibregl-ctrl-terrain",this._container),xe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){xe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},F.TwoFingersTouchPitchHandler=Rs,F.TwoFingersTouchRotateHandler=Xc,F.TwoFingersTouchZoomHandler=Wo,F.TwoFingersTouchZoomRotateHandler=ui,F.VectorTileSource=Xa,F.VideoSource=Ia,F.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(ia(f))throw new Error(`A source type called "${f}" already exists.`);((n,l)=>{Ys[n]=l})(f,e)}),F.clearPrewarmedResources=function(){const f=We;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Xe),We=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},F.createTileMesh=gr,F.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},F.getRTLTextPluginStatus=function(){return Qa().getRTLTextPluginStatus()},F.getVersion=function(){return Jc},F.getWorkerCount=function(){return vt.workerCount},F.getWorkerUrl=function(){return d.a.WORKER_URL},F.importScriptInWorkers=function(f){return Yt().broadcast("IS",f)},F.prewarm=function(){kt().acquire(Xe)},F.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},F.setRTLTextPlugin=function(f,e){return Qa().setRTLTextPlugin(f,e)},F.setWorkerCount=function(f){vt.workerCount=f},F.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var li=Wt;return li})}(Zf)),Zf.exports}var Bp=Lp();const bp=Tp(Bp),Op="https://v2k-dev.vallarismaps.com/core/api/features/1.1/collections/658cd4f88a4811f10a47cea7/items?api_key=bLNytlxTHZINWGt1GIRQBUaIlqz9X45XykLD83UkzIoN6PFgqbH7M7EDbsdgKVwC";function Fp(){const[st,_n]=ff.useState(null),[Wt,Ce]=ff.useState([]);return ff.useEffect(()=>{fetch(Op).then(li=>li.json()).then(li=>{Ce(li.features)});const Ot=new bp.Map({container:"map",style:"https://demotiles.maplibre.org/style.json",center:[100.523186,13.736717],zoom:6});return _n(Ot),()=>Ot.remove()},[]),ff.useEffect(()=>{st&&Wt.length>0&&Wt.forEach(Ot=>{const[li,F]=Ot.geometry.coordinates;new bp.Marker().setLngLat([li,F]).addTo(st)})},[st,Wt]),lp.jsx("div",{id:"map",style:{width:"100vw",height:"100vh"}})}Rp.createRoot(document.getElementById("root")).render(lp.jsx(ff.StrictMode,{children:lp.jsx(Fp,{})}));
